<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HVAC Community Hub - LARK Labs</title>
    <meta name="description" content="Interactive community platform for HVAC professionals, students, and educators. Connect, share knowledge, and advance your career.">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2c3e50 100%);
            color: #ffffff;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: #2c3e50;
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid #34495e;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-content {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #3498db;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo img {
            height: 60px;
            width: auto;
            transition: all 0.3s ease;
        }

        .logo img:hover {
            transform: scale(1.05);
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        .nav-links a {
            color: #ffffff;
            text-decoration: none;
            transition: all 0.3s;
            padding: 8px 16px;
            border-radius: 25px;
            cursor: pointer;
        }

        .nav-links a:hover, .nav-links a.active {
            background: rgba(52, 152, 219, 0.2);
            color: #3498db;
        }

        /* Mobile menu toggle button - hidden by default */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: #ffffff;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 5px;
            transition: all 0.3s;
        }

        .mobile-menu-toggle:hover {
            background: rgba(52, 152, 219, 0.2);
            color: #3498db;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            white-space: nowrap;
            border: 0;
        }

        .user-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .auth-button {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            text-decoration: none;
            font-size: 0.9rem;
        }

        .auth-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .auth-button.secondary {
            background: transparent;
            border: 1px solid #3498db;
        }

        .user-menu {
            position: relative;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 20px;
            transition: all 0.3s;
        }

        .user-menu:hover {
            background: rgba(52, 152, 219, 0.1);
        }

        .user-avatar-small {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(45deg, #3498db, #2980b9);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        /* Main Layout */
        .main-layout {
            display: grid;
            grid-template-columns: 300px 1fr 280px;
            gap: 2rem;
            padding: 2rem 0;
            min-height: calc(100vh - 80px);
        }

        /* Sidebar */
        .sidebar {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 1.5rem;
            height: fit-content;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 100px;
        }

        .sidebar h3 {
            color: #3498db;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 12px 16px;
            margin-bottom: 0.5rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            color: #bdc3c7;
            text-decoration: none;
        }

        .nav-item:hover, .nav-item.active {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            transform: translateX(5px);
        }

        .nav-icon {
            font-size: 1.2rem;
            width: 20px;
            text-align: center;
        }

        .nav-badge {
            background: #e74c3c;
            color: white;
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 0.7rem;
            margin-left: auto;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }

        /* Blog Post Styles */
        .blog-post:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(52, 152, 219, 0.2);
            background: rgba(255, 255, 255, 0.12) !important;
        }

        .blog-featured:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(52, 152, 219, 0.3);
        }

        /* Main Content */
        .main-content {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .content-header {
            background: rgba(52, 152, 219, 0.1);
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .content-body {
            padding: 1.5rem;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
        }

        /* Right Sidebar */
        .right-sidebar {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .widget {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .widget h4 {
            color: #3498db;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        /* Post Creation */
        .post-creator {
            background: rgba(52, 152, 219, 0.08);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(52, 152, 219, 0.2);
        }

        .post-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 15px;
            color: white;
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
            min-height: 120px;
            transition: all 0.3s;
        }

        .post-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.3);
        }

        .post-input::placeholder {
            color: #bdc3c7;
        }

        .post-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
        }

        .media-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .media-button {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #bdc3c7;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .media-button:hover {
            background: rgba(52, 152, 219, 0.2);
            border-color: #3498db;
            color: #3498db;
        }

        .post-button {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .post-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .post-button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }

        /* Feed Posts */
        .feed-post {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
            overflow: hidden;
        }

        .feed-post:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(52, 152, 219, 0.3);
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem 1.5rem 0;
        }

        .post-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, #3498db, #2980b9);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: white;
        }

        .post-info {
            flex: 1;
        }

        .post-author {
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 0.2rem;
        }

        .post-meta {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: #95a5a6;
        }

        .user-badge {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 500;
        }

        .post-content {
            padding: 1rem 1.5rem;
            color: #ecf0f1;
            line-height: 1.7;
        }

        .post-media {
            margin: 1rem 0;
        }

        .post-image {
            width: 100%;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .post-image:hover {
            transform: scale(1.02);
        }

        .post-engagement {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .engagement-buttons {
            display: flex;
            gap: 1rem;
        }

        .engagement-button {
            background: none;
            border: none;
            color: #95a5a6;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 20px;
            transition: all 0.3s;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .engagement-button:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #3498db;
        }

        .engagement-button.liked {
            color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
        }

        /* Comments */
        .comments-section {
            padding: 0 1.5rem 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            background: rgba(0, 0, 0, 0.1);
        }

        .comment {
            display: flex;
            gap: 0.8rem;
            margin: 1rem 0;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .comment-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: bold;
            color: white;
            flex-shrink: 0;
        }

        .comment-content {
            flex: 1;
        }

        .comment-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .comment-author {
            font-weight: 600;
            color: #3498db;
            font-size: 0.9rem;
        }

        .comment-time {
            color: #95a5a6;
            font-size: 0.8rem;
        }

        .comment-text {
            color: #ecf0f1;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .comment-actions {
            margin-top: 0.5rem;
            display: flex;
            gap: 0.5rem;
        }

        .comment-button {
            background: none;
            border: none;
            color: #95a5a6;
            cursor: pointer;
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 12px;
            transition: all 0.3s;
        }

        .comment-button:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #3498db;
        }

        /* Comment Input */
        .comment-input-area {
            display: flex;
            gap: 0.8rem;
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
        }

        .comment-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 10px 15px;
            color: white;
            font-size: 0.9rem;
            resize: none;
            min-height: 40px;
            max-height: 120px;
        }

        .comment-input:focus {
            outline: none;
            border-color: #3498db;
        }

        .comment-submit {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 10px 16px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .comment-submit:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(39, 174, 96, 0.4);
        }

        /* Online Users Widget */
        .online-user {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 0.5rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            transition: all 0.3s;
            cursor: pointer;
        }

        .online-user:hover {
            background: rgba(52, 152, 219, 0.1);
        }

        .online-indicator {
            width: 8px;
            height: 8px;
            background: #27ae60;
            border-radius: 50%;
            position: absolute;
            bottom: 2px;
            right: 2px;
            border: 2px solid #1a1a1a;
        }

        /* Auth Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        }

        .modal {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            border-radius: 15px;
            padding: 2rem;
            width: 90%;
            max-width: 450px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal h3 {
            color: #3498db;
            margin-bottom: 1.5rem;
            text-align: center;
            font-size: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #3498db;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 12px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.3);
        }

        .form-input::placeholder {
            color: #bdc3c7;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .modal-button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .modal-button.primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }

        .modal-button.secondary {
            background: transparent;
            border: 1px solid #95a5a6;
            color: #95a5a6;
        }

        .modal-button:hover {
            transform: translateY(-2px);
        }

        /* Mobile Navigation */
        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: block;
            }

            .nav-links {
                position: fixed;
                top: 100%;
                left: 0;
                width: 100%;
                background: rgba(26, 26, 26, 0.98);
                backdrop-filter: blur(20px);
                border-top: 1px solid rgba(52, 152, 219, 0.3);
                flex-direction: column;
                gap: 0;
                padding: 1rem 0;
                transform: translateY(-100%);
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease-in-out;
                box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            }

            .nav-links.active {
                transform: translateY(0);
                opacity: 1;
                visibility: visible;
            }

            .nav-links li {
                width: 100%;
                text-align: center;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            .nav-links li:last-child {
                border-bottom: none;
            }

            .nav-links a {
                display: block;
                padding: 1rem 2rem;
                margin: 0;
                border-radius: 0;
                width: 100%;
                font-size: 1.1rem;
                transition: all 0.3s;
            }

            .nav-links a:hover, .nav-links a.active {
                background: rgba(52, 152, 219, 0.2);
                color: #3498db;
            }

            .nav-content {
                gap: 1rem;
            }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 250px 1fr 250px;
                gap: 1rem;
            }
        }

        @media (max-width: 992px) {
            .main-layout {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .sidebar, .right-sidebar {
                position: static;
                grid-row: 1;
            }

            .right-sidebar {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 1rem;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 10px;
            }

            .header-content {
                padding: 0 10px;
            }

            .logo {
                font-size: 1.5rem;
            }

            .user-actions {
                gap: 0.5rem;
            }

            .post-actions {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }

            .media-buttons {
                justify-content: center;
            }
        }

        /* Loading States */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            color: #95a5a6;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-top: 2px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 0.5rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Notification System */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 10001;
            transform: translateX(100%);
            transition: all 0.3s ease;
            max-width: 350px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .notification.success {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
        }

        .notification.error {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .notification.info {
            background: linear-gradient(45deg, #3498db, #2980b9);
        }

        .notification.show {
            transform: translateX(0);
        }

        /* Profile Section Styles */
        .profile-grid {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .profile-image-section {
            text-align: center;
        }

        .profile-image {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(45deg, #3498db, #2980b9);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: bold;
            color: white;
            margin: 0 auto 1rem;
            border: 4px solid rgba(52, 152, 219, 0.3);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .profile-image:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(52, 152, 219, 0.5);
        }

        .profile-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .upload-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
            cursor: pointer;
            border-radius: 50%;
        }

        .profile-image:hover .upload-overlay {
            opacity: 1;
        }

        .upload-text {
            color: white;
            font-size: 0.8rem;
            text-align: center;
            font-weight: 500;
        }

        #profilePhotoInput {
            display: none;
        }

        .profile-details h2 {
            color: #ffffff;
            margin-bottom: 0.5rem;
        }

        .profile-title {
            color: #3498db;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .profile-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .certification-badge {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .certification-badge.verified {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
        }

        /* Image Preview Modal */
        .image-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10002;
            backdrop-filter: blur(5px);
        }

        .image-modal img {
            max-width: 90%;
            max-height: 90%;
            border-radius: 8px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .image-modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
        }

        .image-modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Content Section Navigation */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* Online Users Styles */
        .online-user {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem;
            border-radius: 8px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .online-user:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .user-avatar-small {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #3498db, #2980b9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 0.85rem;
        }

        .online-indicator {
            position: absolute;
            bottom: -2px;
            right: -2px;
            width: 12px;
            height: 12px;
            background: #00c851;
            border: 2px solid #1a1a1a;
            border-radius: 50%;
            animation: pulse-online 2s infinite;
        }

        @keyframes pulse-online {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .online-status {
            font-size: 0.8rem;
            color: #95a5a6;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <nav class="container">
            <div class="logo">
                <img src="../assets/images/lark-labs-new-logo.png" width="80" height="80" alt="LARK Labs ‚Äî HVAC tools and resources" style="height: 80px; width: auto;">
            </div>

            <!-- Mobile menu toggle button -->
            <button class="mobile-menu-toggle" onclick="toggleMobileMenu()" aria-expanded="false" aria-controls="site-nav" aria-label="Open navigation">
                <span class="sr-only">Open navigation menu</span>
                ‚ò∞
            </button>

            <div class="nav-content">
                <ul class="nav-links" id="site-nav">
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="../index.html#tools">Tools</a></li>
                    <li><a href="../index.html#resources">Resources</a></li>
                    <li><a href="../code-compass.html">Code Compass</a></li>
                    <li><a href="../hvac-jack-50-landing.html">HVAC JACK 5.0</a></li>
                    <li><a href="community.html" class="active">Community</a></li>
                    <li><a href="../index.html#about">About</a></li>
                </ul>
                <div class="user-actions">
                    <div id="guestActions">
                        <button class="auth-button secondary" onclick="showAuthModal('login')">Login</button>
                        <button class="auth-button" onclick="showAuthModal('register')">Join Community</button>
                    </div>
                    <div id="userActions" style="display: none;">
                        <div class="user-menu" onclick="toggleUserMenu()">
                            <div class="user-avatar-small" id="headerAvatar">U</div>
                            <span id="headerUsername">User</span>
                            <span style="margin-left: 0.5rem;">‚ñº</span>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Layout -->
    <div class="container">
        <div class="main-layout">
            <!-- Left Sidebar Navigation -->
            <aside class="sidebar">
                <h3>üè† Navigation</h3>
                <nav>
                    <a href="#" class="nav-item active" onclick="showSection('blog')" data-section="blog">
                        <span class="nav-icon">üì∞</span>
                        <span>Industry News & Updates</span>
                        <span class="nav-badge">NEW</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showSection('feed')" data-section="feed">
                        <span class="nav-icon">üì±</span>
                        <span>Community Feed</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showSection('discussions')" data-section="discussions">
                        <span class="nav-icon">üí¨</span>
                        <span>Discussions</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showSection('chat')" data-section="chat">
                        <span class="nav-icon">üó®Ô∏è</span>
                        <span>Live Chat</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showSection('directory')" data-section="directory">
                        <span class="nav-icon">üë•</span>
                        <span>Professional Directory</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showSection('friends')" data-section="friends">
                        <span class="nav-icon">ü§ù</span>
                        <span>Friends & Contacts</span>
                        <span id="friendRequestBadge" style="background: #e74c3c; color: white; border-radius: 50%; padding: 2px 6px; font-size: 0.7rem; margin-left: auto; display: none;">0</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showSection('messages')" data-section="messages">
                        <span class="nav-icon">üíå</span>
                        <span>Messages</span>
                        <span id="messagesBadge" style="background: #3498db; color: white; border-radius: 50%; padding: 2px 6px; font-size: 0.7rem; margin-left: auto; display: none;">0</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showSection('groups')" data-section="groups">
                        <span class="nav-icon">üåê</span>
                        <span>Groups</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showSection('profile')" data-section="profile">
                        <span class="nav-icon">üë§</span>
                        <span>My Profile</span>
                    </a>
                </nav>

                <div style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                    <h4 style="color: #3498db; margin-bottom: 0.5rem; font-size: 1rem;">üìä Quick Stats</h4>
                    <div style="color: #95a5a6; font-size: 0.9rem;">
                        <div>üë• <span id="memberCount">247</span> members</div>
                        <div>üí¨ <span id="postCount">1,234</span> posts</div>
                        <div>üü¢ <span id="onlineCount">23</span> online</div>
                    </div>
                </div>
            </aside>

            <!-- Main Content Area -->
            <main class="main-content">
                <!-- Industry News & Updates Blog Section -->
                <section id="section-blog" class="content-section active">
                    <div class="content-header">
                        <h2 style="color: #ffffff; font-size: 1.5rem;">üì∞ Industry News & Updates</h2>
                        <p style="color: #bdc3c7; margin-top: 0.5rem;">Latest HVAC industry updates, promotions, and important announcements</p>
                    </div>
                    <div class="content-body">
                        <!-- Featured Blog Post -->
                        <div class="blog-featured" style="background: linear-gradient(135deg, #27ae60, #2ecc71); border-radius: 15px; padding: 2rem; margin-bottom: 2rem; position: relative; overflow: hidden;">
                            <div style="position: absolute; top: 1rem; right: 1rem; background: #f1c40f; color: #2c3e50; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">NEW GAME!</div>
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div style="background: rgba(255,255,255,0.2); border-radius: 50%; padding: 1rem; font-size: 2rem;">üéÆ</div>
                                <div>
                                    <h3 style="color: #ffffff; font-size: 1.4rem; margin-bottom: 0.5rem;">New HVAC Troubleshooting Simulator Game!</h3>
                                    <div style="color: #ecf0f1; font-size: 0.9rem; opacity: 0.9;">Published just now ‚Ä¢ by LARK Labs Team</div>
                                </div>
                            </div>
                            <p style="color: #ecf0f1; font-size: 1rem; line-height: 1.6; margin-bottom: 1.5rem;">
                                Test your HVAC diagnostic skills with our brand-new interactive troubleshooting simulator! Features realistic scenarios from residential furnaces to complex commercial systems. Compete with friends, track your scores, and climb the leaderboard. Completely free to play!
                            </p>
                            <div style="display: flex; gap: 1rem; align-items: center;">
                                <button onclick="window.open('../apps/hvac-troubleshooting-simulator/index.html', '_blank')" style="background: #ffffff; color: #27ae60; padding: 0.8rem 1.5rem; border: none; border-radius: 25px; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                                    üéÆ Play Game ‚Üí
                                </button>
                                <div style="color: #ecf0f1; font-size: 0.9rem;">
                                    üÜì <strong>Completely FREE</strong> - 3 Difficulty Levels
                                </div>
                            </div>
                        </div>

                        <!-- Blog Posts Grid -->
                        <div class="blog-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                            
                            <!-- Blog Post 1 -->
                            <div class="blog-post" style="background: rgba(255, 255, 255, 0.08); border-radius: 15px; padding: 1.5rem; border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.3s; cursor: pointer;" onclick="openBlogPost('tssa-updates-2025')">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                    <div style="background: linear-gradient(45deg, #e74c3c, #c0392b); border-radius: 50%; padding: 0.8rem; font-size: 1.2rem;">‚ö°</div>
                                    <div>
                                        <div style="color: #e74c3c; font-size: 0.8rem; font-weight: 600; margin-bottom: 0.3rem;">REGULATION UPDATE</div>
                                        <h4 style="color: #ffffff; font-size: 1.1rem; margin-bottom: 0.3rem;">TSSA 2025 Code Changes</h4>
                                        <div style="color: #95a5a6; font-size: 0.8rem;">Published 1 day ago</div>
                                    </div>
                                </div>
                                <p style="color: #bdc3c7; font-size: 0.9rem; line-height: 1.5; margin-bottom: 1rem;">
                                    Important updates to CSA B149.1-25 affecting gas appliance installations. New clearance requirements and safety protocols now in effect...
                                </p>
                                <div style="display: flex; align-items: center; justify-content: space-between;">
                                    <div style="color: #3498db; font-size: 0.8rem; font-weight: 500;">Read More ‚Üí</div>
                                    <div style="color: #95a5a6; font-size: 0.8rem;">üìñ 5 min read</div>
                                </div>
                            </div>

                            <!-- Blog Post 2 -->
                            <div class="blog-post" style="background: rgba(255, 255, 255, 0.08); border-radius: 15px; padding: 1.5rem; border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.3s; cursor: pointer;" onclick="openBlogPost('g3-exam-updates')">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                    <div style="background: linear-gradient(45deg, #27ae60, #2ecc71); border-radius: 50%; padding: 0.8rem; font-size: 1.2rem;">üéì</div>
                                    <div>
                                        <div style="color: #27ae60; font-size: 0.8rem; font-weight: 600; margin-bottom: 0.3rem;">RESOURCE NEWS</div>
                                        <h4 style="color: #ffffff; font-size: 1.1rem; margin-bottom: 0.3rem;">G3 Exam Format Updates</h4>
                                        <div style="color: #95a5a6; font-size: 0.8rem;">Published 3 days ago</div>
                                    </div>
                                </div>
                                <p style="color: #bdc3c7; font-size: 0.9rem; line-height: 1.5; margin-bottom: 1rem;">
                                    TSSA has announced changes to the G3 certification exam format. New practical assessment components and updated study materials available...
                                </p>
                                <div style="display: flex; align-items: center; justify-content: space-between;">
                                    <div style="color: #3498db; font-size: 0.8rem; font-weight: 500;">Read More ‚Üí</div>
                                    <div style="color: #95a5a6; font-size: 0.8rem;">üìñ 3 min read</div>
                                </div>
                            </div>

                            <!-- Blog Post 3 -->
                            <div class="blog-post" style="background: rgba(255, 255, 255, 0.08); border-radius: 15px; padding: 1.5rem; border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.3s; cursor: pointer;" onclick="openBlogPost('tool-promotion')">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                    <div style="background: linear-gradient(45deg, #f39c12, #e67e22); border-radius: 50%; padding: 0.8rem; font-size: 1.2rem;">üõ†Ô∏è</div>
                                    <div>
                                        <div style="color: #f39c12; font-size: 0.8rem; font-weight: 600; margin-bottom: 0.3rem;">PROMOTION</div>
                                        <h4 style="color: #ffffff; font-size: 1.1rem; margin-bottom: 0.3rem;">Free HVAC Pro Tools Access</h4>
                                        <div style="color: #95a5a6; font-size: 0.8rem;">Published 5 days ago</div>
                                    </div>
                                </div>
                                <p style="color: #bdc3c7; font-size: 0.9rem; line-height: 1.5; margin-bottom: 1rem;">
                                    Limited-time offer: Get free access to our premium HVAC calculation tools and unit converters. Perfect for field work and project planning...
                                </p>
                                <div style="display: flex; align-items: center; justify-content: space-between;">
                                    <div style="color: #3498db; font-size: 0.8rem; font-weight: 500;">Claim Offer ‚Üí</div>
                                    <div style="color: #95a5a6; font-size: 0.8rem;">üéÅ FREE</div>
                                </div>
                            </div>

                            <!-- Blog Post 4 -->
                            <div class="blog-post" style="background: rgba(255, 255, 255, 0.08); border-radius: 15px; padding: 1.5rem; border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.3s; cursor: pointer;" onclick="openBlogPost('industry-trends')">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                    <div style="background: linear-gradient(45deg, #9b59b6, #8e44ad); border-radius: 50%; padding: 0.8rem; font-size: 1.2rem;">üìä</div>
                                    <div>
                                        <div style="color: #9b59b6; font-size: 0.8rem; font-weight: 600; margin-bottom: 0.3rem;">INDUSTRY INSIGHTS</div>
                                        <h4 style="color: #ffffff; font-size: 1.1rem; margin-bottom: 0.3rem;">2025 HVAC Market Trends</h4>
                                        <div style="color: #95a5a6; font-size: 0.8rem;">Published 1 week ago</div>
                                    </div>
                                </div>
                                <p style="color: #bdc3c7; font-size: 0.9rem; line-height: 1.5; margin-bottom: 1rem;">
                                    Explore the latest trends shaping the HVAC industry in 2025. From smart technology integration to sustainable practices and workforce development...
                                </p>
                                <div style="display: flex; align-items: center; justify-content: space-between;">
                                    <div style="color: #3498db; font-size: 0.8rem; font-weight: 500;">Read More ‚Üí</div>
                                    <div style="color: #95a5a6; font-size: 0.8rem;">üìñ 8 min read</div>
                                </div>
                            </div>
                        </div>

                        <!-- Newsletter Signup -->
                        <div class="newsletter-signup" style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 2rem; text-align: center; border: 2px dashed rgba(255, 255, 255, 0.1);">
                            <div style="font-size: 2rem; margin-bottom: 1rem;">üìß</div>
                            <h3 style="color: #ffffff; margin-bottom: 0.5rem;">Stay Updated</h3>
                            <p style="color: #bdc3c7; margin-bottom: 1.5rem;">Subscribe to our newsletter for the latest HVAC industry news, resource updates, and exclusive promotions.</p>
                            <div style="display: flex; gap: 1rem; justify-content: center; align-items: center; flex-wrap: wrap;">
                                <input type="email" placeholder="Enter your email address" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 25px; padding: 0.8rem 1.2rem; color: #ffffff; min-width: 250px; outline: none;" id="newsletterEmail">
                                <button onclick="subscribeNewsletter()" style="background: linear-gradient(45deg, #3498db, #2980b9); color: white; padding: 0.8rem 1.5rem; border: none; border-radius: 25px; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                                    Subscribe
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Community Feed Section -->
                <section id="section-feed" class="content-section">
                    <div class="content-header">
                        <h2 style="color: #ffffff; font-size: 1.5rem;">üì± Community Feed</h2>
                        <p style="color: #bdc3c7; margin-top: 0.5rem;">Share knowledge, ask questions, and connect with HVAC professionals</p>
                    </div>
                    <div class="content-body">
                        <!-- Post Creator -->
                        <div class="post-creator">
                            <div style="display: flex; align-items: flex-start; gap: 1rem; margin-bottom: 1rem;">
                                <div class="post-avatar" id="postCreatorAvatar">U</div>
                                <textarea id="postContent" class="post-input" placeholder="What's on your mind? Share HVAC tips, ask questions, or tell us about your latest project..."></textarea>
                            </div>
                            <div class="post-actions">
                                <div class="media-buttons">
                                    <button class="media-button" onclick="triggerPhotoUpload()">üì∑ Photo</button>
                                    <button class="media-button" onclick="addCodeSnippet()">üìù Code/Specs</button>
                                    <button class="media-button" onclick="addLocation()">üìç Location</button>
                                </div>
                                <button class="post-button" onclick="createPost()" id="createPostBtn">Share Post</button>
                            </div>
                            <input type="file" id="photoUpload" accept="image/*" style="display: none;" onchange="handlePostPhotoUpload(this)">
                            <div id="photoPreview" style="display: none; margin-top: 1rem;"></div>
                        </div>

                        <!-- Feed Posts -->
                        <div id="feedPosts">
                            <!-- Sample Posts for Demo -->
                            <div class="feed-post" data-post-id="1">
                                <div class="post-header">
                                    <div class="post-avatar">MR</div>
                                    <div class="post-info">
                                        <div class="post-author">Mike Rodriguez</div>
                                        <div class="post-meta">
                                            <span class="user-badge">G2 Certified</span>
                                            <span>‚Ä¢</span>
                                            <span>2 hours ago</span>
                                            <span>‚Ä¢</span>
                                            <span>üìç Toronto, ON</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="post-content">
                                    Just finished a tricky heat pump installation in -15¬∞C weather. The key was pre-warming the refrigerant lines and using proper insulation techniques. Here's the unit running perfectly! üå°Ô∏è‚ùÑÔ∏è
                                </div>
                                <div class="post-engagement">
                                    <div class="engagement-buttons">
                                        <button class="engagement-button" onclick="togglePostLike(this)">
                                            <span>üëç</span> <span>Like (12)</span>
                                        </button>
                                        <button class="engagement-button" onclick="toggleComments(this)">
                                            <span>üí¨</span> <span>Comment (3)</span>
                                        </button>
                                        <button class="engagement-button" onclick="sharePost(1)">
                                            <span>üîó</span> <span>Share</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="comments-section" style="display: none;">
                                    <div class="comment">
                                        <div class="comment-avatar">SK</div>
                                        <div class="comment-content">
                                            <div class="comment-header">
                                                <span class="comment-author">Sarah Kim</span>
                                                <span class="comment-time">1 hour ago</span>
                                            </div>
                                            <div class="comment-text">Great tip! I've had issues with cold weather installs before. What type of insulation did you use?</div>
                                            <div class="comment-actions">
                                                <button class="comment-button" onclick="toggleCommentLike(this)">üëç 2</button>
                                                <button class="comment-button" onclick="replyToComment(this)">Reply</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="comment-input-area">
                                        <div class="comment-avatar">U</div>
                                        <input type="text" class="comment-input" placeholder="Write a comment...">
                                        <button class="comment-submit" onclick="postComment(this, 1)">Post</button>
                                    </div>
                                </div>
                            </div>

                            <div class="feed-post" data-post-id="2">
                                <div class="post-header">
                                    <div class="post-avatar">TW</div>
                                    <div class="post-info">
                                        <div class="post-author">Tom Wilson</div>
                                        <div class="post-meta">
                                            <span class="user-badge">Inspector</span>
                                            <span>‚Ä¢</span>
                                            <span>4 hours ago</span>
                                            <span>‚Ä¢</span>
                                            <span>üìç Calgary, AB</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="post-content">
                                    PSA: Reminder about the new CSA B149.1-25 amendments regarding appliance clearances. Make sure you're up to date! The changes affect residential installations. üìã‚ö†Ô∏è
                                </div>
                                <div class="post-engagement">
                                    <div class="engagement-buttons">
                                        <button class="engagement-button" onclick="togglePostLike(this)">
                                            <span>üëç</span> <span>Like (8)</span>
                                        </button>
                                        <button class="engagement-button" onclick="toggleComments(this)">
                                            <span>üí¨</span> <span>Comment (5)</span>
                                        </button>
                                        <button class="engagement-button" onclick="sharePost(2)">
                                            <span>üîó</span> <span>Share</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="comments-section" style="display: none;">
                                    <div class="comment-input-area">
                                        <div class="comment-avatar">U</div>
                                        <input type="text" class="comment-input" placeholder="Write a comment...">
                                        <button class="comment-submit" onclick="postComment(this, 2)">Post</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Other sections will be added here -->
                <section id="section-discussions" class="content-section">
                    <div class="content-header">
                        <h2 style="color: #ffffff; font-size: 1.5rem;">üí¨ Discussion Forums</h2>
                        <p style="color: #bdc3c7; margin-top: 0.5rem;">Organized discussions by topic</p>
                    </div>
                    <div class="content-body">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                            <!-- General Discussion -->
                            <div class="forum-category" style="background: rgba(52,152,219,0.1); border-radius: 15px; padding: 1.5rem; border: 1px solid rgba(52,152,219,0.2); cursor: pointer; transition: all 0.3s;" onclick="openForum('general')">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                    <div style="background: linear-gradient(45deg, #3498db, #2980b9); color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">üí¨</div>
                                    <div>
                                        <h3 style="color: #3498db; margin-bottom: 0.3rem;">General Discussion</h3>
                                        <div style="color: #95a5a6; font-size: 0.9rem;">24 topics ‚Ä¢ 156 posts</div>
                                    </div>
                                </div>
                                <div style="color: #ecf0f1; font-size: 0.9rem;">General HVAC discussions, industry news, and community chat</div>
                            </div>

                            <!-- Technical Support -->
                            <div class="forum-category" style="background: rgba(231,76,60,0.1); border-radius: 15px; padding: 1.5rem; border: 1px solid rgba(231,76,60,0.2); cursor: pointer; transition: all 0.3s;" onclick="openForum('technical')">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                    <div style="background: linear-gradient(45deg, #e74c3c, #c0392b); color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">üîß</div>
                                    <div>
                                        <h3 style="color: #e74c3c; margin-bottom: 0.3rem;">Technical Support</h3>
                                        <div style="color: #95a5a6; font-size: 0.9rem;">18 topics ‚Ä¢ 89 posts</div>
                                    </div>
                                </div>
                                <div style="color: #ecf0f1; font-size: 0.9rem;">Troubleshooting, repair help, and technical questions</div>
                            </div>

                            <!-- Certification & Resource -->
                            <div class="forum-category" style="background: rgba(39,174,96,0.1); border-radius: 15px; padding: 1.5rem; border: 1px solid rgba(39,174,96,0.2); cursor: pointer; transition: all 0.3s;" onclick="openForum('certification')">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                    <div style="background: linear-gradient(45deg, #27ae60, #2ecc71); color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">üéì</div>
                                    <div>
                                        <h3 style="color: #27ae60; margin-bottom: 0.3rem;">Certification & Resource</h3>
                                        <div style="color: #95a5a6; font-size: 0.9rem;">12 topics ‚Ä¢ 67 posts</div>
                                    </div>
                                </div>
                                <div style="color: #ecf0f1; font-size: 0.9rem;">G1, G2, G3 certification, exam prep, and resources resources</div>
                            </div>

                            <!-- Tools & Equipment -->
                            <div class="forum-category" style="background: rgba(243,156,18,0.1); border-radius: 15px; padding: 1.5rem; border: 1px solid rgba(243,156,18,0.2); cursor: pointer; transition: all 0.3s;" onclick="openForum('tools')">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                    <div style="background: linear-gradient(45deg, #f39c12, #e67e22); color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">üî®</div>
                                    <div>
                                        <h3 style="color: #f39c12; margin-bottom: 0.3rem;">Tools & Equipment</h3>
                                        <div style="color: #95a5a6; font-size: 0.9rem;">15 topics ‚Ä¢ 92 posts</div>
                                    </div>
                                </div>
                                <div style="color: #ecf0f1; font-size: 0.9rem;">Tool recommendations, equipment reviews, and purchasing advice</div>
                            </div>

                            <!-- Code & Regulations -->
                            <div class="forum-category" style="background: rgba(155,89,182,0.1); border-radius: 15px; padding: 1.5rem; border: 1px solid rgba(155,89,182,0.2); cursor: pointer; transition: all 0.3s;" onclick="openForum('codes')">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                    <div style="background: linear-gradient(45deg, #9b59b6, #8e44ad); color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">üìã</div>
                                    <div>
                                        <h3 style="color: #9b59b6; margin-bottom: 0.3rem;">Code & Regulations</h3>
                                        <div style="color: #95a5a6; font-size: 0.9rem;">9 topics ‚Ä¢ 45 posts</div>
                                    </div>
                                </div>
                                <div style="color: #ecf0f1; font-size: 0.9rem;">CSA B149.1, TSSA regulations, and compliance discussions</div>
                            </div>

                            <!-- Career & Business -->
                            <div class="forum-category" style="background: rgba(52,73,94,0.1); border-radius: 15px; padding: 1.5rem; border: 1px solid rgba(52,73,94,0.2); cursor: pointer; transition: all 0.3s;" onclick="openForum('career')">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                    <div style="background: linear-gradient(45deg, #34495e, #2c3e50); color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">üíº</div>
                                    <div>
                                        <h3 style="color: #95a5a6; margin-bottom: 0.3rem;">Career & Business</h3>
                                        <div style="color: #95a5a6; font-size: 0.9rem;">8 topics ‚Ä¢ 34 posts</div>
                                    </div>
                                </div>
                                <div style="color: #ecf0f1; font-size: 0.9rem;">Career advice, business tips, and job opportunities</div>
                            </div>
                        </div>

                        <!-- Recent Forum Activity -->
                        <div style="background: rgba(255,255,255,0.05); border-radius: 15px; padding: 1.5rem; border: 1px solid rgba(255,255,255,0.1);">
                            <h3 style="color: #3498db; margin-bottom: 1rem;">üî• Recent Activity</h3>
                            <div style="display: flex; flex-direction: column; gap: 1rem;">
                                <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(255,255,255,0.03); border-radius: 8px;">
                                    <div class="comment-avatar" style="background: linear-gradient(45deg, #27ae60, #2ecc71); flex-shrink: 0;">MR</div>
                                    <div style="flex: 1;">
                                        <div style="color: #27ae60; font-weight: bold; font-size: 0.9rem;">Mike Rodriguez</div>
                                        <div style="color: #ecf0f1; font-size: 0.9rem;">Started a discussion about R-32 refrigerant best practices</div>
                                        <div style="color: #95a5a6; font-size: 0.8rem;">in Technical Support ‚Ä¢ 2 hours ago</div>
                                    </div>
                                    <button onclick="openForum('technical')" style="background: linear-gradient(45deg, #e74c3c, #c0392b); color: white; border: none; border-radius: 20px; padding: 8px 16px; cursor: pointer; font-size: 0.85rem;">View</button>
                                </div>
                                
                                <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(255,255,255,0.03); border-radius: 8px;">
                                    <div class="comment-avatar" style="background: linear-gradient(45deg, #3498db, #2980b9); flex-shrink: 0;">SK</div>
                                    <div style="flex: 1;">
                                        <div style="color: #3498db; font-weight: bold; font-size: 0.9rem;">Sarah Kim</div>
                                        <div style="color: #ecf0f1; font-size: 0.9rem;">Posted G2 exam study tips and resources</div>
                                        <div style="color: #95a5a6; font-size: 0.8rem;">in Certification & Resource ‚Ä¢ 4 hours ago</div>
                                    </div>
                                    <button onclick="openForum('certification')" style="background: linear-gradient(45deg, #27ae60, #2ecc71); color: white; border: none; border-radius: 20px; padding: 8px 16px; cursor: pointer; font-size: 0.85rem;">View</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="section-chat" class="content-section">
                    <div class="content-header">
                        <h2 style="color: #ffffff; font-size: 1.5rem;">üó®Ô∏è Live Chat</h2>
                        <p style="color: #bdc3c7; margin-top: 0.5rem;">Real-time conversations with HVAC professionals</p>
                    </div>
                    <div class="content-body">
                        <div id="chatMessages" style="height: 400px; overflow-y: auto; background: rgba(255,255,255,0.05); border-radius: 10px; padding: 1rem; margin-bottom: 1rem; border: 1px solid rgba(255,255,255,0.1);">
                            <!-- Welcome message -->
                            <div style="text-align: center; color: #95a5a6; padding: 2rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <h4 style="color: #3498db; margin-bottom: 1rem;">üí¨ Welcome to HVAC Live Chat</h4>
                                <p>Connect with fellow HVAC professionals, ask questions, and share your expertise!</p>
                            </div>
                            <!-- Sample messages for demo -->
                            <div class="chat-message" style="display: flex; gap: 0.8rem; margin: 1rem 0; padding: 0.8rem; background: rgba(255,255,255,0.03); border-radius: 8px;">
                                <div class="comment-avatar" style="background: linear-gradient(45deg, #27ae60, #2ecc71);">MR</div>
                                <div style="flex: 1;">
                                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.3rem;">
                                        <span style="color: #27ae60; font-weight: bold; font-size: 0.9rem;">Mike Rodriguez</span>
                                        <span style="color: #95a5a6; font-size: 0.8rem;">2:34 PM</span>
                                    </div>
                                    <div style="color: #ecf0f1; font-size: 0.95rem;">Anyone have experience with the new R-32 refrigerant? Switching over some systems this week.</div>
                                </div>
                            </div>
                            <div class="chat-message" style="display: flex; gap: 0.8rem; margin: 1rem 0; padding: 0.8rem; background: rgba(255,255,255,0.03); border-radius: 8px;">
                                <div class="comment-avatar" style="background: linear-gradient(45deg, #3498db, #2980b9);">SK</div>
                                <div style="flex: 1;">
                                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.3rem;">
                                        <span style="color: #3498db; font-weight: bold; font-size: 0.9rem;">Sarah Kim</span>
                                        <span style="color: #95a5a6; font-size: 0.8rem;">2:36 PM</span>
                                    </div>
                                    <div style="color: #ecf0f1; font-size: 0.95rem;">@Mike R-32 is great! Lower GWP than R-410A. Make sure your gauges are compatible and watch the pressure differentials.</div>
                                </div>
                            </div>
                        </div>
                        <div id="chatInput" style="display: flex; gap: 0.8rem; background: rgba(255,255,255,0.05); border-radius: 10px; padding: 1rem; border: 1px solid rgba(255,255,255,0.1);">
                            <div class="comment-avatar" id="chatUserAvatar">${currentUser ? (currentUser.profilePhoto ? `<img src="${currentUser.profilePhoto}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">` : getInitials(currentUser.name)) : 'U'}</div>
                            <input type="text" id="chatMessageInput" placeholder="Type your message..." style="flex: 1; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 20px; padding: 10px 15px; color: white; font-size: 0.95rem;">
                            <button onclick="sendChatMessage()" id="chatSendBtn" style="background: linear-gradient(45deg, #3498db, #2980b9); color: white; border: none; border-radius: 20px; padding: 10px 20px; cursor: pointer; font-weight: 500; transition: all 0.3s;">Send</button>
                        </div>
                        <div style="text-align: center; color: #95a5a6; font-size: 0.85rem; margin-top: 0.5rem;">
                            üí° Tip: Press Enter to send messages quickly
                        </div>
                    </div>
                </section>

                <section id="section-directory" class="content-section">
                    <div class="content-header">
                        <h2 style="color: #ffffff; font-size: 1.5rem;">üë• Professional Directory</h2>
                        <p style="color: #bdc3c7; margin-top: 0.5rem;">Connect with HVAC professionals across Canada</p>
                    </div>
                    <div class="content-body">
                        <div style="margin-bottom: 1.5rem;">
                            <input type="text" id="directorySearch" placeholder="Search by name, location, or certification..." style="width: 100%; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 25px; padding: 12px 20px; color: white; font-size: 1rem;">
                        </div>
                        
                        <div id="directoryProfiles" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem;">
                            <!-- Sample profiles for demo -->
                            <div class="profile-card" style="background: rgba(255,255,255,0.08); border-radius: 15px; padding: 1.5rem; border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s;">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                    <div class="post-avatar" style="background: linear-gradient(45deg, #27ae60, #2ecc71);">MR</div>
                                    <div style="flex: 1;">
                                        <div style="color: #ffffff; font-weight: bold;">Mike Rodriguez</div>
                                        <div style="color: #27ae60; font-size: 0.9rem;">G2 Certified Technician</div>
                                    </div>
                                </div>
                                <div style="color: #bdc3c7; margin-bottom: 1rem;">üìç Toronto, ON</div>
                                <div style="color: #ecf0f1; font-size: 0.9rem; margin-bottom: 1rem;">15+ years experience in residential and commercial HVAC systems. Specializing in heat pump installations and energy efficiency upgrades.</div>
                                <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1rem;">
                                    <span style="background: linear-gradient(45deg, #27ae60, #2ecc71); color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">G2 Certified</span>
                                    <span style="background: linear-gradient(45deg, #f39c12, #e67e22); color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">Heat Pump Specialist</span>
                                </div>
                                <div style="display: flex; gap: 0.5rem;">
                                    <button onclick="sendFriendRequest('mike-rodriguez')" style="background: linear-gradient(45deg, #3498db, #2980b9); color: white; border: none; border-radius: 20px; padding: 8px 16px; cursor: pointer; flex: 1; font-size: 0.9rem;">Add Friend</button>
                                    <button onclick="viewProfile('mike-rodriguez')" style="background: rgba(255,255,255,0.1); color: #bdc3c7; border: 1px solid rgba(255,255,255,0.2); border-radius: 20px; padding: 8px 16px; cursor: pointer; font-size: 0.9rem;">View Profile</button>
                                </div>
                            </div>

                            <div class="profile-card" style="background: rgba(255,255,255,0.08); border-radius: 15px; padding: 1.5rem; border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s;">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                    <div class="post-avatar" style="background: linear-gradient(45deg, #3498db, #2980b9);">SK</div>
                                    <div style="flex: 1;">
                                        <div style="color: #ffffff; font-weight: bold;">Sarah Kim</div>
                                        <div style="color: #3498db; font-size: 0.9rem;">HVAC Engineering Student</div>
                                    </div>
                                </div>
                                <div style="color: #bdc3c7; margin-bottom: 1rem;">üìç Vancouver, BC</div>
                                <div style="color: #ecf0f1; font-size: 0.9rem; margin-bottom: 1rem;">Final year HVAC engineering student looking to connect with industry professionals and learn about the latest technologies in the field.</div>
                                <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1rem;">
                                    <span style="background: linear-gradient(45deg, #3498db, #2980b9); color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">Student</span>
                                    <span style="background: linear-gradient(45deg, #9b59b6, #8e44ad); color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">Looking to Learn</span>
                                </div>
                                <div style="display: flex; gap: 0.5rem;">
                                    <button onclick="sendFriendRequest('sarah-kim')" style="background: linear-gradient(45deg, #3498db, #2980b9); color: white; border: none; border-radius: 20px; padding: 8px 16px; cursor: pointer; flex: 1; font-size: 0.9rem;">Add Friend</button>
                                    <button onclick="viewProfile('sarah-kim')" style="background: rgba(255,255,255,0.1); color: #bdc3c7; border: 1px solid rgba(255,255,255,0.2); border-radius: 20px; padding: 8px 16px; cursor: pointer; font-size: 0.9rem;">View Profile</button>
                                </div>
                            </div>

                            <div class="profile-card" style="background: rgba(255,255,255,0.08); border-radius: 15px; padding: 1.5rem; border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s;">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                    <div class="post-avatar" style="background: linear-gradient(45deg, #e67e22, #d35400);">TW</div>
                                    <div style="flex: 1;">
                                        <div style="color: #ffffff; font-weight: bold;">Tom Wilson</div>
                                        <div style="color: #e67e22; font-size: 0.9rem;">TSSA Inspector</div>
                                    </div>
                                </div>
                                <div style="color: #bdc3c7; margin-bottom: 1rem;">üìç Calgary, AB</div>
                                <div style="color: #ecf0f1; font-size: 0.9rem; margin-bottom: 1rem;">Certified TSSA inspector with 20+ years in the industry. Available for consulting on code compliance and safety protocols.</div>
                                <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1rem;">
                                    <span style="background: linear-gradient(45deg, #e67e22, #d35400); color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">TSSA Inspector</span>
                                    <span style="background: linear-gradient(45deg, #e74c3c, #c0392b); color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">Safety Expert</span>
                                </div>
                                <div style="display: flex; gap: 0.5rem;">
                                    <button onclick="sendFriendRequest('tom-wilson')" style="background: linear-gradient(45deg, #3498db, #2980b9); color: white; border: none; border-radius: 20px; padding: 8px 16px; cursor: pointer; flex: 1; font-size: 0.9rem;">Add Friend</button>
                                    <button onclick="viewProfile('tom-wilson')" style="background: rgba(255,255,255,0.1); color: #bdc3c7; border: 1px solid rgba(255,255,255,0.2); border-radius: 20px; padding: 8px 16px; cursor: pointer; font-size: 0.9rem;">View Profile</button>
                                </div>
                            </div>

                            <!-- Add current user to directory if logged in -->
                            <div id="currentUserProfile" style="display: none;" class="profile-card">
                                <!-- Will be populated by JavaScript -->
                            </div>
                        </div>

                        <div style="text-align: center; margin-top: 2rem; padding: 2rem; background: rgba(52,152,219,0.08); border-radius: 10px; border: 1px solid rgba(52,152,219,0.2);">
                            <h4 style="color: #3498db; margin-bottom: 1rem;">üìã Join the Directory</h4>
                            <p style="color: #bdc3c7; margin-bottom: 1.5rem;">Create your profile to connect with other HVAC professionals and showcase your expertise.</p>
                            <button onclick="showDirectorySignup()" style="background: linear-gradient(45deg, #3498db, #2980b9); color: white; border: none; border-radius: 25px; padding: 12px 24px; cursor: pointer; font-weight: 600;">Create Your Profile</button>
                        </div>
                    </div>
                </section>

                <!-- Friends & Contacts Section -->
                <section id="section-friends" class="content-section">
                    <div class="content-header">
                        <h2 style="color: #ffffff; font-size: 1.5rem;">ü§ù Friends & Contacts</h2>
                        <p style="color: #bdc3c7; margin-top: 0.5rem;">Manage your professional network</p>
                    </div>
                    <div class="content-body">
                        <!-- Friends Navigation Tabs -->
                        <div style="display: flex; gap: 1rem; margin-bottom: 2rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 1rem;">
                            <button id="friendsTab" class="tab-button active" onclick="showFriendsTab('friends')" style="background: linear-gradient(45deg, #3498db, #2980b9); color: white; border: none; border-radius: 20px; padding: 8px 16px; cursor: pointer; transition: all 0.3s;">My Friends</button>
                            <button id="requestsTab" class="tab-button" onclick="showFriendsTab('requests')" style="background: rgba(255,255,255,0.1); color: #bdc3c7; border: none; border-radius: 20px; padding: 8px 16px; cursor: pointer; transition: all 0.3s;">Friend Requests</button>
                            <button id="suggestionsTab" class="tab-button" onclick="showFriendsTab('suggestions')" style="background: rgba(255,255,255,0.1); color: #bdc3c7; border: none; border-radius: 20px; padding: 8px 16px; cursor: pointer; transition: all 0.3s;">Suggestions</button>
                        </div>

                        <!-- My Friends Tab -->
                        <div id="friends-tab" class="friends-content active">
                            <div style="margin-bottom: 1rem;">
                                <input type="text" id="friendsSearch" placeholder="Search your friends..." style="width: 100%; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 25px; padding: 12px 20px; color: white; font-size: 1rem;">
                            </div>
                            <div id="friendsList">
                                <div style="text-align: center; padding: 3rem; color: #95a5a6;">
                                    <h3>No friends yet!</h3>
                                    <p>Start connecting with HVAC professionals by sending friend requests.</p>
                                    <button onclick="showSection('directory')" style="background: linear-gradient(45deg, #3498db, #2980b9); color: white; border: none; border-radius: 25px; padding: 12px 24px; cursor: pointer; margin-top: 1rem;">Browse Directory</button>
                                </div>
                            </div>
                        </div>

                        <!-- Friend Requests Tab -->
                        <div id="requests-tab" class="friends-content" style="display: none;">
                            <div id="friendRequests">
                                <div style="text-align: center; padding: 3rem; color: #95a5a6;">
                                    <h3>No friend requests</h3>
                                    <p>When someone sends you a friend request, it will appear here.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Suggestions Tab -->
                        <div id="suggestions-tab" class="friends-content" style="display: none;">
                            <div id="friendSuggestions">
                                <!-- Sample suggestions -->
                                <div class="suggestion-card" style="background: rgba(255,255,255,0.08); border-radius: 15px; padding: 1.5rem; margin-bottom: 1rem; border: 1px solid rgba(255,255,255,0.1);">
                                    <div style="display: flex; align-items: center; gap: 1rem;">
                                        <div class="post-avatar" style="background: linear-gradient(45deg, #27ae60, #2ecc71);">MR</div>
                                        <div style="flex: 1;">
                                            <div style="color: #ffffff; font-weight: bold;">Mike Rodriguez</div>
                                            <div style="color: #27ae60; font-size: 0.9rem;">G2 Certified Technician ‚Ä¢ Toronto, ON</div>
                                            <div style="color: #95a5a6; font-size: 0.8rem;">2 mutual connections</div>
                                        </div>
                                        <button onclick="sendFriendRequest('mike-rodriguez')" style="background: linear-gradient(45deg, #3498db, #2980b9); color: white; border: none; border-radius: 20px; padding: 8px 16px; cursor: pointer;">Add Friend</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Messages Section -->
                <section id="section-messages" class="content-section">
                    <div class="content-header">
                        <h2 style="color: #ffffff; font-size: 1.5rem;">üíå Messages</h2>
                        <p style="color: #bdc3c7; margin-top: 0.5rem;">Private conversations with your network</p>
                    </div>
                    <div class="content-body">
                        <div style="display: grid; grid-template-columns: 300px 1fr; gap: 1rem; height: 500px;">
                            <!-- Conversations List -->
                            <div style="background: rgba(255,255,255,0.05); border-radius: 15px; padding: 1rem; border: 1px solid rgba(255,255,255,0.1); overflow-y: auto;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                    <h4 style="color: #3498db;">Conversations</h4>
                                    <button onclick="startNewConversation()" style="background: linear-gradient(45deg, #3498db, #2980b9); color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; font-size: 0.9rem;">+</button>
                                </div>
                                <div id="conversationsList">
                                    <div style="text-align: center; padding: 2rem; color: #95a5a6;">
                                        <p>No conversations yet.</p>
                                        <p style="font-size: 0.9rem; margin-top: 0.5rem;">Start chatting with your friends!</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Message Area -->
                            <div style="background: rgba(255,255,255,0.05); border-radius: 15px; padding: 1rem; border: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column;">
                                <div id="messageHeader" style="padding-bottom: 1rem; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 1rem; display: none;">
                                    <div style="display: flex; align-items: center; gap: 1rem;">
                                        <div class="comment-avatar">U</div>
                                        <div>
                                            <div style="color: #ffffff; font-weight: bold;">Select a conversation</div>
                                            <div style="color: #95a5a6; font-size: 0.9rem;">Choose someone to message</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="messagesArea" style="flex: 1; overflow-y: auto; margin-bottom: 1rem;">
                                    <div style="text-align: center; padding: 3rem; color: #95a5a6;">
                                        <h3>üíå Welcome to Messages</h3>
                                        <p>Select a conversation to start chatting, or start a new one with your friends.</p>
                                    </div>
                                </div>
                                
                                <div id="messageInput" style="display: none;">
                                    <div style="display: flex; gap: 0.8rem;">
                                        <input type="text" id="privateMessageInput" placeholder="Type a message..." style="flex: 1; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 20px; padding: 10px 15px; color: white;">
                                        <button onclick="sendPrivateMessage()" style="background: linear-gradient(45deg, #3498db, #2980b9); color: white; border: none; border-radius: 20px; padding: 10px 20px; cursor: pointer;">Send</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Groups Section -->
                <section id="section-groups" class="content-section">
                    <div class="content-header">
                        <h2 style="color: #ffffff; font-size: 1.5rem;">üåê Groups</h2>
                        <p style="color: #bdc3c7; margin-top: 0.5rem;">Join and create professional groups</p>
                    </div>
                    <div class="content-body">
                        <!-- Groups Navigation -->
                        <div style="display: flex; gap: 1rem; margin-bottom: 2rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 1rem;">
                            <button id="myGroupsTab" class="tab-button active" onclick="showGroupsTab('mygroups')" style="background: linear-gradient(45deg, #3498db, #2980b9); color: white; border: none; border-radius: 20px; padding: 8px 16px; cursor: pointer;">My Groups</button>
                            <button id="discoverTab" class="tab-button" onclick="showGroupsTab('discover')" style="background: rgba(255,255,255,0.1); color: #bdc3c7; border: none; border-radius: 20px; padding: 8px 16px; cursor: pointer;">Discover</button>
                            <button onclick="createNewGroup()" style="background: linear-gradient(45deg, #27ae60, #2ecc71); color: white; border: none; border-radius: 20px; padding: 8px 16px; cursor: pointer;">+ Create Group</button>
                        </div>

                        <!-- My Groups Tab -->
                        <div id="mygroups-tab" class="groups-content active">
                            <div id="myGroupsList">
                                <div style="text-align: center; padding: 3rem; color: #95a5a6;">
                                    <h3>No groups yet!</h3>
                                    <p>Join professional groups to connect with like-minded HVAC professionals.</p>
                                    <button onclick="showGroupsTab('discover')" style="background: linear-gradient(45deg, #3498db, #2980b9); color: white; border: none; border-radius: 25px; padding: 12px 24px; cursor: pointer; margin-top: 1rem;">Discover Groups</button>
                                </div>
                            </div>
                        </div>

                        <!-- Discover Groups Tab -->
                        <div id="discover-tab" class="groups-content" style="display: none;">
                            <div style="margin-bottom: 1rem;">
                                <input type="text" id="groupsSearch" placeholder="Search groups..." style="width: 100%; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 25px; padding: 12px 20px; color: white; font-size: 1rem;">
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem;">
                                <!-- Sample Groups -->
                                <div class="group-card" style="background: rgba(52,152,219,0.1); border-radius: 15px; padding: 1.5rem; border: 1px solid rgba(52,152,219,0.2); transition: all 0.3s;">
                                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                        <div style="background: linear-gradient(45deg, #3498db, #2980b9); color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">üîß</div>
                                        <div>
                                            <h4 style="color: #3498db; margin-bottom: 0.3rem;">HVAC Troubleshooting Masters</h4>
                                            <div style="color: #95a5a6; font-size: 0.9rem;">1,234 members ‚Ä¢ Public</div>
                                        </div>
                                    </div>
                                    <div style="color: #ecf0f1; font-size: 0.9rem; margin-bottom: 1rem;">Share troubleshooting tips, complex repair solutions, and learn from experienced technicians.</div>
                                    <button onclick="joinGroup('hvac-troubleshooting')" style="background: linear-gradient(45deg, #3498db, #2980b9); color: white; border: none; border-radius: 20px; padding: 8px 16px; cursor: pointer; width: 100%;">Join Group</button>
                                </div>

                                <div class="group-card" style="background: rgba(39,174,96,0.1); border-radius: 15px; padding: 1.5rem; border: 1px solid rgba(39,174,96,0.2); transition: all 0.3s;">
                                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                        <div style="background: linear-gradient(45deg, #27ae60, #2ecc71); color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">üéì</div>
                                        <div>
                                            <h4 style="color: #27ae60; margin-bottom: 0.3rem;">G2 Exam Study Group</h4>
                                            <div style="color: #95a5a6; font-size: 0.9rem;">456 members ‚Ä¢ Public</div>
                                        </div>
                                    </div>
                                    <div style="color: #ecf0f1; font-size: 0.9rem; margin-bottom: 1rem;">Study together, share resources, and support each other through G2 certification.</div>
                                    <button onclick="joinGroup('g2-study-group')" style="background: linear-gradient(45deg, #27ae60, #2ecc71); color: white; border: none; border-radius: 20px; padding: 8px 16px; cursor: pointer; width: 100%;">Join Group</button>
                                </div>

                                <div class="group-card" style="background: rgba(243,156,18,0.1); border-radius: 15px; padding: 1.5rem; border: 1px solid rgba(243,156,18,0.2); transition: all 0.3s;">
                                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                        <div style="background: linear-gradient(45deg, #f39c12, #e67e22); color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">üíº</div>
                                        <div>
                                            <h4 style="color: #f39c12; margin-bottom: 0.3rem;">HVAC Business Owners</h4>
                                            <div style="color: #95a5a6; font-size: 0.9rem;">189 members ‚Ä¢ Private</div>
                                        </div>
                                    </div>
                                    <div style="color: #ecf0f1; font-size: 0.9rem; margin-bottom: 1rem;">Network with fellow business owners, share business strategies and industry insights.</div>
                                    <button onclick="requestGroupAccess('business-owners')" style="background: linear-gradient(45deg, #f39c12, #e67e22); color: white; border: none; border-radius: 20px; padding: 8px 16px; cursor: pointer; width: 100%;">Request Access</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="section-profile" class="content-section">
                    <div class="content-header">
                        <h2 style="color: #ffffff; font-size: 1.5rem;">üë§ My Profile</h2>
                        <p style="color: #bdc3c7; margin-top: 0.5rem;">Manage your professional profile</p>
                    </div>
                    <div class="content-body">
                        <div id="profileContent">
                            <div style="text-align: center; padding: 2rem; color: #95a5a6;">
                                <h3>Welcome to LARK Labs Community!</h3>
                                <p style="margin: 1rem 0;">Please login or register to access your profile and start connecting with HVAC professionals.</p>
                                <button class="auth-button" onclick="showAuthModal('register')">Join the Community</button>
                            </div>
                        </div>
                    </div>
                </section>
            </main>

            <!-- Right Sidebar -->
            <aside class="right-sidebar">
                <!-- Online Users Widget -->
                <div class="widget">
                    <h4>üü¢ Online Now</h4>
                    <div id="onlineUsers">
                        <!-- Online users will be populated dynamically -->
                    </div>
                </div>

                <!-- Popular Topics Widget -->
                <div class="widget">
                    <h4>üî• Trending Topics</h4>
                    <div style="color: #ecf0f1; font-size: 0.9rem;">
                        <div style="padding: 0.5rem 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                            <span style="color: #3498db;">#</span> Heat pump efficiency
                        </div>
                        <div style="padding: 0.5rem 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                            <span style="color: #3498db;">#</span> CSA code updates
                        </div>
                        <div style="padding: 0.5rem 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                            <span style="color: #3498db;">#</span> G2 exam prep
                        </div>
                        <div style="padding: 0.5rem 0;">
                            <span style="color: #3498db;">#</span> Refrigerant transition
                        </div>
                    </div>
                </div>

                <!-- LARK Labs Tools Widget -->
                <div class="widget">
                    <h4>üõ†Ô∏è Quick Tools</h4>
                    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                        <a href="../../apps/calculators/superheat-subcooling-calculator.html" target="_blank" 
                           style="color: #3498db; text-decoration: none; padding: 8px; border-radius: 5px; transition: all 0.3s;">
                            üå°Ô∏è Superheat Calculator
                        </a>
                        <a href="../../apps/tools/pt-chart-generator.html" target="_blank" 
                           style="color: #3498db; text-decoration: none; padding: 8px; border-radius: 5px; transition: all 0.3s;">
                            üìä P-T Charts
                        </a>
                        <a href="https://codecompassapp.netlify.app/" target="_blank" 
                           style="color: #3498db; text-decoration: none; padding: 8px; border-radius: 5px; transition: all 0.3s;">
                            üß≠ Code Compass (Free + 7-Day Trial)
                        </a>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Authentication Modal -->
    <div id="authModal" class="modal-overlay">
        <div class="modal">
            <h3 id="authModalTitle">Join the HVAC Community</h3>
            <form id="authForm">
                <div class="form-group">
                    <label for="authEmail">Email Address</label>
                    <input type="email" id="authEmail" class="form-input" placeholder="your.email@example.com" required>
                </div>
                <div class="form-group">
                    <label for="authPassword">Password</label>
                    <input type="password" id="authPassword" class="form-input" placeholder="Enter your password" required>
                </div>
                <div id="registerFields" style="display: none;">
                    <div class="form-group">
                        <label for="authName">Full Name</label>
                        <input type="text" id="authName" class="form-input" placeholder="Your full name">
                    </div>
                    <div class="form-group">
                        <label for="authTitle">Professional Title</label>
                        <input type="text" id="authTitle" class="form-input" placeholder="e.g., HVAC Technician, Student">
                    </div>
                    <div class="form-group">
                        <label for="authLocation">Location</label>
                        <input type="text" id="authLocation" class="form-input" placeholder="City, Province">
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="modal-button secondary" onclick="closeAuthModal()">Cancel</button>
                    <button type="submit" class="modal-button primary" id="authSubmitBtn">Join Community</button>
                </div>
            </form>
            <div style="text-align: center; margin-top: 1rem;">
                <a href="#" id="authToggleLink" onclick="toggleAuthMode()" style="color: #3498db; text-decoration: none;">
                    Already have an account? Login here
                </a>
            </div>
        </div>
    </div>

    <!-- Image Preview Modal -->
    <div id="imageModal" class="image-modal" onclick="closeImageModal()">
        <button class="image-modal-close" onclick="closeImageModal()">√ó</button>
        <img id="modalImage" src="" alt="Preview">
    </div>

    <script>
        // Mobile menu functionality
        function toggleMobileMenu() {
            const navLinks = document.getElementById('site-nav');
            const menuToggle = document.querySelector('.mobile-menu-toggle');
            const isExpanded = navLinks.classList.contains('active');

            navLinks.classList.toggle('active');
            menuToggle.setAttribute('aria-expanded', !isExpanded);

            // Update screen reader text
            const srText = menuToggle.querySelector('.sr-only');
            srText.textContent = isExpanded ? 'Open navigation menu' : 'Close navigation menu';
        }

        function closeMobileMenu() {
            const navLinks = document.getElementById('site-nav');
            const menuToggle = document.querySelector('.mobile-menu-toggle');
            if (navLinks && menuToggle) {
                navLinks.classList.remove('active');
                menuToggle.setAttribute('aria-expanded', 'false');
            }
        }

        // Close mobile menu when clicking outside
        document.addEventListener('click', function(event) {
            const navLinks = document.getElementById('site-nav');
            const menuToggle = document.querySelector('.mobile-menu-toggle');
            const nav = document.querySelector('nav');

            if (nav && !nav.contains(event.target) && navLinks && navLinks.classList.contains('active')) {
                navLinks.classList.remove('active');
                if (menuToggle) menuToggle.setAttribute('aria-expanded', 'false');
            }
        });

        // Global State
        let currentUser = null;
        let currentSection = 'feed';
        let posts = [];
        let comments = {};
        let authMode = 'register'; // 'login' or 'register'
        let friendsList = [];
        let friendRequests = [];
        let conversations = {};
        let userGroups = [];
        let allGroups = [];
        let currentConversation = null;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadUserState();
            loadPosts();
            updateUI();
            setupEventListeners();
            initializeChat();
            initializeDirectory();
            initializeMessaging();
            initializeOnlineUsers();
        });

        // User Authentication System
        function loadUserState() {
            const savedUser = localStorage.getItem('hvacCommunityUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                updateUserInterface();
            }
            
            // Load saved groups
            const savedGroups = localStorage.getItem('hvacCommunityGroups');
            if (savedGroups) {
                allGroups = JSON.parse(savedGroups);
            }
            
            // Initialize default groups if none exist
            if (!allGroups || allGroups.length === 0) {
                allGroups = [
                    {
                        id: 'hvac-troubleshooting',
                        name: 'HVAC Troubleshooting Masters',
                        description: 'Share troubleshooting tips, complex repair solutions, and learn from experienced technicians.',
                        isPrivate: false,
                        memberCount: 1234,
                        members: [],
                        createdBy: 'system',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'g2-study-group',
                        name: 'G2 Exam Study Group',
                        description: 'Study together, share resources, and support each other through G2 certification.',
                        isPrivate: false,
                        memberCount: 456,
                        members: [],
                        createdBy: 'system',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'business-owners',
                        name: 'HVAC Business Owners',
                        description: 'Network with fellow business owners, share business strategies and industry insights.',
                        isPrivate: true,
                        memberCount: 189,
                        members: [],
                        createdBy: 'system',
                        createdAt: new Date().toISOString()
                    }
                ];
                localStorage.setItem('hvacCommunityGroups', JSON.stringify(allGroups));
            }
            
            // Initialize demo friend requests for testing
            if (currentUser && friendRequests.length === 0) {
                // Create a demo friend request to the current user
                friendRequests.push({
                    id: 'demo-request-1',
                    from: 'mike-rodriguez',
                    fromName: 'Mike Rodriguez',
                    to: currentUser.id,
                    timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(), // 2 hours ago
                    status: 'pending'
                });
                
                updateFriendRequestsBadge();
            }
        }

        function updateUserInterface() {
            if (currentUser) {
                // Update online status
                if (typeof updateUserOnlineStatus === 'function') {
                    updateUserOnlineStatus(currentUser, true);
                }
                
                document.getElementById('guestActions').style.display = 'none';
                document.getElementById('userActions').style.display = 'flex';
                document.getElementById('headerUsername').textContent = currentUser.name;
                
                // Update all avatar displays
                updateAllAvatarDisplays();
                
                // Update profile section
                updateProfileSection();
                
                // Update badges
                updateFriendRequestsBadge();
                updateMessagesBadge();
            } else {
                document.getElementById('guestActions').style.display = 'flex';
                document.getElementById('userActions').style.display = 'none';
                document.getElementById('postCreatorAvatar').textContent = 'U';
                
                const chatAvatar = document.getElementById('chatUserAvatar');
                if (chatAvatar) {
                    chatAvatar.textContent = 'U';
                }
                
                // Hide badges when logged out
                document.getElementById('friendRequestBadge').style.display = 'none';
                document.getElementById('messagesBadge').style.display = 'none';
            }
        }

        function updateMessagesBadge() {
            const badge = document.getElementById('messagesBadge');
            let unreadCount = 0;
            
            // Count unread messages (in real app, this would track read status)
            // For demo, we'll just count total conversations
            if (currentUser && Object.keys(conversations).length > 0) {
                const userConversations = Object.values(conversations)
                    .filter(conv => conv.participants.includes(currentUser.id));
                unreadCount = userConversations.length;
            }
            
            if (unreadCount > 0) {
                badge.textContent = unreadCount;
                badge.style.display = 'block';
            } else {
                badge.style.display = 'none';
            }
        }

        function updateProfileSection() {
            if (!currentUser) return;

            const profileContent = document.getElementById('profileContent');
            profileContent.innerHTML = `
                <input type="file" id="profilePhotoInput" accept="image/*" onchange="handleProfilePhotoUpload(event)">
                <div class="profile-grid">
                    <div class="profile-image-section">
                        <div class="profile-image" id="profileImage" onclick="document.getElementById('profilePhotoInput').click()">
                            ${currentUser.profilePhoto ? `<img src="${currentUser.profilePhoto}">` : getInitials(currentUser.name)}
                            <div class="upload-overlay">
                                <div class="upload-text">üì∏<br>Upload Photo</div>
                            </div>
                        </div>
                        <button class="auth-button" onclick="editProfile()">‚úèÔ∏è Edit Profile</button>
                    </div>
                    <div class="profile-details">
                        <h2>${currentUser.name}</h2>
                        <div class="profile-title">${currentUser.title}</div>
                        <div style="color: #95a5a6; margin-bottom: 1rem;">üìç ${currentUser.location}</div>
                        <div class="profile-badges">
                            ${currentUser.certifications?.map(cert => `<span class="certification-badge verified">${cert}</span>`).join('') || ''}
                        </div>
                        <div style="color: #ecf0f1;">
                            ${currentUser.bio || 'No bio provided yet.'}
                        </div>
                    </div>
                </div>
                <div style="background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 10px;">
                    <h3 style="color: #3498db; margin-bottom: 1rem;">üìä Your Activity</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; text-align: center;">
                        <div>
                            <div style="font-size: 1.5rem; font-weight: bold; color: #3498db;">${currentUser.posts || 0}</div>
                            <div style="color: #95a5a6; font-size: 0.9rem;">Posts</div>
                        </div>
                        <div>
                            <div style="font-size: 1.5rem; font-weight: bold; color: #27ae60;">${currentUser.likes || 0}</div>
                            <div style="color: #95a5a6; font-size: 0.9rem;">Likes Received</div>
                        </div>
                        <div>
                            <div style="font-size: 1.5rem; font-weight: bold; color: #e67e22;">${currentUser.connections || 0}</div>
                            <div style="color: #95a5a6; font-size: 0.9rem;">Connections</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function showAuthModal(mode) {
            authMode = mode;
            const modal = document.getElementById('authModal');
            const title = document.getElementById('authModalTitle');
            const registerFields = document.getElementById('registerFields');
            const submitBtn = document.getElementById('authSubmitBtn');
            const toggleLink = document.getElementById('authToggleLink');

            if (mode === 'register') {
                title.textContent = 'Join the HVAC Community';
                registerFields.style.display = 'block';
                submitBtn.textContent = 'Join Community';
                toggleLink.innerHTML = 'Already have an account? <span style="text-decoration: underline;">Login here</span>';
                toggleLink.onclick = () => showAuthModal('login');
            } else {
                title.textContent = 'Welcome Back';
                registerFields.style.display = 'none';
                submitBtn.textContent = 'Login';
                toggleLink.innerHTML = 'New to the community? <span style="text-decoration: underline;">Register here</span>';
                toggleLink.onclick = () => showAuthModal('register');
            }

            modal.style.display = 'flex';
            document.getElementById('authEmail').focus();
        }

        function closeAuthModal() {
            document.getElementById('authModal').style.display = 'none';
            document.getElementById('authForm').reset();
        }

        function toggleAuthMode() {
            showAuthModal(authMode === 'login' ? 'register' : 'login');
        }

        // Handle form submission
        document.getElementById('authForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;
            
            if (authMode === 'register') {
                const name = document.getElementById('authName').value;
                const title = document.getElementById('authTitle').value;
                const location = document.getElementById('authLocation').value;
                
                if (!name || !title || !location) {
                    showNotification('Please fill in all fields to create your profile.', 'error');
                    return;
                }
                
                // Create new user
                currentUser = {
                    id: generateUserId(),
                    email: email,
                    name: name,
                    title: title,
                    location: location,
                    joinDate: new Date().toISOString(),
                    posts: 0,
                    likes: 0,
                    connections: 0,
                    certifications: [],
                    bio: ''
                };
                
                // Save current user
                localStorage.setItem('hvacCommunityUser', JSON.stringify(currentUser));
                
                // Add to all users list for community features
                const allUsers = JSON.parse(localStorage.getItem('hvacCommunityAllUsers')) || [];
                allUsers.push(currentUser);
                localStorage.setItem('hvacCommunityAllUsers', JSON.stringify(allUsers));
                
                showNotification(`Welcome to the community, ${name}! üéâ`, 'success');
            } else {
                // Login simulation - in production, this would authenticate against a backend
                const savedUser = localStorage.getItem('hvacCommunityUser');
                if (savedUser) {
                    currentUser = JSON.parse(savedUser);
                    showNotification(`Welcome back, ${currentUser.name}! üëã`, 'success');
                } else {
                    showNotification('Account not found. Please register first.', 'error');
                    return;
                }
            }
            
            updateUserInterface();
            closeAuthModal();
        });

        // Navigation
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(`section-${sectionName}`).classList.add('active');
            
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-section="${sectionName}"]`).classList.add('active');
            
            currentSection = sectionName;
        }

        // Post Creation
        function createPost() {
            if (!currentUser) {
                showNotification('Please login to share posts.', 'error');
                showAuthModal('login');
                return;
            }

            const content = document.getElementById('postContent').value.trim();
            if (!content) {
                showNotification('Please write something before posting.', 'error');
                return;
            }

            // Check for attached image
            const photoPreview = document.getElementById('photoPreview');
            const imageData = photoPreview.dataset.imageData;

            const postData = {
                id: generatePostId(),
                author: currentUser.name,
                authorId: currentUser.id,
                authorPhoto: currentUser.profilePhoto,
                content: content,
                timestamp: new Date().toISOString(),
                likes: 0,
                comments: [],
                likedBy: [],
                image: imageData || null
            };

            // Add to feed
            addPostToFeed(postData);
            
            // Update user stats
            currentUser.posts = (currentUser.posts || 0) + 1;
            localStorage.setItem('hvacCommunityUser', JSON.stringify(currentUser));
            updateProfileSection();

            // Clear form and photo preview
            document.getElementById('postContent').value = '';
            removePhotoPreview();
            
            showNotification('Post shared successfully! üéâ', 'success');
        }

        function addPostToFeed(postData) {
            // Add post to the posts array for persistence
            posts.unshift(postData);
            
            // Save posts to localStorage
            localStorage.setItem('hvacCommunityPosts', JSON.stringify(posts));
            
            // Create and add the post element to DOM
            const feedPosts = document.getElementById('feedPosts');
            const postElement = document.createElement('div');
            postElement.className = 'feed-post';
            postElement.setAttribute('data-post-id', postData.id);
            
            const timeAgo = getTimeAgo(new Date(postData.timestamp));
            
            postElement.innerHTML = `
                <div class="post-header">
                    <div class="post-avatar">${postData.authorPhoto ? `<img src="${postData.authorPhoto}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">` : getInitials(postData.author)}</div>
                    <div class="post-info">
                        <div class="post-author">${postData.author}</div>
                        <div class="post-meta">
                            <span class="user-badge">${currentUser?.title || 'Community Member'}</span>
                            <span>‚Ä¢</span>
                            <span>${timeAgo}</span>
                            <span>‚Ä¢</span>
                            <span>üìç ${currentUser?.location || 'Unknown'}</span>
                        </div>
                    </div>
                </div>
                <div class="post-content">${postData.content.replace(/\n/g, '<br>')}</div>
                ${postData.image ? `<div class="post-media"><img src="${postData.image}" class="post-image" onclick="openImageModal('${postData.image}')" alt="Post image"></div>` : ''}
                <div class="post-engagement">
                    <div class="engagement-buttons">
                        <button class="engagement-button" onclick="togglePostLike(this)">
                            <span>üëç</span> <span>Like (${postData.likes || 0})</span>
                        </button>
                        <button class="engagement-button" onclick="toggleComments(this)">
                            <span>üí¨</span> <span>Comment (${(postData.comments || []).length})</span>
                        </button>
                        <button class="engagement-button" onclick="sharePost('${postData.id}')">
                            <span>üîó</span> <span>Share</span>
                        </button>
                    </div>
                </div>
                <div class="comments-section" style="display: none;">
                    <div class="comment-input-area">
                        <div class="comment-avatar">${currentUser ? (currentUser.profilePhoto ? `<img src="${currentUser.profilePhoto}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">` : getInitials(currentUser.name)) : 'U'}</div>
                        <input type="text" class="comment-input" placeholder="Write a comment...">
                        <button class="comment-submit" onclick="postComment(this, '${postData.id}')">Post</button>
                    </div>
                </div>
            `;
            
            feedPosts.insertBefore(postElement, feedPosts.firstChild);
            
            // Animate new post
            postElement.style.transform = 'translateY(-20px)';
            postElement.style.opacity = '0';
            setTimeout(() => {
                postElement.style.transform = 'translateY(0)';
                postElement.style.opacity = '1';
                postElement.style.transition = 'all 0.5s ease';
            }, 100);
        }

        // Post Interactions
        function togglePostLike(button) {
            if (!currentUser) {
                showNotification('Please login to like posts.', 'error');
                return;
            }

            const postElement = button.closest('.feed-post');
            const postId = postElement.getAttribute('data-post-id');
            const post = posts.find(p => p.id === postId);
            
            if (!post) return;

            const isLiked = button.classList.contains('liked');
            const likeSpan = button.querySelector('span:last-child');
            
            if (isLiked) {
                // Remove like
                button.classList.remove('liked');
                post.likes = Math.max(0, post.likes - 1);
                post.likedBy = post.likedBy.filter(id => id !== currentUser.id);
                likeSpan.textContent = `Like (${post.likes})`;
            } else {
                // Add like
                button.classList.add('liked');
                post.likes = (post.likes || 0) + 1;
                post.likedBy = post.likedBy || [];
                if (!post.likedBy.includes(currentUser.id)) {
                    post.likedBy.push(currentUser.id);
                }
                likeSpan.textContent = `Like (${post.likes})`;
            }
            
            // Save updated posts to localStorage
            localStorage.setItem('hvacCommunityPosts', JSON.stringify(posts));
        }

        function toggleComments(button) {
            const post = button.closest('.feed-post');
            const commentsSection = post.querySelector('.comments-section');
            
            if (commentsSection.style.display === 'none') {
                commentsSection.style.display = 'block';
                commentsSection.querySelector('.comment-input').focus();
            } else {
                commentsSection.style.display = 'none';
            }
        }

        function postComment(button, postId) {
            if (!currentUser) {
                showNotification('Please login to comment.', 'error');
                return;
            }

            const input = button.previousElementSibling;
            const content = input.value.trim();
            
            if (!content) {
                showNotification('Please write a comment before posting.', 'error');
                return;
            }

            // Find the post in the posts array
            const post = posts.find(p => p.id === postId);
            if (!post) return;

            // Create comment data
            const commentData = {
                id: generatePostId(),
                author: currentUser.name,
                authorId: currentUser.id,
                authorPhoto: currentUser.profilePhoto,
                content: content,
                timestamp: new Date().toISOString(),
                likes: 0,
                likedBy: []
            };

            // Add comment to post data
            post.comments = post.comments || [];
            post.comments.push(commentData);

            const comment = document.createElement('div');
            comment.className = 'comment';
            comment.innerHTML = `
                <div class="comment-avatar">${currentUser.profilePhoto ? `<img src="${currentUser.profilePhoto}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">` : getInitials(currentUser.name)}</div>
                <div class="comment-content">
                    <div class="comment-header">
                        <span class="comment-author">${currentUser.name}</span>
                        <span class="comment-time">just now</span>
                    </div>
                    <div class="comment-text">${content}</div>
                    <div class="comment-actions">
                        <button class="comment-button" onclick="toggleCommentLike(this)">üëç 0</button>
                        <button class="comment-button" onclick="replyToComment(this)">Reply</button>
                    </div>
                </div>
            `;

            const commentsSection = button.closest('.comments-section');
            commentsSection.insertBefore(comment, commentsSection.querySelector('.comment-input-area'));
            
            // Update comment count
            const commentButton = button.closest('.feed-post').querySelector('.engagement-button:nth-child(2) span:last-child');
            commentButton.textContent = `Comment (${post.comments.length})`;
            
            // Save updated posts to localStorage
            localStorage.setItem('hvacCommunityPosts', JSON.stringify(posts));
            
            input.value = '';
            showNotification('Comment posted! üí¨', 'success');
        }

        // Utility Functions
        function getInitials(name) {
            return name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
        }

        function getAvatarDisplay(user) {
            if (user.profilePhoto) {
                return `<img src="${user.profilePhoto}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
            }
            return getInitials(user.name);
        }

        function getUserById(userId) {
            const users = JSON.parse(localStorage.getItem('hvacCommunityUsers')) || [];
            return users.find(u => u.id === userId);
        }

        function updateAllAvatarDisplays() {
            if (!currentUser) return;

            // Update header avatar
            const headerAvatar = document.getElementById('headerAvatar');
            if (headerAvatar) {
                if (currentUser.profilePhoto) {
                    headerAvatar.innerHTML = `<img src="${currentUser.profilePhoto}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
                } else {
                    headerAvatar.textContent = getInitials(currentUser.name);
                }
            }

            // Update post creator avatar
            const postCreatorAvatar = document.getElementById('postCreatorAvatar');
            if (postCreatorAvatar) {
                if (currentUser.profilePhoto) {
                    postCreatorAvatar.innerHTML = `<img src="${currentUser.profilePhoto}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
                } else {
                    postCreatorAvatar.textContent = getInitials(currentUser.name);
                }
            }

            // Update chat avatar
            const chatAvatar = document.getElementById('chatUserAvatar');
            if (chatAvatar) {
                if (currentUser.profilePhoto) {
                    chatAvatar.innerHTML = `<img src="${currentUser.profilePhoto}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
                } else {
                    chatAvatar.textContent = getInitials(currentUser.name);
                }
            }
        }

        function generateUserId() {
            return 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function generatePostId() {
            return 'post_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return 'just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            return date.toLocaleDateString();
        }

        function loadPosts() {
            // Load saved posts from localStorage
            const savedPosts = JSON.parse(localStorage.getItem('hvacCommunityPosts')) || [];
            posts = savedPosts;
            
            // Render existing posts to the feed
            const feedPosts = document.getElementById('feedPosts');
            if (feedPosts && posts.length > 0) {
                // Clear existing posts in DOM
                feedPosts.innerHTML = '';
                
                // Render each saved post
                posts.forEach(postData => {
                    renderPostToDOM(postData);
                });
            }
        }

        function renderPostToDOM(postData) {
            const feedPosts = document.getElementById('feedPosts');
            const postElement = document.createElement('div');
            postElement.className = 'feed-post';
            postElement.setAttribute('data-post-id', postData.id);
            
            const timeAgo = getTimeAgo(new Date(postData.timestamp));
            
            postElement.innerHTML = `
                <div class="post-header">
                    <div class="post-avatar">${postData.authorPhoto ? `<img src="${postData.authorPhoto}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">` : getInitials(postData.author)}</div>
                    <div class="post-info">
                        <div class="post-author">${postData.author}</div>
                        <div class="post-meta">
                            <span class="user-badge">Community Member</span>
                            <span>‚Ä¢</span>
                            <span>${timeAgo}</span>
                        </div>
                    </div>
                </div>
                <div class="post-content">${postData.content.replace(/\n/g, '<br>')}</div>
                ${postData.image ? `<div class="post-media"><img src="${postData.image}" class="post-image" onclick="openImageModal('${postData.image}')" alt="Post image"></div>` : ''}
                <div class="post-engagement">
                    <div class="engagement-buttons">
                        <button class="engagement-button ${currentUser && postData.likedBy && postData.likedBy.includes(currentUser.id) ? 'liked' : ''}" onclick="togglePostLike(this)">
                            <span>üëç</span> <span>Like (${postData.likes || 0})</span>
                        </button>
                        <button class="engagement-button" onclick="toggleComments(this)">
                            <span>üí¨</span> <span>Comment (${(postData.comments || []).length})</span>
                        </button>
                        <button class="engagement-button" onclick="sharePost('${postData.id}')">
                            <span>üîó</span> <span>Share</span>
                        </button>
                    </div>
                </div>
                <div class="comments-section" style="display: none;">
                    <div class="existing-comments">
                        ${(postData.comments || []).map(comment => `
                            <div class="comment">
                                <div class="comment-avatar">${comment.authorPhoto ? `<img src="${comment.authorPhoto}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">` : getInitials(comment.author)}</div>
                                <div class="comment-content">
                                    <div class="comment-header">
                                        <span class="comment-author">${comment.author}</span>
                                        <span class="comment-time">${getTimeAgo(new Date(comment.timestamp))}</span>
                                    </div>
                                    <div class="comment-text">${comment.content}</div>
                                    <div class="comment-actions">
                                        <button class="comment-button" onclick="toggleCommentLike(this)">üëç ${comment.likes || 0}</button>
                                        <button class="comment-button" onclick="replyToComment(this)">Reply</button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="comment-input-area">
                        <div class="comment-avatar">${currentUser ? (currentUser.profilePhoto ? `<img src="${currentUser.profilePhoto}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">` : getInitials(currentUser.name)) : 'U'}</div>
                        <input type="text" class="comment-input" placeholder="Write a comment...">
                        <button class="comment-submit" onclick="postComment(this, '${postData.id}')">Post</button>
                    </div>
                </div>
            `;
            
            feedPosts.appendChild(postElement);
        }

        function updateUI() {
            updateMemberCount();
        }

        function updateMemberCount() {
            // Simulate member count updates
            const baseMembers = 247;
            const savedUsers = JSON.parse(localStorage.getItem('hvacCommunityAllUsers')) || [];
            document.getElementById('memberCount').textContent = baseMembers + savedUsers.length;
        }

        function setupEventListeners() {
            // Auto-resize textarea
            const postContent = document.getElementById('postContent');
            postContent.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.max(120, this.scrollHeight) + 'px';
            });

            // Enter key to post (Ctrl+Enter)
            postContent.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
                    e.preventDefault();
                    createPost();
                }
            });
        }

        // Media Functions (placeholders for full implementation)
        function triggerPhotoUpload() {
            document.getElementById('photoUpload').click();
        }

        function handlePostPhotoUpload(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                const maxSize = 5 * 1024 * 1024; // 5MB
                
                if (file.size > maxSize) {
                    showNotification('Image too large. Please choose an image under 5MB.', 'error');
                    return;
                }
                
                if (!file.type.startsWith('image/')) {
                    showNotification('Please select a valid image file.', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('photoPreview');
                    preview.innerHTML = `
                        <div style="position: relative; display: inline-block;">
                            <img src="${e.target.result}" style="max-width: 100%; max-height: 200px; border-radius: 8px; cursor: pointer;" onclick="openImageModal('${e.target.result}')">
                            <button onclick="removePhotoPreview()" style="position: absolute; top: 5px; right: 5px; background: rgba(0,0,0,0.7); color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; font-size: 14px;">√ó</button>
                        </div>
                    `;
                    preview.style.display = 'block';
                    
                    // Store image data for posting
                    preview.dataset.imageData = e.target.result;
                };
                reader.readAsDataURL(file);
                showNotification('Image uploaded successfully! üì∑', 'success');
            }
        }

        function addCodeSnippet() {
            const textarea = document.getElementById('postContent');
            textarea.value += '\n\n```\n// Your code here\n```\n';
            textarea.focus();
        }

        function addLocation() {
            const textarea = document.getElementById('postContent');
            const currentValue = textarea.value;
            
            if (currentUser && currentUser.location) {
                const locationText = `\nüìç ${currentUser.location}`;
                if (!currentValue.includes(locationText)) {
                    textarea.value += locationText;
                    showNotification('Location added to post! üìç', 'success');
                } else {
                    showNotification('Location already added to this post.', 'info');
                }
            } else {
                const customLocation = prompt('Enter your location:');
                if (customLocation) {
                    textarea.value += `\nüìç ${customLocation}`;
                    showNotification('Location added to post! üìç', 'success');
                }
            }
            textarea.focus();
        }

        function sharePost(postId) {
            navigator.clipboard.writeText(window.location.href + '#post-' + postId)
                .then(() => showNotification('Post link copied to clipboard! üîó', 'success'))
                .catch(() => showNotification('Share functionality coming soon! üîó', 'info'));
        }

        function handleProfilePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Validate file type
            if (!file.type.startsWith('image/')) {
                showNotification('Please select a valid image file.', 'error');
                return;
            }

            // Validate file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                showNotification('Image size must be less than 5MB.', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const imageData = e.target.result;
                
                // Update current user profile photo
                currentUser.profilePhoto = imageData;
                
                // Save to localStorage
                const users = JSON.parse(localStorage.getItem('hvacCommunityUsers')) || [];
                const userIndex = users.findIndex(u => u.email === currentUser.email);
                if (userIndex !== -1) {
                    users[userIndex].profilePhoto = imageData;
                    localStorage.setItem('hvacCommunityUsers', JSON.stringify(users));
                }
                
                // Update profile section display
                updateProfileSection();
                
                // Update all avatar displays throughout the app
                updateAllAvatarDisplays();
                
                showNotification('Profile photo updated successfully! üì∏', 'success');
            };
            
            reader.readAsDataURL(file);
        }

        function editProfile() {
            if (!currentUser) {
                showAuthModal('login');
                return;
            }
            
            const name = prompt('Enter your full name:', currentUser.name);
            if (name === null) return;
            
            const title = prompt('Enter your professional title:', currentUser.title);
            if (title === null) return;
            
            const location = prompt('Enter your location:', currentUser.location);
            if (location === null) return;
            
            const bio = prompt('Enter your bio (optional):', currentUser.bio || '');
            if (bio === null) return;
            
            // Update user data
            currentUser.name = name.trim();
            currentUser.title = title.trim();
            currentUser.location = location.trim();
            currentUser.bio = bio.trim();
            
            localStorage.setItem('hvacCommunityUser', JSON.stringify(currentUser));
            updateUserInterface();
            updateProfileSection();
            
            showNotification('Profile updated successfully! ‚úèÔ∏è', 'success');
        }

        function toggleCommentLike(button) {
            const currentLikes = parseInt(button.textContent.match(/\d+/)[0]);
            const isLiked = button.style.color === 'rgb(231, 76, 60)';
            
            if (isLiked) {
                button.textContent = `üëç ${currentLikes - 1}`;
                button.style.color = '';
            } else {
                button.textContent = `üëç ${currentLikes + 1}`;
                button.style.color = '#e74c3c';
            }
        }

        function replyToComment(button) {
            if (!currentUser) {
                showNotification('Please login to reply to comments.', 'error');
                return;
            }

            const comment = button.closest('.comment');
            const existingReply = comment.querySelector('.reply-input-area');
            
            if (existingReply) {
                existingReply.remove();
                return;
            }
            
            const replyArea = document.createElement('div');
            replyArea.className = 'reply-input-area';
            replyArea.style.cssText = 'margin-top: 0.5rem; padding-left: 2rem;';
            replyArea.innerHTML = `
                <div style="display: flex; gap: 0.8rem; margin-top: 0.5rem;">
                    <div class="comment-avatar" style="width: 30px; height: 30px; font-size: 0.8rem;">${currentUser.profilePhoto ? `<img src="${currentUser.profilePhoto}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">` : getInitials(currentUser.name)}</div>
                    <input type="text" class="comment-input" placeholder="Write a reply..." style="flex: 1; min-height: 35px; font-size: 0.85rem;">
                    <button class="comment-submit" onclick="postReply(this, '${comment.dataset.commentId || generatePostId()}')" style="padding: 8px 12px; font-size: 0.85rem;">Reply</button>
                </div>
            `;
            
            comment.appendChild(replyArea);
            replyArea.querySelector('.comment-input').focus();
        }

        function postReply(button, commentId) {
            const input = button.previousElementSibling;
            const content = input.value.trim();
            
            if (!content) {
                showNotification('Please write a reply before posting.', 'error');
                return;
            }

            const reply = document.createElement('div');
            reply.className = 'comment reply';
            reply.style.cssText = 'margin-left: 2rem; margin-top: 0.5rem; background: rgba(255, 255, 255, 0.03);';
            reply.innerHTML = `
                <div class="comment-avatar" style="width: 30px; height: 30px; font-size: 0.8rem;">${currentUser.profilePhoto ? `<img src="${currentUser.profilePhoto}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">` : getInitials(currentUser.name)}</div>
                <div class="comment-content">
                    <div class="comment-header">
                        <span class="comment-author" style="font-size: 0.85rem;">${currentUser.name}</span>
                        <span class="comment-time" style="font-size: 0.75rem;">just now</span>
                    </div>
                    <div class="comment-text" style="font-size: 0.9rem;">${content}</div>
                    <div class="comment-actions">
                        <button class="comment-button" onclick="toggleCommentLike(this)">üëç 0</button>
                    </div>
                </div>
            `;

            const replyArea = button.closest('.reply-input-area');
            const comment = replyArea.closest('.comment');
            comment.insertAdjacentElement('afterend', reply);
            replyArea.remove();
            
            showNotification('Reply posted! üí¨', 'success');
        }

        function removePhotoPreview() {
            const preview = document.getElementById('photoPreview');
            preview.innerHTML = '';
            preview.style.display = 'none';
            preview.dataset.imageData = '';
            document.getElementById('photoUpload').value = '';
            showNotification('Photo removed from post.', 'info');
        }

        function openImageModal(imageSrc) {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            modalImage.src = imageSrc;
            modal.style.display = 'flex';
        }

        function toggleUserMenu() {
            if (!currentUser) {
                showAuthModal('login');
                return;
            }
            
            // Create dropdown menu
            const existingMenu = document.getElementById('userDropdown');
            if (existingMenu) {
                existingMenu.remove();
                return;
            }
            
            const dropdown = document.createElement('div');
            dropdown.id = 'userDropdown';
            dropdown.style.cssText = `
                position: absolute;
                top: 100%;
                right: 0;
                background: linear-gradient(135deg, #2c3e50, #34495e);
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 10px;
                padding: 1rem;
                min-width: 200px;
                z-index: 1001;
                margin-top: 0.5rem;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            `;
            
            dropdown.innerHTML = `
                <div style="color: #3498db; font-weight: bold; margin-bottom: 0.5rem;">${currentUser.name}</div>
                <div style="color: #95a5a6; font-size: 0.9rem; margin-bottom: 1rem;">${currentUser.title}</div>
                <div style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 1rem;">
                    <button onclick="showSection('profile')" style="background: none; border: none; color: #3498db; width: 100%; text-align: left; padding: 8px 0; cursor: pointer;">üë§ My Profile</button>
                    <button onclick="editProfile()" style="background: none; border: none; color: #3498db; width: 100%; text-align: left; padding: 8px 0; cursor: pointer;">‚úèÔ∏è Edit Profile</button>
                    <button onclick="logoutUser()" style="background: none; border: none; color: #e74c3c; width: 100%; text-align: left; padding: 8px 0; cursor: pointer;">üö™ Logout</button>
                </div>
            `;
            
            const userMenu = document.querySelector('.user-menu');
            userMenu.style.position = 'relative';
            userMenu.appendChild(dropdown);
            
            // Close dropdown when clicking outside
            setTimeout(() => {
                document.addEventListener('click', function closeDropdown(e) {
                    if (!dropdown.contains(e.target) && !userMenu.contains(e.target)) {
                        dropdown.remove();
                        document.removeEventListener('click', closeDropdown);
                    }
                });
            }, 100);
        }

        function logoutUser() {
            currentUser = null;
            localStorage.removeItem('hvacCommunityUser');
            updateUserInterface();
            showSection('feed');
            showNotification('You have been logged out. Thanks for visiting! üëã', 'success');
            
            const dropdown = document.getElementById('userDropdown');
            if (dropdown) dropdown.remove();
        }

        // Chat System
        function sendChatMessage() {
            if (!currentUser) {
                showNotification('Please login to participate in chat.', 'error');
                showAuthModal('login');
                return;
            }

            const input = document.getElementById('chatMessageInput');
            const message = input.value.trim();
            
            if (!message) {
                showNotification('Please type a message before sending.', 'error');
                return;
            }

            const chatMessages = document.getElementById('chatMessages');
            const messageElement = document.createElement('div');
            messageElement.className = 'chat-message';
            messageElement.style.cssText = 'display: flex; gap: 0.8rem; margin: 1rem 0; padding: 0.8rem; background: rgba(52, 152, 219, 0.1); border-radius: 8px; border-left: 3px solid #3498db;';
            
            const now = new Date();
            const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            messageElement.innerHTML = `
                <div class="comment-avatar">${currentUser.profilePhoto ? `<img src="${currentUser.profilePhoto}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">` : getInitials(currentUser.name)}</div>
                <div style="flex: 1;">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.3rem;">
                        <span style="color: #3498db; font-weight: bold; font-size: 0.9rem;">${currentUser.name}</span>
                        <span style="color: #95a5a6; font-size: 0.8rem;">${timeString}</span>
                        <span style="background: linear-gradient(45deg, #3498db, #2980b9); color: white; padding: 2px 6px; border-radius: 8px; font-size: 0.7rem;">You</span>
                    </div>
                    <div style="color: #ecf0f1; font-size: 0.95rem;">${message}</div>
                </div>
            `;
            
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            input.value = '';
            showNotification('Message sent! üí¨', 'success');
            
            // Auto-scroll animation
            messageElement.style.transform = 'translateX(-20px)';
            messageElement.style.opacity = '0';
            setTimeout(() => {
                messageElement.style.transform = 'translateX(0)';
                messageElement.style.opacity = '1';
                messageElement.style.transition = 'all 0.3s ease';
            }, 100);
        }

        function initializeChat() {
            const chatInput = document.getElementById('chatMessageInput');
            if (chatInput) {
                // Update chat avatar when user changes
                const chatAvatar = document.getElementById('chatUserAvatar');
                if (currentUser && chatAvatar) {
                    chatAvatar.textContent = getInitials(currentUser.name);
                }
                
                // Enter key to send
                chatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        sendChatMessage();
                    }
                });
                
                // Focus and placeholder updates
                chatInput.addEventListener('focus', function() {
                    if (!currentUser) {
                        this.placeholder = 'Please login to participate in chat...';
                        this.blur();
                        showAuthModal('login');
                    } else {
                        this.placeholder = `Message as ${currentUser.name}...`;
                    }
                });
            }
        }

        // Professional Directory Functions
        function viewProfile(userId) {
            showNotification(`Profile view for ${userId} coming soon! üë§`, 'info');
        }

        function showDirectorySignup() {
            if (!currentUser) {
                showNotification('Please create an account to join the directory! üìã', 'info');
                showAuthModal('register');
                return;
            }
            
            const confirm = window.confirm(`Add your profile (${currentUser.name}) to the professional directory? This will make you discoverable to other HVAC professionals.`);
            
            if (confirm) {
                addCurrentUserToDirectory();
                showNotification('Your profile has been added to the directory! üéâ', 'success');
            }
        }

        function addCurrentUserToDirectory() {
            if (!currentUser) return;
            
            const userProfile = document.getElementById('currentUserProfile');
            userProfile.innerHTML = `
                <div style="background: rgba(52,152,219,0.1); border-radius: 15px; padding: 1.5rem; border: 2px solid #3498db; transition: all 0.3s; cursor: pointer;" onclick="showSection('profile')">
                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                        <div class="post-avatar">${currentUser.profilePhoto ? `<img src="${currentUser.profilePhoto}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">` : getInitials(currentUser.name)}</div>
                        <div>
                            <div style="color: #ffffff; font-weight: bold;">${currentUser.name}</div>
                            <div style="color: #3498db; font-size: 0.9rem;">${currentUser.title}</div>
                        </div>
                        <div style="background: linear-gradient(45deg, #3498db, #2980b9); color: white; padding: 4px 8px; border-radius: 8px; font-size: 0.7rem; margin-left: auto;">You</div>
                    </div>
                    <div style="color: #bdc3c7; margin-bottom: 1rem;">üìç ${currentUser.location}</div>
                    <div style="color: #ecf0f1; font-size: 0.9rem; margin-bottom: 1rem;">${currentUser.bio || 'Professional HVAC technician and community member.'}</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                        ${currentUser.certifications?.map(cert => `<span style="background: linear-gradient(45deg, #27ae60, #2ecc71); color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">${cert}</span>`).join('') || '<span style="background: linear-gradient(45deg, #95a5a6, #7f8c8d); color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">Community Member</span>'}
                    </div>
                </div>
            `;
            userProfile.style.display = 'block';
        }

        function initializeDirectory() {
            // Add search functionality
            const searchInput = document.getElementById('directorySearch');
            if (searchInput) {
                searchInput.addEventListener('input', function(e) {
                    const searchTerm = e.target.value.toLowerCase();
                    const profiles = document.querySelectorAll('.profile-card');
                    
                    profiles.forEach(profile => {
                        const text = profile.textContent.toLowerCase();
                        if (text.includes(searchTerm)) {
                            profile.style.display = 'block';
                        } else {
                            profile.style.display = 'none';
                        }
                    });
                });
            }
            
            // Add current user to directory if logged in
            if (currentUser) {
                addCurrentUserToDirectory();
            }

            // Add hover effects
            const profiles = document.querySelectorAll('.profile-card');
            profiles.forEach(profile => {
                profile.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-5px)';
                    this.style.boxShadow = '0 10px 30px rgba(52, 152, 219, 0.3)';
                });
                
                profile.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                    this.style.boxShadow = 'none';
                });
            });
        }

        function initializeMessaging() {
            // Add enter key listener for private messages
            const privateMessageInput = document.getElementById('privateMessageInput');
            if (privateMessageInput) {
                privateMessageInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        sendPrivateMessage();
                    }
                });
            }
        }

        // Forum Functions
        function openForum(forumType) {
            const forumNames = {
                'general': 'General Discussion',
                'technical': 'Technical Support',
                'certification': 'Certification & Resources',
                'tools': 'Tools & Equipment',
                'codes': 'Code & Regulations',
                'career': 'Career & Business'
            };
            
            const forumColors = {
                'general': '#3498db',
                'technical': '#e74c3c',
                'certification': '#27ae60',
                'tools': '#f39c12',
                'codes': '#9b59b6',
                'career': '#95a5a6'
            };
            
            showNotification(`Opening ${forumNames[forumType]} forum... üí¨`, 'info');
            
            // In a real implementation, this would navigate to a dedicated forum page
            // For now, we'll show a placeholder that looks professional
            if (window.confirm(`Visit ${forumNames[forumType]}? This will open the dedicated forum page.`)) {
                // Simulate forum loading
                const loading = document.createElement('div');
                loading.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0,0,0,0.8);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 10000;
                    color: white;
                    font-size: 1.2rem;
                `;
                loading.innerHTML = `
                    <div style="text-align: center;">
                        <div class="spinner" style="margin: 0 auto 1rem;"></div>
                        Loading ${forumNames[forumType]}...
                    </div>
                `;
                
                document.body.appendChild(loading);
                
                setTimeout(() => {
                    loading.remove();
                    showNotification(`${forumNames[forumType]} forum ready! Individual forum pages coming soon. üöß`, 'info');
                }, 2000);
            }
        }

        function closeImageModal() {
            document.getElementById('imageModal').style.display = 'none';
        }

        // ============================================
        // FRIENDS & CONTACTS SYSTEM
        // ============================================

        function showFriendsTab(tab) {
            // Update tab buttons
            document.querySelectorAll('#section-friends .tab-button').forEach(btn => {
                btn.style.background = 'rgba(255,255,255,0.1)';
                btn.style.color = '#bdc3c7';
            });
            
            document.getElementById(tab + 'Tab').style.background = 'linear-gradient(45deg, #3498db, #2980b9)';
            document.getElementById(tab + 'Tab').style.color = 'white';

            // Show/hide content
            document.querySelectorAll('.friends-content').forEach(content => {
                content.style.display = 'none';
            });
            
            document.getElementById(tab + '-tab').style.display = 'block';
            
            // Load specific content
            if (tab === 'friends') {
                loadFriendsList();
            } else if (tab === 'requests') {
                loadFriendRequests();
            } else if (tab === 'suggestions') {
                loadFriendSuggestions();
            }
        }

        function sendFriendRequest(userId) {
            if (!currentUser) {
                showNotification('Please login to send friend requests.', 'error');
                showAuthModal('login');
                return;
            }

            // Check if already friends or request pending
            if (friendsList.some(f => f.id === userId)) {
                showNotification('You are already friends with this person.', 'info');
                return;
            }

            if (friendRequests.some(r => r.to === userId && r.from === currentUser.id)) {
                showNotification('Friend request already sent.', 'info');
                return;
            }

            // Add to friend requests (simulate sending)
            const request = {
                id: generatePostId(),
                from: currentUser.id,
                fromName: currentUser.name,
                fromPhoto: currentUser.profilePhoto,
                to: userId,
                timestamp: new Date().toISOString(),
                status: 'pending'
            };

            // In a real app, this would be sent to server
            // For demo, we'll add it to the target user's requests
            friendRequests.push(request);
            
            // Update button
            const button = event.target;
            button.textContent = 'Request Sent';
            button.style.background = 'linear-gradient(45deg, #95a5a6, #7f8c8d)';
            button.disabled = true;

            showNotification('Friend request sent! ü§ù', 'success');
        }

        function loadFriendsList() {
            const friendsList = document.getElementById('friendsList');
            
            if (currentUser && currentUser.friends && currentUser.friends.length > 0) {
                // Display friends if user has any
                friendsList.innerHTML = currentUser.friends.map(friend => `
                    <div class="friend-card" style="background: rgba(255,255,255,0.08); border-radius: 15px; padding: 1rem; margin-bottom: 1rem; border: 1px solid rgba(255,255,255,0.1);">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div class="post-avatar">${friend.profilePhoto ? `<img src="${friend.profilePhoto}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">` : getInitials(friend.name)}</div>
                            <div style="flex: 1;">
                                <div style="color: #ffffff; font-weight: bold;">${friend.name}</div>
                                <div style="color: #95a5a6; font-size: 0.9rem;">${friend.title} ‚Ä¢ ${friend.location}</div>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button onclick="startPrivateMessage('${friend.id}')" style="background: linear-gradient(45deg, #3498db, #2980b9); color: white; border: none; border-radius: 20px; padding: 8px 12px; cursor: pointer; font-size: 0.8rem;">Message</button>
                                <button onclick="removeFriend('${friend.id}')" style="background: rgba(231,76,60,0.2); color: #e74c3c; border: 1px solid #e74c3c; border-radius: 20px; padding: 8px 12px; cursor: pointer; font-size: 0.8rem;">Remove</button>
                            </div>
                        </div>
                    </div>
                `).join('');
            } else {
                friendsList.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #95a5a6;">
                        <h3>No friends yet!</h3>
                        <p>Start connecting with HVAC professionals by sending friend requests.</p>
                        <button onclick="showSection('directory')" style="background: linear-gradient(45deg, #3498db, #2980b9); color: white; border: none; border-radius: 25px; padding: 12px 24px; cursor: pointer; margin-top: 1rem;">Browse Directory</button>
                    </div>
                `;
            }
        }

        function loadFriendRequests() {
            const requestsContainer = document.getElementById('friendRequests');
            
            // Filter requests for current user
            const incomingRequests = friendRequests.filter(r => r.to === currentUser?.id && r.status === 'pending');
            
            if (incomingRequests.length > 0) {
                requestsContainer.innerHTML = incomingRequests.map(request => `
                    <div class="request-card" style="background: rgba(52,152,219,0.1); border-radius: 15px; padding: 1.5rem; margin-bottom: 1rem; border: 1px solid rgba(52,152,219,0.2);">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div class="post-avatar">${request.fromPhoto ? `<img src="${request.fromPhoto}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">` : getInitials(request.fromName)}</div>
                            <div style="flex: 1;">
                                <div style="color: #ffffff; font-weight: bold;">${request.fromName}</div>
                                <div style="color: #95a5a6; font-size: 0.9rem;">wants to be friends</div>
                                <div style="color: #7f8c8d; font-size: 0.8rem;">${getTimeAgo(request.timestamp)}</div>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button onclick="acceptFriendRequest('${request.id}')" style="background: linear-gradient(45deg, #27ae60, #2ecc71); color: white; border: none; border-radius: 20px; padding: 8px 16px; cursor: pointer;">Accept</button>
                                <button onclick="declineFriendRequest('${request.id}')" style="background: rgba(231,76,60,0.2); color: #e74c3c; border: 1px solid #e74c3c; border-radius: 20px; padding: 8px 16px; cursor: pointer;">Decline</button>
                            </div>
                        </div>
                    </div>
                `).join('');
            } else {
                requestsContainer.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #95a5a6;">
                        <h3>No friend requests</h3>
                        <p>When someone sends you a friend request, it will appear here.</p>
                    </div>
                `;
            }
        }

        function acceptFriendRequest(requestId) {
            const request = friendRequests.find(r => r.id === requestId);
            if (!request) return;

            // Add to friends list
            if (!currentUser.friends) currentUser.friends = [];
            
            // Get the requesting user's full profile data
            const requestingUser = getUserById(request.from);
            
            currentUser.friends.push({
                id: request.from,
                name: request.fromName,
                profilePhoto: request.fromPhoto,
                title: requestingUser?.title || 'HVAC Professional',
                location: requestingUser?.location || 'Ontario, Canada'
            });

            // Update request status
            request.status = 'accepted';

            // Save to localStorage
            localStorage.setItem('hvacCommunityUser', JSON.stringify(currentUser));

            showNotification(`You are now friends with ${request.fromName}! üéâ`, 'success');
            
            // Refresh the requests view
            loadFriendRequests();
            updateFriendRequestsBadge();
        }

        function declineFriendRequest(requestId) {
            const request = friendRequests.find(r => r.id === requestId);
            if (!request) return;

            request.status = 'declined';
            
            showNotification('Friend request declined.', 'info');
            loadFriendRequests();
            updateFriendRequestsBadge();
        }

        function removeFriend(friendId) {
            if (!currentUser.friends) return;
            
            const friend = currentUser.friends.find(f => f.id === friendId);
            if (!friend) return;
            
            if (confirm(`Remove ${friend.name} from your friends list?`)) {
                currentUser.friends = currentUser.friends.filter(f => f.id !== friendId);
                localStorage.setItem('hvacCommunityUser', JSON.stringify(currentUser));
                
                showNotification(`${friend.name} removed from friends.`, 'info');
                loadFriendsList();
            }
        }

        function loadFriendSuggestions() {
            // This would typically come from server based on mutual connections, location, etc.
            // For demo, we'll show the existing sample
        }

        function updateFriendRequestsBadge() {
            const badge = document.getElementById('friendRequestBadge');
            const pendingRequests = friendRequests.filter(r => r.to === currentUser?.id && r.status === 'pending').length;
            
            if (pendingRequests > 0) {
                badge.textContent = pendingRequests;
                badge.style.display = 'block';
            } else {
                badge.style.display = 'none';
            }
        }

        // ============================================
        // PRIVATE MESSAGING SYSTEM
        // ============================================

        function startNewConversation() {
            if (!currentUser) {
                showNotification('Please login to send messages.', 'error');
                showAuthModal('login');
                return;
            }

            if (!currentUser.friends || currentUser.friends.length === 0) {
                showNotification('Add some friends first to start conversations! ü§ù', 'info');
                showSection('friends');
                return;
            }

            // Show friend selection modal
            const friendOptions = currentUser.friends.map(friend => 
                `<option value="${friend.id}">${friend.name}</option>`
            ).join('');

            const selectedFriend = prompt('Enter the name of the friend you want to message:');
            if (selectedFriend) {
                const friend = currentUser.friends.find(f => f.name.toLowerCase().includes(selectedFriend.toLowerCase()));
                if (friend) {
                    startPrivateMessage(friend.id);
                } else {
                    showNotification('Friend not found. Please check the name and try again.', 'error');
                }
            }
        }

        function startPrivateMessage(friendId) {
            if (!currentUser) {
                showNotification('Please login to send messages.', 'error');
                return;
            }

            const friend = currentUser.friends?.find(f => f.id === friendId);
            if (!friend) {
                showNotification('Friend not found.', 'error');
                return;
            }

            // Create or load conversation
            const conversationId = [currentUser.id, friendId].sort().join('-');
            if (!conversations[conversationId]) {
                conversations[conversationId] = {
                    id: conversationId,
                    participants: [currentUser.id, friendId],
                    messages: [],
                    lastActivity: new Date().toISOString()
                };
            }

            currentConversation = conversationId;

            // Update UI
            showSection('messages');
            loadConversationsList();
            loadMessages(conversationId);
            
            // Update message header
            const messageHeader = document.getElementById('messageHeader');
            messageHeader.innerHTML = `
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <div class="comment-avatar">${friend.profilePhoto ? `<img src="${friend.profilePhoto}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">` : getInitials(friend.name)}</div>
                    <div>
                        <div style="color: #ffffff; font-weight: bold;">${friend.name}</div>
                        <div style="color: #95a5a6; font-size: 0.9rem;">${friend.title}</div>
                    </div>
                </div>
            `;
            messageHeader.style.display = 'block';
            document.getElementById('messageInput').style.display = 'block';
        }

        function loadConversationsList() {
            const conversationsList = document.getElementById('conversationsList');
            
            if (Object.keys(conversations).length > 0) {
                const userConversations = Object.values(conversations)
                    .filter(conv => conv.participants.includes(currentUser.id))
                    .sort((a, b) => new Date(b.lastActivity) - new Date(a.lastActivity));

                conversationsList.innerHTML = userConversations.map(conv => {
                    const otherId = conv.participants.find(p => p !== currentUser.id);
                    const otherUser = currentUser.friends?.find(f => f.id === otherId);
                    const lastMessage = conv.messages[conv.messages.length - 1];
                    
                    return `
                        <div class="conversation-item ${currentConversation === conv.id ? 'active' : ''}" 
                             onclick="loadMessages('${conv.id}')" 
                             style="padding: 0.8rem; border-radius: 8px; cursor: pointer; margin-bottom: 0.5rem; ${currentConversation === conv.id ? 'background: rgba(52,152,219,0.2);' : 'background: rgba(255,255,255,0.03);'} transition: all 0.3s;">
                            <div style="display: flex; align-items: center; gap: 0.8rem;">
                                <div class="comment-avatar" style="width: 35px; height: 35px; font-size: 0.8rem;">${otherUser?.profilePhoto ? `<img src="${otherUser.profilePhoto}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">` : getInitials(otherUser?.name || 'Unknown')}</div>
                                <div style="flex: 1; min-width: 0;">
                                    <div style="color: #ffffff; font-weight: bold; font-size: 0.9rem;">${otherUser?.name || 'Unknown'}</div>
                                    <div style="color: #95a5a6; font-size: 0.8rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                        ${lastMessage ? lastMessage.content : 'No messages yet'}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            } else {
                conversationsList.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #95a5a6;">
                        <p>No conversations yet.</p>
                        <p style="font-size: 0.9rem; margin-top: 0.5rem;">Start chatting with your friends!</p>
                    </div>
                `;
            }
        }

        function loadMessages(conversationId) {
            currentConversation = conversationId;
            const conversation = conversations[conversationId];
            if (!conversation) return;

            const messagesArea = document.getElementById('messagesArea');
            
            if (conversation.messages.length > 0) {
                messagesArea.innerHTML = conversation.messages.map(message => {
                    const sender = getUserById(message.senderId);
                    const senderAvatar = sender ? getAvatarDisplay(sender) : getInitials(message.senderName);
                    const currentUserAvatar = getAvatarDisplay(currentUser);
                    
                    return `
                    <div style="display: flex; gap: 0.8rem; margin: 1rem 0; ${message.senderId === currentUser.id ? 'justify-content: flex-end;' : ''}">
                        ${message.senderId !== currentUser.id ? `<div class="comment-avatar" style="width: 30px; height: 30px; font-size: 0.8rem;">${senderAvatar}</div>` : ''}
                        <div style="max-width: 70%; padding: 0.8rem; border-radius: 15px; ${message.senderId === currentUser.id ? 'background: linear-gradient(45deg, #3498db, #2980b9); color: white;' : 'background: rgba(255,255,255,0.1); color: #ecf0f1;'}">
                            <div style="font-size: 0.95rem; margin-bottom: 0.3rem;">${message.content}</div>
                            <div style="font-size: 0.75rem; opacity: 0.8;">${getTimeAgo(message.timestamp)}</div>
                        </div>
                        ${message.senderId === currentUser.id ? `<div class="comment-avatar" style="width: 30px; height: 30px; font-size: 0.8rem;">${currentUserAvatar}</div>` : ''}
                    </div>`;
                }).join('');
            } else {
                messagesArea.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #95a5a6;">
                        <h3>Start your conversation!</h3>
                        <p>Send your first message below.</p>
                    </div>
                `;
            }

            messagesArea.scrollTop = messagesArea.scrollHeight;
            
            // Update conversations list to show active conversation
            loadConversationsList();
        }

        function sendPrivateMessage() {
            if (!currentConversation || !currentUser) return;

            const input = document.getElementById('privateMessageInput');
            const content = input.value.trim();
            
            if (!content) {
                showNotification('Please type a message.', 'error');
                return;
            }

            const message = {
                id: generatePostId(),
                senderId: currentUser.id,
                senderName: currentUser.name,
                content: content,
                timestamp: new Date().toISOString()
            };

            conversations[currentConversation].messages.push(message);
            conversations[currentConversation].lastActivity = new Date().toISOString();

            input.value = '';
            loadMessages(currentConversation);
            loadConversationsList();

            showNotification('Message sent! üíå', 'success');
        }

        // ============================================
        // GROUPS SYSTEM
        // ============================================

        function showGroupsTab(tab) {
            // Update tab buttons
            document.querySelectorAll('#section-groups .tab-button').forEach(btn => {
                if (!btn.onclick.toString().includes('createNewGroup')) {
                    btn.style.background = 'rgba(255,255,255,0.1)';
                    btn.style.color = '#bdc3c7';
                }
            });
            
            if (tab === 'mygroups') {
                document.getElementById('myGroupsTab').style.background = 'linear-gradient(45deg, #3498db, #2980b9)';
                document.getElementById('myGroupsTab').style.color = 'white';
            } else if (tab === 'discover') {
                document.getElementById('discoverTab').style.background = 'linear-gradient(45deg, #3498db, #2980b9)';
                document.getElementById('discoverTab').style.color = 'white';
            }

            // Show/hide content
            document.querySelectorAll('.groups-content').forEach(content => {
                content.style.display = 'none';
            });
            
            document.getElementById(tab + '-tab').style.display = 'block';
            
            // Load specific content
            if (tab === 'mygroups') {
                loadMyGroups();
            } else if (tab === 'discover') {
                loadDiscoverGroups();
            }
        }

        function createNewGroup() {
            if (!currentUser) {
                showNotification('Please login to create groups.', 'error');
                showAuthModal('login');
                return;
            }

            const groupName = prompt('Enter group name:');
            if (!groupName) return;

            const groupDescription = prompt('Enter group description:');
            if (!groupDescription) return;

            const isPrivate = confirm('Make this group private? (Click Cancel for public)');

            const newGroup = {
                id: generatePostId(),
                name: groupName.trim(),
                description: groupDescription.trim(),
                isPrivate: isPrivate,
                createdBy: currentUser.id,
                createdByName: currentUser.name,
                members: [currentUser.id],
                memberCount: 1,
                createdAt: new Date().toISOString(),
                posts: []
            };

            // Add to user's groups
            if (!currentUser.groups) currentUser.groups = [];
            currentUser.groups.push(newGroup.id);

            // Add to all groups (in real app, this would be server-side)
            if (!allGroups) allGroups = [];
            allGroups.push(newGroup);

            // Save to localStorage
            localStorage.setItem('hvacCommunityUser', JSON.stringify(currentUser));
            localStorage.setItem('hvacCommunityGroups', JSON.stringify(allGroups));

            showNotification(`Group "${groupName}" created successfully! üåê`, 'success');
            loadMyGroups();
            showGroupsTab('mygroups');
        }

        function joinGroup(groupId) {
            if (!currentUser) {
                showNotification('Please login to join groups.', 'error');
                showAuthModal('login');
                return;
            }

            // Check if already a member
            if (currentUser.groups && currentUser.groups.includes(groupId)) {
                showNotification('You are already a member of this group.', 'info');
                return;
            }

            // Add to user's groups
            if (!currentUser.groups) currentUser.groups = [];
            currentUser.groups.push(groupId);

            // Find the group and increment member count (simulate server update)
            const group = allGroups.find(g => g.id === groupId);
            if (group) {
                group.members.push(currentUser.id);
                group.memberCount++;
                
                localStorage.setItem('hvacCommunityGroups', JSON.stringify(allGroups));
            }

            localStorage.setItem('hvacCommunityUser', JSON.stringify(currentUser));

            // Update button
            const button = event.target;
            button.textContent = 'Joined!';
            button.style.background = 'linear-gradient(45deg, #27ae60, #2ecc71)';
            button.disabled = true;

            showNotification(`Successfully joined the group! üéâ`, 'success');
        }

        function requestGroupAccess(groupId) {
            if (!currentUser) {
                showNotification('Please login to request group access.', 'error');
                showAuthModal('login');
                return;
            }

            // Update button
            const button = event.target;
            button.textContent = 'Request Sent';
            button.style.background = 'linear-gradient(45deg, #95a5a6, #7f8c8d)';
            button.disabled = true;

            showNotification('Access request sent to group administrators. üì®', 'info');
        }

        function loadMyGroups() {
            const myGroupsList = document.getElementById('myGroupsList');
            
            if (currentUser && currentUser.groups && currentUser.groups.length > 0) {
                // Filter user's groups from all groups
                const userGroups = allGroups.filter(group => 
                    currentUser.groups.includes(group.id)
                );

                myGroupsList.innerHTML = userGroups.map(group => `
                    <div class="group-card" style="background: rgba(52,152,219,0.1); border-radius: 15px; padding: 1.5rem; margin-bottom: 1rem; border: 1px solid rgba(52,152,219,0.2); transition: all 0.3s;">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div style="background: linear-gradient(45deg, #3498db, #2980b9); color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">üåê</div>
                            <div style="flex: 1;">
                                <h4 style="color: #3498db; margin-bottom: 0.3rem;">${group.name}</h4>
                                <div style="color: #95a5a6; font-size: 0.9rem;">${group.memberCount} members ‚Ä¢ ${group.isPrivate ? 'Private' : 'Public'}</div>
                                ${group.createdBy === currentUser.id ? '<div style="color: #f39c12; font-size: 0.8rem;">üëë Owner</div>' : ''}
                            </div>
                        </div>
                        <div style="color: #ecf0f1; font-size: 0.9rem; margin-bottom: 1rem;">${group.description}</div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button onclick="openGroupChat('${group.id}')" style="background: linear-gradient(45deg, #3498db, #2980b9); color: white; border: none; border-radius: 20px; padding: 8px 16px; cursor: pointer; flex: 1;">Open Group</button>
                            ${group.createdBy === currentUser.id ? 
                                `<button onclick="manageGroup('${group.id}')" style="background: linear-gradient(45deg, #f39c12, #e67e22); color: white; border: none; border-radius: 20px; padding: 8px 16px; cursor: pointer;">Manage</button>` : 
                                `<button onclick="leaveGroup('${group.id}')" style="background: rgba(231,76,60,0.2); color: #e74c3c; border: 1px solid #e74c3c; border-radius: 20px; padding: 8px 16px; cursor: pointer;">Leave</button>`
                            }
                        </div>
                    </div>
                `).join('');
            } else {
                myGroupsList.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #95a5a6;">
                        <h3>No groups yet!</h3>
                        <p>Join professional groups to connect with like-minded HVAC professionals.</p>
                        <button onclick="showGroupsTab('discover')" style="background: linear-gradient(45deg, #3498db, #2980b9); color: white; border: none; border-radius: 25px; padding: 12px 24px; cursor: pointer; margin-top: 1rem;">Discover Groups</button>
                    </div>
                `;
            }
        }

        function loadDiscoverGroups() {
            // Groups are already in the HTML, but we can add dynamic filtering here
            const searchInput = document.getElementById('groupsSearch');
            if (searchInput) {
                searchInput.addEventListener('input', function(e) {
                    const searchTerm = e.target.value.toLowerCase();
                    const groupCards = document.querySelectorAll('#discover-tab .group-card');
                    
                    groupCards.forEach(card => {
                        const text = card.textContent.toLowerCase();
                        if (text.includes(searchTerm)) {
                            card.style.display = 'block';
                        } else {
                            card.style.display = 'none';
                        }
                    });
                });
            }
        }

        function openGroupChat(groupId) {
            showNotification('Group chat opening... Individual group pages coming soon! üöß', 'info');
        }

        function manageGroup(groupId) {
            const group = allGroups.find(g => g.id === groupId);
            if (!group || group.createdBy !== currentUser.id) {
                showNotification('You can only manage groups you created.', 'error');
                return;
            }

            const action = prompt('Group Management:\n1. Edit group\n2. View members\n3. Delete group\n\nEnter 1, 2, or 3:');
            
            switch(action) {
                case '1':
                    editGroup(groupId);
                    break;
                case '2':
                    viewGroupMembers(groupId);
                    break;
                case '3':
                    deleteGroup(groupId);
                    break;
                default:
                    showNotification('Invalid option selected.', 'error');
            }
        }

        function editGroup(groupId) {
            const group = allGroups.find(g => g.id === groupId);
            if (!group) return;

            const newName = prompt('Edit group name:', group.name);
            if (newName && newName !== group.name) {
                group.name = newName.trim();
            }

            const newDescription = prompt('Edit group description:', group.description);
            if (newDescription && newDescription !== group.description) {
                group.description = newDescription.trim();
            }

            localStorage.setItem('hvacCommunityGroups', JSON.stringify(allGroups));
            showNotification('Group updated successfully! ‚úèÔ∏è', 'success');
            loadMyGroups();
        }

        function viewGroupMembers(groupId) {
            const group = allGroups.find(g => g.id === groupId);
            if (!group) return;

            showNotification(`${group.name} has ${group.memberCount} members. Member management coming soon!`, 'info');
        }

        function deleteGroup(groupId) {
            const group = allGroups.find(g => g.id === groupId);
            if (!group) return;

            if (confirm(`Are you sure you want to delete "${group.name}"? This action cannot be undone.`)) {
                // Remove from all groups
                allGroups = allGroups.filter(g => g.id !== groupId);
                
                // Remove from user's groups
                currentUser.groups = currentUser.groups.filter(id => id !== groupId);

                localStorage.setItem('hvacCommunityGroups', JSON.stringify(allGroups));
                localStorage.setItem('hvacCommunityUser', JSON.stringify(currentUser));

                showNotification('Group deleted successfully.', 'info');
                loadMyGroups();
            }
        }

        function leaveGroup(groupId) {
            const group = allGroups.find(g => g.id === groupId);
            if (!group) return;

            if (confirm(`Are you sure you want to leave "${group.name}"?`)) {
                // Remove from user's groups
                currentUser.groups = currentUser.groups.filter(id => id !== groupId);
                
                // Remove from group members
                group.members = group.members.filter(id => id !== currentUser.id);
                group.memberCount--;

                localStorage.setItem('hvacCommunityGroups', JSON.stringify(allGroups));
                localStorage.setItem('hvacCommunityUser', JSON.stringify(currentUser));

                showNotification(`Left "${group.name}" successfully.`, 'info');
                loadMyGroups();
            }
        }

        // Notification System
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Blog Functions
        function openBlogPost(postId) {
            const blogPosts = {
                'tssa-updates-2025': {
                    title: 'TSSA 2025 Code Changes',
                    url: '../pages/blog/tssa-g2-exam-guide.html',
                    content: 'Important updates to CSA B149.1-25 affecting gas appliance installations...'
                },
                'g3-exam-updates': {
                    title: 'G3 Exam Format Updates',
                    url: '../pages/blog/tssa-g3-exam-guide.html',
                    content: 'TSSA has announced changes to the G3 certification exam format...'
                },
                'tool-promotion': {
                    title: 'Free HVAC Pro Tools Access',
                    url: '../apps/tools/HVAC_PRO_Tools.html',
                    content: 'Limited-time offer: Get free access to our premium HVAC calculation tools...'
                },
                'industry-trends': {
                    title: '2025 HVAC Market Trends',
                    url: '#',
                    content: 'Explore the latest trends shaping the HVAC industry in 2025...'
                }
            };

            const post = blogPosts[postId];
            if (post && post.url !== '#') {
                window.open(post.url, '_blank');
            } else {
                showNotification('Blog post coming soon! Stay tuned for updates.', 'info');
            }
        }

        function subscribeNewsletter() {
            const email = document.getElementById('newsletterEmail').value;
            
            if (!email) {
                showNotification('Please enter your email address.', 'error');
                return;
            }
            
            if (!isValidEmail(email)) {
                showNotification('Please enter a valid email address.', 'error');
                return;
            }

            // In real app, this would send to backend
            showNotification('Successfully subscribed to our newsletter! üìß', 'success');
            document.getElementById('newsletterEmail').value = '';
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Online Users System
        let onlineUsers = [];
        let lastActivity = Date.now();

        function initializeOnlineUsers() {
            // Mark current user as online when they login
            if (currentUser) {
                updateUserOnlineStatus(currentUser, true);
            }
            
            // Load existing online users
            loadOnlineUsers();
            
            // Update display
            updateOnlineUsersDisplay();
            
            // Simulate some online users for demo
            addSimulatedUsers();
            
            // Update activity timestamp periodically
            setInterval(updateActivity, 30000); // Every 30 seconds
            
            // Clean up inactive users periodically
            setInterval(cleanupInactiveUsers, 60000); // Every minute
        }

        function addSimulatedUsers() {
            const demoUsers = [
                { id: 'demo1', name: 'Mike Rodriguez', title: 'G2 Certified', initials: 'MR', lastActivity: Date.now() },
                { id: 'demo2', name: 'Sarah Kim', title: 'Student', initials: 'SK', lastActivity: Date.now() - 120000 },
                { id: 'demo3', name: 'Tom Wilson', title: 'Inspector', initials: 'TW', lastActivity: Date.now() - 60000 },
                { id: 'demo4', name: 'Lisa Chen', title: 'G3 Tech', initials: 'LC', lastActivity: Date.now() - 300000 }
            ];
            
            demoUsers.forEach(user => {
                if (!onlineUsers.find(u => u.id === user.id)) {
                    onlineUsers.push(user);
                }
            });
            
            updateOnlineUsersDisplay();
        }

        function updateUserOnlineStatus(user, isOnline) {
            if (isOnline) {
                // Add or update user in online list
                const existingIndex = onlineUsers.findIndex(u => u.id === user.id);
                const userData = {
                    id: user.id,
                    name: user.name,
                    title: user.title || 'Community Member',
                    initials: getInitials(user.name),
                    lastActivity: Date.now()
                };
                
                if (existingIndex !== -1) {
                    onlineUsers[existingIndex] = userData;
                } else {
                    onlineUsers.push(userData);
                }
            } else {
                // Remove user from online list
                onlineUsers = onlineUsers.filter(u => u.id !== user.id);
            }
            
            saveOnlineUsers();
            updateOnlineUsersDisplay();
        }

        function loadOnlineUsers() {
            const saved = localStorage.getItem('hvacCommunityOnlineUsers');
            if (saved) {
                onlineUsers = JSON.parse(saved);
                // Filter out users who haven't been active in the last 5 minutes
                const fiveMinutesAgo = Date.now() - (5 * 60 * 1000);
                onlineUsers = onlineUsers.filter(user => user.lastActivity > fiveMinutesAgo);
            }
        }

        function saveOnlineUsers() {
            localStorage.setItem('hvacCommunityOnlineUsers', JSON.stringify(onlineUsers));
        }

        function updateActivity() {
            lastActivity = Date.now();
            if (currentUser) {
                updateUserOnlineStatus(currentUser, true);
            }
        }

        function cleanupInactiveUsers() {
            const fiveMinutesAgo = Date.now() - (5 * 60 * 1000);
            const activeUsers = onlineUsers.filter(user => user.lastActivity > fiveMinutesAgo);
            
            if (activeUsers.length !== onlineUsers.length) {
                onlineUsers = activeUsers;
                saveOnlineUsers();
                updateOnlineUsersDisplay();
            }
        }

        function updateOnlineUsersDisplay() {
            const container = document.getElementById('onlineUsers');
            if (!container) return;
            
            // Sort by most recent activity
            const sortedUsers = onlineUsers.sort((a, b) => b.lastActivity - a.lastActivity);
            
            if (sortedUsers.length === 0) {
                container.innerHTML = '<div style="color: #95a5a6; text-align: center; padding: 1rem;">No users currently online</div>';
                return;
            }
            
            container.innerHTML = sortedUsers.map(user => `
                <div class="online-user" onclick="viewUserProfile('${user.id}')">
                    <div style="position: relative;">
                        <div class="user-avatar-small">${user.initials}</div>
                        <div class="online-indicator"></div>
                    </div>
                    <div style="flex: 1; min-width: 0;">
                        <div style="font-size: 0.9rem; color: #ffffff; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${user.name}</div>
                        <div class="online-status">${user.title}</div>
                    </div>
                </div>
            `).join('');
            
            // Update header count if it exists
            const onlineCountElement = document.getElementById('onlineCount');
            if (onlineCountElement) {
                onlineCountElement.textContent = sortedUsers.length;
            }
        }

        function viewUserProfile(userId) {
            const user = onlineUsers.find(u => u.id === userId);
            if (user) {
                showNotification(`Viewing ${user.name}'s profile (feature coming soon!)`, 'info');
            }
        }

        // Update login/logout functions to manage online status

        function logout() {
            if (currentUser) {
                updateUserOnlineStatus(currentUser, false);
            }
            
            currentUser = null;
            localStorage.removeItem('hvacCommunityUser');
            updateUserInterface();
            showNotification('Logged out successfully! üëã', 'info');
            
            // Redirect to main site after logout
            setTimeout(() => {
                window.location.href = '../index.html';
            }, 1500);
        }

        // Auto-update online count simulation (keeping for compatibility)
        setInterval(() => {
            const baseOnline = Math.max(onlineUsers.length, 1);
            const randomVariation = Math.floor(Math.random() * 3);
            const onlineCountElement = document.getElementById('onlineCount');
            if (onlineCountElement) {
                onlineCountElement.textContent = baseOnline + randomVariation;
            }
        }, 30000);
    </script>
</body>
</html>