<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Parallel Circuit Diagram</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: #f9fafb;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #f3f4f6;
            border-radius: 8px;
            padding: 24px;
        }

        .header {
            margin-bottom: 24px;
        }

        .title {
            font-size: 24px;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 8px;
        }

        .controls {
            display: flex;
            gap: 16px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 8px 24px;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn-on { background: #10b981; color: white; }
        .btn-on:hover { background: #059669; }
        .btn-off { background: #ef4444; color: white; }
        .btn-off:hover { background: #dc2626; }

        .legend {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #6b7280;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .status {
            background: white;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #d1d5db;
            font-size: 14px;
        }

        .resistance-panel {
            margin-bottom: 24px;
            padding: 16px;
            background: white;
            border-radius: 6px;
            border: 1px solid #d1d5db;
        }

        .panel-title {
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 12px;
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .label {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 4px;
        }

        .input {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }

        .input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .input-note {
            font-size: 12px;
            color: #6b7280;
            margin-top: 4px;
        }

        .circuit-container {
            position: relative;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            margin-bottom: 24px;
        }

        .circuit-svg {
            width: 100%;
            height: auto;
        }

        .info-panel {
            position: absolute;
            top: 0;
            right: 0;
            background: white;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border: 1px solid #d1d5db;
            max-width: 320px;
            z-index: 10;
        }

        .info-close {
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            font-size: 18px;
            float: right;
        }

        .info-close:hover { color: #6b7280; }

        .info-title {
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 8px;
        }

        .info-desc {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 12px;
        }

        .info-specs {
            font-size: 12px;
            color: #6b7280;
        }

        .info-specs div {
            margin-bottom: 4px;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 16px;
        }

        .analysis-panel {
            padding: 16px;
            background: white;
            border-radius: 6px;
            border: 1px solid #d1d5db;
        }

        .spec-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .spec-label { color: #6b7280; }
        .spec-value { font-weight: 500; }
        .spec-green { color: #10b981; }
        .spec-red { color: #ef4444; }
        .spec-purple { color: #8b5cf6; }

        .branch-item {
            margin-bottom: 12px;
            font-size: 14px;
        }

        .branch-yellow { border-left: 4px solid #fbbf24; padding-left: 12px; }
        .branch-green { border-left: 4px solid #10b981; padding-left: 12px; }
        .branch-blue { border-left: 4px solid #3b82f6; padding-left: 12px; }

        .branch-title { font-weight: 500; }
        .branch-specs { color: #6b7280; }

        .educational-note {
            margin-top: 16px;
            padding: 16px;
            background: #dcfce7;
            border: 1px solid #86efac;
            border-radius: 6px;
        }

        .note-title {
            font-weight: bold;
            color: #166534;
            margin-bottom: 8px;
        }

        .note-list {
            font-size: 14px;
            color: #166534;
            list-style: none;
        }

        .note-list li {
            margin-bottom: 4px;
        }

        .clickable { cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h2 class="title">Parallel Circuit - Variable Load Resistances</h2>
            <div class="controls">
                <button id="switchBtn" class="btn btn-off">Switch OFF (Open)</button>
                <div class="legend">
                    <div class="legend-dot" style="background: #dc2626;"></div>
                    <span>Hot Wire (Live)</span>
                </div>
                <div class="legend">
                    <div class="legend-dot" style="background: #2563eb;"></div>
                    <span>Neutral Wire</span>
                </div>
                <div class="legend">
                    <div class="legend-dot" style="background: #fbbf24;"></div>
                    <span>Current Flow</span>
                </div>
                <div class="status">
                    <strong>Total Current: <span id="currentDisplay">0.000A</span></strong>
                </div>
            </div>
        </div>

        <div class="resistance-panel">
            <h3 class="panel-title">⚡ Circuit Controls</h3>
            <div class="input-grid">
                <div class="input-group">
                    <label class="label">Supply Voltage (V)</label>
                    <input type="number" id="supplyVoltageInput" class="input" min="1" max="500" value="120">
                    <div class="input-note">AC Power Source Voltage</div>
                </div>
                <div class="input-group">
                    <label class="label">Bulb 1 Resistance (Ω)</label>
                    <input type="number" id="bulb1Input" class="input" min="1" max="1000" value="100">
                    <div class="input-note" id="bulb1Note">144.0W @ 120.0V, 1.20A</div>
                </div>
                <div class="input-group">
                    <label class="label">Bulb 2 Resistance (Ω)</label>
                    <input type="number" id="bulb2Input" class="input" min="1" max="1000" value="100">
                    <div class="input-note" id="bulb2Note">144.0W @ 120.0V, 1.20A</div>
                </div>
                <div class="input-group">
                    <label class="label">Bulb 3 Resistance (Ω)</label>
                    <input type="number" id="bulb3Input" class="input" min="1" max="1000" value="100">
                    <div class="input-note" id="bulb3Note">144.0W @ 120.0V, 1.20A</div>
                </div>
            </div>
        </div>

        <div class="circuit-container">
            <svg viewBox="0 0 1000 600" class="circuit-svg" id="circuitSVG">
                <!-- Parallel Circuit Wiring -->
                <g stroke="#DC2626" stroke-width="4" fill="none">
                    <!-- Source to switch -->
                    <path d="M 100 300 L 200 300"/>
                    <!-- Switch to main hot bus -->
                    <path d="M 300 300 L 400 300"/>
                    <!-- Main hot bus -->
                    <path d="M 400 300 L 800 300"/>
                    <!-- Branch connections -->
                    <path d="M 500 300 L 500 340"/>
                    <path d="M 650 300 L 650 340"/>
                    <path d="M 800 300 L 800 340"/>
                </g>
                
                <g stroke="#2563EB" stroke-width="4" fill="none">
                    <!-- Main neutral bus -->
                    <path d="M 400 450 L 800 450"/>
                    <!-- Branch returns -->
                    <path d="M 500 450 L 500 410"/>
                    <path d="M 650 450 L 650 410"/>
                    <path d="M 800 450 L 800 410"/>
                    <!-- Neutral back to source -->
                    <path d="M 400 450 L 100 450"/>
                    <path d="M 100 450 L 100 300"/>
                </g>

                <!-- Wire labels -->
                <text x="30" y="290" style="font-weight: bold; font-size: 14px; fill: #dc2626;">HOT</text>
                <text x="10" y="440" style="font-weight: bold; font-size: 14px; fill: #2563eb;">NEUTRAL</text>

                <!-- Current flow animations -->
                <g id="currentFlow" style="display: none;">
                    <!-- Main supply current -->
                    <circle r="8" fill="#eab308">
                        <animateMotion dur="2s" repeatCount="indefinite">
                            <mpath href="#main-supply-path"/>
                        </animateMotion>
                    </circle>
                    <circle r="8" fill="#eab308">
                        <animateMotion dur="2s" repeatCount="indefinite" begin="0.5s">
                            <mpath href="#main-supply-path"/>
                        </animateMotion>
                    </circle>
                    
                    <!-- Branch currents -->
                    <circle r="6" fill="#eab308">
                        <animateMotion dur="3s" repeatCount="indefinite">
                            <mpath href="#branch1-path"/>
                        </animateMotion>
                    </circle>
                    
                    <circle r="6" fill="#eab308">
                        <animateMotion dur="3s" repeatCount="indefinite" begin="0.3s">
                            <mpath href="#branch2-path"/>
                        </animateMotion>
                    </circle>
                    
                    <circle r="6" fill="#eab308">
                        <animateMotion dur="3s" repeatCount="indefinite" begin="0.6s">
                            <mpath href="#branch3-path"/>
                        </animateMotion>
                    </circle>
                    
                    <!-- Neutral return current -->
                    <circle r="8" fill="#eab308">
                        <animateMotion dur="2.5s" repeatCount="indefinite">
                            <mpath href="#neutral-return-path"/>
                        </animateMotion>
                    </circle>
                    <circle r="8" fill="#eab308">
                        <animateMotion dur="2.5s" repeatCount="indefinite" begin="0.7s">
                            <mpath href="#neutral-return-path"/>
                        </animateMotion>
                    </circle>
                </g>

                <!-- Hidden paths for animations -->
                <defs>
                    <path id="main-supply-path" d="M 300 300 L 400 300 L 800 300"/>
                    <path id="branch1-path" d="M 500 300 L 500 340 L 500 410 L 500 450"/>
                    <path id="branch2-path" d="M 650 300 L 650 340 L 650 410 L 650 450"/>
                    <path id="branch3-path" d="M 800 300 L 800 340 L 800 410 L 800 450"/>
                    <path id="neutral-return-path" d="M 800 450 L 400 450 L 100 450 L 100 300"/>
                </defs>

                <!-- Current direction arrows -->
                <g id="currentArrows" style="display: none;" fill="#eab308">
                    <!-- Main supply arrows -->
                    <polygon points="350,290 370,300 350,310"/>
                    <polygon points="600,290 620,300 600,310"/>
                    <polygon points="750,290 770,300 750,310"/>
                    
                    <!-- Branch arrows down -->
                    <polygon points="490,350 500,370 510,350"/>
                    <polygon points="640,350 650,370 660,350"/>
                    <polygon points="790,350 800,370 810,350"/>
                    
                    <!-- Branch arrows up (return) -->
                    <polygon points="510,420 500,400 490,420"/>
                    <polygon points="660,420 650,400 640,420"/>
                    <polygon points="810,420 800,400 790,420"/>
                    
                    <!-- Neutral return arrows -->
                    <polygon points="700,460 680,450 700,440"/>
                    <polygon points="550,460 530,450 550,440"/>
                    <polygon points="300,460 280,450 300,440"/>
                    <polygon points="140,360 150,340 160,360"/>
                </g>

                <!-- Power Source -->
                <g class="clickable" data-component="source">
                    <rect x="75" y="250" width="50" height="200" fill="#DC2626" stroke="#991B1B" stroke-width="3" rx="5"/>
                    <text x="100" y="335" text-anchor="middle" id="sourceVoltageText" style="fill: white; font-weight: bold; font-size: 14px;">120V</text>
                    <text x="100" y="350" text-anchor="middle" style="fill: white; font-weight: bold; font-size: 18px;">~</text>
                    <text x="100" y="365" text-anchor="middle" style="fill: white; font-weight: bold; font-size: 14px;">AC</text>
                    <text x="100" y="380" text-anchor="middle" style="fill: white; font-weight: bold; font-size: 14px;">SOURCE</text>
                    
                    <path id="acWaveform" d="M 85 395 Q 92 385 100 395 Q 108 405 115 395" 
                          stroke="#FFF" stroke-width="2" fill="none" opacity="0.8" style="display: none;">
                        <animate attributeName="opacity" values="0.8;0.3;0.8" dur="0.5s" repeatCount="indefinite"/>
                    </path>
                </g>

                <!-- SPST Switch -->
                <g class="clickable" data-component="switch">
                    <circle cx="200" cy="300" r="8" fill="#1F2937" stroke="#4B5563" stroke-width="2"/>
                    <circle cx="300" cy="300" r="8" fill="#1F2937" stroke="#4B5563" stroke-width="2"/>
                    
                    <line id="switchLever" x1="208" y1="300" x2="280" y2="280" stroke="#1F2937" stroke-width="4" stroke-linecap="round"/>
                    
                    <rect x="180" y="250" width="140" height="100" fill="#F3F4F6" stroke="#9CA3AF" stroke-width="2" rx="5"/>
                    <text x="250" y="240" text-anchor="middle" style="fill: #1f2937; font-weight: bold; font-size: 14px;">SPST SWITCH</text>
                    <text x="250" y="370" text-anchor="middle" id="switchStatus" style="fill: #1f2937; font-weight: bold; font-size: 12px;">OPEN</text>
                    
                    <rect id="switchIndicator" x="240" y="320" width="20" height="10" fill="#EF4444" rx="2"/>
                    <text x="250" y="395" text-anchor="middle" id="totalCurrentDisplay" style="fill: #10b981; font-weight: bold; font-size: 12px; display: none;">0.00A Total</text>
                </g>

                <!-- Light Bulb 1 -->
                <g class="clickable" data-component="bulb1">
                    <circle id="bulb1Circle" cx="500" cy="375" r="35" fill="#D1D5DB" stroke="#92400E" stroke-width="3"/>
                    <text x="500" y="360" text-anchor="middle" style="fill: #1f2937; font-weight: bold; font-size: 12px;">BULB 1</text>
                    <text x="500" y="375" text-anchor="middle" id="bulb1Icon" style="font-size: 24px;">⚫</text>
                    <text x="500" y="390" text-anchor="middle" id="bulb1Resistance" style="fill: #1f2937; font-size: 12px;">100Ω</text>
                    <text x="450" y="320" text-anchor="middle" id="bulb1Voltage" style="fill: #10b981; font-weight: bold; font-size: 14px;">0V</text>
                    <text x="450" y="335" text-anchor="middle" id="bulb1Current" style="fill: #f97316; font-weight: bold; font-size: 12px;">0.00A</text>
                    
                    <circle id="bulb1Glow" cx="500" cy="375" r="25" fill="#FFA500" opacity="0" style="display: none;"/>
                    
                    <circle cx="500" cy="340" r="4" fill="#DC2626"/>
                    <circle cx="500" cy="410" r="4" fill="#2563EB"/>
                </g>

                <!-- Light Bulb 2 -->
                <g class="clickable" data-component="bulb2">
                    <circle id="bulb2Circle" cx="650" cy="375" r="35" fill="#D1D5DB" stroke="#92400E" stroke-width="3"/>
                    <text x="650" y="360" text-anchor="middle" style="fill: #1f2937; font-weight: bold; font-size: 12px;">BULB 2</text>
                    <text x="650" y="375" text-anchor="middle" id="bulb2Icon" style="font-size: 24px;">⚫</text>
                    <text x="650" y="390" text-anchor="middle" id="bulb2Resistance" style="fill: #1f2937; font-size: 12px;">100Ω</text>
                    <text x="600" y="320" text-anchor="middle" id="bulb2Voltage" style="fill: #10b981; font-weight: bold; font-size: 14px;">0V</text>
                    <text x="600" y="335" text-anchor="middle" id="bulb2Current" style="fill: #f97316; font-weight: bold; font-size: 12px;">0.00A</text>
                    
                    <circle id="bulb2Glow" cx="650" cy="375" r="25" fill="#FFA500" opacity="0" style="display: none;"/>
                    
                    <circle cx="650" cy="340" r="4" fill="#DC2626"/>
                    <circle cx="650" cy="410" r="4" fill="#2563EB"/>
                </g>

                <!-- Light Bulb 3 -->
                <g class="clickable" data-component="bulb3">
                    <circle id="bulb3Circle" cx="800" cy="375" r="35" fill="#D1D5DB" stroke="#92400E" stroke-width="3"/>
                    <text x="800" y="360" text-anchor="middle" style="fill: #1f2937; font-weight: bold; font-size: 12px;">BULB 3</text>
                    <text x="800" y="375" text-anchor="middle" id="bulb3Icon" style="font-size: 24px;">⚫</text>
                    <text x="800" y="390" text-anchor="middle" id="bulb3Resistance" style="fill: #1f2937; font-size: 12px;">100Ω</text>
                    <text x="750" y="320" text-anchor="middle" id="bulb3Voltage" style="fill: #10b981; font-weight: bold; font-size: 14px;">0V</text>
                    <text x="750" y="335" text-anchor="middle" id="bulb3Current" style="fill: #f97316; font-weight: bold; font-size: 12px;">0.00A</text>
                    
                    <circle id="bulb3Glow" cx="800" cy="375" r="25" fill="#FFA500" opacity="0" style="display: none;"/>
                    
                    <circle cx="800" cy="340" r="4" fill="#DC2626"/>
                    <circle cx="800" cy="410" r="4" fill="#2563EB"/>
                </g>

                <!-- Wire junction dots -->
                <g fill="#DC2626">
                    <circle cx="100" cy="300" r="4"/>
                    <circle cx="200" cy="300" r="4"/>
                    <circle cx="300" cy="300" r="4"/>
                    <circle cx="400" cy="300" r="4"/>
                    <circle cx="500" cy="300" r="4"/>
                    <circle cx="650" cy="300" r="4"/>
                    <circle cx="800" cy="300" r="4"/>
                </g>
                
                <g fill="#2563EB">
                    <circle cx="100" cy="450" r="4"/>
                    <circle cx="400" cy="450" r="4"/>
                    <circle cx="500" cy="450" r="4"/>
                    <circle cx="650" cy="450" r="4"/>
                    <circle cx="800" cy="450" r="4"/>
                </g>

                <!-- Parallel circuit indicators -->
                <text id="allBulbsVoltage" x="600" y="120" text-anchor="middle" style="fill: #10b981; font-weight: bold; font-size: 18px; display: none;">
                    All Bulbs Get Full Voltage: 120V Each
                </text>
                
                <text id="individualCurrents" x="600" y="140" text-anchor="middle" style="fill: #8b5cf6; font-weight: bold; font-size: 14px; display: none;">
                    Individual Currents: 0.00A + 0.00A + 0.00A = 0.00A Total
                </text>

                <!-- Total current flow indicator -->
                <text id="currentDivides" x="600" y="550" text-anchor="middle" style="fill: #fbbf24; font-weight: bold; font-size: 18px; display: none;">
                    Current Divides: Each Branch Independent (Parallel Circuit)
                </text>

                <!-- Circuit diagram label -->
                <text x="600" y="50" text-anchor="middle" style="fill: #1f2937; font-weight: bold; font-size: 20px;">
                    TRUE PARALLEL CIRCUIT - Multiple Current Paths
                </text>
            </svg>

            <div id="infoPanel" class="info-panel" style="display: none;">
                <button class="info-close" onclick="closeInfo()">✕</button>
                <h3 id="infoTitle" class="info-title"></h3>
                <p id="infoDesc" class="info-desc"></p>
                <div id="infoSpecs" class="info-specs"></div>
            </div>
        </div>

        <div class="analysis-grid">
            <div class="analysis-panel">
                <h3 class="panel-title">Parallel Circuit Measurements</h3>
                <div class="spec-row">
                    <span class="spec-label">Source Voltage:</span>
                    <span class="spec-value" id="sourceVoltageDisplay">120V AC</span>
                </div>
                <div class="spec-row">
                    <span class="spec-label">Equivalent Resistance:</span>
                    <span class="spec-value" id="equivalentResistance">33.3Ω</span>
                </div>
                <div class="spec-row">
                    <span class="spec-label">Total Current:</span>
                    <span class="spec-value spec-red" id="totalCurrent">0.000A</span>
                </div>
                <div class="spec-row">
                    <span class="spec-label">Total Power:</span>
                    <span class="spec-value" id="totalPower">0.0W</span>
                </div>
                <div class="spec-row">
                    <span class="spec-label">Current Check:</span>
                    <span class="spec-value spec-purple" id="currentCheck">0.000A ✓</span>
                </div>
            </div>

            <div class="analysis-panel">
                <h3 class="panel-title">Individual Branch Analysis</h3>
                <div class="branch-item branch-yellow">
                    <div class="branch-title" id="bulb1Analysis">Branch 1: 100Ω</div>
                    <div class="branch-specs" id="bulb1Specs">120V, 0.00A, 0.0W</div>
                </div>
                <div class="branch-item branch-green">
                    <div class="branch-title" id="bulb2Analysis">Branch 2: 100Ω</div>
                    <div class="branch-specs" id="bulb2Specs">120V, 0.00A, 0.0W</div>
                </div>
                <div class="branch-item branch-blue">
                    <div class="branch-title" id="bulb3Analysis">Branch 3: 100Ω</div>
                    <div class="branch-specs" id="bulb3Specs">120V, 0.00A, 0.0W</div>
                </div>
                <div style="font-size: 12px; color: #6b7280; margin-top: 8px;">
                    <strong>Note:</strong> Lower resistance = Higher current in parallel
                </div>
            </div>
        </div>

        <div class="educational-note">
            <h3 class="note-title">🎓 Parallel Circuit Key Points</h3>
            <ul class="note-list">
                <li>• <strong>Multiple Paths:</strong> Current has separate routes through each branch</li>
                <li>• <strong>Same Voltage:</strong> All components get full source voltage (V = V₁ = V₂ = V₃)</li>
                <li>• <strong>Current Divides:</strong> I₁/I₂ = R₂/R₁ (inversely proportional to resistance)</li>
                <li>• <strong>Independent Operation:</strong> If one branch fails, others continue working</li>
                <li>• <strong>Total Current:</strong> Itotal = I₁ + I₂ + I₃ (branch currents add up)</li>
                <li>• <strong>Equivalent Resistance:</strong> 1/Req = 1/R₁ + 1/R₂ + 1/R₃ (always less than smallest R)</li>
            </ul>
        </div>
    </div>

    <script>
        // Circuit state
        let switchClosed = false;
        let selectedComponent = null;
        let supplyVoltage = 120;
        let bulb1Resistance = 100;
        let bulb2Resistance = 100;
        let bulb3Resistance = 100;

        // Component data
        const components = {
            source: {
                name: "120V AC Power Source",
                description: "Provides electrical energy to the circuit",
                voltage: "120V AC",
                frequency: "60Hz"
            },
            switch: {
                name: "SPST Switch (Hot Wire)",
                description: "Single Pole Single Throw switch controls current flow to all parallel branches"
            },
            bulb1: {
                name: "Light Bulb #1 (Branch 1)",
                description: "Incandescent bulb in parallel - gets full voltage independently"
            },
            bulb2: {
                name: "Light Bulb #2 (Branch 2)", 
                description: "Incandescent bulb in parallel - gets full voltage independently"
            },
            bulb3: {
                name: "Light Bulb #3 (Branch 3)",
                description: "Incandescent bulb in parallel - gets full voltage independently"
            }
        };

        // Calculate circuit values
        function calculateCircuit() {
            const sourceVoltage = supplyVoltage;
            
            // In parallel: Each bulb gets full voltage
            const voltage1 = switchClosed ? sourceVoltage : 0;
            const voltage2 = switchClosed ? sourceVoltage : 0;
            const voltage3 = switchClosed ? sourceVoltage : 0;
            
            // Individual currents: I = V/R
            const current1 = switchClosed ? voltage1 / bulb1Resistance : 0;
            const current2 = switchClosed ? voltage2 / bulb2Resistance : 0;
            const current3 = switchClosed ? voltage3 / bulb3Resistance : 0;
            
            // Total current (sum of all branch currents)
            const totalCurrent = current1 + current2 + current3;
            
            // Individual wattages: P = V²/R
            const wattage1 = switchClosed ? Math.pow(voltage1, 2) / bulb1Resistance : 0;
            const wattage2 = switchClosed ? Math.pow(voltage2, 2) / bulb2Resistance : 0;
            const wattage3 = switchClosed ? Math.pow(voltage3, 2) / bulb3Resistance : 0;
            
            // Equivalent resistance: 1/Req = 1/R1 + 1/R2 + 1/R3
            const equivalentResistance = 1 / (1/bulb1Resistance + 1/bulb2Resistance + 1/bulb3Resistance);

            return {
                current1,
                current2,
                current3,
                totalCurrent,
                voltage1,
                voltage2,
                voltage3,
                wattage1,
                wattage2,
                wattage3,
                equivalentResistance,
                totalPower: wattage1 + wattage2 + wattage3
            };
        }

        // Update display
        function updateDisplay() {
            const calc = calculateCircuit();
            
            // Update switch
            const switchBtn = document.getElementById('switchBtn');
            const switchLever = document.getElementById('switchLever');
            const switchStatus = document.getElementById('switchStatus');
            const switchIndicator = document.getElementById('switchIndicator');
            const totalCurrentDisplay = document.getElementById('totalCurrentDisplay');
            
            if (switchClosed) {
                switchBtn.textContent = 'Switch ON (Closed)';
                switchBtn.className = 'btn btn-on';
                switchLever.setAttribute('x2', '292');
                switchLever.setAttribute('y2', '300');
                switchStatus.textContent = 'CLOSED';
                switchIndicator.setAttribute('fill', '#10B981');
                totalCurrentDisplay.style.display = 'block';
                totalCurrentDisplay.textContent = calc.totalCurrent.toFixed(2) + 'A Total';
            } else {
                switchBtn.textContent = 'Switch OFF (Open)';
                switchBtn.className = 'btn btn-off';
                switchLever.setAttribute('x2', '280');
                switchLever.setAttribute('y2', '280');
                switchStatus.textContent = 'OPEN';
                switchIndicator.setAttribute('fill', '#EF4444');
                totalCurrentDisplay.style.display = 'none';
            }

            // Update source voltage display
            document.getElementById('sourceVoltageText').textContent = supplyVoltage + 'V';
            document.getElementById('sourceVoltageDisplay').textContent = supplyVoltage + 'V AC';

            // Update current display
            document.getElementById('currentDisplay').textContent = calc.totalCurrent.toFixed(3) + 'A';

            // Update bulbs
            updateBulb('bulb1', calc.voltage1, calc.current1, calc.wattage1, bulb1Resistance);
            updateBulb('bulb2', calc.voltage2, calc.current2, calc.wattage2, bulb2Resistance);
            updateBulb('bulb3', calc.voltage3, calc.current3, calc.wattage3, bulb3Resistance);

            // Update resistance displays
            document.getElementById('bulb1Resistance').textContent = bulb1Resistance + 'Ω';
            document.getElementById('bulb2Resistance').textContent = bulb2Resistance + 'Ω';
            document.getElementById('bulb3Resistance').textContent = bulb3Resistance + 'Ω';

            // Update input notes
            document.getElementById('bulb1Note').textContent = calc.wattage1.toFixed(1) + 'W @ ' + calc.voltage1.toFixed(1) + 'V, ' + calc.current1.toFixed(2) + 'A';
            document.getElementById('bulb2Note').textContent = calc.wattage2.toFixed(1) + 'W @ ' + calc.voltage2.toFixed(1) + 'V, ' + calc.current2.toFixed(2) + 'A';
            document.getElementById('bulb3Note').textContent = calc.wattage3.toFixed(1) + 'W @ ' + calc.voltage3.toFixed(1) + 'V, ' + calc.current3.toFixed(2) + 'A';

            // Update voltage and current labels on bulbs
            document.getElementById('bulb1Voltage').textContent = calc.voltage1.toFixed(0) + 'V';
            document.getElementById('bulb1Current').textContent = calc.current1.toFixed(2) + 'A';
            document.getElementById('bulb2Voltage').textContent = calc.voltage2.toFixed(0) + 'V';
            document.getElementById('bulb2Current').textContent = calc.current2.toFixed(2) + 'A';
            document.getElementById('bulb3Voltage').textContent = calc.voltage3.toFixed(0) + 'V';
            document.getElementById('bulb3Current').textContent = calc.current3.toFixed(2) + 'A';

            // Update animations and indicators
            const currentFlow = document.getElementById('currentFlow');
            const currentArrows = document.getElementById('currentArrows');
            const acWaveform = document.getElementById('acWaveform');
            const allBulbsVoltage = document.getElementById('allBulbsVoltage');
            const individualCurrents = document.getElementById('individualCurrents');
            const currentDivides = document.getElementById('currentDivides');

            if (switchClosed) {
                currentFlow.style.display = 'block';
                currentArrows.style.display = 'block';
                acWaveform.style.display = 'block';
                allBulbsVoltage.style.display = 'block';
                individualCurrents.style.display = 'block';
                currentDivides.style.display = 'block';

                allBulbsVoltage.textContent = `All Bulbs Get Full Voltage: ${supplyVoltage}V Each`;
                individualCurrents.textContent = `Individual Currents: ${calc.current1.toFixed(2)}A + ${calc.current2.toFixed(2)}A + ${calc.current3.toFixed(2)}A = ${calc.totalCurrent.toFixed(2)}A Total`;
            } else {
                currentFlow.style.display = 'none';
                currentArrows.style.display = 'none';
                acWaveform.style.display = 'none';
                allBulbsVoltage.style.display = 'none';
                individualCurrents.style.display = 'none';
                currentDivides.style.display = 'none';
            }

            // Update analysis panels
            document.getElementById('equivalentResistance').textContent = calc.equivalentResistance.toFixed(1) + 'Ω';
            document.getElementById('totalCurrent').textContent = calc.totalCurrent.toFixed(3) + 'A';
            document.getElementById('totalCurrent').className = 'spec-value ' + (switchClosed ? 'spec-green' : 'spec-red');
            document.getElementById('totalPower').textContent = calc.totalPower.toFixed(1) + 'W';
            document.getElementById('currentCheck').textContent = (calc.current1 + calc.current2 + calc.current3).toFixed(3) + 'A ✓';

            document.getElementById('bulb1Analysis').textContent = `Branch 1: ${bulb1Resistance}Ω`;
            document.getElementById('bulb1Specs').textContent = `${supplyVoltage}V, ${calc.current1.toFixed(2)}A, ${calc.wattage1.toFixed(1)}W`;
            document.getElementById('bulb2Analysis').textContent = `Branch 2: ${bulb2Resistance}Ω`;
            document.getElementById('bulb2Specs').textContent = `${supplyVoltage}V, ${calc.current2.toFixed(2)}A, ${calc.wattage2.toFixed(1)}W`;
            document.getElementById('bulb3Analysis').textContent = `Branch 3: ${bulb3Resistance}Ω`;
            document.getElementById('bulb3Specs').textContent = `${supplyVoltage}V, ${calc.current3.toFixed(2)}A, ${calc.wattage3.toFixed(1)}W`;
        }

        function updateBulb(bulbId, voltage, current, wattage, resistance) {
            const circle = document.getElementById(bulbId + 'Circle');
            const icon = document.getElementById(bulbId + 'Icon');
            const glow = document.getElementById(bulbId + 'Glow');

            if (switchClosed) {
                circle.setAttribute('fill', '#FCD34D');
                icon.textContent = '💡';
                glow.style.display = 'block';
                glow.setAttribute('opacity', Math.min(wattage / 144, 0.8));
            } else {
                circle.setAttribute('fill', '#D1D5DB');
                icon.textContent = '⚫';
                glow.style.display = 'none';
            }
        }

        // Event listeners
        document.getElementById('switchBtn').addEventListener('click', () => {
            switchClosed = !switchClosed;
            updateDisplay();
        });

        document.getElementById('supplyVoltageInput').addEventListener('input', (e) => {
            supplyVoltage = Number(e.target.value);
            updateDisplay();
        });

        document.getElementById('bulb1Input').addEventListener('input', (e) => {
            bulb1Resistance = Number(e.target.value);
            updateDisplay();
        });

        document.getElementById('bulb2Input').addEventListener('input', (e) => {
            bulb2Resistance = Number(e.target.value);
            updateDisplay();
        });

        document.getElementById('bulb3Input').addEventListener('input', (e) => {
            bulb3Resistance = Number(e.target.value);
            updateDisplay();
        });

        // Component info
        document.querySelectorAll('.clickable').forEach(element => {
            element.addEventListener('click', (e) => {
                const component = e.currentTarget.dataset.component;
                showInfo(component);
            });
        });

        function showInfo(component) {
            const calc = calculateCircuit();
            selectedComponent = component;
            const info = components[component];
            const panel = document.getElementById('infoPanel');
            
            document.getElementById('infoTitle').textContent = info.name;
            document.getElementById('infoDesc').textContent = info.description;
            
            let specs = '';
            if (component === 'source') {
                specs = `<div><strong>Voltage:</strong> ${supplyVoltage}V AC</div>`;
                specs += `<div><strong>Frequency:</strong> ${info.frequency}</div>`;
            } else if (component === 'switch') {
                specs = `<div><strong>Position:</strong> ${switchClosed ? 'CLOSED' : 'OPEN'}</div>`;
                specs += `<div><strong>Current:</strong> ${switchClosed ? calc.totalCurrent.toFixed(2) + 'A' : '0A'}</div>`;
            } else if (component === 'bulb1') {
                specs = `<div><strong>Voltage:</strong> ${calc.voltage1.toFixed(1)}V</div>`;
                specs += `<div><strong>Current:</strong> ${calc.current1.toFixed(2)}A</div>`;
                specs += `<div><strong>Resistance:</strong> ${bulb1Resistance}Ω</div>`;
                specs += `<div><strong>Power:</strong> ${calc.wattage1.toFixed(1)}W</div>`;
            } else if (component === 'bulb2') {
                specs = `<div><strong>Voltage:</strong> ${calc.voltage2.toFixed(1)}V</div>`;
                specs += `<div><strong>Current:</strong> ${calc.current2.toFixed(2)}A</div>`;
                specs += `<div><strong>Resistance:</strong> ${bulb2Resistance}Ω</div>`;
                specs += `<div><strong>Power:</strong> ${calc.wattage2.toFixed(1)}W</div>`;
            } else if (component === 'bulb3') {
                specs = `<div><strong>Voltage:</strong> ${calc.voltage3.toFixed(1)}V</div>`;
                specs += `<div><strong>Current:</strong> ${calc.current3.toFixed(2)}A</div>`;
                specs += `<div><strong>Resistance:</strong> ${bulb3Resistance}Ω</div>`;
                specs += `<div><strong>Power:</strong> ${calc.wattage3.toFixed(1)}W</div>`;
            }
            
            document.getElementById('infoSpecs').innerHTML = specs;
            panel.style.display = 'block';
        }

        function closeInfo() {
            document.getElementById('infoPanel').style.display = 'none';
            selectedComponent = null;
        }

        // Initialize
        updateDisplay();
    </script>
</body>
</html>