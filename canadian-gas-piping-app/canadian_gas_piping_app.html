<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canadian Gas Piping Sizing Calculator - CSA B149.1:25</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        .input-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            border: 1px solid #e9ecef;
        }

        .results-section {
            background: #fff;
            padding: 25px;
            border-radius: 12px;
            border: 2px solid #28a745;
        }

        .section-title {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .appliance-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            margin-bottom: 15px;
            position: relative;
        }

        .remove-appliance {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
            transform: translateY(-2px);
        }

        .total-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }

        .total-display h3 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .result-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #28a745;
        }

        .result-item h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .calculation-details {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .disclaimer {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Canadian Gas Piping Sizing Calculator</h1>
            <p>Based on CSA B149.1:25 Natural Gas and Propane Installation Code - Annex A</p>
        </div>

        <div class="main-content">
            <div class="input-section">
                <h2 class="section-title">System Parameters</h2>
                
                <div class="form-group">
                    <label for="gasType">Type of Gas:</label>
                    <select id="gasType">
                        <option value="natural">Natural Gas (0.6 Relative Density)</option>
                        <option value="propane" disabled>Propane (Coming Soon - Annex B)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="pipeType">Pipe/Tubing Type:</label>
                    <select id="pipeType">
                        <option value="schedule40">Schedule 40 Black Iron Pipe</option>
                        <option value="copper">Type K Copper Tubing</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="pressure">Operating Pressure:</label>
                    <select id="pressure">
                        <option value="0.5">0.5 in w.c. (1.25 kPa)</option>
                        <option value="2">2 psig (13.8 kPa)</option>
                        <option value="5">5 psig (34.5 kPa)</option>
                        <option value="10">10 psig (69 kPa)</option>
                        <option value="20">20 psig (138 kPa)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="lmr">Longest Measured Run (LMR) in feet:</label>
                    <input type="number" id="lmr" placeholder="Enter LMR in feet" min="1" value="50">
                </div>

                <h3 style="margin-top: 30px; margin-bottom: 15px; color: #2c3e50;">Appliances</h3>
                <div id="appliancesList">
                    <div class="appliance-item">
                        <label>Appliance Name:</label>
                        <input type="text" class="appliance-name" placeholder="e.g., Furnace">
                        <label style="margin-top: 10px;">Capacity (Btu/h):</label>
                        <input type="number" class="appliance-btuh" placeholder="Enter Btu/h" min="1">
                    </div>
                </div>

                <button class="btn btn-primary" onclick="addAppliance()">+ Add Appliance</button>
                <button class="btn btn-success" onclick="calculatePipeSize()" style="margin-left: 10px;">Calculate Pipe Size</button>

                <div class="total-display">
                    <h3>Total System Load</h3>
                    <div id="totalBtuh">0 Btu/h</div>
                </div>
            </div>

            <div class="results-section">
                <h2 class="section-title">Sizing Results</h2>
                <div id="results">
                    <p style="color: #6c757d; text-align: center; margin-top: 50px;">
                        Enter appliance data and click "Calculate Pipe Size" to see results
                    </p>
                </div>
            </div>
        </div>

        <div class="disclaimer">
            <strong>IMPORTANT DISCLAIMER:</strong> This calculator is for reference purposes only. All gas piping installations must be performed by licensed gas technicians in accordance with local codes and regulations. The CSA B149.1:25 code and local authority having jurisdiction take precedence. Always consult with qualified professionals and obtain proper permits before installation.
        </div>
    </div>

    <script>
        // Natural Gas Capacity Tables (from CSA B149.1:25 Annex A)
        const naturalGasTables = {
            schedule40: {
                "0.5": { // 0.5 in w.c.
                    10: {size: "1/2", capacity: 156},
                    20: {size: "1/2", capacity: 107},
                    30: {size: "1/2", capacity: 86},
                    40: {size: "1/2", capacity: 74},
                    50: {size: "1/2", capacity: 65},
                    60: {size: "1/2", capacity: 59},
                    70: {size: "1/2", capacity: 54},
                    80: {size: "1/2", capacity: 51},
                    90: {size: "1/2", capacity: 48},
                    100: {size: "1/2", capacity: 45},
                    125: {size: "1/2", capacity: 40},
                    150: {size: "1/2", capacity: 36},
                    175: {size: "1/2", capacity: 33},
                    200: {size: "1/2", capacity: 31},
                    250: {size: "1/2", capacity: 27},
                    300: {size: "1/2", capacity: 25},
                    350: {size: "1/2", capacity: 23},
                    400: {size: "1/2", capacity: 21},
                    450: {size: "1/2", capacity: 20},
                    500: {size: "1/2", capacity: 19}
                }
            },
            copper: {
                "0.5": { // 0.5 in w.c.
                    10: {size: "1/2", capacity: 46},
                    20: {size: "1/2", capacity: 32},
                    30: {size: "1/2", capacity: 25},
                    40: {size: "1/2", capacity: 22},
                    50: {size: "1/2", capacity: 19},
                    60: {size: "1/2", capacity: 18},
                    70: {size: "1/2", capacity: 16},
                    80: {size: "1/2", capacity: 15},
                    90: {size: "1/2", capacity: 14},
                    100: {size: "1/2", capacity: 13},
                    125: {size: "1/2", capacity: 12},
                    150: {size: "1/2", capacity: 11},
                    175: {size: "1/2", capacity: 10},
                    200: {size: "1/2", capacity: 9},
                    250: {size: "1/2", capacity: 8},
                    300: {size: "1/2", capacity: 8},
                    350: {size: "1/2", capacity: 7},
                    400: {size: "1/2", capacity: 7},
                    450: {size: "1/2", capacity: 6},
                    500: {size: "1/2", capacity: 6}
                }
            }
        };

        // Extended capacity tables for different pipe sizes
        const extendedCapacityTables = {
            schedule40: {
                "0.5": {
                    "1/2": [
                        {length: 10, capacity: 156},
                        {length: 20, capacity: 107},
                        {length: 30, capacity: 86},
                        {length: 40, capacity: 74},
                        {length: 50, capacity: 65},
                        {length: 60, capacity: 59},
                        {length: 70, capacity: 54},
                        {length: 80, capacity: 51},
                        {length: 90, capacity: 48},
                        {length: 100, capacity: 45},
                        {length: 125, capacity: 40},
                        {length: 150, capacity: 36},
                        {length: 175, capacity: 33},
                        {length: 200, capacity: 31},
                        {length: 250, capacity: 27},
                        {length: 300, capacity: 25},
                        {length: 350, capacity: 23},
                        {length: 400, capacity: 21},
                        {length: 450, capacity: 20},
                        {length: 500, capacity: 19}
                    ],
                    "3/4": [
                        {length: 10, capacity: 324},
                        {length: 20, capacity: 220},
                        {length: 30, capacity: 180},
                        {length: 40, capacity: 154},
                        {length: 50, capacity: 137},
                        {length: 60, capacity: 124},
                        {length: 70, capacity: 114},
                        {length: 80, capacity: 106},
                        {length: 90, capacity: 99},
                        {length: 100, capacity: 94},
                        {length: 125, capacity: 83},
                        {length: 150, capacity: 75},
                        {length: 175, capacity: 69},
                        {length: 200, capacity: 64},
                        {length: 250, capacity: 57},
                        {length: 300, capacity: 52},
                        {length: 350, capacity: 48},
                        {length: 400, capacity: 44},
                        {length: 450, capacity: 42},
                        {length: 500, capacity: 39}
                    ],
                    "1": [
                        {length: 10, capacity: 614},
                        {length: 20, capacity: 422},
                        {length: 30, capacity: 339},
                        {length: 40, capacity: 290},
                        {length: 50, capacity: 257},
                        {length: 60, capacity: 233},
                        {length: 70, capacity: 214},
                        {length: 80, capacity: 199},
                        {length: 90, capacity: 187},
                        {length: 100, capacity: 177},
                        {length: 125, capacity: 157},
                        {length: 150, capacity: 142},
                        {length: 175, capacity: 131},
                        {length: 200, capacity: 121},
                        {length: 250, capacity: 108},
                        {length: 300, capacity: 98},
                        {length: 350, capacity: 90},
                        {length: 400, capacity: 83},
                        {length: 450, capacity: 78},
                        {length: 500, capacity: 74}
                    ],
                    "1-1/4": [
                        {length: 10, capacity: 1261},
                        {length: 20, capacity: 867},
                        {length: 30, capacity: 696},
                        {length: 40, capacity: 596},
                        {length: 50, capacity: 528},
                        {length: 60, capacity: 478},
                        {length: 70, capacity: 440},
                        {length: 80, capacity: 409},
                        {length: 90, capacity: 384},
                        {length: 100, capacity: 363},
                        {length: 125, capacity: 322},
                        {length: 150, capacity: 291},
                        {length: 175, capacity: 268},
                        {length: 200, capacity: 249},
                        {length: 250, capacity: 221},
                        {length: 300, capacity: 200},
                        {length: 350, capacity: 184},
                        {length: 400, capacity: 171},
                        {length: 450, capacity: 161},
                        {length: 500, capacity: 152}
                    ],
                    "1-1/2": [
                        {length: 10, capacity: 1890},
                        {length: 20, capacity: 1299},
                        {length: 30, capacity: 1043},
                        {length: 40, capacity: 893},
                        {length: 50, capacity: 791},
                        {length: 60, capacity: 717},
                        {length: 70, capacity: 659},
                        {length: 80, capacity: 613},
                        {length: 90, capacity: 576},
                        {length: 100, capacity: 544},
                        {length: 125, capacity: 482},
                        {length: 150, capacity: 437},
                        {length: 175, capacity: 402},
                        {length: 200, capacity: 374},
                        {length: 250, capacity: 331},
                        {length: 300, capacity: 300},
                        {length: 350, capacity: 276},
                        {length: 400, capacity: 257},
                        {length: 450, capacity: 241},
                        {length: 500, capacity: 228}
                    ]
                }
            },
            copper: {
                "0.5": {
                    "1/2": [
                        {length: 10, capacity: 46},
                        {length: 20, capacity: 32},
                        {length: 30, capacity: 25},
                        {length: 40, capacity: 22},
                        {length: 50, capacity: 19},
                        {length: 60, capacity: 18},
                        {length: 70, capacity: 16},
                        {length: 80, capacity: 15},
                        {length: 90, capacity: 14},
                        {length: 100, capacity: 13},
                        {length: 125, capacity: 12},
                        {length: 150, capacity: 11},
                        {length: 175, capacity: 10},
                        {length: 200, capacity: 9},
                        {length: 250, capacity: 8},
                        {length: 300, capacity: 8},
                        {length: 350, capacity: 7},
                        {length: 400, capacity: 7},
                        {length: 450, capacity: 6},
                        {length: 500, capacity: 6}
                    ],
                    "5/8": [
                        {length: 10, capacity: 101},
                        {length: 20, capacity: 69},
                        {length: 30, capacity: 56},
                        {length: 40, capacity: 48},
                        {length: 50, capacity: 42},
                        {length: 60, capacity: 38},
                        {length: 70, capacity: 35},
                        {length: 80, capacity: 33},
                        {length: 90, capacity: 31},
                        {length: 100, capacity: 29},
                        {length: 125, capacity: 26},
                        {length: 150, capacity: 23},
                        {length: 175, capacity: 21},
                        {length: 200, capacity: 20},
                        {length: 250, capacity: 18},
                        {length: 300, capacity: 16},
                        {length: 350, capacity: 15},
                        {length: 400, capacity: 14},
                        {length: 450, capacity: 13},
                        {length: 500, capacity: 12}
                    ],
                    "3/4": [
                        {length: 10, capacity: 176},
                        {length: 20, capacity: 121},
                        {length: 30, capacity: 97},
                        {length: 40, capacity: 83},
                        {length: 50, capacity: 74},
                        {length: 60, capacity: 67},
                        {length: 70, capacity: 62},
                        {length: 80, capacity: 57},
                        {length: 90, capacity: 54},
                        {length: 100, capacity: 51},
                        {length: 125, capacity: 45},
                        {length: 150, capacity: 41},
                        {length: 175, capacity: 38},
                        {length: 200, capacity: 35},
                        {length: 250, capacity: 31},
                        {length: 300, capacity: 28},
                        {length: 350, capacity: 26},
                        {length: 400, capacity: 24},
                        {length: 450, capacity: 23},
                        {length: 500, capacity: 21}
                    ]
                }
            }
        };

        function addAppliance() {
            const appliancesList = document.getElementById('appliancesList');
            const applianceItem = document.createElement('div');
            applianceItem.className = 'appliance-item';
            applianceItem.innerHTML = `
                <button class="remove-appliance" onclick="removeAppliance(this)">×</button>
                <label>Appliance Name:</label>
                <input type="text" class="appliance-name" placeholder="e.g., Water Heater">
                <label style="margin-top: 10px;">Capacity (Btu/h):</label>
                <input type="number" class="appliance-btuh" placeholder="Enter Btu/h" min="1">
            `;
            appliancesList.appendChild(applianceItem);
            updateTotal();
        }

        function removeAppliance(button) {
            button.parentElement.remove();
            updateTotal();
        }

        function updateTotal() {
            const applianceBtuhs = document.querySelectorAll('.appliance-btuh');
            let total = 0;
            applianceBtuhs.forEach(input => {
                const value = parseFloat(input.value) || 0;
                total += value;
            });
            document.getElementById('totalBtuh').textContent = total.toLocaleString() + ' Btu/h';
        }

        // Update total when appliance values change
        document.addEventListener('input', function(e) {
            if (e.target.classList.contains('appliance-btuh')) {
                updateTotal();
            }
        });

        function interpolateCapacity(length, capacityData) {
            // Find the closest length values in the table
            let lowerBound = null;
            let upperBound = null;

            for (let i = 0; i < capacityData.length; i++) {
                if (capacityData[i].length <= length) {
                    lowerBound = capacityData[i];
                }
                if (capacityData[i].length >= length && !upperBound) {
                    upperBound = capacityData[i];
                    break;
                }
            }

            if (!lowerBound && upperBound) {
                return upperBound.capacity;
            }
            if (lowerBound && !upperBound) {
                return lowerBound.capacity;
            }
            if (lowerBound && upperBound && lowerBound.length === upperBound.length) {
                return lowerBound.capacity;
            }
            if (lowerBound && upperBound) {
                // Linear interpolation
                const ratio = (length - lowerBound.length) / (upperBound.length - lowerBound.length);
                return lowerBound.capacity + ratio * (upperBound.capacity - lowerBound.capacity);
            }

            return 0;
        }

        function findRequiredPipeSize(totalBtuh, lmr, pipeType, pressure) {
            const tables = extendedCapacityTables[pipeType][pressure];
            const pipeSizes = Object.keys(tables);
            
            for (let size of pipeSizes) {
                const capacity = interpolateCapacity(lmr, tables[size]);
                if (capacity >= totalBtuh) {
                    return {
                        size: size,
                        capacity: Math.round(capacity),
                        available: Math.round(capacity - totalBtuh)
                    };
                }
            }
            
            return null;
        }

        function calculatePipeSize() {
            const totalBtuh = parseFloat(document.getElementById('totalBtuh').textContent.replace(/[^\d]/g, ''));
            const lmr = parseFloat(document.getElementById('lmr').value);
            const pipeType = document.getElementById('pipeType').value;
            const pressure = document.getElementById('pressure').value;
            const gasType = document.getElementById('gasType').value;

            if (!totalBtuh || totalBtuh <= 0) {
                document.getElementById('results').innerHTML = `
                    <div class="warning">
                        <strong>Warning:</strong> Please enter at least one appliance with a valid Btu/h rating.
                    </div>
                `;
                return;
            }

            if (!lmr || lmr <= 0) {
                document.getElementById('results').innerHTML = `
                    <div class="warning">
                        <strong>Warning:</strong> Please enter a valid Longest Measured Run (LMR).
                    </div>
                `;
                return;
            }

            if (gasType === 'propane') {
                document.getElementById('results').innerHTML = `
                    <div class="warning">
                        <strong>Note:</strong> Propane sizing tables (Annex B) will be available in the next update.
                    </div>
                `;
                return;
            }

            const result = findRequiredPipeSize(totalBtuh, lmr, pipeType, pressure);

            if (!result) {
                document.getElementById('results').innerHTML = `
                    <div class="warning">
                        <strong>Warning:</strong> The required capacity (${totalBtuh.toLocaleString()} Btu/h) exceeds the maximum capacity for available pipe sizes at ${lmr} feet. Consider reducing the load, shortening the run, or increasing the operating pressure.
                    </div>
                `;
                return;
            }

            const pipeTypeName = pipeType === 'schedule40' ? 'Schedule 40 Black Iron Pipe' : 'Type K Copper Tubing';
            const pressureText = {
                '0.5': '< 1.75 kPa (< 7" w.c.) - Tables A.1 & A.8',
                '1.75': '1.75 kPa (7" w.c.) - Tables A.2 & A.9',
                '3.5': '3.5 kPa (14" w.c.) - Tables A.3 & A.10',
                '7': '7 kPa (2 psig) - Tables A.4 & A.11',
                '17': '17 kPa (5 psig) - Tables A.5 & A.12',
                '35': '35 kPa (10 psig) - Tables A.6 & A.13',
                '70': '70 kPa (20 psig) - Tables A.7 & A.14'
            }[pressure];

            document.getElementById('results').innerHTML = `
                <div class="result-item">
                    <h4>Recommended Pipe Size</h4>
                    <p><strong>Size:</strong> ${result.size}" ${pipeTypeName}</p>
                    <p><strong>Capacity at ${lmr} ft:</strong> ${result.capacity.toLocaleString()} Btu/h</p>
                    <p><strong>System Load:</strong> ${totalBtuh.toLocaleString()} Btu/h</p>
                    <p><strong>Available Capacity:</strong> ${result.available.toLocaleString()} Btu/h</p>
                    <p><strong>Utilization:</strong> ${Math.round((totalBtuh / result.capacity) * 100)}%</p>
                </div>

                <div class="result-item">
                    <h4>System Parameters</h4>
                    <p><strong>Gas Type:</strong> Natural Gas (0.6 Relative Density)</p>
                    <p><strong>Operating Pressure:</strong> ${pressureText}</p>
                    <p><strong>Longest Measured Run:</strong> ${lmr} feet</p>
                    <p><strong>Pipe Material:</strong> ${pipeTypeName}</p>
                </div>

                <div class="calculation-details">
                    <strong>Calculation Method:</strong><br>
                    Based on CSA B149.1:25 Annex A capacity tables<br>
                    Interpolated capacity for ${lmr} ft length<br>
                    Selected minimum pipe size meeting capacity requirement
                </div>

                <div class="warning">
                    <strong>Important:</strong> This calculation is based on natural gas with 0.6 relative density. Verify actual gas composition and adjust if necessary. Always consult local codes and qualified professionals.
                </div>
            `;
        }

        // Initialize with first calculation
        updateTotal();
    </script>
</body>
</html>