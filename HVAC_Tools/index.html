<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HVAC Pro Tools 3.0</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Professional HVAC calculation tools for technicians and engineers including load calculations, superheat/subcool, P-T charts, and unit conversions.">
    <meta name="theme-color" content="#1e3c72">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="HVAC Pro Tools">
    <meta name="msapplication-TileColor" content="#1e3c72">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Favicon and App Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-180.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icon-180.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 10px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            text-align: center;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            position: relative;
        }

        .header h1 {
            color: #1e3c72;
            font-size: 1.8em;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .header p {
            color: #718096;
            font-size: 0.9em;
        }

        /* Install Button */
        .install-container {
            position: absolute;
            top: 15px;
            right: 15px;
        }

        .install-btn {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.8em;
            font-weight: 600;
            cursor: pointer;
            display: none;
            align-items: center;
            gap: 5px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(72, 187, 120, 0.3);
        }

        .install-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(72, 187, 120, 0.4);
        }

        .install-btn.show {
            display: flex;
        }

        /* Navigation Menu */
        .nav-menu {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9em;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            white-space: nowrap;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            box-shadow: 0 5px 20px rgba(255, 107, 107, 0.4);
        }

        /* Calculator Containers */
        .calculator {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            display: none;
        }

        .calculator.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .calc-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .calc-header h2 {
            color: #2d3748;
            font-size: 1.5em;
            margin-bottom: 8px;
        }

        .calc-header p {
            color: #718096;
            font-size: 0.9em;
        }

        /* Form Styling */
        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            color: #4a5568;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            background: white;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Button Styling */
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #a0aec0 0%, #718096 100%);
            box-shadow: 0 4px 15px rgba(160, 174, 192, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
            box-shadow: 0 4px 15px rgba(245, 101, 101, 0.3);
        }

        .btn-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        /* Results Display */
        .results {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #667eea;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: 600;
            color: #4a5568;
        }

        .result-value {
            font-weight: 700;
            color: #2d3748;
            font-size: 1.1em;
        }

        /* Status Indicators */
        .status-good { color: #48bb78; }
        .status-warning { color: #ed8936; }
        .status-danger { color: #f56565; }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 5px;
            }
            
            .header h1 {
                font-size: 1.5em;
            }
            
            .nav-menu {
                padding: 10px;
            }
            
            .nav-btn {
                padding: 10px 16px;
                font-size: 0.8em;
            }
            
            .calculator {
                padding: 20px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .install-container {
                position: static;
                margin-top: 10px;
            }
        }

        /* Touch Optimization */
        @media (pointer: coarse) {
            .nav-btn, .btn {
                min-height: 44px;
                touch-action: manipulation;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="install-container">
                <button class="install-btn" id="installBtn" onclick="installApp()">
                    <span class="install-icon">📱</span>
                    Install App
                </button>
            </div>
            <h1>🔧 HVAC Pro Tools 3.0</h1>
            <p>Professional HVAC calculation suite for technicians and engineers</p>
        </div>

        <!-- Navigation Menu -->
        <div class="nav-menu">
            <button class="nav-btn active" onclick="showCalculator('load-calc', this)">Load Calculator</button>
            <button class="nav-btn" onclick="showCalculator('superheat-subcool', this)">SuperHeat/SubCool</button>
            <button class="nav-btn" onclick="showCalculator('pt-chart', this)">P-T Chart</button>
            <button class="nav-btn" onclick="showCalculator('psychrometric', this)">Psychrometric</button>
            <button class="nav-btn" onclick="showCalculator('unit-converter', this)">Unit Converter</button>
            <button class="nav-btn" onclick="showCalculator('duct-sizing', this)">Duct Sizing</button>
        </div>

        <!-- Load Calculator -->
        <div id="load-calc" class="calculator active">
            <div class="calc-header">
                <h2>🏠 Heat/Cool Load Calculator</h2>
                <p>Calculate heating and cooling loads for residential and commercial buildings</p>
            </div>
            
            <div class="form-group">
                <div class="form-row">
                    <div>
                        <label for="building-area">Building Area (sq ft)</label>
                        <input type="number" id="building-area" placeholder="e.g., 2000">
                    </div>
                    <div>
                        <label for="ceiling-height">Ceiling Height (ft)</label>
                        <input type="number" id="ceiling-height" value="8" placeholder="8">
                    </div>
                </div>
                
                <div class="form-row">
                    <div>
                        <label for="occupants">Number of Occupants</label>
                        <input type="number" id="occupants" value="2" placeholder="2">
                    </div>
                    <div>
                        <label for="insulation-level">Insulation Level</label>
                        <select id="insulation-level">
                            <option value="poor">Poor</option>
                            <option value="standard" selected>Standard</option>
                            <option value="good">Good</option>
                            <option value="excellent">Excellent</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div>
                        <label for="climate-zone">Climate Zone</label>
                        <select id="climate-zone">
                            <option value="4">Zone 4 (Moderate)</option>
                            <option value="5" selected>Zone 5 (Cool)</option>
                            <option value="6">Zone 6 (Cold)</option>
                            <option value="7a">Zone 7A (Very Cold)</option>
                            <option value="7b">Zone 7B (Very Cold)</option>
                            <option value="8">Zone 8 (Subarctic)</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn" onclick="calculateLoad()">🔥❄️ Calculate Load</button>
                <button class="btn btn-secondary" onclick="clearLoadInputs()">Clear</button>
            </div>
            
            <div id="load-results" class="results" style="display: none;"></div>
        </div>

        <!-- SuperHeat/SubCool Calculator -->
        <div id="superheat-subcool" class="calculator">
            <div class="calc-header">
                <h2>🌡️ SuperHeat/SubCool Calculator</h2>
                <p>Calculate superheat and subcooling for system diagnostics</p>
            </div>
            
            <div class="form-group">
                <h3 style="color: #e53e3e; margin-bottom: 15px;">SuperHeat Calculation</h3>
                <div class="form-row">
                    <div>
                        <label for="sh-saturated-temp">Saturated Temperature (°F)</label>
                        <input type="number" id="sh-saturated-temp" placeholder="e.g., 40">
                    </div>
                    <div>
                        <label for="sh-actual-temp">Actual Temperature (°F)</label>
                        <input type="number" id="sh-actual-temp" placeholder="e.g., 50">
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn" onclick="calculateSuperheat()">Calculate SuperHeat</button>
                    <button class="btn btn-secondary" onclick="resetSuperheat()">Reset</button>
                </div>
                <div id="superheat-result" class="results" style="display: none;"></div>
            </div>
            
            <div class="form-group">
                <h3 style="color: #3182ce; margin-bottom: 15px;">SubCooling Calculation</h3>
                <div class="form-row">
                    <div>
                        <label for="sc-saturated-temp">Saturated Temperature (°F)</label>
                        <input type="number" id="sc-saturated-temp" placeholder="e.g., 105">
                    </div>
                    <div>
                        <label for="sc-actual-temp">Actual Temperature (°F)</label>
                        <input type="number" id="sc-actual-temp" placeholder="e.g., 95">
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn" onclick="calculateSubcooling()">Calculate SubCooling</button>
                    <button class="btn btn-secondary" onclick="resetSubcooling()">Reset</button>
                </div>
                <div id="subcooling-result" class="results" style="display: none;"></div>
            </div>
        </div>

        <!-- P-T Chart Calculator -->
        <div id="pt-chart" class="calculator">
            <div class="calc-header">
                <h2>📊 Refrigeration P-T Chart</h2>
                <p>Generate pressure-temperature charts for refrigerants</p>
            </div>
            
            <div class="form-group">
                <div class="form-row">
                    <div>
                        <label for="pt-refrigerant">Refrigerant Type</label>
                        <select id="pt-refrigerant">
                            <option value="R22">R-22 (HCFC)</option>
                            <option value="R134a">R-134a (HFC)</option>
                            <option value="R410A" selected>R-410A (HFC)</option>
                            <option value="R404A">R-404A (HFC)</option>
                            <option value="R407C">R-407C (HFC)</option>
                            <option value="R32">R-32 (HFC - A2L)</option>
                            <option value="R454B">R-454B (HFO - A2L)</option>
                        </select>
                    </div>
                    <div>
                        <label for="pt-min-temp">Min Temperature (°C)</label>
                        <input type="number" id="pt-min-temp" value="-40" placeholder="-40">
                    </div>
                    <div>
                        <label for="pt-max-temp">Max Temperature (°C)</label>
                        <input type="number" id="pt-max-temp" value="60" placeholder="60">
                    </div>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn" onclick="generatePTChart()">📈 Generate Chart</button>
                <button class="btn btn-secondary" onclick="clearPTChart()">Clear</button>
            </div>
            
            <div id="pt-results" class="results" style="display: none;">
                <canvas id="pt-chart-canvas" width="400" height="300"></canvas>
            </div>
        </div>

        <!-- Psychrometric Calculator -->
        <div id="psychrometric" class="calculator">
            <div class="calc-header">
                <h2>💧 Psychrometric Calculator</h2>
                <p>Calculate air properties for comfort and efficiency analysis</p>
            </div>
            
            <div class="form-group">
                <div class="form-row">
                    <div>
                        <label for="dry-bulb-temp">Dry Bulb Temperature (°F)</label>
                        <input type="number" id="dry-bulb-temp" placeholder="e.g., 75">
                    </div>
                    <div>
                        <label for="relative-humidity">Relative Humidity (%)</label>
                        <input type="number" id="relative-humidity" placeholder="e.g., 50" min="0" max="100">
                    </div>
                </div>
                
                <div class="form-row">
                    <div>
                        <label for="barometric-pressure">Barometric Pressure (inHg)</label>
                        <input type="number" id="barometric-pressure" value="29.92" placeholder="29.92">
                    </div>
                    <div>
                        <label for="elevation">Elevation (ft)</label>
                        <input type="number" id="elevation" value="0" placeholder="0">
                    </div>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn" onclick="calculatePsychrometric()">💨 Calculate Properties</button>
                <button class="btn btn-secondary" onclick="clearPsychrometric()">Clear</button>
            </div>
            
            <div id="psychrometric-results" class="results" style="display: none;"></div>
        </div>

        <!-- Unit Converter -->
        <div id="unit-converter" class="calculator">
            <div class="calc-header">
                <h2>🔄 Universal Unit Converter</h2>
                <p>Convert between imperial and metric units</p>
            </div>
            
            <!-- Temperature Conversion -->
            <div class="form-group">
                <h3 style="color: #e53e3e; margin-bottom: 15px;">Temperature</h3>
                <div class="form-row">
                    <div>
                        <label for="temp-celsius">Celsius (°C)</label>
                        <input type="number" id="temp-celsius" placeholder="0" oninput="convertTemperature('c')">
                    </div>
                    <div>
                        <label for="temp-fahrenheit">Fahrenheit (°F)</label>
                        <input type="number" id="temp-fahrenheit" placeholder="32" oninput="convertTemperature('f')">
                    </div>
                </div>
            </div>
            
            <!-- Length Conversion -->
            <div class="form-group">
                <h3 style="color: #3182ce; margin-bottom: 15px;">Length</h3>
                <div class="form-row">
                    <div>
                        <label for="length-feet">Feet</label>
                        <input type="number" id="length-feet" placeholder="0" oninput="convertLength('ft')">
                    </div>
                    <div>
                        <label for="length-meters">Meters</label>
                        <input type="number" id="length-meters" placeholder="0" oninput="convertLength('m')">
                    </div>
                </div>
            </div>
            
            <!-- Pressure Conversion -->
            <div class="form-group">
                <h3 style="color: #805ad5; margin-bottom: 15px;">Pressure</h3>
                <div class="form-row">
                    <div>
                        <label for="pressure-psi">PSI</label>
                        <input type="number" id="pressure-psi" placeholder="0" oninput="convertPressure('psi')">
                    </div>
                    <div>
                        <label for="pressure-kpa">kPa</label>
                        <input type="number" id="pressure-kpa" placeholder="0" oninput="convertPressure('kpa')">
                    </div>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-danger" onclick="clearAllConversions()">Clear All</button>
            </div>
        </div>

        <!-- Duct Sizing Calculator -->
        <div id="duct-sizing" class="calculator">
            <div class="calc-header">
                <h2>💨 Duct Sizing Calculator</h2>
                <p>Calculate optimal duct sizes for HVAC systems</p>
            </div>
            
            <div class="form-group">
                <div class="form-row">
                    <div>
                        <label for="cfm-required">CFM Required</label>
                        <input type="number" id="cfm-required" placeholder="e.g., 400">
                    </div>
                    <div>
                        <label for="duct-type">Duct Type</label>
                        <select id="duct-type">
                            <option value="round">Round</option>
                            <option value="rectangular">Rectangular</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div>
                        <label for="friction-rate">Friction Rate (in. w.c./100 ft)</label>
                        <input type="number" id="friction-rate" value="0.08" step="0.01" placeholder="0.08">
                    </div>
                    <div>
                        <label for="velocity-limit">Max Velocity (FPM)</label>
                        <input type="number" id="velocity-limit" value="900" placeholder="900">
                    </div>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn" onclick="calculateDuctSize()">📏 Calculate Size</button>
                <button class="btn btn-secondary" onclick="clearDuctInputs()">Clear</button>
            </div>
            
            <div id="duct-results" class="results" style="display: none;"></div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        // Global variables
        let deferredPrompt;
        let currentChart = null;

        // Navigation Function
        function showCalculator(calcId, btn) {
            // Hide all calculators
            const calculators = document.querySelectorAll('.calculator');
            calculators.forEach(calc => calc.classList.remove('active'));
            
            // Remove active class from all nav buttons
            const navBtns = document.querySelectorAll('.nav-btn');
            navBtns.forEach(navBtn => navBtn.classList.remove('active'));
            
            // Show selected calculator
            document.getElementById(calcId).classList.add('active');
            btn.classList.add('active');
            
            console.log(`Showing calculator: ${calcId}`);
        }

        // Load Calculator Functions
        function calculateLoad() {
            const area = parseFloat(document.getElementById('building-area').value);
            const height = parseFloat(document.getElementById('ceiling-height').value) || 8;
            const occupants = parseInt(document.getElementById('occupants').value) || 2;
            const insulation = document.getElementById('insulation-level').value;
            const climateZone = document.getElementById('climate-zone').value;
            
            if (!area || area <= 0) {
                showResults('load-results', '<p style="color: #f56565; text-align: center;">Please enter a valid building area</p>');
                return;
            }
            
            // Climate factors for Canadian zones
            const climateFactors = {
                '4': { heating: 35, cooling: 25 },
                '5': { heating: 40, cooling: 30 },
                '6': { heating: 45, cooling: 35 },
                '7a': { heating: 50, cooling: 25 },
                '7b': { heating: 45, cooling: 30 },
                '8': { heating: 60, cooling: 20 }
            };
            
            // Insulation factors
            const insulationFactors = {
                'poor': 1.3,
                'standard': 1.0,
                'good': 0.8,
                'excellent': 0.6
            };
            
            const climate = climateFactors[climateZone];
            const insulationFactor = insulationFactors[insulation];
            
            // Calculate loads
            const heatingLoad = Math.round(area * climate.heating * insulationFactor + (occupants * 300));
            const coolingLoad = Math.round(area * climate.cooling * insulationFactor + (occupants * 400));
            
            const results = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div style="background: linear-gradient(135deg, #e53e3e, #c53030); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                        <h4 style="margin-bottom: 10px;">🔥 Heating Load</h4>
                        <div style="font-size: 2em; font-weight: bold;">${heatingLoad.toLocaleString()}</div>
                        <div>BTU/hr</div>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #3182ce, #2c5282); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                        <h4 style="margin-bottom: 10px;">❄️ Cooling Load</h4>
                        <div style="font-size: 2em; font-weight: bold;">${coolingLoad.toLocaleString()}</div>
                        <div>BTU/hr</div>
                    </div>
                </div>
                
                <div class="result-item">
                    <span class="result-label">Building Area:</span>
                    <span class="result-value">${area} sq ft</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Climate Zone:</span>
                    <span class="result-value">${climateZone}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Insulation Level:</span>
                    <span class="result-value">${insulation}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Occupants:</span>
                    <span class="result-value">${occupants}</span>
                </div>
                <div style="background: #e6fffa; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #38b2ac;">
                    <strong>💡 Equipment Recommendations:</strong><br>
                    Heating: ${Math.round(heatingLoad / 1000)}k BTU/hr unit<br>
                    Cooling: ${Math.round(coolingLoad / 1000)}k BTU/hr unit
                </div>
            `;
            
            showResults('load-results', results);
        }

        function clearLoadInputs() {
            document.getElementById('building-area').value = '';
            document.getElementById('ceiling-height').value = '8';
            document.getElementById('occupants').value = '2';
            document.getElementById('insulation-level').value = 'standard';
            document.getElementById('climate-zone').value = '5';
            hideResults('load-results');
        }

        // SuperHeat/SubCool Functions
        function calculateSuperheat() {
            const saturatedTemp = parseFloat(document.getElementById('sh-saturated-temp').value);
            const actualTemp = parseFloat(document.getElementById('sh-actual-temp').value);
            
            if (isNaN(saturatedTemp) || isNaN(actualTemp)) {
                showResults('superheat-result', '<p style="color: #f56565; text-align: center;">Please enter valid temperatures</p>');
                return;
            }
            
            const superheat = actualTemp - saturatedTemp;
            let status = '';
            let statusColor = '';
            
            if (superheat < 5) {
                status = 'LOW - Check for liquid refrigerant';
                statusColor = '#f56565';
            } else if (superheat > 20) {
                status = 'HIGH - Check refrigerant charge';
                statusColor = '#ed8936';
            } else {
                status = 'NORMAL - Good superheat level';
                statusColor = '#48bb78';
            }
            
            const results = `
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 2.5em; margin-bottom: 15px; color: ${statusColor}; font-weight: bold;">
                        ${superheat.toFixed(1)}°F
                    </div>
                    <div style="color: ${statusColor}; font-weight: bold; font-size: 1.1em;">
                        ${status}
                    </div>
                </div>
            `;
            
            showResults('superheat-result', results);
        }

        function resetSuperheat() {
            document.getElementById('sh-saturated-temp').value = '';
            document.getElementById('sh-actual-temp').value = '';
            hideResults('superheat-result');
        }

        function calculateSubcooling() {
            const saturatedTemp = parseFloat(document.getElementById('sc-saturated-temp').value);
            const actualTemp = parseFloat(document.getElementById('sc-actual-temp').value);
            
            if (isNaN(saturatedTemp) || isNaN(actualTemp)) {
                showResults('subcooling-result', '<p style="color: #f56565; text-align: center;">Please enter valid temperatures</p>');
                return;
            }
            
            const subcooling = saturatedTemp - actualTemp;
            let status = '';
            let statusColor = '';
            
            if (subcooling < 5) {
                status = 'LOW - Check condenser operation';
                statusColor = '#f56565';
            } else if (subcooling > 20) {
                status = 'HIGH - Check for overcharge';
                statusColor = '#ed8936';
            } else {
                status = 'NORMAL - Good subcooling level';
                statusColor = '#48bb78';
            }
            
            const results = `
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 2.5em; margin-bottom: 15px; color: ${statusColor}; font-weight: bold;">
                        ${subcooling.toFixed(1)}°F
                    </div>
                    <div style="color: ${statusColor}; font-weight: bold; font-size: 1.1em;">
                        ${status}
                    </div>
                </div>
            `;
            
            showResults('subcooling-result', results);
        }

        function resetSubcooling() {
            document.getElementById('sc-saturated-temp').value = '';
            document.getElementById('sc-actual-temp').value = '';
            hideResults('subcooling-result');
        }

        // P-T Chart Functions
        function generatePTChart() {
            const refrigerant = document.getElementById('pt-refrigerant').value;
            const minTemp = parseFloat(document.getElementById('pt-min-temp').value) || -40;
            const maxTemp = parseFloat(document.getElementById('pt-max-temp').value) || 60;
            
            // Clear existing chart
            if (currentChart) {
                currentChart.destroy();
            }
            
            // Generate data points
            const temperatureData = [];
            const pressureData = [];
            
            for (let temp = minTemp; temp <= maxTemp; temp += 2) {
                temperatureData.push(temp);
                // Simplified saturation pressure calculation
                const satPressure = Math.exp(16.3872 - 3885.7 / (temp + 273.15));
                pressureData.push(satPressure);
            }
            
            // Create chart
            const canvas = document.getElementById('pt-chart-canvas');
            const ctx = canvas.getContext('2d');
            
            currentChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: temperatureData,
                    datasets: [{
                        label: `${refrigerant} Saturation Curve`,
                        data: pressureData,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: `${refrigerant} Pressure-Temperature Chart`
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Temperature (°C)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Pressure (kPa)'
                            },
                            type: 'logarithmic'
                        }
                    }
                }
            });
            
            showResults('pt-results', '');
        }

        function clearPTChart() {
            if (currentChart) {
                currentChart.destroy();
                currentChart = null;
            }
            hideResults('pt-results');
        }

        // Psychrometric Functions
        function calculatePsychrometric() {
            const dryBulb = parseFloat(document.getElementById('dry-bulb-temp').value);
            const humidity = parseFloat(document.getElementById('relative-humidity').value);
            const pressure = parseFloat(document.getElementById('barometric-pressure').value) || 29.92;
            const elevation = parseFloat(document.getElementById('elevation').value) || 0;
            
            if (isNaN(dryBulb) || isNaN(humidity)) {
                showResults('psychrometric-results', '<p style="color: #f56565; text-align: center;">Please enter valid temperature and humidity values</p>');
                return;
            }
            
            // Convert to Celsius for calculations
            const tempC = (dryBulb - 32) * 5/9;
            
            // Basic psychrometric calculations
            const saturationPressure = 6.112 * Math.exp((17.67 * tempC) / (tempC + 243.5));
            const actualVaporPressure = (humidity / 100) * saturationPressure;
            const dewPointC = (243.5 * Math.log(actualVaporPressure / 6.112)) / (17.67 - Math.log(actualVaporPressure / 6.112));
            const dewPointF = dewPointC * 9/5 + 32;
            const absoluteHumidity = (actualVaporPressure * 2.166) / (tempC + 273.15);
            
            // Atmospheric pressure adjustment
            const adjustedPressure = pressure * Math.pow((1 - 0.0065 * elevation / 288.15), 5.255);
            
            const results = `
                <div class="result-item">
                    <span class="result-label">Dew Point:</span>
                    <span class="result-value">${dewPointF.toFixed(1)}°F</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Absolute Humidity:</span>
                    <span class="result-value">${absoluteHumidity.toFixed(3)} kg/m³</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Vapor Pressure:</span>
                    <span class="result-value">${actualVaporPressure.toFixed(2)} kPa</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Adjusted Pressure:</span>
                    <span class="result-value">${adjustedPressure.toFixed(2)} inHg</span>
                </div>
                <div style="background: ${humidity > 70 ? '#fed7d7' : humidity < 30 ? '#feebc8' : '#c6f6d5'}; padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <strong>Analysis:</strong> 
                    ${humidity > 70 ? 'High humidity - potential comfort and efficiency issues' : 
                      humidity < 30 ? 'Low humidity - potential comfort and static issues' : 
                      'Humidity levels are within comfortable range'}
                </div>
            `;
            
            showResults('psychrometric-results', results);
        }

        function clearPsychrometric() {
            document.getElementById('dry-bulb-temp').value = '';
            document.getElementById('relative-humidity').value = '';
            document.getElementById('barometric-pressure').value = '29.92';
            document.getElementById('elevation').value = '0';
            hideResults('psychrometric-results');
        }

        // Unit Converter Functions
        function convertTemperature(from) {
            if (from === 'c') {
                const celsius = parseFloat(document.getElementById('temp-celsius').value);
                if (!isNaN(celsius)) {
                    const fahrenheit = (celsius * 9/5) + 32;
                    document.getElementById('temp-fahrenheit').value = fahrenheit.toFixed(2);
                }
            } else {
                const fahrenheit = parseFloat(document.getElementById('temp-fahrenheit').value);
                if (!isNaN(fahrenheit)) {
                    const celsius = (fahrenheit - 32) * 5/9;
                    document.getElementById('temp-celsius').value = celsius.toFixed(2);
                }
            }
        }

        function convertLength(from) {
            if (from === 'ft') {
                const feet = parseFloat(document.getElementById('length-feet').value);
                if (!isNaN(feet)) {
                    const meters = feet * 0.3048;
                    document.getElementById('length-meters').value = meters.toFixed(3);
                }
            } else {
                const meters = parseFloat(document.getElementById('length-meters').value);
                if (!isNaN(meters)) {
                    const feet = meters / 0.3048;
                    document.getElementById('length-feet').value = feet.toFixed(3);
                }
            }
        }

        function convertPressure(from) {
            if (from === 'psi') {
                const psi = parseFloat(document.getElementById('pressure-psi').value);
                if (!isNaN(psi)) {
                    const kpa = psi * 6.89476;
                    document.getElementById('pressure-kpa').value = kpa.toFixed(2);
                }
            } else {
                const kpa = parseFloat(document.getElementById('pressure-kpa').value);
                if (!isNaN(kpa)) {
                    const psi = kpa / 6.89476;
                    document.getElementById('pressure-psi').value = psi.toFixed(2);
                }
            }
        }

        function clearAllConversions() {
            document.getElementById('temp-celsius').value = '';
            document.getElementById('temp-fahrenheit').value = '';
            document.getElementById('length-feet').value = '';
            document.getElementById('length-meters').value = '';
            document.getElementById('pressure-psi').value = '';
            document.getElementById('pressure-kpa').value = '';
        }

        // Duct Sizing Functions
        function calculateDuctSize() {
            const cfm = parseFloat(document.getElementById('cfm-required').value);
            const ductType = document.getElementById('duct-type').value;
            const frictionRate = parseFloat(document.getElementById('friction-rate').value) || 0.08;
            const maxVelocity = parseFloat(document.getElementById('velocity-limit').value) || 900;
            
            if (!cfm || cfm <= 0) {
                showResults('duct-results', '<p style="color: #f56565; text-align: center;">Please enter valid CFM requirement</p>');
                return;
            }
            
            let results = '';
            
            if (ductType === 'round') {
                // Round duct calculation
                const diameter = Math.sqrt((cfm * 144) / (Math.PI * maxVelocity / 4));
                const actualVelocity = (cfm * 144) / (Math.PI * Math.pow(diameter, 2) / 4);
                const standardSizes = [4, 5, 6, 7, 8, 9, 10, 12, 14, 16, 18, 20, 22, 24];
                const recommendedSize = standardSizes.find(size => size >= diameter) || Math.ceil(diameter);
                
                results = `
                    <div class="result-item">
                        <span class="result-label">Calculated Diameter:</span>
                        <span class="result-value">${diameter.toFixed(2)} inches</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Recommended Size:</span>
                        <span class="result-value status-good">${recommendedSize}" round</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Actual Velocity:</span>
                        <span class="result-value">${actualVelocity.toFixed(0)} FPM</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Friction Rate:</span>
                        <span class="result-value">${frictionRate} in. w.c./100 ft</span>
                    </div>
                `;
            } else {
                // Rectangular duct calculation
                const area = cfm / maxVelocity * 144;
                const aspectRatio = 3; // Default 3:1 ratio
                const height = Math.sqrt(area / aspectRatio);
                const width = area / height;
                
                results = `
                    <div class="result-item">
                        <span class="result-label">Required Area:</span>
                        <span class="result-value">${area.toFixed(0)} sq in</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Recommended Size:</span>
                        <span class="result-value status-good">${Math.ceil(width)}" x ${Math.ceil(height)}"</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Aspect Ratio:</span>
                        <span class="result-value">${aspectRatio}:1</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Velocity:</span>
                        <span class="result-value">${maxVelocity} FPM</span>
                    </div>
                `;
            }
            
            showResults('duct-results', results);
        }

        function clearDuctInputs() {
            document.getElementById('cfm-required').value = '';
            document.getElementById('duct-type').value = 'round';
            document.getElementById('friction-rate').value = '0.08';
            document.getElementById('velocity-limit').value = '900';
            hideResults('duct-results');
        }

        // Utility Functions
        function showResults(elementId, content) {
            const element = document.getElementById(elementId);
            element.innerHTML = content;
            element.style.display = 'block';
        }

        function hideResults(elementId) {
            const element = document.getElementById(elementId);
            element.style.display = 'none';
        }

        // PWA Installation
        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('PWA installation accepted');
                    }
                    deferredPrompt = null;
                    document.getElementById('installBtn').style.display = 'none';
                });
            }
        }

        // PWA Events
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installBtn').classList.add('show');
        });

        window.addEventListener('appinstalled', () => {
            console.log('PWA was installed');
            document.getElementById('installBtn').style.display = 'none';
        });

        // Mobile Touch Optimization
        document.addEventListener('DOMContentLoaded', function() {
            // Add touch-action to all interactive elements
            const interactiveElements = document.querySelectorAll('button, input, select');
            interactiveElements.forEach(element => {
                element.style.touchAction = 'manipulation';
            });
            
            console.log('✅ HVAC Pro Tools 3.0 initialized successfully');
        });

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html>