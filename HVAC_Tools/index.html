<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HVAC Pro Tools</title>
    <meta name="description" content="Professional HVAC calculation tools for technicians and engineers">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="HVAC Pro Tools">
    
    <!-- PWA Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icon-180.png">
    <link rel="apple-touch-icon" sizes="167x167" href="icon-167.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icon-152.png">
    <link rel="apple-touch-icon" sizes="120x120" href="icon-120.png">
    <link rel="manifest" href="#" id="app-manifest">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .app-header {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .app-title {
            font-size: 1.8em;
            font-weight: bold;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .app-subtitle {
            font-size: 0.9em;
            opacity: 0.8;
            margin-top: 5px;
        }

        .tools-grid {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .tool-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .tool-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            background: rgba(255, 255, 255, 0.2);
        }

        .tool-card.coming-soon {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .tool-card.coming-soon::before {
            content: 'COMING SOON';
            position: absolute;
            top: 10px;
            right: -30px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 5px 40px;
            font-size: 0.7em;
            font-weight: bold;
            transform: rotate(45deg);
            letter-spacing: 1px;
        }

        .tool-icon {
            font-size: 3em;
            margin-bottom: 15px;
            display: block;
        }

        .tool-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #4ecdc4;
        }

        .tool-description {
            font-size: 0.9em;
            line-height: 1.4;
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .tool-features {
            list-style: none;
            font-size: 0.8em;
        }

        .tool-features li {
            margin-bottom: 5px;
            opacity: 0.8;
        }

        .tool-features li::before {
            content: '‚úì ';
            color: #4ecdc4;
            font-weight: bold;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            border-radius: 15px;
            padding: 30px;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5em;
            color: #4ecdc4;
        }

        .close-btn {
            background: none;
            border: none;
            color: #fff;
            font-size: 1.5em;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: background 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .download-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px;
            text-align: center;
        }

        .download-btn {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .install-instructions {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px;
        }

        .install-instructions h3 {
            color: #4ecdc4;
            margin-bottom: 15px;
        }

        .install-instructions ol {
            text-align: left;
            padding-left: 20px;
        }

        .install-instructions li {
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .footer {
            text-align: center;
            padding: 40px 20px;
            background: rgba(0, 0, 0, 0.3);
            margin-top: 40px;
        }

        /* Enhanced Tool Navigation */
        .tool-nav {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .nav-btn {
            background: rgba(78, 205, 196, 0.2);
            border: 1px solid rgba(78, 205, 196, 0.4);
            color: #4ecdc4;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
            text-decoration: none;
        }

        .nav-btn:hover, .nav-btn.active {
            background: rgba(78, 205, 196, 0.3);
            border-color: #4ecdc4;
            color: white;
            transform: translateY(-2px);
        }

        /* Enhanced Input Styling */
        .input-group {
            margin-bottom: 20px;
        }

        .input-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4ecdc4;
            font-size: 0.95em;
        }

        .input-field {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid rgba(78, 205, 196, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: #4ecdc4;
            box-shadow: 0 0 10px rgba(78, 205, 196, 0.3);
            background: rgba(255, 255, 255, 0.15);
        }

        .input-field::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        /* Enhanced Button Styling */
        .btn-primary {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(78, 205, 196, 0.4);
            background: linear-gradient(45deg, #44a08d, #4ecdc4);
        }

        .btn-secondary {
            background: transparent;
            color: #4ecdc4;
            border: 2px solid #4ecdc4;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-secondary:hover {
            background: #4ecdc4;
            color: white;
            transform: translateY(-2px);
        }

        /* Results Enhancement */
        .results-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            border: 1px solid rgba(78, 205, 196, 0.3);
            backdrop-filter: blur(10px);
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: 600;
            color: #4ecdc4;
        }

        .result-value {
            font-size: 1.1em;
            font-weight: bold;
            color: white;
        }

        /* Save/Load Feature Styling */
        .data-management {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .saved-calculations {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .saved-item {
            background: rgba(78, 205, 196, 0.1);
            border: 1px solid rgba(78, 205, 196, 0.3);
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .saved-item:hover {
            background: rgba(78, 205, 196, 0.2);
            transform: translateY(-2px);
        }

        .saved-item-title {
            font-weight: bold;
            color: #4ecdc4;
            margin-bottom: 5px;
        }

        .saved-item-date {
            font-size: 0.8em;
            opacity: 0.7;
        }

        /* Enhanced Mobile Responsiveness */
        @media (max-width: 768px) {
            .tools-grid {
                grid-template-columns: 1fr;
                padding: 15px;
            }
            
            .tool-card {
                padding: 20px;
            }
            
            .modal-content {
                max-width: 95vw;
                padding: 20px;
            }
            
            .tool-nav {
                margin: 15px;
                padding: 10px;
            }
            
            .nav-btn {
                font-size: 0.8em;
                padding: 6px 12px;
            }
            
            .results-container {
                padding: 20px;
                margin: 20px 0;
            }
        }

        .footer-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
        }

        .lark-logo {
            width: 60px;
            height: 60px;
            margin-right: 15px;
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
        }

        .footer-text {
            font-size: 1.1em;
            font-weight: bold;
            color: #4ecdc4;
            margin-bottom: 10px;
        }

        .copyright {
            font-size: 0.9em;
            opacity: 0.7;
            margin-bottom: 5px;
        }

        .app-content {
            display: none;
            padding: 20px;
            max-width: 100%;
            overflow-x: auto;
        }

        .back-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 20px;
            font-size: 1em;
        }

        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        @media (max-width: 768px) {
            .tools-grid {
                grid-template-columns: 1fr;
                padding: 15px;
            }
            
            .tool-card {
                padding: 20px;
            }
            
            .modal-content {
                padding: 20px;
                max-width: 95vw;
            }
        }

        /* PWA specific styles */
        .pwa-prompt {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            padding: 15px;
            border-radius: 10px;
            display: none;
            z-index: 1001;
        }

        .pwa-prompt button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            margin: 5px;
            cursor: pointer;
        }

        /* Hide download section when app is installed */
        .app-installed .download-section {
            display: none;
        }

        /* Psychrometric and Unit Converter specific styles */
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .result-item:last-child {
            border-bottom: none;
        }
        .result-label {
            font-weight: 500;
            color: #555;
        }
        .result-value {
            font-weight: 600;
            color: #2196F3;
        }
        .unit-btn {
            padding: 8px 16px;
            border: 2px solid #2196F3;
            background: white;
            color: #2196F3;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .unit-btn.active {
            background: #2196F3 !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <div id="main-app">
        <header class="app-header">
            <h1 class="app-title">üîß HVAC Pro Tools</h1>
            <p class="app-subtitle">Professional HVAC Calculation Suite</p>
            
            <!-- Enhanced Navigation and Features -->
            <div class="tool-nav" style="margin: 15px 0;">
                <button class="nav-btn active" onclick="showMainTools()">üè† All Tools</button>
                <button class="nav-btn" onclick="hvacEnhanced.showSavedCalculations()">üíæ Saved</button>
                <button class="nav-btn" id="installAppBtn" onclick="showInstallPrompt()" style="display: none;">üì± Install App</button>
                <button class="nav-btn" onclick="showHelpGuide()">‚ùì Help</button>
            </div>
        </header>



        <main class="tools-grid">
            <!-- Heat/Cool Load Calculator -->
            <div class="tool-card" onclick="openTool('load-calculator')">
                <span class="tool-icon">üè†</span>
                <h3 class="tool-title">Heat/Cool Load Calculator</h3>
                <p class="tool-description">Calculate heating and cooling loads for residential and commercial spaces.</p>
                <ul class="tool-features">
                    <li>Canadian climate data</li>
                    <li>Building envelope analysis</li>
                    <li>Multiple building types</li>
                    <li>Imperial/Metric units</li>
                </ul>
            </div>

            <!-- SuperHeat / SubCool Calculator -->
            <div class="tool-card" onclick="openTool('superheat-subcool')">
                <span class="tool-icon">üå°Ô∏è</span>
                <h3 class="tool-title">SuperHeat / SubCool Calculator</h3>
                <p class="tool-description">Calculate superheat and subcooling values for refrigeration systems.</p>
                <ul class="tool-features">
                    <li>Multiple refrigerant types</li>
                    <li>A2L safety warnings</li>
                    <li>Real-time calculations</li>
                    <li>Acceptable range indicators</li>
                </ul>
            </div>

            <!-- Refrigeration P-T Chart Tool -->
            <div class="tool-card" onclick="openTool('pt-chart')">
                <span class="tool-icon">üìä</span>
                <h3 class="tool-title">Refrigeration P-T Chart Tool</h3>
                <p class="tool-description">Interactive pressure-temperature charts for refrigeration analysis.</p>
                <ul class="tool-features">
                    <li>Multiple refrigerant options</li>
                    <li>Interactive charts</li>
                    <li>Saturation curves</li>
                    <li>Isotherm visualization</li>
                </ul>
            </div>

            <!-- Psychrometric Calculator -->
            <div class="tool-card" onclick="openTool('psychrometric')">
                <span class="tool-icon">üíß</span>
                <h3 class="tool-title">Psychrometric Calculator</h3>
                <p class="tool-description">Advanced pressure chart analysis and air property calculations.</p>
                <ul class="tool-features">
                    <li>Humidity calculations</li>
                    <li>Dew point analysis</li>
                    <li>Enthalpy calculations</li>
                    <li>Interactive psychrometric charts</li>
                </ul>
            </div>

            <!-- Universal Unit Converter -->
            <div class="tool-card" onclick="openTool('unit-converter')">
                <span class="tool-icon">üîÑ</span>
                <h3 class="tool-title">Universal Unit Converter</h3>
                <p class="tool-description">Convert between Imperial, Metric, Temperature, Pressure, Energy & Power units.</p>
                <ul class="tool-features">
                    <li>Length & weight conversion</li>
                    <li>Temperature conversion</li>
                    <li>Pressure & energy units</li>
                    <li>Power calculations</li>
                </ul>
            </div>

            <!-- Duct Sizing Calculator -->
            <div class="tool-card" onclick="openTool('duct-sizing')">
                <span class="tool-icon">üí®</span>
                <h3 class="tool-title">Duct Sizing Calculator</h3>
                <p class="tool-description">Professional duct sizing based on CSA and NBC standards.</p>
                <ul class="tool-features">
                    <li>Canadian climate zones</li>
                    <li>Multiple duct materials</li>
                    <li>Pressure loss analysis</li>
                    <li>Room-by-room calculations</li>
                </ul>
            </div>

            <!-- Pipe/Tube Sizing Calculator -->
            <div class="tool-card coming-soon" onclick="showComingSoon('Pipe/Tube Sizing Calculator')">
                <span class="tool-icon">üîß</span>
                <h3 class="tool-title">Pipe/Tube Sizing Calculator</h3>
                <p class="tool-description">Size refrigerant and water pipes for optimal system performance.</p>
                <ul class="tool-features">
                    <li>Refrigerant line sizing</li>
                    <li>Water pipe calculations</li>
                    <li>Pressure drop analysis</li>
                    <li>Velocity recommendations</li>
                </ul>
            </div>
        </main>

        <footer class="footer">
            <div class="footer-logo">
                <div class="lark-logo">üê¶</div>
                <div>
                    <div class="footer-text">Created by LARK Labs</div>
                    <div style="font-size: 0.8em; opacity: 0.7;">Software Development</div>
                </div>
            </div>
            <div class="copyright">¬© 2025 LARK Labs. All rights reserved.</div>
            <div class="copyright">Professional HVAC calculation tools for technicians and engineers.</div>
            <div class="copyright">This software is provided "as is" without warranty. Use at your own discretion.</div>
        </footer>
    </div>

    <!-- Install Modal -->
    <div id="installModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üì± Install HVAC Pro Tools</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            
            <div class="install-instructions">
                <h3>üì± iOS Installation:</h3>
                <ol>
                    <li>Open this page in Safari</li>
                    <li>Tap the Share button (square with arrow)</li>
                    <li>Scroll down and tap "Add to Home Screen"</li>
                    <li>Tap "Add" to install the app</li>
                </ol>
            </div>

            <div class="install-instructions">
                <h3>ü§ñ Android Installation:</h3>
                <ol>
                    <li>Open this page in Chrome</li>
                    <li>Tap the menu (three dots)</li>
                    <li>Tap "Add to Home screen"</li>
                    <li>Tap "Add" to install the app</li>
                </ol>
            </div>

            <div style="text-align: center; padding: 20px;">
                <button class="download-btn" onclick="installPWA()">üöÄ Install Now</button>
            </div>
        </div>
    </div>

    <!-- Coming Soon Modal -->
    <div id="comingSoonModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üöß Coming Soon</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div style="text-align: center; padding: 20px;">
                <p id="comingSoonText" style="font-size: 1.2em; margin-bottom: 20px;"></p>
                <p>This feature is currently under development and will be available in a future update.</p>
                <button class="download-btn" onclick="closeModal()" style="margin-top: 20px;">OK</button>
            </div>
        </div>
    </div>

    <!-- PWA Install Prompt -->
    <div id="pwaPrompt" class="pwa-prompt">
        <p>üì± Install HVAC Pro Tools for easy access!</p>
        <button onclick="installPWA()">Install</button>
        <button onclick="dismissPrompt()">Later</button>
    </div>

    <!-- Tool Content Areas -->
    <div id="load-calculator" class="app-content">
        <button class="back-btn" onclick="showMainApp()">‚Üê Back to Tools</button>
        <div id="load-calculator-content"></div>
    </div>

    <div id="superheat-subcool" class="app-content">
        <button class="back-btn" onclick="showMainApp()">‚Üê Back to Tools</button>
        <div id="superheat-subcool-content"></div>
    </div>

    <div id="pt-chart" class="app-content">
        <button class="back-btn" onclick="showMainApp()">‚Üê Back to Tools</button>
        <div id="pt-chart-content"></div>
    </div>

    <div id="psychrometric" class="app-content">
        <button class="back-btn" onclick="showMainApp()">‚Üê Back to Tools</button>
        <div id="psychrometric-content"></div>
    </div>

    <div id="unit-converter" class="app-content">
        <button class="back-btn" onclick="showMainApp()">‚Üê Back to Tools</button>
        <div id="unit-converter-content"></div>
    </div>

    <div id="duct-sizing" class="app-content">
        <button class="back-btn" onclick="showMainApp()">‚Üê Back to Tools</button>
        <div id="duct-sizing-content"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="enhanced-refrigerant-data.js"></script>
    <script src="enhanced-features.js"></script>
    <script src="accessibility-enhancements.js"></script>
    <!-- Mobile Touch Fix for Tool Opening -->
    <script src="mobile-fix.js"></script>
    <!-- Comprehensive Mobile Optimization -->
    <script src="mobile-optimization.js"></script>
    <!-- Missing Functions Fix -->
    <script src="missing-functions.js"></script>
    <!-- Final Mobile Fix - Must load last -->
    <script src="mobile-final-fix.js"></script>
    <script>
        let deferredPrompt;
        let isInstalled = false;

        // Check if already installed
        if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone) {
            isInstalled = true;
            document.body.classList.add('app-installed');
        }

        // PWA Installation
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            if (!isInstalled) {
                showPWAPrompt();
            }
        });

        window.addEventListener('appinstalled', () => {
            isInstalled = true;
            document.body.classList.add('app-installed');
            hidePWAPrompt();
            const downloadSection = document.getElementById('downloadSection');
            if (downloadSection) {
                downloadSection.style.display = 'none';
            }
        });

        function showPWAPrompt() {
            if (!isInstalled) {
                document.getElementById('pwaPrompt').style.display = 'block';
            }
        }

        function dismissPrompt() {
            document.getElementById('pwaPrompt').style.display = 'none';
        }

        function hidePWAPrompt() {
            document.getElementById('pwaPrompt').style.display = 'none';
        }

        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                        hidePWAPrompt();
                    }
                    deferredPrompt = null;
                });
            } else {
                showInstallModal();
            }
            closeModal();
        }

        function showInstallModal() {
            document.getElementById('installModal').style.display = 'block';
        }

        function showComingSoon(toolName) {
            document.getElementById('comingSoonText').textContent = toolName + ' is coming soon!';
            document.getElementById('comingSoonModal').style.display = 'block';
        }

        function closeModal() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
        }

        function showMainApp() {
            document.getElementById('main-app').style.display = 'block';
            document.querySelectorAll('.app-content').forEach(content => {
                content.style.display = 'none';
            });
        }

        function showMainTools() {
            showMainApp();
            // Update navigation
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.nav-btn').classList.add('active');
        }

        function showHelpGuide() {
            const helpModal = document.createElement('div');
            helpModal.className = 'modal';
            helpModal.style.display = 'block';
            helpModal.innerHTML = `
                <div class="modal-content" style="max-width: 600px;">
                    <div class="modal-header">
                        <h2 class="modal-title">üîß HVAC Pro Tools Help Guide</h2>
                        <button class="close-btn" onclick="this.parentElement.parentElement.parentElement.remove()">√ó</button>
                    </div>
                    
                    <div style="padding: 20px 0;">
                        <h3 style="color: #4ecdc4; margin-bottom: 15px;">üìö Available Tools</h3>
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #ff6b6b;">üè† Load Calculator</h4>
                            <p>Calculate heating and cooling loads for buildings using Canadian climate data. Includes building envelope analysis and equipment sizing recommendations.</p>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #74b9ff;">üå°Ô∏è Superheat/Subcooling</h4>
                            <p>Calculate superheat and subcooling values for refrigeration system diagnostics. Essential for proper system charging and troubleshooting.</p>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #a29bfe;">üìä P-T Charts</h4>
                            <p>Interactive pressure-temperature charts for all common refrigerants including A2L refrigerants. Perfect for field diagnosis.</p>
                        </div>
                        
                        <h3 style="color: #4ecdc4; margin: 25px 0 15px 0;">üíæ Enhanced Features</h3>
                        <ul style="list-style: none; padding: 0;">
                            <li style="margin: 8px 0; padding: 8px; background: rgba(78, 205, 196, 0.1); border-radius: 5px;">üíæ <strong>Save Calculations:</strong> Store your calculations for later reference</li>
                            <li style="margin: 8px 0; padding: 8px; background: rgba(78, 205, 196, 0.1); border-radius: 5px;">üìÑ <strong>Export to PDF:</strong> Generate professional reports</li>
                            <li style="margin: 8px 0; padding: 8px; background: rgba(78, 205, 196, 0.1); border-radius: 5px;">üì± <strong>Install as App:</strong> Add to home screen for offline use</li>
                            <li style="margin: 8px 0; padding: 8px; background: rgba(78, 205, 196, 0.1); border-radius: 5px;">üîÑ <strong>Auto-save:</strong> Your inputs are automatically saved</li>
                        </ul>
                        
                        <h3 style="color: #4ecdc4; margin: 25px 0 15px 0;">üéØ Pro Tips</h3>
                        <ul style="list-style: none; padding: 0;">
                            <li style="margin: 8px 0;">‚Ä¢ Use Enhanced Calculate for detailed analysis and equipment recommendations</li>
                            <li style="margin: 8px 0;">‚Ä¢ Canadian climate data is built-in for accurate regional calculations</li>
                            <li style="margin: 8px 0;">‚Ä¢ All calculations include appropriate safety factors</li>
                            <li style="margin: 8px 0;">‚Ä¢ Results can be exported as professional PDF reports</li>
                        </ul>
                    </div>
                </div>
            `;
            document.body.appendChild(helpModal);
        }

        function openTool(toolId) {
            document.getElementById('main-app').style.display = 'none';
            document.getElementById(toolId).style.display = 'block';
            loadToolContent(toolId);
        }

        function loadToolContent(toolId) {
            const contentDiv = document.getElementById(toolId + '-content');
            
            if (toolId === 'load-calculator') {
                contentDiv.innerHTML = getLoadCalculatorContent();
                initializeLoadCalculator();
            } else if (toolId === 'superheat-subcool') {
                contentDiv.innerHTML = getSuperheatSubcoolContent();
                initializeSuperheatSubcool();
            } else if (toolId === 'pt-chart') {
                contentDiv.innerHTML = getPTChartContent();
                initializePTChart();
            } else if (toolId === 'psychrometric') {
                contentDiv.innerHTML = getPsychrometricContent();
                initializePsychrometric();
            } else if (toolId === 'unit-converter') {
                contentDiv.innerHTML = getUnitConverterContent();
                initializeUnitConverter();
            } else if (toolId === 'duct-sizing') {
                contentDiv.innerHTML = getDuctSizingContent();
                initializeDuctSizing();
            }
        }

        // Load Calculator Content
        function getLoadCalculatorContent() {
            return `
                <div style="max-width: 1200px; margin: 0 auto; background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                    <div style="background: linear-gradient(135deg, #2c3e50, #3498db); color: white; padding: 30px; text-align: center;">
                        <h1 style="font-size: 2.5em; margin-bottom: 10px; font-weight: 300;">üè† Canadian HVAC Load Calculator</h1>
                        <p style="font-size: 1.1em; opacity: 0.9;">Professional heating and cooling load calculations for Canadian climates</p>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; padding: 30px;">
                        <div style="background: #f8f9fa; padding: 25px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.05);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h2 style="font-size: 1.4em; color: #2c3e50; margin-bottom: 0; font-weight: 600; border-bottom: 3px solid #3498db; padding-bottom: 10px;">Building Information</h2>
                                <button onclick="toggleUnitsLC()" style="background: linear-gradient(135deg, #27ae60, #2ecc71); border: none; border-radius: 25px; padding: 10px 20px; color: white; cursor: pointer; font-weight: 600; transition: all 0.3s ease; font-size: 0.9em; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                                    üìè Switch to <span id="lc-unit-display">Imperial</span>
                                </button>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; color: #34495e; font-weight: 500;">Province/Territory <span style="color: #3498db; cursor: help; margin-left: 5px;" title="Climate data varies significantly across Canada">‚ÑπÔ∏è</span></label>
                                <select id="lc-province" style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 16px; transition: border-color 0.3s ease;">
                                    <option value="">Select Province/Territory</option>
                                    <option value="BC">British Columbia</option>
                                    <option value="AB">Alberta</option>
                                    <option value="SK">Saskatchewan</option>
                                    <option value="MB">Manitoba</option>
                                    <option value="ON" selected>Ontario</option>
                                    <option value="QC">Quebec</option>
                                    <option value="NB">New Brunswick</option>
                                    <option value="NS">Nova Scotia</option>
                                    <option value="PE">Prince Edward Island</option>
                                    <option value="NL">Newfoundland and Labrador</option>
                                    <option value="YT">Yukon</option>
                                    <option value="NT">Northwest Territories</option>
                                    <option value="NU">Nunavut</option>
                                </select>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; color: #34495e; font-weight: 500;">Floor Area <span id="lc-area-unit">(ft¬≤)</span> <span style="color: #3498db; cursor: help; margin-left: 5px;" title="Total conditioned floor area">‚ÑπÔ∏è</span></label>
                                <input type="number" id="lc-area" placeholder="e.g., 1600" min="1" style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 16px; transition: border-color 0.3s ease;">
                            </div>

                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; color: #34495e; font-weight: 500;">Ceiling Height <span id="lc-height-unit">(ft)</span></label>
                                <input type="number" id="lc-ceiling-height" placeholder="e.g., 8" min="6" max="16" step="0.1" value="8" style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 16px; transition: border-color 0.3s ease;">
                            </div>

                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; color: #34495e; font-weight: 500;">Insulation Level</label>
                                <select id="lc-insulation" style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 16px; transition: border-color 0.3s ease;">
                                    <option value="poor">Poor (R-8 walls, R-20 attic)</option>
                                    <option value="average" selected>Average (R-12 walls, R-30 attic)</option>
                                    <option value="good">Good (R-20 walls, R-40 attic)</option>
                                    <option value="excellent">Excellent (R-24+ walls, R-50+ attic)</option>
                                </select>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; color: #34495e; font-weight: 500;">Window Area <span id="lc-window-unit">(ft¬≤)</span> <span style="color: #3498db; cursor: help; margin-left: 5px;" title="Total area of all windows and doors with glass">‚ÑπÔ∏è</span></label>
                                <input type="number" id="lc-windows" placeholder="e.g., 270" min="0" style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 16px; transition: border-color 0.3s ease;">
                            </div>

                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; color: #34495e; font-weight: 500;">Window Type</label>
                                <select id="lc-window-type" style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 16px; transition: border-color 0.3s ease;">
                                    <option value="single">Single Pane</option>
                                    <option value="double" selected>Double Pane</option>
                                    <option value="triple">Triple Pane</option>
                                    <option value="low-e">Low-E Double Pane</option>
                                    <option value="low-e-triple">Low-E Triple Pane</option>
                                </select>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; color: #34495e; font-weight: 500;">Number of Occupants</label>
                                <input type="number" id="lc-occupants" placeholder="e.g., 4" min="1" value="4" style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 16px; transition: border-color 0.3s ease;">
                            </div>

                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; color: #34495e; font-weight: 500;">Building Age</label>
                                <select id="lc-building-age" style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 16px; transition: border-color 0.3s ease;">
                                    <option value="new">New (2010+)</option>
                                    <option value="recent">Recent (1990-2009)</option>
                                    <option value="older" selected>Older (1970-1989)</option>
                                    <option value="old">Old (Pre-1970)</option>
                                </select>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; color: #34495e; font-weight: 500;">Primary Orientation <span style="color: #3498db; cursor: help; margin-left: 5px;" title="Direction of most windows for solar gain calculations">‚ÑπÔ∏è</span></label>
                                <select id="lc-orientation" style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 16px; transition: border-color 0.3s ease;">
                                    <option value="south" selected>South (Maximum Solar Gain)</option>
                                    <option value="north">North (Minimum Solar Gain)</option>
                                    <option value="east">East (Morning Sun)</option>
                                    <option value="west">West (Afternoon Sun)</option>
                                </select>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px;">
                                <button onclick="calculateLoadsEnhanced()" class="btn-primary" style="width: 100%; padding: 15px; font-size: 1em;">
                                    üî•‚ùÑÔ∏è Enhanced Calculate
                                </button>
                                <button onclick="calculateLoadsLC()" class="btn-secondary" style="width: 100%; padding: 15px; font-size: 0.9em;">
                                    üìä Basic Calculate
                                </button>
                            </div>
                        </div>

                        <div style="background: #f8f9fa; padding: 25px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); display: flex; flex-direction: column;">
                            <h2 style="font-size: 1.4em; color: #2c3e50; margin-bottom: 20px; font-weight: 600; border-bottom: 3px solid #3498db; padding-bottom: 10px;">Calculation Results</h2>
                            <div id="lc-results">
                                <p style="text-align: center; color: #7f8c8d; margin-top: 50px; font-size: 1.1em;">
                                    Enter building details and click calculate to see your heating and cooling load requirements.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <style>
                    @media (max-width: 768px) {
                        #load-calculator-content > div > div:nth-child(2) {
                            grid-template-columns: 1fr !important;
                        }
                        .lc-result-item {
                            margin-bottom: 15px !important;
                        }
                    }
                    
                    .lc-result-item {
                        background: white;
                        padding: 20px;
                        margin-bottom: 15px;
                        border-radius: 8px;
                        border-left: 5px solid #3498db;
                        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
                    }

                    .lc-result-item h3 {
                        color: #2c3e50;
                        margin-bottom: 10px;
                        font-size: 1.2em;
                    }

                    .lc-result-value {
                        font-size: 1.5em;
                        font-weight: bold;
                        color: #27ae60;
                    }

                    .lc-climate-info {
                        background: #e8f4f8;
                        padding: 15px;
                        border-radius: 8px;
                        margin-top: 20px;
                        border-left: 4px solid #3498db;
                    }

                    .lc-warning {
                        background: #fff3cd;
                        color: #856404;
                        padding: 15px;
                        border-radius: 8px;
                        margin-top: 20px;
                        border-left: 4px solid #ffc107;
                    }
                </style>
            `;
        }

        // SuperHeat/SubCool Content
        function getSuperheatSubcoolContent() {
            return `
                <div style="max-width: 1200px; margin: 0 auto;">
                    <h1 style="text-align: center; margin-bottom: 30px; font-size: 2em; background: linear-gradient(45deg, #ff6b6b, #4ecdc4); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">üîß SuperHeat & SubCool Calculator</h1>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                        <!-- Super-Heat Calculator -->
                        <div style="background: rgba(255, 255, 255, 0.15); border-radius: 15px; padding: 25px; border: 1px solid rgba(255, 255, 255, 0.2);">
                            <h2 style="margin-bottom: 20px; color: #4ecdc4; font-size: 1.8em; text-align: center;">üå°Ô∏è Super-Heat Calculator</h2>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #e0e0e0;">Refrigerant Type:</label>
                                <select id="sh-refrigerant" style="width: 100%; padding: 12px; border: none; border-radius: 8px; background: rgba(255, 255, 255, 0.9); color: #333; font-size: 16px;">
                                    <option value="">Select Refrigerant</option>
                                    <optgroup label="Traditional Refrigerants">
                                        <option value="R22">R-22 (HCFC)</option>
                                        <option value="R134a">R-134a (HFC)</option>
                                        <option value="R404A">R-404A (HFC)</option>
                                        <option value="R407C">R-407C (HFC)</option>
                                        <option value="R410A">R-410A (HFC)</option>
                                    </optgroup>
                                    <optgroup label="A2L Low-GWP Refrigerants">
                                        <option value="R32">R-32 (HFC - A2L)</option>
                                        <option value="R454B">R-454B (HFO Blend - A2L)</option>
                                        <option value="R454C">R-454C (HFO Blend - A2L)</option>
                                        <option value="R455A">R-455A (HFO Blend - A2L)</option>
                                        <option value="R452B">R-452B (HFO Blend - A2L)</option>
                                        <option value="R466A">R-466A (HFO Blend - A2L)</option>
                                    </optgroup>
                                    <optgroup label="Natural Refrigerants">
                                        <option value="R290">R-290 (Propane - A3)</option>
                                        <option value="R600a">R-600a (Isobutane - A3)</option>
                                        <option value="R744">R-744 (CO2 - A1)</option>
                                    </optgroup>
                                </select>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #e0e0e0;">Suction Pressure (PSIG):</label>
                                <input type="number" id="suction-pressure" placeholder="Enter suction pressure" style="width: 100%; padding: 12px; border: none; border-radius: 8px; background: rgba(255, 255, 255, 0.9); color: #333; font-size: 16px;">
                            </div>

                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #e0e0e0;">Suction Line Temperature (¬∞F):</label>
                                <input type="number" id="suction-temp" placeholder="Enter suction line temp" style="width: 100%; padding: 12px; border: none; border-radius: 8px; background: rgba(255, 255, 255, 0.9); color: #333; font-size: 16px;">
                            </div>

                            <button onclick="calculateSuperheat()" style="background: linear-gradient(45deg, #ff6b6b, #ee5a24); color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-size: 16px; margin: 10px 5px;">Calculate Super-Heat</button>
                            <button onclick="resetSuperheat()" style="background: linear-gradient(45deg, #ff6b6b, #ee5a24); color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-size: 16px; margin: 10px 5px;">Reset</button>

                            <div id="superheat-result" style="background: linear-gradient(45deg, #ff6b6b, #ee5a24); border-radius: 10px; padding: 15px; margin-top: 20px; text-align: center; font-size: 1.3em; font-weight: bold; min-height: 60px; display: flex; align-items: center; justify-content: center;">
                                Enter values to calculate super-heat
                            </div>
                        </div>

                        <!-- Sub-Cooling Calculator -->
                        <div style="background: rgba(255, 255, 255, 0.15); border-radius: 15px; padding: 25px; border: 1px solid rgba(255, 255, 255, 0.2);">
                            <h2 style="margin-bottom: 20px; color: #4ecdc4; font-size: 1.8em; text-align: center;">‚ùÑÔ∏è Sub-Cooling Calculator</h2>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #e0e0e0;">Refrigerant Type:</label>
                                <select id="sc-refrigerant" style="width: 100%; padding: 12px; border: none; border-radius: 8px; background: rgba(255, 255, 255, 0.9); color: #333; font-size: 16px;">
                                    <option value="">Select Refrigerant</option>
                                    <optgroup label="Traditional Refrigerants">
                                        <option value="R22">R-22 (HCFC)</option>
                                        <option value="R134a">R-134a (HFC)</option>
                                        <option value="R404A">R-404A (HFC)</option>
                                        <option value="R407C">R-407C (HFC)</option>
                                        <option value="R410A">R-410A (HFC)</option>
                                    </optgroup>
                                    <optgroup label="A2L Low-GWP Refrigerants">
                                        <option value="R32">R-32 (HFC - A2L)</option>
                                        <option value="R454B">R-454B (HFO Blend - A2L)</option>
                                        <option value="R454C">R-454C (HFO Blend - A2L)</option>
                                        <option value="R455A">R-455A (HFO Blend - A2L)</option>
                                        <option value="R452B">R-452B (HFO Blend - A2L)</option>
                                        <option value="R466A">R-466A (HFO Blend - A2L)</option>
                                    </optgroup>
                                    <optgroup label="Natural Refrigerants">
                                        <option value="R290">R-290 (Propane - A3)</option>
                                        <option value="R600a">R-600a (Isobutane - A3)</option>
                                        <option value="R744">R-744 (CO2 - A1)</option>
                                    </optgroup>
                                </select>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #e0e0e0;">Discharge Pressure (PSIG):</label>
                                <input type="number" id="discharge-pressure" placeholder="Enter discharge pressure" style="width: 100%; padding: 12px; border: none; border-radius: 8px; background: rgba(255, 255, 255, 0.9); color: #333; font-size: 16px;">
                            </div>

                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #e0e0e0;">Liquid Line Temperature (¬∞F):</label>
                                <input type="number" id="liquid-temp" placeholder="Enter liquid line temp" style="width: 100%; padding: 12px; border: none; border-radius: 8px; background: rgba(255, 255, 255, 0.9); color: #333; font-size: 16px;">
                            </div>

                            <button onclick="calculateSubcooling()" style="background: linear-gradient(45deg, #ff6b6b, #ee5a24); color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-size: 16px; margin: 10px 5px;">Calculate Sub-Cooling</button>
                            <button onclick="resetSubcooling()" style="background: linear-gradient(45deg, #ff6b6b, #ee5a24); color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-size: 16px; margin: 10px 5px;">Reset</button>

                            <div id="subcooling-result" style="background: linear-gradient(45deg, #ff6b6b, #ee5a24); border-radius: 10px; padding: 15px; margin-top: 20px; text-align: center; font-size: 1.3em; font-weight: bold; min-height: 60px; display: flex; align-items: center; justify-content: center;">
                                Enter values to calculate sub-cooling
                            </div>
                        </div>
                    </div>

                    <!-- Quick Reference -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 30px;">
                        <div style="background: rgba(255, 255, 255, 0.1); border-radius: 10px; padding: 20px; text-align: center;">
                            <h3 style="color: #4ecdc4; margin-bottom: 10px;">Typical Super-Heat Ranges</h3>
                            <p><strong>Residential AC:</strong> 8-12¬∞F</p>
                            <p><strong>Heat Pumps:</strong> 5-15¬∞F</p>
                            <p><strong>Commercial:</strong> 10-20¬∞F</p>
                            <p><strong>Low Temp:</strong> 20-30¬∞F</p>
                        </div>
                        
                        <div style="background: rgba(255, 255, 255, 0.1); border-radius: 10px; padding: 20px; text-align: center;">
                            <h3 style="color: #4ecdc4; margin-bottom: 10px;">Typical Sub-Cooling Ranges</h3>
                            <p><strong>Residential AC:</strong> 8-12¬∞F</p>
                            <p><strong>Heat Pumps:</strong> 5-15¬∞F</p>
                            <p><strong>Commercial:</strong> 10-20¬∞F</p>
                            <p><strong>TXV Systems:</strong> 10-15¬∞F</p>
                        </div>
                        
                        <div style="background: rgba(255, 255, 255, 0.1); border-radius: 10px; padding: 20px; text-align: center;">
                            <h3 style="color: #4ecdc4; margin-bottom: 10px;">A2L Safety Notes</h3>
                            <p>‚ö†Ô∏è Mildly flammable</p>
                            <p>üîß Special tools required</p>
                            <p>üìã Additional training needed</p>
                            <p>üõ°Ô∏è Enhanced safety protocols</p>
                        </div>
                    </div>
                </div>

                <style>
                    @media (max-width: 768px) {
                        #superheat-subcool-content > div > div:first-child {
                            grid-template-columns: 1fr !important;
                        }
                    }
                </style>
            `;
        }

        // P-T Chart Content
        function getPTChartContent() {
            return `
                <div style="max-width: 1400px; margin: 0 auto;">
                    <h1 style="text-align: center; margin-bottom: 30px; font-size: 2em; background: linear-gradient(45deg, #ff6b6b, #4ecdc4); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">üå°Ô∏è Refrigeration P-T Chart Generator</h1>
                    <p style="text-align: center; margin-bottom: 30px; font-size: 1.1em;">Interactive Pressure-Temperature charts for refrigeration analysis</p>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; padding: 20px; background: rgba(52, 152, 219, 0.1); border-radius: 15px; border: 2px solid rgba(52, 152, 219, 0.2);">
                        <div style="display: flex; flex-direction: column;">
                            <label style="font-weight: 600; color: #e0e0e0; margin-bottom: 8px; font-size: 0.95em;">Refrigerant Type:</label>
                            <select id="refrigerant" style="padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1em; background: rgba(255, 255, 255, 0.9); color: #333;">
                                <optgroup label="Traditional HFCs/HCFCs">
                                    <option value="R22">R-22 (HCFC-22)</option>
                                    <option value="R134a">R-134a (HFC-134a)</option>
                                    <option value="R410A">R-410A (HFC-410A)</option>
                                    <option value="R407C">R-407C (HFC-407C)</option>
                                    <option value="R404A">R-404A (HFC-404A)</option>
                                </optgroup>
                                <optgroup label="A2L Refrigerants (Mildly Flammable)">
                                    <option value="R32">R-32 (HFC-32) üî•</option>
                                    <option value="R454B">R-454B (HFO Blend) üî•</option>
                                    <option value="R452A">R-452A (HFC/HFO Blend) üî•</option>
                                    <option value="R454A">R-454A (HFO Blend) üî•</option>
                                    <option value="R1234yf">R-1234yf (HFO-1234yf) üî•</option>
                                    <option value="R1234ze">R-1234ze (HFO-1234ze) üî•</option>
                                </optgroup>
                                <optgroup label="Natural Refrigerants">
                                    <option value="R290">R-290 (Propane) üî•</option>
                                    <option value="R600a">R-600a (Isobutane) üî•</option>
                                    <option value="R717">R-717 (Ammonia) ‚ö†Ô∏è</option>
                                </optgroup>
                            </select>
                        </div>

                        <div style="display: flex; flex-direction: column;">
                            <label style="font-weight: 600; color: #e0e0e0; margin-bottom: 8px;">Min Temperature (¬∞C):</label>
                            <input type="number" id="tempMin" value="-40" step="5" style="padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1em; background: rgba(255, 255, 255, 0.9); color: #333;">
                        </div>

                        <div style="display: flex; flex-direction: column;">
                            <label style="font-weight: 600; color: #e0e0e0; margin-bottom: 8px;">Max Temperature (¬∞C):</label>
                            <input type="number" id="tempMax" value="60" step="5" style="padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1em; background: rgba(255, 255, 255, 0.9); color: #333;">
                        </div>

                        <div style="display: flex; flex-direction: column;">
                            <label style="font-weight: 600; color: #e0e0e0; margin-bottom: 8px;">Chart Type:</label>
                            <select id="chartType" style="padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1em; background: rgba(255, 255, 255, 0.9); color: #333;">
                                <option value="saturation">Saturation Curve</option>
                                <option value="isotherms">Isotherms</option>
                                <option value="both">Both</option>
                            </select>
                        </div>

                        <div style="display: flex; flex-direction: column;">
                            <label>&nbsp;</label>
                            <button onclick="generateChart()" style="background: linear-gradient(45deg, #3498db, #2980b9); color: white; border: none; cursor: pointer; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; padding: 12px; border-radius: 8px; font-size: 1em;">Generate P-T Chart</button>
                        </div>
                    </div>

                    <div style="position: relative; height: 600px; margin-bottom: 30px; background: white; border-radius: 15px; padding: 20px; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);">
                        <canvas id="ptChart"></canvas>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                        <div style="background: linear-gradient(135deg, #74b9ff, #0984e3); color: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(116, 185, 255, 0.3);">
                            <h3 style="margin-bottom: 15px; font-size: 1.3em;">üìä Chart Information</h3>
                            <p id="chartInfo">Select a refrigerant and generate chart to see information</p>
                        </div>

                        <div style="background: linear-gradient(135deg, #74b9ff, #0984e3); color: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(116, 185, 255, 0.3);">
                            <h3 style="margin-bottom: 15px; font-size: 1.3em;">üß™ Refrigerant Properties</h3>
                            <p id="refProperties">Properties will be displayed after chart generation</p>
                        </div>
                    </div>
                </div>

                <style>
                    @media (max-width: 768px) {
                        #pt-chart-content .chart-container {
                            height: 400px !important;
                        }
                    }
                </style>
            `;
        }

        // Psychrometric Content
        function getPsychrometricContent() {
            return `
                <div style="max-width: 1400px; margin: 0 auto; background: rgba(255, 255, 255, 0.95); border-radius: 20px; overflow: hidden;">
                    <div style="background: linear-gradient(135deg, #2196F3, #1976D2); color: white; padding: 30px; text-align: center;">
                        <h1 style="font-size: 2.5em; margin-bottom: 10px; font-weight: 300;">Refrigeration Psychrometric Calculator</h1>
                        <p style="font-size: 1.1em; opacity: 0.9;">Advanced Pressure Chart Analysis Tool</p>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 30px; padding: 30px;">
                        <div style="background: #f8f9fa; border-radius: 15px; padding: 25px; height: fit-content;">
                            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                                <button class="unit-btn active" onclick="toggleUnits('metric')">Metric</button>
                                <button class="unit-btn" onclick="toggleUnits('imperial')">Imperial</button>
                            </div>

                            <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                                <h4 style="color: #1976D2; margin-bottom: 10px;">Refrigerant Properties</h4>
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Refrigerant Type:</label>
                                    <select id="refrigerant" onchange="updateRefrigerantInfo()" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px;">
                                        <option value="R22">R-22 (HCFC-22)</option>
                                        <option value="R134a">R-134a (HFC-134a)</option>
                                        <option value="R410A">R-410A (HFC-410A)</option>
                                        <option value="R404A">R-404A (HFC-404A)</option>
                                        <option value="R507A">R-507A (HFC-507A)</option>
                                        <option value="R407C">R-407C (HFC-407C)</option>
                                    </select>
                                </div>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Temperature (<span id="tempUnit">¬∞C</span>):</label>
                                <input type="number" id="temperature" value="25" step="0.1" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px;">
                            </div>

                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Pressure (<span id="pressureUnit">kPa</span>):</label>
                                <input type="number" id="pressure" value="101.325" step="0.001" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px;">
                            </div>

                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Relative Humidity (%):</label>
                                <input type="number" id="humidity" value="50" min="0" max="100" step="0.1" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px;">
                            </div>

                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Elevation (<span id="elevationUnit">m</span>):</label>
                                <input type="number" id="elevation" value="0" step="1" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px;">
                            </div>

                            <button onclick="calculateProperties()" style="width: 100%; padding: 15px; background: linear-gradient(135deg, #4CAF50, #45a049); color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: 600; cursor: pointer; margin-bottom: 20px;">Calculate Properties</button>

                            <div id="results" style="background: white; border-radius: 10px; padding: 20px; margin-top: 20px;">
                                <h3 style="color: #333; margin-bottom: 15px; border-bottom: 2px solid #2196F3; padding-bottom: 8px;">Calculated Properties</h3>
                                <div id="resultsContent">
                                    <p>Enter values and click Calculate to see results</p>
                                </div>
                            </div>
                        </div>

                        <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);">
                            <canvas id="psychrometricChart" style="width: 100%; height: 500px;"></canvas>
                        </div>
                    </div>
                </div>

                <style>
                    @media (max-width: 768px) {
                        #psychrometric-content > div > div:nth-child(2) {
                            grid-template-columns: 1fr !important;
                        }
                    }
                </style>
            `;
        }

        // Unit Converter Content
        function getUnitConverterContent() {
            return `
                <div style="max-width: 1200px; margin: 0 auto; background: rgba(255, 255, 255, 0.95); border-radius: 20px; overflow: hidden;">
                    <div style="background: linear-gradient(135deg, #2c3e50, #3498db); color: white; padding: 30px; text-align: center;">
                        <h1 style="font-size: 2.5rem; margin-bottom: 10px; font-weight: 300;">Universal Unit Converter</h1>
                        <p style="opacity: 0.9; font-size: 1.1rem;">Convert between Imperial, Metric, Temperature, Pressure, Energy & Power units</p>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; padding: 30px;">
                        <!-- Length Converter -->
                        <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1); border: 1px solid #e1e8ed;">
                            <h3 style="font-size: 1.4rem; color: #2c3e50; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;"><span style="width: 4px; height: 25px; background: linear-gradient(135deg, #3498db, #2980b9); border-radius: 2px;"></span>Length Conversion</h3>
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px; flex-wrap: wrap;">
                                <div style="flex: 1; min-width: 120px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555; font-size: 0.9rem;">Feet</label>
                                    <input type="number" id="length1" step="any" placeholder="Enter feet" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem; background: #f8f9fa;">
                                </div>
                                <button onclick="swapLength()" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 1.2rem; flex-shrink: 0; display: flex; align-items: center; justify-content: center;">‚áÑ</button>
                                <div style="flex: 1; min-width: 120px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555; font-size: 0.9rem;">Meters</label>
                                    <input type="number" id="length2" step="any" placeholder="Enter meters" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem; background: #f8f9fa;">
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px; flex-wrap: wrap;">
                                <div style="flex: 1; min-width: 120px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555; font-size: 0.9rem;">Inches</label>
                                    <input type="number" id="length3" step="any" placeholder="Enter inches" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem; background: #f8f9fa;">
                                </div>
                                <button onclick="swapLengthInchCm()" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 1.2rem; flex-shrink: 0; display: flex; align-items: center; justify-content: center;">‚áÑ</button>
                                <div style="flex: 1; min-width: 120px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555; font-size: 0.9rem;">Centimeters</label>
                                    <input type="number" id="length4" step="any" placeholder="Enter cm" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem; background: #f8f9fa;">
                                </div>
                            </div>
                            <button onclick="clearLength()" style="background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 0.9rem; margin-top: 10px;">Clear All</button>
                        </div>

                        <!-- Weight Converter -->
                        <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1); border: 1px solid #e1e8ed;">
                            <h3 style="font-size: 1.4rem; color: #2c3e50; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;"><span style="width: 4px; height: 25px; background: linear-gradient(135deg, #3498db, #2980b9); border-radius: 2px;"></span>Weight Conversion</h3>
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px; flex-wrap: wrap;">
                                <div style="flex: 1; min-width: 120px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555; font-size: 0.9rem;">Pounds</label>
                                    <input type="number" id="weight1" step="any" placeholder="Enter pounds" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem; background: #f8f9fa;">
                                </div>
                                <button onclick="swapWeight()" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 1.2rem; flex-shrink: 0; display: flex; align-items: center; justify-content: center;">‚áÑ</button>
                                <div style="flex: 1; min-width: 120px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555; font-size: 0.9rem;">Kilograms</label>
                                    <input type="number" id="weight2" step="any" placeholder="Enter kg" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem; background: #f8f9fa;">
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px; flex-wrap: wrap;">
                                <div style="flex: 1; min-width: 120px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555; font-size: 0.9rem;">Ounces</label>
                                    <input type="number" id="weight3" step="any" placeholder="Enter ounces" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem; background: #f8f9fa;">
                                </div>
                                <button onclick="swapWeightOzGram()" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 1.2rem; flex-shrink: 0; display: flex; align-items: center; justify-content: center;">‚áÑ</button>
                                <div style="flex: 1; min-width: 120px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555; font-size: 0.9rem;">Grams</label>
                                    <input type="number" id="weight4" step="any" placeholder="Enter grams" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem; background: #f8f9fa;">
                                </div>
                            </div>
                            <button onclick="clearWeight()" style="background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 0.9rem; margin-top: 10px;">Clear All</button>
                        </div>

                        <!-- Temperature Converter -->
                        <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1); border: 1px solid #e1e8ed;">
                            <h3 style="font-size: 1.4rem; color: #2c3e50; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;"><span style="width: 4px; height: 25px; background: linear-gradient(135deg, #3498db, #2980b9); border-radius: 2px;"></span>Temperature Conversion</h3>
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px; flex-wrap: wrap;">
                                <div style="flex: 1; min-width: 120px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555; font-size: 0.9rem;">Celsius</label>
                                    <input type="number" id="temp1" step="any" placeholder="Enter ¬∞C" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem; background: #f8f9fa;">
                                </div>
                                <button onclick="swapTemperature()" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 1.2rem; flex-shrink: 0; display: flex; align-items: center; justify-content: center;">‚áÑ</button>
                                <div style="flex: 1; min-width: 120px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555; font-size: 0.9rem;">Fahrenheit</label>
                                    <input type="number" id="temp2" step="any" placeholder="Enter ¬∞F" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem; background: #f8f9fa;">
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px; flex-wrap: wrap;">
                                <div style="flex: 1; min-width: 120px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555; font-size: 0.9rem;">Kelvin</label>
                                    <input type="number" id="temp3" step="any" placeholder="Enter K" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem; background: #f8f9fa;">
                                </div>
                            </div>
                            <button onclick="clearTemperature()" style="background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 0.9rem; margin-top: 10px;">Clear All</button>
                            <div id="tempResult" style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-radius: 8px; padding: 15px; margin-top: 15px; border-left: 4px solid #28a745; font-family: 'Courier New', monospace; font-size: 0.95rem;"></div>
                        </div>

                        <!-- Pressure Converter -->
                        <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1); border: 1px solid #e1e8ed;">
                            <h3 style="font-size: 1.4rem; color: #2c3e50; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;"><span style="width: 4px; height: 25px; background: linear-gradient(135deg, #3498db, #2980b9); border-radius: 2px;"></span>Pressure Conversion</h3>
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px; flex-wrap: wrap;">
                                <div style="flex: 1; min-width: 120px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555; font-size: 0.9rem;">PSI</label>
                                    <input type="number" id="pressure1" step="any" placeholder="Enter PSI" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem; background: #f8f9fa;">
                                </div>
                                <button onclick="swapPressurePsiBar()" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 1.2rem; flex-shrink: 0; display: flex; align-items: center; justify-content: center;">‚áÑ</button>
                                <div style="flex: 1; min-width: 120px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555; font-size: 0.9rem;">Bar</label>
                                    <input type="number" id="pressure2" step="any" placeholder="Enter bar" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem; background: #f8f9fa;">
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px; flex-wrap: wrap;">
                                <div style="flex: 1; min-width: 120px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555; font-size: 0.9rem;">kPa</label>
                                    <input type="number" id="pressure3" step="any" placeholder="Enter kPa" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem; background: #f8f9fa;">
                                </div>
                                <button onclick="swapPressureKpaPa()" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 1.2rem; flex-shrink: 0; display: flex; align-items: center; justify-content: center;">‚áÑ</button>
                                <div style="flex: 1; min-width: 120px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555; font-size: 0.9rem;">Pascal</label>
                                    <input type="number" id="pressure4" step="any" placeholder="Enter Pa" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem; background: #f8f9fa;">
                                </div>
                            </div>
                            <button onclick="clearPressure()" style="background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 0.9rem; margin-top: 10px;">Clear All</button>
                        </div>

                        <!-- Energy Converter -->
                        <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1); border: 1px solid #e1e8ed;">
                            <h3 style="font-size: 1.4rem; color: #2c3e50; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;"><span style="width: 4px; height: 25px; background: linear-gradient(135deg, #3498db, #2980b9); border-radius: 2px;"></span>Energy Conversion</h3>
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px; flex-wrap: wrap;">
                                <div style="flex: 1; min-width: 120px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555; font-size: 0.9rem;">BTU</label>
                                    <input type="number" id="energy1" step="any" placeholder="Enter BTU" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem; background: #f8f9fa;">
                                </div>
                                <button onclick="swapEnergyBtuJoule()" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 1.2rem; flex-shrink: 0; display: flex; align-items: center; justify-content: center;">‚áÑ</button>
                                <div style="flex: 1; min-width: 120px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555; font-size: 0.9rem;">Joules</label>
                                    <input type="number" id="energy2" step="any" placeholder="Enter J" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem; background: #f8f9fa;">
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px; flex-wrap: wrap;">
                                <div style="flex: 1; min-width: 120px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555; font-size: 0.9rem;">kWh</label>
                                    <input type="number" id="energy3" step="any" placeholder="Enter kWh" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem; background: #f8f9fa;">
                                </div>
                                <button onclick="swapEnergyKwhCal()" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 1.2rem; flex-shrink: 0; display: flex; align-items: center; justify-content: center;">‚áÑ</button>
                                <div style="flex: 1; min-width: 120px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555; font-size: 0.9rem;">Calories</label>
                                    <input type="number" id="energy4" step="any" placeholder="Enter cal" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem; background: #f8f9fa;">
                                </div>
                            </div>
                            <button onclick="clearEnergy()" style="background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 0.9rem; margin-top: 10px;">Clear All</button>
                        </div>

                        <!-- Power Converter -->
                        <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1); border: 1px solid #e1e8ed;">
                            <h3 style="font-size: 1.4rem; color: #2c3e50; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;"><span style="width: 4px; height: 25px; background: linear-gradient(135deg, #3498db, #2980b9); border-radius: 2px;"></span>Power Conversion</h3>
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px; flex-wrap: wrap;">
                                <div style="flex: 1; min-width: 120px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555; font-size: 0.9rem;">BTU/h</label>
                                    <input type="number" id="power1" step="any" placeholder="Enter BTU/h" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem; background: #f8f9fa;">
                                </div>
                                <button onclick="swapPowerBtuKw()" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 1.2rem; flex-shrink: 0; display: flex; align-items: center; justify-content: center;">‚áÑ</button>
                                <div style="flex: 1; min-width: 120px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555; font-size: 0.9rem;">Kilowatts</label>
                                    <input type="number" id="power2" step="any" placeholder="Enter kW" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem; background: #f8f9fa;">
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px; flex-wrap: wrap;">
                                <div style="flex: 1; min-width: 120px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555; font-size: 0.9rem;">Horsepower</label>
                                    <input type="number" id="power3" step="any" placeholder="Enter HP" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem; background: #f8f9fa;">
                                </div>
                                <button onclick="swapPowerHpWatt()" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 1.2rem; flex-shrink: 0; display: flex; align-items: center; justify-content: center;">‚áÑ</button>
                                <div style="flex: 1; min-width: 120px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555; font-size: 0.9rem;">Watts</label>
                                    <input type="number" id="power4" step="any" placeholder="Enter W" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 1rem; background: #f8f9fa;">
                                </div>
                            </div>
                            <button onclick="clearPower()" style="background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 0.9rem; margin-top: 10px;">Clear All</button>
                        </div>
                    </div>
                </div>

                <style>
                    @media (max-width: 768px) {
                        #unit-converter-content > div > div:nth-child(2) {
                            grid-template-columns: 1fr !important;
                        }
                        #unit-converter-content .conversion-row {
                            flex-direction: column !important;
                            align-items: stretch !important;
                        }
                        #unit-converter-content .swap-btn {
                            align-self: center !important;
                            margin: 10px 0 !important;
                        }
                    }
                </style>
            `;
        }

        // Duct Sizing Content
        function getDuctSizingContent() {
            return `
                <div style="max-width: 1400px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden;">
                    <div style="background: linear-gradient(135deg, #2c3e50, #34495e); color: white; padding: 30px; text-align: center;">
                        <h1 style="font-size: 2.5em; margin-bottom: 10px;">üè† Canadian HVAC Duct Sizing Calculator</h1>
                        <p style="opacity: 0.9; font-size: 1.1em;">Professional duct sizing based on CSA and NBC standards (Imperial Units)</p>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1.5fr; gap: 0; min-height: 800px;">
                        <div style="padding: 40px; background: #f8f9fa; border-right: 1px solid #e9ecef;">
                            <h2 style="font-size: 1.5em; color: #2c3e50; margin-bottom: 25px; padding-bottom: 10px; border-bottom: 3px solid #3498db;">System Parameters</h2>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50;">Climate Zone</label>
                                    <select id="ds-climate-zone" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 16px;">
                                        <option value="4">Zone 4 (Southern ON)</option>
                                        <option value="5">Zone 5 (Central ON)</option>
                                        <option value="6">Zone 6 (Northern ON)</option>
                                        <option value="7a">Zone 7A (MB, SK)</option>
                                        <option value="7b">Zone 7B (AB)</option>
                                        <option value="8">Zone 8 (Northern Canada)</option>
                                    </select>
                                </div>
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50;">Building Type</label>
                                    <select id="ds-building-type" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 16px;">
                                        <option value="residential">Residential</option>
                                        <option value="commercial">Commercial</option>
                                        <option value="industrial">Industrial</option>
                                    </select>
                                </div>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50;">Furnace/AHU Input (BTU/h)</label>
                                    <input type="number" id="ds-furnace-capacity" placeholder="e.g., 80000" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 16px;">
                                </div>
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50;">Fan Capacity (CFM)</label>
                                    <input type="number" id="ds-fan-speed" placeholder="e.g., 1200" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 16px;">
                                </div>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50;">Duct Material</label>
                                    <select id="ds-duct-material" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 16px;">
                                        <option value="galvanized">Galvanized Steel</option>
                                        <option value="aluminum">Aluminum</option>
                                        <option value="flexible">Flexible Duct</option>
                                        <option value="fiberglass">Fiberglass Board</option>
                                    </select>
                                </div>
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50;">System Type</label>
                                    <select id="ds-system-type" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 16px;">
                                        <option value="heating">Heating Only</option>
                                        <option value="cooling">Cooling Only</option>
                                        <option value="both">Heating & Cooling</option>
                                    </select>
                                </div>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50;">Total Equivalent Length (ft)</label>
                                    <input type="number" id="ds-duct-length" placeholder="e.g., 150" value="150" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 16px;">
                                </div>
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50;">Number of Fittings</label>
                                    <input type="number" id="ds-fitting-count" placeholder="e.g., 8" value="8" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 16px;">
                                </div>
                            </div>

                            <div style="background: white; border-radius: 10px; padding: 20px; margin-top: 20px; border: 2px solid #e9ecef;">
                                <h3 style="margin-bottom: 15px; color: #2c3e50;">Room Information</h3>
                                <div id="ds-rooms-container">
                                    <div class="ds-room-input" style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 10px; align-items: end; margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                                        <div>
                                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Room Name</label>
                                            <input type="text" class="ds-room-name" placeholder="e.g., Living Room" style="width: 100%; padding: 8px; border: 1px solid #e9ecef; border-radius: 4px; font-size: 14px;">
                                        </div>
                                        <div>
                                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Area (sq ft)</label>
                                            <input type="number" class="ds-room-area" placeholder="250" style="width: 100%; padding: 8px; border: 1px solid #e9ecef; border-radius: 4px; font-size: 14px;">
                                        </div>
                                        <div>
                                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Ceiling Height (ft)</label>
                                            <input type="number" class="ds-room-height" placeholder="8" step="0.5" value="8" style="width: 100%; padding: 8px; border: 1px solid #e9ecef; border-radius: 4px; font-size: 14px;">
                                        </div>
                                        <div>
                                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Registers</label>
                                            <input type="number" class="ds-room-registers" placeholder="1" min="1" value="1" style="width: 100%; padding: 8px; border: 1px solid #e9ecef; border-radius: 4px; font-size: 14px;">
                                        </div>
                                    </div>
                                </div>
                                <button onclick="addDSRoom()" style="padding: 10px 20px; background: #27ae60; color: white; border: none; border-radius: 6px; cursor: pointer; margin-top: 10px;">+ Add Room</button>
                            </div>

                            <button onclick="calculateDSResults()" style="width: 100%; padding: 15px; background: linear-gradient(135deg, #3498db, #2980b9); color: white; border: none; border-radius: 10px; font-size: 18px; font-weight: 600; cursor: pointer; margin-top: 20px;">Calculate Duct Sizing</button>
                        </div>

                        <div style="padding: 40px; background: white; overflow-y: auto; max-height: 800px;">
                            <h2 style="font-size: 1.5em; color: #2c3e50; margin-bottom: 25px; padding-bottom: 10px; border-bottom: 3px solid #3498db;">Calculation Results</h2>
                            
                            <div id="ds-results-summary" style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-radius: 15px; padding: 25px; margin-bottom: 20px; border-left: 5px solid #3498db;">
                                <h3 style="margin-bottom: 15px; color: #2c3e50;">System Summary</h3>
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #dee2e6;">
                                    <span style="font-weight: 600; color: #2c3e50;">Total Heating Load:</span>
                                    <span style="font-size: 1.1em; color: #e74c3c; font-weight: 700;" id="ds-total-load">- BTU/h</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #dee2e6;">
                                    <span style="font-weight: 600; color: #2c3e50;">Total Airflow Required:</span>
                                    <span style="font-size: 1.1em; color: #e74c3c; font-weight: 700;" id="ds-total-cfm">- CFM</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #dee2e6;">
                                    <span style="font-weight: 600; color: #2c3e50;">Static Pressure Loss:</span>
                                    <span style="font-size: 1.1em; color: #e74c3c; font-weight: 700;" id="ds-pressure-loss">- in. w.c.</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0;">
                                    <span style="font-weight: 600; color: #2c3e50;">Cold Air Return Area:</span>
                                    <span style="font-size: 1.1em; color: #e74c3c; font-weight: 700;" id="ds-return-area">- sq in</span>
                                </div>
                            </div>

                            <div id="ds-trunk-specs" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-top: 20px;">
                                <div style="background: white; border: 2px solid #3498db; border-radius: 10px; padding: 15px; text-align: center;">
                                    <div style="font-size: 1.1em; font-weight: 600; color: #2c3e50; margin-bottom: 10px;">Main Trunk</div>
                                    <div id="ds-main-trunk-size" style="font-size: 1.3em; font-weight: bold; color: #3498db;">- inches</div>
                                    <div style="font-size: 0.9em; color: #666; margin-top: 5px;">
                                        Velocity: <span id="ds-trunk-velocity">-</span> ft/min
                                    </div>
                                </div>
                                <div style="background: white; border: 2px solid #3498db; border-radius: 10px; padding: 15px; text-align: center;">
                                    <div style="font-size: 1.1em; font-weight: 600; color: #2c3e50; margin-bottom: 10px;">Sub-Trunk</div>
                                    <div id="ds-sub-trunk-size" style="font-size: 1.3em; font-weight: bold; color: #3498db;">- inches</div>
                                    <div style="font-size: 0.9em; color: #666; margin-top: 5px;">
                                        Velocity: <span id="ds-sub-trunk-velocity">-</span> ft/min
                                    </div>
                                </div>
                                <div style="background: white; border: 2px solid #3498db; border-radius: 10px; padding: 15px; text-align: center;">
                                    <div style="font-size: 1.1em; font-weight: 600; color: #2c3e50; margin-bottom: 10px;">Branch Ducts</div>
                                    <div id="ds-branch-duct-range" style="font-size: 1.3em; font-weight: bold; color: #3498db;">- inches</div>
                                    <div style="font-size: 0.9em; color: #666; margin-top: 5px;">
                                        Round: <span id="ds-round-duct-range">-</span>
                                    </div>
                                </div>
                            </div>

                            <div id="ds-detailed-results">
                                <!-- Dynamic duct sizing table will be inserted here -->
                            </div>
                        </div>
                    </div>
                </div>

                <style>
                    @media (max-width: 1024px) {
                        #duct-sizing-content > div > div:nth-child(2) {
                            grid-template-columns: 1fr !important;
                        }
                        
                        #duct-sizing-content .ds-room-input {
                            grid-template-columns: 1fr !important;
                        }

                        #ds-trunk-specs {
                            grid-template-columns: 1fr !important;
                        }
                    }
                    
                    .ds-duct-sizing-table {
                        width: 100%;
                        border-collapse: collapse;
                        margin-top: 20px;
                        background: white;
                        border-radius: 10px;
                        overflow: hidden;
                        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
                        font-size: 14px;
                    }

                    .ds-duct-sizing-table th,
                    .ds-duct-sizing-table td {
                        padding: 8px 6px;
                        text-align: center;
                        border-bottom: 1px solid #e9ecef;
                    }

                    .ds-duct-sizing-table th {
                        background: #34495e;
                        color: white;
                        font-weight: 600;
                        font-size: 12px;
                    }

                    .ds-duct-sizing-table tr:hover {
                        background: #f8f9fa;
                    }

                    .ds-warning {
                        background: #fff3cd;
                        border: 1px solid #ffeaa7;
                        color: #856404;
                        padding: 15px;
                        border-radius: 8px;
                        margin-top: 20px;
                    }

                    .ds-error {
                        background: #f8d7da;
                        border: 1px solid #f5c6cb;
                        color: #721c24;
                        padding: 15px;
                        border-radius: 8px;
                        margin-top: 20px;
                    }
                </style>
            `;
        }

        // Initialize functions
        function initializeLoadCalculator() {
            // Initialize Load Calculator with Canadian climate data and unit conversion
            isMetricLC = false; // Start with Imperial units
            setupLoadCalculatorData();
        }

        // Load Calculator Variables
        let isMetricLC = false;

        // Canadian climate data by province (heating degree days and cooling degree days)
        const climateDataLC = {
            'BC': { hdd: 2800, cdd: 150, winterTemp: -8, summerTemp: 28, zone: 'Marine West Coast', winterTempF: 18, summerTempF: 82 },
            'AB': { hdd: 4500, cdd: 280, winterTemp: -25, summerTemp: 26, zone: 'Continental', winterTempF: -13, summerTempF: 79 },
            'SK': { hdd: 5200, cdd: 350, winterTemp: -28, summerTemp: 25, zone: 'Continental', winterTempF: -18, summerTempF: 77 },
            'MB': { hdd: 5100, cdd: 320, winterTemp: -27, summerTemp: 26, zone: 'Continental', winterTempF: -17, summerTempF: 79 },
            'ON': { hdd: 3800, cdd: 300, winterTemp: -18, summerTemp: 28, zone: 'Continental', winterTempF: 0, summerTempF: 82 },
            'QC': { hdd: 4200, cdd: 250, winterTemp: -22, summerTemp: 26, zone: 'Continental', winterTempF: -8, summerTempF: 79 },
            'NB': { hdd: 4100, cdd: 180, winterTemp: -18, summerTemp: 24, zone: 'Maritime', winterTempF: 0, summerTempF: 75 },
            'NS': { hdd: 3600, cdd: 120, winterTemp: -12, summerTemp: 23, zone: 'Maritime', winterTempF: 10, summerTempF: 73 },
            'PE': { hdd: 3800, cdd: 150, winterTemp: -14, summerTemp: 24, zone: 'Maritime', winterTempF: 7, summerTempF: 75 },
            'NL': { hdd: 4800, cdd: 80, winterTemp: -18, summerTemp: 20, zone: 'Maritime', winterTempF: 0, summerTempF: 68 },
            'YT': { hdd: 6500, cdd: 100, winterTemp: -35, summerTemp: 20, zone: 'Subarctic', winterTempF: -31, summerTempF: 68 },
            'NT': { hdd: 7200, cdd: 120, winterTemp: -35, summerTemp: 22, zone: 'Subarctic', winterTempF: -31, summerTempF: 72 },
            'NU': { hdd: 8500, cdd: 50, winterTemp: -40, summerTemp: 15, zone: 'Arctic', winterTempF: -40, summerTempF: 59 }
        };

        // Insulation R-values (Imperial and Metric)
        const insulationValuesLC = {
            'poor': { wall: 8, ceiling: 20, floor: 12 },
            'average': { wall: 12, ceiling: 30, floor: 20 },
            'good': { wall: 20, ceiling: 40, floor: 25 },
            'excellent': { wall: 24, ceiling: 50, floor: 30 }
        };

        // Window U-values (Imperial: BTU/hr¬∑ft¬≤¬∑¬∞F, Metric: W/m¬≤¬∑K)
        const windowUValuesLC = {
            'single': { imperial: 1.02, metric: 5.8 },
            'double': { imperial: 0.49, metric: 2.8 },
            'triple': { imperial: 0.32, metric: 1.8 },
            'low-e': { imperial: 0.35, metric: 2.0 },
            'low-e-triple': { imperial: 0.21, metric: 1.2 }
        };

        function setupLoadCalculatorData() {
            console.log('Load Calculator data initialized');
        }

        window.toggleUnitsLC = function() {
            isMetricLC = !isMetricLC;
            const unitDisplay = document.getElementById('lc-unit-display');
            const areaUnit = document.getElementById('lc-area-unit');
            const heightUnit = document.getElementById('lc-height-unit');
            const windowUnit = document.getElementById('lc-window-unit');
            
            const areaInput = document.getElementById('lc-area');
            const heightInput = document.getElementById('lc-ceiling-height');
            const windowInput = document.getElementById('lc-windows');

            if (isMetricLC) {
                unitDisplay.textContent = 'Imperial';
                areaUnit.textContent = '(m¬≤)';
                heightUnit.textContent = '(m)';
                windowUnit.textContent = '(m¬≤)';
                
                // Convert current values to metric
                if (areaInput.value) areaInput.value = Math.round(parseFloat(areaInput.value) * 0.092903);
                if (heightInput.value) heightInput.value = (parseFloat(heightInput.value) * 0.3048).toFixed(1);
                else heightInput.value = '2.4';
                if (windowInput.value) windowInput.value = Math.round(parseFloat(windowInput.value) * 0.092903);
                
                areaInput.placeholder = 'e.g., 150';
                heightInput.placeholder = 'e.g., 2.4';
                windowInput.placeholder = 'e.g., 25';
                
                heightInput.min = '2';
                heightInput.max = '5';
            } else {
                unitDisplay.textContent = 'Metric';
                areaUnit.textContent = '(ft¬≤)';
                heightUnit.textContent = '(ft)';
                windowUnit.textContent = '(ft¬≤)';
                
                // Convert current values to imperial
                if (areaInput.value) areaInput.value = Math.round(parseFloat(areaInput.value) / 0.092903);
                if (heightInput.value) heightInput.value = (parseFloat(heightInput.value) / 0.3048).toFixed(1);
                else heightInput.value = '8';
                if (windowInput.value) windowInput.value = Math.round(parseFloat(windowInput.value) / 0.092903);
                
                areaInput.placeholder = 'e.g., 1600';
                heightInput.placeholder = 'e.g., 8';
                windowInput.placeholder = 'e.g., 270';
                
                heightInput.min = '6';
                heightInput.max = '16';
            }
        };

        window.calculateLoadsLC = function() {
            // Get input values
            const province = document.getElementById('lc-province').value;
            let area = parseFloat(document.getElementById('lc-area').value);
            let ceilingHeight = parseFloat(document.getElementById('lc-ceiling-height').value);
            const insulation = document.getElementById('lc-insulation').value;
            let windowArea = parseFloat(document.getElementById('lc-windows').value);
            const windowType = document.getElementById('lc-window-type').value;
            const occupants = parseInt(document.getElementById('lc-occupants').value);
            const buildingAge = document.getElementById('lc-building-age').value;

            // Validation
            if (!province || !area || windowArea === null || !occupants) {
                alert('Please fill in all required fields.');
                return;
            }

            // Convert imperial to metric for calculations if needed
            let areaM2 = isMetricLC ? area : area * 0.092903;
            let heightM = isMetricLC ? ceilingHeight : ceilingHeight * 0.3048;
            let windowAreaM2 = isMetricLC ? windowArea : windowArea * 0.092903;

            const climate = climateDataLC[province];
            const insul = insulationValuesLC[insulation];
            const windowU = windowUValuesLC[windowType].metric; // Always use metric for calculations
            const volume = areaM2 * heightM;

            // Calculate heat loss components
            const wallArea = Math.sqrt(areaM2) * 4 * heightM - windowAreaM2; // Approximate wall area
            const ceilingArea = areaM2;
            const floorArea = areaM2;

            // Heat loss calculations (W)
            const wallLoss = (wallArea / insul.wall) * (21 - climate.winterTemp);
            const ceilingLoss = (ceilingArea / insul.ceiling) * (21 - climate.winterTemp);
            const floorLoss = (floorArea / insul.floor) * (21 - climate.winterTemp) * 0.5; // Ground temp factor
            const windowLoss = windowAreaM2 * windowU * (21 - climate.winterTemp);
            
            // Air infiltration (assuming 0.5 ACH for average building)
            const infiltrationMultiplier = buildingAge === 'new' ? 0.3 : buildingAge === 'recent' ? 0.4 : buildingAge === 'older' ? 0.6 : 0.8;
            const infiltrationLoss = volume * infiltrationMultiplier * 1.2 * 1000 * (21 - climate.winterTemp) / 3600;

            const totalHeatLoss = wallLoss + ceilingLoss + floorLoss + windowLoss + infiltrationLoss;

            // Add safety factor and equipment sizing
            const designHeatLoad = totalHeatLoss * 1.2; // 20% safety factor
            const heatingCapacityBtu = designHeatLoad * 3.412; // Convert W to BTU/h

            // Cooling load calculations
            const coolingLoad = calculateCoolingLoadLC(areaM2, windowAreaM2, windowU, occupants, climate, insul);
            const coolingCapacityBtu = coolingLoad * 3.412;
            const coolingTons = coolingCapacityBtu / 12000; // Convert to tons

            // Display results
            displayResultsLC({
                province,
                climate,
                designHeatLoad,
                heatingCapacityBtu,
                coolingLoad,
                coolingCapacityBtu,
                coolingTons,
                area: areaM2,
                areaDisplay: area,
                insulation,
                windowType
            });
        };

        function calculateCoolingLoadLC(areaM2, windowAreaM2, windowU, occupants, climate, insul) {
            // Simplified cooling load calculation
            const wallArea = Math.sqrt(areaM2) * 4 * 2.4 - windowAreaM2;
            
            // Solar heat gain through windows (W)
            const solarGain = windowAreaM2 * 300; // Average solar heat gain factor for Canada
            
            // Heat gain through walls and roof
            const wallGain = (wallArea / insul.wall) * (climate.summerTemp - 21) * 0.7; // Reduced due to thermal mass
            const roofGain = (areaM2 / insul.ceiling) * (climate.summerTemp - 21 + 10); // +10¬∞C for roof surface temp
            
            // Internal gains
            const occupantGain = occupants * 100; // 100W per person
            const applianceGain = areaM2 * 5; // 5W/m¬≤ for appliances and lighting
            
            // Ventilation load
            const ventilationGain = areaM2 * 2 * 1.2 * 1000 * (climate.summerTemp - 21) / 3600; // 2 L/s per m¬≤
            
            return solarGain + wallGain + roofGain + occupantGain + applianceGain + ventilationGain;
        }

        function displayResultsLC(data) {
            const resultsDiv = document.getElementById('lc-results');
            const areaUnit = isMetricLC ? 'm¬≤' : 'ft¬≤';
            const loadUnit = isMetricLC ? 'W/m¬≤' : 'BTU/h¬∑ft¬≤';
            const winterTemp = isMetricLC ? data.climate.winterTemp + '¬∞C' : data.climate.winterTempF + '¬∞F';
            const summerTemp = isMetricLC ? data.climate.summerTemp + '¬∞C' : data.climate.summerTempF + '¬∞F';
            
            // Calculate load densities
            const heatingDensity = isMetricLC ? 
                Math.round(data.designHeatLoad / data.area) : 
                Math.round(data.heatingCapacityBtu / data.areaDisplay);
            const coolingDensity = isMetricLC ? 
                Math.round(data.coolingLoad / data.area) : 
                Math.round(data.coolingCapacityBtu / data.areaDisplay);
            
            resultsDiv.innerHTML = `
                <div class="lc-result-item">
                    <h3>üî• Heating Load</h3>
                    <div class="lc-result-value">${Math.round(data.designHeatLoad).toLocaleString()} W</div>
                    <div style="margin-top: 8px; color: #666;">
                        ${Math.round(data.heatingCapacityBtu).toLocaleString()} BTU/h
                    </div>
                </div>

                <div class="lc-result-item">
                    <h3>‚ùÑÔ∏è Cooling Load</h3>
                    <div class="lc-result-value">${Math.round(data.coolingLoad).toLocaleString()} W</div>
                    <div style="margin-top: 8px; color: #666;">
                        ${Math.round(data.coolingCapacityBtu).toLocaleString()} BTU/h<br>
                        ${data.coolingTons.toFixed(1)} Tons
                    </div>
                </div>

                <div class="lc-result-item">
                    <h3>üìä Load Density</h3>
                    <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                        <span>Heating: <strong>${heatingDensity} ${loadUnit}</strong></span>
                        <span>Cooling: <strong>${coolingDensity} ${loadUnit}</strong></span>
                    </div>
                </div>

                <div class="lc-climate-info">
                    <h4>üå°Ô∏è Climate Information - ${data.province}</h4>
                    <p><strong>Zone:</strong> ${data.climate.zone}</p>
                    <p><strong>Design Temperatures:</strong></p>
                    <p>‚Ä¢ Winter: ${winterTemp} | Summer: ${summerTemp}</p>
                    <p><strong>Degree Days:</strong> ${data.climate.hdd.toLocaleString()} HDD | ${data.climate.cdd} CDD</p>
                </div>

                <div class="lc-warning">
                    <strong>‚ö†Ô∏è Professional Note:</strong> These calculations provide estimates based on simplified methods. 
                    For final equipment sizing and installation, consult with a licensed HVAC professional who can perform 
                    detailed Manual J calculations and consider local building codes.
                </div>
            `;
        }

        function initializeSuperheatSubcool() {
            initializeRefrigerantDataSH();
            setupEventListenersSH();
        }

        // Refrigerant data for SuperHeat/SubCool Calculator
        let refrigerantDataSH = {};
        
        function initializeRefrigerantDataSH() {
            refrigerantDataSH = {
                'R22': {
                    name: 'R-22 (HCFC-22)',
                    type: 'HCFC',
                    safety: 'A1',
                    gwp: 1810,
                    pressureTemp: {
                        20: 43.0, 25: 47.5, 30: 52.5, 35: 57.8, 40: 63.5, 45: 69.5, 50: 76.0,
                        55: 83.0, 60: 90.5, 65: 98.5, 70: 107.0, 75: 116.0, 80: 125.5, 85: 135.5,
                        90: 146.0, 95: 157.0, 100: 169.0, 105: 181.5, 110: 194.5, 115: 208.0,
                        120: 222.0, 125: 237.0, 130: 252.5
                    }
                },
                'R134a': {
                    name: 'R-134a (HFC-134a)',
                    type: 'HFC',
                    safety: 'A1',
                    gwp: 1430,
                    pressureTemp: {
                        20: 21.0, 25: 24.0, 30: 27.5, 35: 31.5, 40: 35.7, 45: 40.3, 50: 45.2,
                        55: 50.5, 60: 56.2, 65: 62.3, 70: 68.8, 75: 75.7, 80: 83.1, 85: 91.0,
                        90: 99.4, 95: 108.3, 100: 117.8, 105: 127.9, 110: 138.6, 115: 149.9,
                        120: 161.9, 125: 174.6, 130: 188.0
                    }
                },
                'R404A': {
                    name: 'R-404A (HFC Blend)',
                    type: 'HFC Blend',
                    safety: 'A1',
                    gwp: 3922,
                    pressureTemp: {
                        '-20': 9.5, '-15': 12.0, '-10': 15.0, '-5': 18.5, 0: 22.5, 5: 27.0, 10: 32.0,
                        15: 37.5, 20: 43.5, 25: 50.0, 30: 57.0, 35: 64.5, 40: 72.8, 45: 81.5,
                        50: 91.0, 55: 101.0, 60: 112.0, 65: 123.5, 70: 136.0, 75: 149.0,
                        80: 163.0, 85: 177.5, 90: 193.0
                    }
                },
                'R407C': {
                    name: 'R-407C (HFC Blend)',
                    type: 'HFC Blend',
                    safety: 'A1',
                    gwp: 1774,
                    pressureTemp: {
                        20: 42.0, 25: 46.5, 30: 51.5, 35: 57.0, 40: 63.0, 45: 69.5, 50: 76.5,
                        55: 84.0, 60: 92.0, 65: 100.5, 70: 109.5, 75: 119.0, 80: 129.0, 85: 140.0,
                        90: 151.5, 95: 163.5, 100: 176.0, 105: 189.0, 110: 203.0, 115: 217.5,
                        120: 233.0, 125: 249.0, 130: 266.0
                    }
                },
                'R410A': {
                    name: 'R-410A (HFC Blend)',
                    type: 'HFC Blend',
                    safety: 'A1',
                    gwp: 2088,
                    pressureTemp: {
                        20: 71.0, 25: 78.0, 30: 85.5, 35: 93.5, 40: 102.0, 45: 111.0, 50: 120.5,
                        55: 130.5, 60: 141.0, 65: 152.0, 70: 164.0, 75: 176.5, 80: 189.5, 85: 203.0,
                        90: 217.5, 95: 232.5, 100: 248.0, 105: 264.5, 110: 281.5, 115: 299.0,
                        120: 317.5, 125: 336.5, 130: 356.0
                    }
                },
                'R32': {
                    name: 'R-32 (HFC-32)',
                    type: 'HFC',
                    safety: 'A2L',
                    gwp: 675,
                    pressureTemp: {
                        20: 78.0, 25: 86.0, 30: 94.5, 35: 103.5, 40: 113.0, 45: 123.0, 50: 133.5,
                        55: 144.5, 60: 156.0, 65: 168.0, 70: 180.5, 75: 193.5, 80: 207.0, 85: 221.0,
                        90: 235.5, 95: 250.5, 100: 266.0, 105: 282.0, 110: 298.5, 115: 315.5,
                        120: 333.0, 125: 351.0, 130: 369.5
                    }
                },
                'R454B': {
                    name: 'R-454B (HFO Blend)',
                    type: 'HFO Blend',
                    safety: 'A2L',
                    gwp: 466,
                    pressureTemp: {
                        20: 43.5, 25: 48.0, 30: 53.0, 35: 58.5, 40: 64.5, 45: 71.0, 50: 78.0,
                        55: 85.5, 60: 93.5, 65: 102.0, 70: 111.0, 75: 120.5, 80: 130.5, 85: 141.0,
                        90: 152.0, 95: 164.0, 100: 176.5, 105: 189.5, 110: 203.0, 115: 217.0,
                        120: 231.5, 125: 247.0, 130: 263.0
                    }
                },
                'R454C': {
                    name: 'R-454C (HFO Blend)',
                    type: 'HFO Blend',
                    safety: 'A2L',
                    gwp: 148,
                    pressureTemp: {
                        20: 42.8, 25: 47.2, 30: 52.2, 35: 57.6, 40: 63.5, 45: 69.8, 50: 76.6,
                        55: 84.0, 60: 91.8, 65: 100.2, 70: 109.2, 75: 118.8, 80: 129.0, 85: 139.8,
                        90: 151.2, 95: 163.2, 100: 175.8, 105: 189.0, 110: 202.8, 115: 217.2,
                        120: 232.2, 125: 247.8, 130: 264.0
                    }
                },
                'R455A': {
                    name: 'R-455A (HFO Blend)',
                    type: 'HFO Blend',
                    safety: 'A2L',
                    gwp: 148,
                    pressureTemp: {
                        20: 70.5, 25: 77.5, 30: 85.0, 35: 93.0, 40: 101.5, 45: 110.5, 50: 120.0,
                        55: 130.0, 60: 140.5, 65: 151.5, 70: 163.0, 75: 175.0, 80: 187.5, 85: 200.5,
                        90: 214.0, 95: 228.0, 100: 242.5, 105: 257.5, 110: 273.0, 115: 289.0,
                        120: 305.5, 125: 322.5, 130: 340.0
                    }
                },
                'R452B': {
                    name: 'R-452B (HFO Blend)',
                    type: 'HFO Blend',
                    safety: 'A2L',
                    gwp: 698,
                    pressureTemp: {
                        20: 70.8, 25: 77.8, 30: 85.3, 35: 93.3, 40: 101.8, 45: 110.8, 50: 120.3,
                        55: 130.3, 60: 140.8, 65: 151.8, 70: 163.3, 75: 175.3, 80: 187.8, 85: 200.8,
                        90: 214.3, 95: 228.3, 100: 242.8, 105: 257.8, 110: 273.3, 115: 289.3,
                        120: 305.8, 125: 322.8, 130: 340.3
                    }
                },
                'R466A': {
                    name: 'R-466A (HFO Blend)',
                    type: 'HFO Blend',
                    safety: 'A2L',
                    gwp: 733,
                    pressureTemp: {
                        20: 71.2, 25: 78.2, 30: 85.7, 35: 93.7, 40: 102.2, 45: 111.2, 50: 120.7,
                        55: 130.7, 60: 141.2, 65: 152.2, 70: 163.7, 75: 175.7, 80: 188.2, 85: 201.2,
                        90: 214.7, 95: 228.7, 100: 243.2, 105: 258.2, 110: 273.7, 115: 289.7,
                        120: 306.2, 125: 323.2, 130: 340.7
                    }
                },
                'R290': {
                    name: 'R-290 (Propane)',
                    type: 'Natural',
                    safety: 'A3',
                    gwp: 3,
                    pressureTemp: {
                        20: 36.0, 25: 41.0, 30: 46.5, 35: 52.5, 40: 59.0, 45: 66.0, 50: 73.5,
                        55: 81.5, 60: 90.0, 65: 99.0, 70: 108.5, 75: 118.5, 80: 129.0, 85: 140.0,
                        90: 151.5, 95: 163.5, 100: 176.0, 105: 189.0, 110: 202.5, 115: 216.5,
                        120: 231.0, 125: 246.0, 130: 261.5
                    }
                },
                'R600a': {
                    name: 'R-600a (Isobutane)',
                    type: 'Natural',
                    safety: 'A3',
                    gwp: 3,
                    pressureTemp: {
                        20: 7.5, 25: 9.0, 30: 10.8, 35: 12.8, 40: 15.0, 45: 17.5, 50: 20.3,
                        55: 23.5, 60: 27.0, 65: 30.8, 70: 35.0, 75: 39.5, 80: 44.5, 85: 49.8,
                        90: 55.5, 95: 61.5, 100: 68.0, 105: 75.0, 110: 82.5, 115: 90.5,
                        120: 99.0, 125: 108.0, 130: 117.5
                    }
                },
                'R744': {
                    name: 'R-744 (CO2)',
                    type: 'Natural',
                    safety: 'A1',
                    gwp: 1,
                    pressureTemp: {
                        '-20': 200.0, '-15': 230.0, '-10': 263.0, '-5': 300.0, 0: 340.0, 5: 383.0, 10: 430.0,
                        15: 481.0, 20: 536.0, 25: 595.0, 30: 659.0, 35: 727.0, 40: 800.0, 45: 878.0,
                        50: 962.0, 55: 1051.0, 60: 1146.0, 65: 1247.0, 70: 1354.0, 75: 1468.0,
                        80: 1589.0, 85: 1717.0, '87.7': 1800.0
                    }
                }
            };
        }

        function setupEventListenersSH() {
            const shRefrigerant = document.getElementById('sh-refrigerant');
            const scRefrigerant = document.getElementById('sc-refrigerant');
            const suctionPressure = document.getElementById('suction-pressure');
            const suctionTemp = document.getElementById('suction-temp');
            const dischargePressure = document.getElementById('discharge-pressure');
            const liquidTemp = document.getElementById('liquid-temp');

            if (shRefrigerant) {
                shRefrigerant.addEventListener('change', function() {
                    calculateSuperheat();
                    updateRefrigerantInfoSH('sh');
                });
            }

            if (scRefrigerant) {
                scRefrigerant.addEventListener('change', function() {
                    calculateSubcooling();
                    updateRefrigerantInfoSH('sc');
                });
            }

            if (suctionPressure) {
                suctionPressure.addEventListener('input', calculateSuperheat);
            }

            if (suctionTemp) {
                suctionTemp.addEventListener('input', calculateSuperheat);
            }

            if (dischargePressure) {
                dischargePressure.addEventListener('input', calculateSubcooling);
            }

            if (liquidTemp) {
                liquidTemp.addEventListener('input', calculateSubcooling);
            }
        }

        function interpolateTemperatureSH(pressure, pressureTempData) {
            const pressures = Object.keys(pressureTempData).map(Number).sort(function(a, b) { return a - b; });
            const temperatures = pressures.map(function(p) { return pressureTempData[p]; });
            
            let lowerIndex = -1;
            for (let i = 0; i < temperatures.length - 1; i++) {
                if (pressure >= temperatures[i] && pressure <= temperatures[i + 1]) {
                    lowerIndex = i;
                    break;
                }
            }
            
            if (lowerIndex === -1) {
                if (pressure < temperatures[0]) {
                    return pressures[0];
                } else {
                    return pressures[pressures.length - 1];
                }
            }
            
            const p1 = temperatures[lowerIndex];
            const p2 = temperatures[lowerIndex + 1];
            const t1 = pressures[lowerIndex];
            const t2 = pressures[lowerIndex + 1];
            
            return t1 + (pressure - p1) * (t2 - t1) / (p2 - p1);
        }

        // SuperHeat/SubCool Calculator Functions
        window.calculateSuperheat = function() {
            const refrigerant = document.getElementById('sh-refrigerant').value;
            const suctionPressure = parseFloat(document.getElementById('suction-pressure').value);
            const suctionTemp = parseFloat(document.getElementById('suction-temp').value);
            const resultDiv = document.getElementById('superheat-result');

            if (!refrigerant || isNaN(suctionPressure) || isNaN(suctionTemp)) {
                resultDiv.textContent = 'Please fill in all fields';
                resultDiv.style.background = 'linear-gradient(45deg, #ff6b6b, #ee5a24)';
                return;
            }

            const refData = refrigerantDataSH[refrigerant];
            if (!refData) {
                resultDiv.textContent = 'Refrigerant data not available';
                resultDiv.style.background = 'linear-gradient(45deg, #ff6b6b, #ee5a24)';
                return;
            }

            const absolutePressure = suctionPressure + 14.7;
            const saturatedTemp = interpolateTemperatureSH(absolutePressure, refData.pressureTemp);
            const superheat = suctionTemp - saturatedTemp;

            let message = 'Super-Heat: ' + superheat.toFixed(1) + '¬∞F';

            if (superheat >= 5 && superheat <= 20) {
                resultDiv.style.background = 'linear-gradient(45deg, #2ecc71, #27ae60)';
                message += ' ‚úì GOOD';
            } else if (superheat >= 20 && superheat <= 30) {
                resultDiv.style.background = 'linear-gradient(45deg, #f39c12, #e67e22)';
                message += ' ‚ö†Ô∏è HIGH';
            } else if (superheat < 5) {
                resultDiv.style.background = 'linear-gradient(45deg, #e74c3c, #c0392b)';
                message += ' ‚ùå TOO LOW';
            } else {
                resultDiv.style.background = 'linear-gradient(45deg, #e74c3c, #c0392b)';
                message += ' ‚ùå TOO HIGH';
            }

            message += '\nSaturated Temp: ' + saturatedTemp.toFixed(1) + '¬∞F';
            resultDiv.textContent = message;
        };

        window.calculateSubcooling = function() {
            const refrigerant = document.getElementById('sc-refrigerant').value;
            const dischargePressure = parseFloat(document.getElementById('discharge-pressure').value);
            const liquidTemp = parseFloat(document.getElementById('liquid-temp').value);
            const resultDiv = document.getElementById('subcooling-result');

            if (!refrigerant || isNaN(dischargePressure) || isNaN(liquidTemp)) {
                resultDiv.textContent = 'Please fill in all fields';
                resultDiv.style.background = 'linear-gradient(45deg, #ff6b6b, #ee5a24)';
                return;
            }

            const refData = refrigerantDataSH[refrigerant];
            if (!refData) {
                resultDiv.textContent = 'Refrigerant data not available';
                resultDiv.style.background = 'linear-gradient(45deg, #ff6b6b, #ee5a24)';
                return;
            }

            const absolutePressure = dischargePressure + 14.7;
            const saturatedTemp = interpolateTemperatureSH(absolutePressure, refData.pressureTemp);
            const subcooling = saturatedTemp - liquidTemp;

            let message = 'Sub-Cooling: ' + subcooling.toFixed(1) + '¬∞F';

            if (subcooling >= 5 && subcooling <= 20) {
                resultDiv.style.background = 'linear-gradient(45deg, #2ecc71, #27ae60)';
                message += ' ‚úì GOOD';
            } else if (subcooling >= 20 && subcooling <= 30) {
                resultDiv.style.background = 'linear-gradient(45deg, #f39c12, #e67e22)';
                message += ' ‚ö†Ô∏è HIGH';
            } else if (subcooling < 5) {
                resultDiv.style.background = 'linear-gradient(45deg, #e74c3c, #c0392b)';
                message += ' ‚ùå TOO LOW';
            } else {
                resultDiv.style.background = 'linear-gradient(45deg, #e74c3c, #c0392b)';
                message += ' ‚ùå TOO HIGH';
            }

            message += '\nSaturated Temp: ' + saturatedTemp.toFixed(1) + '¬∞F';
            resultDiv.textContent = message;
        };

        function updateRefrigerantInfoSH(section) {
            // This function can be implemented if needed for refrigerant info display
            console.log('Refrigerant info update for section:', section);
        }

        window.resetSuperheat = function() {
            const shRefrigerant = document.getElementById('sh-refrigerant');
            const suctionPressure = document.getElementById('suction-pressure');
            const suctionTemp = document.getElementById('suction-temp');
            const superheatResult = document.getElementById('superheat-result');
            
            if (shRefrigerant) shRefrigerant.value = '';
            if (suctionPressure) suctionPressure.value = '';
            if (suctionTemp) suctionTemp.value = '';
            if (superheatResult) superheatResult.innerHTML = 'Enter values to calculate super-heat';
        };

        window.resetSubcooling = function() {
            const scRefrigerant = document.getElementById('sc-refrigerant');
            const dischargePressure = document.getElementById('discharge-pressure');
            const liquidTemp = document.getElementById('liquid-temp');
            const subcoolingResult = document.getElementById('subcooling-result');
            
            if (scRefrigerant) scRefrigerant.value = '';
            if (dischargePressure) dischargePressure.value = '';
            if (liquidTemp) liquidTemp.value = '';
            if (subcoolingResult) subcoolingResult.innerHTML = 'Enter values to calculate sub-cooling';
        };

        function initializePTChart() {
            console.log('P-T Chart tool initialized');
        }

        function initializePsychrometric() {
            setTimeout(() => {
                if (document.getElementById('psychrometric-content').style.display !== 'none') {
                    calculateProperties();
                }
            }, 100);
        }

        function initializeUnitConverter() {
            setupUnitConverterListeners();
        }

        function initializeDuctSizing() {
            // Initialize default values
            document.getElementById('ds-furnace-capacity').value = '80000';
            document.getElementById('ds-fan-speed').value = '1200';
            document.querySelector('.ds-room-name').value = 'Living Room';
            document.querySelector('.ds-room-area').value = '250';
            
            // Initialize duct sizing variables
            window.dsRoomCount = 1;
        }

        // Duct Sizing Calculator Functions
        const dsClimateFactors = {
            '4': 35,    // Southern Ontario
            '5': 40,    // Central Ontario
            '6': 45,    // Northern Ontario
            '7a': 50,   // Manitoba, Saskatchewan
            '7b': 45,   // Alberta
            '8': 60     // Northern Canada
        };

        const dsMaterialFriction = {
            'galvanized': 0.1,
            'aluminum': 0.08,
            'flexible': 0.25,
            'fiberglass': 0.12
        };

        const dsStandardDuctSizes = [
            [6, 4], [8, 4], [10, 4], [12, 4], [14, 4], [16, 4], [18, 4], [20, 4],
            [6, 6], [8, 6], [10, 6], [12, 6], [14, 6], [16, 6], [18, 6], [20, 6], [22, 6], [24, 6],
            [8, 8], [10, 8], [12, 8], [14, 8], [16, 8], [18, 8], [20, 8], [22, 8], [24, 8], [26, 8], [28, 8],
            [10, 10], [12, 10], [14, 10], [16, 10], [18, 10], [20, 10], [22, 10], [24, 10], [26, 10], [28, 10], [30, 10],
            [12, 12], [14, 12], [16, 12], [18, 12], [20, 12], [22, 12], [24, 12], [26, 12], [28, 12], [30, 12], [32, 12], [36, 12]
        ];

        const dsRoundDuctSizes = [4, 5, 6, 7, 8, 9, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30];

        window.addDSRoom = function() {
            window.dsRoomCount++;
            const container = document.getElementById('ds-rooms-container');
            const roomDiv = document.createElement('div');
            roomDiv.className = 'ds-room-input';
            roomDiv.style.cssText = 'display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 10px; align-items: end; margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px;';
            roomDiv.innerHTML = `
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Room Name</label>
                    <input type="text" class="ds-room-name" placeholder="e.g., Bedroom ${window.dsRoomCount}" style="width: 100%; padding: 8px; border: 1px solid #e9ecef; border-radius: 4px; font-size: 14px;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Area (sq ft)</label>
                    <input type="number" class="ds-room-area" placeholder="150" style="width: 100%; padding: 8px; border: 1px solid #e9ecef; border-radius: 4px; font-size: 14px;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Ceiling Height (ft)</label>
                    <input type="number" class="ds-room-height" placeholder="8" step="0.5" value="8" style="width: 100%; padding: 8px; border: 1px solid #e9ecef; border-radius: 4px; font-size: 14px;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Registers</label>
                    <input type="number" class="ds-room-registers" placeholder="1" min="1" value="1" style="width: 100%; padding: 8px; border: 1px solid #e9ecef; border-radius: 4px; font-size: 14px;">
                </div>
            `;
            container.appendChild(roomDiv);
        };

        function dsCalculateEquivalentDiameter(width, height) {
            return 1.3 * Math.pow((width * height), 0.625) / Math.pow((width + height), 0.25);
        }

        function dsSelectOptimalDuctSize(cfm, maxVelocity = 900) {
            const requiredArea = cfm / maxVelocity * 144;
            
            let bestSize = null;
            let bestVelocity = Infinity;
            
            for (let [w, h] of dsStandardDuctSizes) {
                const area = w * h;
                if (area >= requiredArea) {
                    const velocity = (cfm / area) * 144;
                    if (velocity <= maxVelocity && velocity < bestVelocity) {
                        bestSize = [w, h, 'rect'];
                        bestVelocity = velocity;
                    }
                }
            }
            
            return bestSize || [dsStandardDuctSizes[dsStandardDuctSizes.length - 1][0], dsStandardDuctSizes[dsStandardDuctSizes.length - 1][1], 'rect'];
        }

        function dsSelectRoundDuct(cfm, maxVelocity = 800) {
            const requiredArea = cfm / maxVelocity * 144;
            const requiredDiameter = Math.sqrt(requiredArea * 4 / Math.PI);
            
            for (let diameter of dsRoundDuctSizes) {
                const area = Math.PI * Math.pow(diameter / 2, 2);
                const velocity = (cfm / area) * 144;
                if (velocity <= maxVelocity) {
                    return diameter;
                }
            }
            return dsRoundDuctSizes[dsRoundDuctSizes.length - 1];
        }

        function dsCalculatePressureLoss(cfm, ductSize, length, material, fittings = 0) {
            let equivalentDiameter;
            if (Array.isArray(ductSize)) {
                equivalentDiameter = dsCalculateEquivalentDiameter(ductSize[0], ductSize[1]);
            } else {
                equivalentDiameter = ductSize;
            }
            
            const frictionFactor = dsMaterialFriction[material];
            const velocity = cfm / (Math.PI * Math.pow(equivalentDiameter / 24, 2)) * 4;
            
            const frictionPer100 = frictionFactor * Math.pow(velocity / 1000, 1.9);
            const frictionLoss = (frictionPer100 * length) / 100;
            const fittingLoss = (frictionPer100 * fittings * 5) / 100;
            
            return frictionLoss + fittingLoss;
        }

        window.calculateDSResults = function() {
            const climateZone = document.getElementById('ds-climate-zone').value;
            const buildingType = document.getElementById('ds-building-type').value;
            const furnaceCapacity = parseFloat(document.getElementById('ds-furnace-capacity').value) || 0;
            const fanSpeed = parseFloat(document.getElementById('ds-fan-speed').value) || 0;
            const ductMaterial = document.getElementById('ds-duct-material').value;
            const systemType = document.getElementById('ds-system-type').value;
            const ductLength = parseFloat(document.getElementById('ds-duct-length').value) || 150;
            const fittingCount = parseInt(document.getElementById('ds-fitting-count').value) || 8;

            const rooms = [];
            const roomInputs = document.querySelectorAll('.ds-room-input');
            
            roomInputs.forEach(room => {
                const name = room.querySelector('.ds-room-name').value || 'Unnamed Room';
                const area = parseFloat(room.querySelector('.ds-room-area').value) || 0;
                const height = parseFloat(room.querySelector('.ds-room-height').value) || 8;
                const registers = parseInt(room.querySelector('.ds-room-registers').value) || 1;
                
                if (area > 0) {
                    rooms.push({ name, area, height, registers });
                }
            });

            if (rooms.length === 0) {
                alert('Please add at least one room with valid area.');
                return;
            }

            const heatingFactor = dsClimateFactors[climateZone];
            let totalLoad = 0;
            let totalCFM = 0;
            
            rooms.forEach(room => {
                room.heatLoad = room.area * heatingFactor;
                const cfmPerBtu = systemType === 'cooling' ? 400 : 450;
                room.cfm = room.heatLoad / cfmPerBtu;
                room.cfmPerRegister = room.cfm / room.registers;
                
                totalLoad += room.heatLoad;
                totalCFM += room.cfm;
            });

            const mainTrunkSize = dsSelectOptimalDuctSize(totalCFM, 1100);
            const mainTrunkVelocity = mainTrunkSize ? 
                (totalCFM / (mainTrunkSize[0] * mainTrunkSize[1])) * 144 : 0;

            const subTrunkCFM = totalCFM * 0.6;
            const subTrunkSize = dsSelectOptimalDuctSize(subTrunkCFM, 900);
            const subTrunkVelocity = subTrunkSize ? 
                (subTrunkCFM / (subTrunkSize[0] * subTrunkSize[1])) * 144 : 0;

            rooms.forEach(room => {
                room.ductSize = dsSelectOptimalDuctSize(room.cfm, 800);
                room.roundDuct = dsSelectRoundDuct(room.cfm, 750);
                
                if (room.cfmPerRegister <= 60) {
                    room.registerSize = "3\" √ó 10\"";
                } else {
                    room.registerSize = "4\" √ó 10\"";
                }
            });

            const mainTrunkPressure = dsCalculatePressureLoss(totalCFM, mainTrunkSize, ductLength * 0.4, ductMaterial, fittingCount * 0.3);
            const subTrunkPressure = dsCalculatePressureLoss(subTrunkCFM, subTrunkSize, ductLength * 0.3, ductMaterial, fittingCount * 0.3);
            const branchPressure = Math.max(...rooms.map(room => 
                dsCalculatePressureLoss(room.cfm, room.ductSize, ductLength * 0.3 / rooms.length, ductMaterial, fittingCount * 0.4 / rooms.length)
            ));
            
            const totalPressureLoss = mainTrunkPressure + subTrunkPressure + branchPressure;

            const returnCFM = totalCFM * 0.8;
            const returnArea = (returnCFM / 500) * 144;

            // Update results
            document.getElementById('ds-total-load').textContent = `${Math.round(totalLoad).toLocaleString()} BTU/h`;
            document.getElementById('ds-total-cfm').textContent = `${Math.round(totalCFM)} CFM`;
            document.getElementById('ds-pressure-loss').textContent = `${totalPressureLoss.toFixed(3)} in. w.c.`;
            document.getElementById('ds-return-area').textContent = `${Math.round(returnArea)} sq in`;

            if (mainTrunkSize) {
                document.getElementById('ds-main-trunk-size').textContent = `${mainTrunkSize[0]}" √ó ${mainTrunkSize[1]}"`;
                document.getElementById('ds-trunk-velocity').textContent = `${Math.round(mainTrunkVelocity)}`;
            }

            if (subTrunkSize) {
                document.getElementById('ds-sub-trunk-size').textContent = `${subTrunkSize[0]}" √ó ${subTrunkSize[1]}"`;
                document.getElementById('ds-sub-trunk-velocity').textContent = `${Math.round(subTrunkVelocity)}`;
            }

            document.getElementById('ds-branch-duct-range').textContent = `${Math.min(...rooms.map(r => r.ductSize[0]))}-${Math.max(...rooms.map(r => r.ductSize[0]))} inch`;
            document.getElementById('ds-round-duct-range').textContent = `${Math.min(...rooms.map(r => r.roundDuct))}-${Math.max(...rooms.map(r => r.roundDuct))}"`;

            dsGenerateDetailedResults(rooms, returnCFM, returnArea, furnaceCapacity, totalLoad, fanSpeed, totalCFM, totalPressureLoss);
        };

        function dsGenerateDetailedResults(rooms, returnCFM, returnArea, furnaceCapacity, totalLoad, fanSpeed, totalCFM, totalPressureLoss) {
            const resultsDiv = document.getElementById('ds-detailed-results');
            
            let tableHTML = `
                <div style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-radius: 15px; padding: 25px; margin-bottom: 20px; border-left: 5px solid #3498db; margin-top: 20px;">
                    <h3 style="margin-bottom: 15px; color: #2c3e50;">Individual Room Duct Sizing</h3>
                    <table class="ds-duct-sizing-table">
                        <thead>
                            <tr>
                                <th>Room</th>
                                <th>Area<br>(sq ft)</th>
                                <th>Heat Load<br>(BTU/h)</th>
                                <th>CFM<br>Required</th>
                                <th>Registers</th>
                                <th>CFM/<br>Register</th>
                                <th>Rectangular<br>Duct Size</th>
                                <th>Round Duct<br>Size</th>
                                <th>Register<br>Size</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            rooms.forEach(room => {
                tableHTML += `
                    <tr>
                        <td>${room.name}</td>
                        <td>${room.area}</td>
                        <td>${Math.round(room.heatLoad).toLocaleString()}</td>
                        <td>${Math.round(room.cfm)}</td>
                        <td>${room.registers}</td>
                        <td>${Math.round(room.cfmPerRegister)}</td>
                        <td>${room.ductSize[0]}" √ó ${room.ductSize[1]}"</td>
                        <td>${room.roundDuct}" ‚àÖ</td>
                        <td>${room.registerSize}</td>
                    </tr>
                `;
            });

            tableHTML += `
                        </tbody>
                    </table>
                </div>
            `;

            const recommendedReturns = Math.ceil(returnArea / 200);

            tableHTML += `
                <div style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-radius: 15px; padding: 25px; margin-bottom: 20px; border-left: 5px solid #3498db;">
                    <h3 style="margin-bottom: 15px; color: #2c3e50;">Cold Air Return Requirements</h3>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #dee2e6;">
                        <span style="font-weight: 600; color: #2c3e50;">Return Air CFM:</span>
                        <span style="font-size: 1.1em; color: #e74c3c; font-weight: 700;">${Math.round(returnCFM)} CFM</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #dee2e6;">
                        <span style="font-weight: 600; color: #2c3e50;">Total Return Area Required:</span>
                        <span style="font-size: 1.1em; color: #e74c3c; font-weight: 700;">${Math.round(returnArea)} sq in</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #dee2e6;">
                        <span style="font-weight: 600; color: #2c3e50;">Recommended Number of Returns:</span>
                        <span style="font-size: 1.1em; color: #e74c3c; font-weight: 700;">${recommendedReturns}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0;">
                        <span style="font-weight: 600; color: #2c3e50;">Return Grille Size (each):</span>
                        <span style="font-size: 1.1em; color: #e74c3c; font-weight: 700;">${recommendedReturns === 1 ? '20" √ó 20"' : '16" √ó 20"'}</span>
                    </div>
                </div>
            `;

            // Check for warnings and errors
            let warnings = [];
            let errors = [];

            if (furnaceCapacity > 0 && furnaceCapacity < totalLoad) {
                errors.push('üö® Furnace capacity is insufficient for calculated heating load.');
            }

            if (fanSpeed > 0 && fanSpeed < totalCFM) {
                errors.push('üö® Fan capacity is insufficient for required airflow.');
            }

            if (totalPressureLoss > 0.5) {
                errors.push(`üö® Static pressure loss (${totalPressureLoss.toFixed(3)}" w.c.) exceeds maximum allowable (0.5" w.c.).`);
            }

            if (totalCFM > 2000) {
                warnings.push('‚ö†Ô∏è High airflow requirements may require zoning or larger equipment.');
            }

            if (totalPressureLoss > 0.4) {
                warnings.push('‚ö†Ô∏è Static pressure approaching maximum limit. Consider larger ducts.');
            }

            if (errors.length > 0) {
                tableHTML += `
                    <div class="ds-error">
                        <strong>System Errors - Must Be Addressed:</strong><br>
                        ${errors.join('<br>')}
                    </div>
                `;
            }

            if (warnings.length > 0) {
                tableHTML += `
                    <div class="ds-warning">
                        <strong>System Warnings:</strong><br>
                        ${warnings.join('<br>')}
                    </div>
                `;
            }

            resultsDiv.innerHTML = tableHTML;
        }

        // Unit Converter Functions
        function setupUnitConverterListeners() {
            setupLengthConverters();
            setupWeightConverters();
            setupTemperatureConverters();
            setupPressureConverters();
            setupEnergyConverters();
            setupPowerConverters();
        }

        function setupLengthConverters() {
            const length1 = document.getElementById('length1');
            const length2 = document.getElementById('length2');
            const length3 = document.getElementById('length3');
            const length4 = document.getElementById('length4');

            if (length1) {
                length1.addEventListener('input', function() {
                    const feet = parseFloat(this.value);
                    if (!isNaN(feet) && length2) {
                        length2.value = (feet * 0.3048).toFixed(6);
                    }
                });
            }

            if (length2) {
                length2.addEventListener('input', function() {
                    const meters = parseFloat(this.value);
                    if (!isNaN(meters) && length1) {
                        length1.value = (meters / 0.3048).toFixed(6);
                    }
                });
            }

            if (length3) {
                length3.addEventListener('input', function() {
                    const inches = parseFloat(this.value);
                    if (!isNaN(inches) && length4) {
                        length4.value = (inches * 2.54).toFixed(6);
                    }
                });
            }

            if (length4) {
                length4.addEventListener('input', function() {
                    const cm = parseFloat(this.value);
                    if (!isNaN(cm) && length3) {
                        length3.value = (cm / 2.54).toFixed(6);
                    }
                });
            }
        }

        function setupWeightConverters() {
            const weight1 = document.getElementById('weight1');
            const weight2 = document.getElementById('weight2');
            const weight3 = document.getElementById('weight3');
            const weight4 = document.getElementById('weight4');

            if (weight1) {
                weight1.addEventListener('input', function() {
                    const pounds = parseFloat(this.value);
                    if (!isNaN(pounds) && weight2) {
                        weight2.value = (pounds * 0.453592).toFixed(6);
                    }
                });
            }

            if (weight2) {
                weight2.addEventListener('input', function() {
                    const kg = parseFloat(this.value);
                    if (!isNaN(kg) && weight1) {
                        weight1.value = (kg / 0.453592).toFixed(6);
                    }
                });
            }

            if (weight3) {
                weight3.addEventListener('input', function() {
                    const ounces = parseFloat(this.value);
                    if (!isNaN(ounces) && weight4) {
                        weight4.value = (ounces * 28.3495).toFixed(6);
                    }
                });
            }

            if (weight4) {
                weight4.addEventListener('input', function() {
                    const grams = parseFloat(this.value);
                    if (!isNaN(grams) && weight3) {
                        weight3.value = (grams / 28.3495).toFixed(6);
                    }
                });
            }
        }

        function setupTemperatureConverters() {
            const temp1 = document.getElementById('temp1');
            const temp2 = document.getElementById('temp2');
            const temp3 = document.getElementById('temp3');

            if (temp1) {
                temp1.addEventListener('input', updateTemperature);
            }
            if (temp2) {
                temp2.addEventListener('input', updateTemperature);
            }
            if (temp3) {
                temp3.addEventListener('input', updateTemperature);
            }
        }

        function setupPressureConverters() {
            const pressure1 = document.getElementById('pressure1');
            const pressure2 = document.getElementById('pressure2');
            const pressure3 = document.getElementById('pressure3');
            const pressure4 = document.getElementById('pressure4');

            if (pressure1) {
                pressure1.addEventListener('input', function() {
                    const psi = parseFloat(this.value);
                    if (!isNaN(psi)) {
                        if (pressure2) pressure2.value = (psi * 0.0689476).toFixed(6);
                        if (pressure3) pressure3.value = (psi * 6.89476).toFixed(6);
                        if (pressure4) pressure4.value = (psi * 6894.76).toFixed(2);
                    }
                });
            }

            if (pressure2) {
                pressure2.addEventListener('input', function() {
                    const bar = parseFloat(this.value);
                    if (!isNaN(bar)) {
                        if (pressure1) pressure1.value = (bar / 0.0689476).toFixed(6);
                        if (pressure3) pressure3.value = (bar * 100).toFixed(6);
                        if (pressure4) pressure4.value = (bar * 100000).toFixed(2);
                    }
                });
            }

            if (pressure3) {
                pressure3.addEventListener('input', function() {
                    const kpa = parseFloat(this.value);
                    if (!isNaN(kpa)) {
                        if (pressure1) pressure1.value = (kpa / 6.89476).toFixed(6);
                        if (pressure2) pressure2.value = (kpa / 100).toFixed(6);
                        if (pressure4) pressure4.value = (kpa * 1000).toFixed(2);
                    }
                });
            }

            if (pressure4) {
                pressure4.addEventListener('input', function() {
                    const pa = parseFloat(this.value);
                    if (!isNaN(pa)) {
                        if (pressure1) pressure1.value = (pa / 6894.76).toFixed(6);
                        if (pressure2) pressure2.value = (pa / 100000).toFixed(6);
                        if (pressure3) pressure3.value = (pa / 1000).toFixed(6);
                    }
                });
            }
        }

        function setupEnergyConverters() {
            const energy1 = document.getElementById('energy1');
            const energy2 = document.getElementById('energy2');
            const energy3 = document.getElementById('energy3');
            const energy4 = document.getElementById('energy4');

            if (energy1) {
                energy1.addEventListener('input', function() {
                    const btu = parseFloat(this.value);
                    if (!isNaN(btu)) {
                        if (energy2) energy2.value = (btu * 1055.06).toFixed(2);
                        if (energy3) energy3.value = (btu * 0.000293071).toFixed(8);
                        if (energy4) energy4.value = (btu * 252.164).toFixed(2);
                    }
                });
            }

            if (energy2) {
                energy2.addEventListener('input', function() {
                    const joules = parseFloat(this.value);
                    if (!isNaN(joules)) {
                        if (energy1) energy1.value = (joules / 1055.06).toFixed(8);
                        if (energy3) energy3.value = (joules / 3600000).toFixed(8);
                        if (energy4) energy4.value = (joules / 4.184).toFixed(2);
                    }
                });
            }

            if (energy3) {
                energy3.addEventListener('input', function() {
                    const kwh = parseFloat(this.value);
                    if (!isNaN(kwh)) {
                        if (energy1) energy1.value = (kwh / 0.000293071).toFixed(2);
                        if (energy2) energy2.value = (kwh * 3600000).toFixed(2);
                        if (energy4) energy4.value = (kwh * 860421).toFixed(2);
                    }
                });
            }

            if (energy4) {
                energy4.addEventListener('input', function() {
                    const cal = parseFloat(this.value);
                    if (!isNaN(cal)) {
                        if (energy1) energy1.value = (cal / 252.164).toFixed(6);
                        if (energy2) energy2.value = (cal * 4.184).toFixed(2);
                        if (energy3) energy3.value = (cal / 860421).toFixed(8);
                    }
                });
            }
        }

        function setupPowerConverters() {
            const power1 = document.getElementById('power1');
            const power2 = document.getElementById('power2');
            const power3 = document.getElementById('power3');
            const power4 = document.getElementById('power4');

            if (power1) {
                power1.addEventListener('input', function() {
                    const btuh = parseFloat(this.value);
                    if (!isNaN(btuh)) {
                        if (power2) power2.value = (btuh * 0.000293071).toFixed(6);
                        if (power3) power3.value = (btuh * 0.000393014).toFixed(6);
                        if (power4) power4.value = (btuh * 0.293071).toFixed(3);
                    }
                });
            }

            if (power2) {
                power2.addEventListener('input', function() {
                    const kw = parseFloat(this.value);
                    if (!isNaN(kw)) {
                        if (power1) power1.value = (kw / 0.000293071).toFixed(2);
                        if (power3) power3.value = (kw * 1.34102).toFixed(6);
                        if (power4) power4.value = (kw * 1000).toFixed(3);
                    }
                });
            }

            if (power3) {
                power3.addEventListener('input', function() {
                    const hp = parseFloat(this.value);
                    if (!isNaN(hp)) {
                        if (power1) power1.value = (hp / 0.000393014).toFixed(2);
                        if (power2) power2.value = (hp * 0.745699).toFixed(6);
                        if (power4) power4.value = (hp * 745.699).toFixed(3);
                    }
                });
            }

            if (power4) {
                power4.addEventListener('input', function() {
                    const watts = parseFloat(this.value);
                    if (!isNaN(watts)) {
                        if (power1) power1.value = (watts / 0.293071).toFixed(2);
                        if (power2) power2.value = (watts / 1000).toFixed(6);
                        if (power3) power3.value = (watts / 745.699).toFixed(6);
                    }
                });
            }
        }

        // Unit Converter Swap Functions
        window.swapLength = function() {
            const val1 = document.getElementById('length1').value;
            const val2 = document.getElementById('length2').value;
            document.getElementById('length1').value = val2;
            document.getElementById('length2').value = val1;
        };

        window.swapLengthInchCm = function() {
            const val3 = document.getElementById('length3').value;
            const val4 = document.getElementById('length4').value;
            document.getElementById('length3').value = val4;
            document.getElementById('length4').value = val3;
        };

        window.clearLength = function() {
            document.getElementById('length1').value = '';
            document.getElementById('length2').value = '';
            document.getElementById('length3').value = '';
            document.getElementById('length4').value = '';
        };

        window.swapWeight = function() {
            const val1 = document.getElementById('weight1').value;
            const val2 = document.getElementById('weight2').value;
            document.getElementById('weight1').value = val2;
            document.getElementById('weight2').value = val1;
        };

        window.swapWeightOzGram = function() {
            const val3 = document.getElementById('weight3').value;
            const val4 = document.getElementById('weight4').value;
            document.getElementById('weight3').value = val4;
            document.getElementById('weight4').value = val3;
        };

        window.clearWeight = function() {
            document.getElementById('weight1').value = '';
            document.getElementById('weight2').value = '';
            document.getElementById('weight3').value = '';
            document.getElementById('weight4').value = '';
        };

        window.updateTemperature = function() {
            const resultDiv = document.getElementById('tempResult');
            if (!resultDiv) return;
            
            const celsius = parseFloat(document.getElementById('temp1').value);
            const fahrenheit = parseFloat(document.getElementById('temp2').value);
            const kelvin = parseFloat(document.getElementById('temp3').value);

            let results = [];
            
            if (!isNaN(celsius)) {
                const f = (celsius * 9/5) + 32;
                const k = celsius + 273.15;
                document.getElementById('temp2').value = f.toFixed(2);
                document.getElementById('temp3').value = k.toFixed(2);
                results.push(`${celsius}¬∞C = ${f.toFixed(2)}¬∞F = ${k.toFixed(2)}K`);
            } else if (!isNaN(fahrenheit)) {
                const c = (fahrenheit - 32) * 5/9;
                const k = c + 273.15;
                document.getElementById('temp1').value = c.toFixed(2);
                document.getElementById('temp3').value = k.toFixed(2);
                results.push(`${fahrenheit}¬∞F = ${c.toFixed(2)}¬∞C = ${k.toFixed(2)}K`);
            } else if (!isNaN(kelvin)) {
                const c = kelvin - 273.15;
                const f = (c * 9/5) + 32;
                document.getElementById('temp1').value = c.toFixed(2);
                document.getElementById('temp2').value = f.toFixed(2);
                results.push(`${kelvin}K = ${c.toFixed(2)}¬∞C = ${f.toFixed(2)}¬∞F`);
            }

            resultDiv.innerHTML = results.join('<br>');
        };

        window.swapTemperature = function() {
            const val1 = document.getElementById('temp1').value;
            const val2 = document.getElementById('temp2').value;
            document.getElementById('temp1').value = val2;
            document.getElementById('temp2').value = val1;
            updateTemperature();
        };

        window.clearTemperature = function() {
            document.getElementById('temp1').value = '';
            document.getElementById('temp2').value = '';
            document.getElementById('temp3').value = '';
            const resultDiv = document.getElementById('tempResult');
            if (resultDiv) resultDiv.innerHTML = '';
        };

        window.swapPressurePsiBar = function() {
            const val1 = document.getElementById('pressure1').value;
            const val2 = document.getElementById('pressure2').value;
            document.getElementById('pressure1').value = val2;
            document.getElementById('pressure2').value = val1;
        };

        window.swapPressureKpaPa = function() {
            const val3 = document.getElementById('pressure3').value;
            const val4 = document.getElementById('pressure4').value;
            document.getElementById('pressure3').value = val4;
            document.getElementById('pressure4').value = val3;
        };

        window.clearPressure = function() {
            document.getElementById('pressure1').value = '';
            document.getElementById('pressure2').value = '';
            document.getElementById('pressure3').value = '';
            document.getElementById('pressure4').value = '';
        };

        window.swapEnergyBtuJoule = function() {
            const val1 = document.getElementById('energy1').value;
            const val2 = document.getElementById('energy2').value;
            document.getElementById('energy1').value = val2;
            document.getElementById('energy2').value = val1;
        };

        window.swapEnergyKwhCal = function() {
            const val3 = document.getElementById('energy3').value;
            const val4 = document.getElementById('energy4').value;
            document.getElementById('energy3').value = val4;
            document.getElementById('energy4').value = val3;
        };

        window.clearEnergy = function() {
            document.getElementById('energy1').value = '';
            document.getElementById('energy2').value = '';
            document.getElementById('energy3').value = '';
            document.getElementById('energy4').value = '';
        };

        window.swapPowerBtuKw = function() {
            const val1 = document.getElementById('power1').value;
            const val2 = document.getElementById('power2').value;
            document.getElementById('power1').value = val2;
            document.getElementById('power2').value = val1;
        };

        window.swapPowerHpWatt = function() {
            const val3 = document.getElementById('power3').value;
            const val4 = document.getElementById('power4').value;
            document.getElementById('power3').value = val4;
            document.getElementById('power4').value = val3;
        };

        window.clearPower = function() {
            document.getElementById('power1').value = '';
            document.getElementById('power2').value = '';
            document.getElementById('power3').value = '';
            document.getElementById('power4').value = '';
        };

        // Psychrometric Calculator Functions
        let currentUnits = 'metric';
        let psychChart = null;
        let calculatedData = [];

        const refrigerantData = {
            'R22': { name: 'R-22 (HCFC-22)', mw: 86.47, criticalTemp: 96.2, criticalPressure: 4990 },
            'R134a': { name: 'R-134a (HFC-134a)', mw: 102.03, criticalTemp: 101.1, criticalPressure: 4059 },
            'R410A': { name: 'R-410A (HFC-410A)', mw: 72.58, criticalTemp: 71.3, criticalPressure: 4901 },
            'R404A': { name: 'R-404A (HFC-404A)', mw: 97.6, criticalTemp: 72.1, criticalPressure: 3734 },
            'R507A': { name: 'R-507A (HFC-507A)', mw: 98.86, criticalTemp: 70.6, criticalPressure: 3705 },
            'R407C': { name: 'R-407C (HFC-407C)', mw: 86.2, criticalTemp: 86.7, criticalPressure: 4630 }
        };

        window.toggleUnits = function(unit) {
            currentUnits = unit;
            document.querySelectorAll('.unit-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            updateUnitLabels();
            convertCurrentValues();
        };

        function updateUnitLabels() {
            const tempUnit = document.getElementById('tempUnit');
            const pressureUnit = document.getElementById('pressureUnit');
            const elevationUnit = document.getElementById('elevationUnit');
            
            if (tempUnit && pressureUnit && elevationUnit) {
                if (currentUnits === 'metric') {
                    tempUnit.textContent = '¬∞C';
                    pressureUnit.textContent = 'kPa';
                    elevationUnit.textContent = 'm';
                } else {
                    tempUnit.textContent = '¬∞F';
                    pressureUnit.textContent = 'psi';
                    elevationUnit.textContent = 'ft';
                }
            }
        }

        function convertCurrentValues() {
            const tempInput = document.getElementById('temperature');
            const pressureInput = document.getElementById('pressure');
            const elevationInput = document.getElementById('elevation');

            if (tempInput && pressureInput && elevationInput) {
                if (currentUnits === 'imperial') {
                    tempInput.value = (parseFloat(tempInput.value) * 9/5 + 32).toFixed(1);
                    pressureInput.value = (parseFloat(pressureInput.value) * 0.145038).toFixed(3);
                    elevationInput.value = (parseFloat(elevationInput.value) * 3.28084).toFixed(0);
                } else {
                    tempInput.value = ((parseFloat(tempInput.value) - 32) * 5/9).toFixed(1);
                    pressureInput.value = (parseFloat(pressureInput.value) / 0.145038).toFixed(3);
                    elevationInput.value = (parseFloat(elevationInput.value) / 3.28084).toFixed(0);
                }
            }
        }

        window.updateRefrigerantInfo = function() {
            const refrigerant = document.getElementById('refrigerant').value;
            const info = refrigerantData[refrigerant];
        };

        window.calculateProperties = function() {
            const temperature = parseFloat(document.getElementById('temperature').value);
            const pressure = parseFloat(document.getElementById('pressure').value);
            const humidity = parseFloat(document.getElementById('humidity').value);
            const elevation = parseFloat(document.getElementById('elevation').value);
            const refrigerant = document.getElementById('refrigerant').value;

            let tempC = currentUnits === 'imperial' ? (temperature - 32) * 5/9 : temperature;
            let pressureKPa = currentUnits === 'imperial' ? pressure / 0.145038 : pressure;
            let elevationM = currentUnits === 'imperial' ? elevation / 3.28084 : elevation;

            const results = performPsychrometricCalculations(tempC, pressureKPa, humidity, elevationM, refrigerant);
            
            displayResults(results);
            updatePsychChart(results);
        };

        function performPsychrometricCalculations(tempC, pressureKPa, humidity, elevationM, refrigerant) {
            const correctedPressure = pressureKPa * Math.pow((1 - 0.0065 * elevationM / 288.15), 5.257);
            const satVaporPressure = 0.61078 * Math.exp(17.27 * tempC / (tempC + 237.3));
            const vaporPressure = (humidity / 100) * satVaporPressure;
            const absoluteHumidity = 0.622 * vaporPressure / (correctedPressure - vaporPressure);
            const dewPoint = 237.3 * Math.log(vaporPressure / 0.61078) / (17.27 - Math.log(vaporPressure / 0.61078));
            const wetBulb = tempC * Math.atan(0.151977 * Math.sqrt(humidity + 8.313659)) +
                           Math.atan(tempC + humidity) - Math.atan(humidity - 1.676331) +
                           0.00391838 * Math.pow(humidity, 1.5) * Math.atan(0.023101 * humidity) - 4.686035;
            const enthalpy = 1.006 * tempC + absoluteHumidity * (2501 + 1.86 * tempC);
            const specificVolume = (287.055 * (tempC + 273.15) * (1 + 1.607858 * absoluteHumidity)) / (correctedPressure * 1000);
            const refData = refrigerantData[refrigerant];
            const saturatedPressure = calculateSaturatedPressure(tempC, refData);
            
            return {
                temperature: tempC,
                pressure: correctedPressure,
                humidity: humidity,
                absoluteHumidity: absoluteHumidity,
                dewPoint: dewPoint,
                wetBulb: wetBulb,
                enthalpy: enthalpy,
                specificVolume: specificVolume,
                vaporPressure: vaporPressure,
                saturatedPressure: saturatedPressure,
                refrigerant: refrigerant
            };
        }

        function calculateSaturatedPressure(tempC, refData) {
            const A = 8.0, B = 1500, C = 230;
            return Math.exp(A - B / (tempC + 273.15 + C));
        }

        function displayResults(results) {
            const resultsContent = document.getElementById('resultsContent');
            if (!resultsContent) return;
            
            let displayTemp = currentUnits === 'imperial' ? results.temperature * 9/5 + 32 : results.temperature;
            let displayPressure = currentUnits === 'imperial' ? results.pressure * 0.145038 : results.pressure;
            let displayDewPoint = currentUnits === 'imperial' ? results.dewPoint * 9/5 + 32 : results.dewPoint;
            let displayWetBulb = currentUnits === 'imperial' ? results.wetBulb * 9/5 + 32 : results.wetBulb;
            
            const tempUnit = currentUnits === 'imperial' ? '¬∞F' : '¬∞C';
            const pressureUnit = currentUnits === 'imperial' ? 'psi' : 'kPa';
            const humidityUnit = currentUnits === 'imperial' ? 'lb/lb' : 'kg/kg';
            const enthalpyUnit = currentUnits === 'imperial' ? 'BTU/lb' : 'kJ/kg';
            const volumeUnit = currentUnits === 'imperial' ? 'ft¬≥/lb' : 'm¬≥/kg';

            resultsContent.innerHTML = `
                <div class="result-item">
                    <span class="result-label">Dry Bulb Temperature:</span>
                    <span class="result-value">${displayTemp.toFixed(2)} ${tempUnit}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Corrected Pressure:</span>
                    <span class="result-value">${displayPressure.toFixed(3)} ${pressureUnit}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Relative Humidity:</span>
                    <span class="result-value">${results.humidity.toFixed(1)} %</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Absolute Humidity:</span>
                    <span class="result-value">${results.absoluteHumidity.toFixed(4)} ${humidityUnit}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Dew Point:</span>
                    <span class="result-value">${displayDewPoint.toFixed(2)} ${tempUnit}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Wet Bulb Temperature:</span>
                    <span class="result-value">${displayWetBulb.toFixed(2)} ${tempUnit}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Enthalpy:</span>
                    <span class="result-value">${results.enthalpy.toFixed(2)} ${enthalpyUnit}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Specific Volume:</span>
                    <span class="result-value">${results.specificVolume.toFixed(4)} ${volumeUnit}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Vapor Pressure:</span>
                    <span class="result-value">${results.vaporPressure.toFixed(3)} kPa</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Refrigerant Sat. Pressure:</span>
                    <span class="result-value">${results.saturatedPressure.toFixed(3)} kPa</span>
                </div>
            `;
            
            calculatedData.push(results);
        }

        function updatePsychChart(results) {
            const ctx = document.getElementById('psychrometricChart');
            if (!ctx) return;
            
            const chartCtx = ctx.getContext('2d');
            const chartData = generateChartData(results);
            
            if (psychChart) {
                psychChart.destroy();
            }
            
            psychChart = new Chart(chartCtx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'Constant RH Lines',
                            data: chartData.rhLines,
                            borderColor: 'rgba(75, 192, 192, 0.6)',
                            backgroundColor: 'transparent',
                            showLine: true,
                            pointRadius: 0
                        },
                        {
                            label: 'Constant Enthalpy Lines',
                            data: chartData.enthalpyLines,
                            borderColor: 'rgba(255, 99, 132, 0.6)',
                            backgroundColor: 'transparent',
                            showLine: true,
                            pointRadius: 0
                        },
                        {
                            label: 'Current State Point',
                            data: [{
                                x: results.temperature,
                                y: results.absoluteHumidity * 1000
                            }],
                            backgroundColor: 'rgba(255, 206, 86, 1)',
                            borderColor: 'rgba(255, 206, 86, 1)',
                            pointRadius: 8
                        },
                        {
                            label: 'Saturation Line',
                            data: chartData.saturationLine,
                            borderColor: 'rgba(54, 162, 235, 1)',
                            backgroundColor: 'transparent',
                            showLine: true,
                            pointRadius: 0,
                            borderWidth: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: currentUnits === 'imperial' ? 'Dry Bulb Temperature (¬∞F)' : 'Dry Bulb Temperature (¬∞C)'
                            },
                            min: currentUnits === 'imperial' ? 32 : 0,
                            max: currentUnits === 'imperial' ? 140 : 60
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Absolute Humidity (g/kg dry air)'
                            },
                            min: 0,
                            max: 30
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: `Psychrometric Chart - ${results.refrigerant}`,
                            font: {
                                size: 18
                            }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }

        function generateChartData(results) {
            const rhLines = [];
            const enthalpyLines = [];
            const saturationLine = [];
            
            const tempRange = currentUnits === 'imperial' ? 
                { min: 32, max: 140, step: 2 } : 
                { min: 0, max: 60, step: 1 };
            
            for (let t = tempRange.min; t <= tempRange.max; t += tempRange.step) {
                const tempC = currentUnits === 'imperial' ? (t - 32) * 5/9 : t;
                const satVaporPressure = 0.61078 * Math.exp(17.27 * tempC / (tempC + 237.3));
                const maxHumidity = 0.622 * satVaporPressure / (101.325 - satVaporPressure) * 1000;
                saturationLine.push({ x: t, y: maxHumidity });
            }
            
            [20, 40, 60, 80].forEach(rh => {
                const line = [];
                for (let t = tempRange.min; t <= tempRange.max; t += tempRange.step * 2) {
                    const tempC = currentUnits === 'imperial' ? (t - 32) * 5/9 : t;
                    const satVaporPressure = 0.61078 * Math.exp(17.27 * tempC / (tempC + 237.3));
                    const vaporPressure = (rh / 100) * satVaporPressure;
                    const humidity = 0.622 * vaporPressure / (101.325 - vaporPressure) * 1000;
                    if (humidity > 0 && humidity < 30) {
                        line.push({ x: t, y: humidity });
                    }
                }
                rhLines.push(...line);
            });
            
            [40, 60, 80, 100, 120].forEach(h => {
                const line = [];
                for (let humidity = 0; humidity < 25; humidity += 1) {
                    const humidityRatio = humidity / 1000;
                    const tempC = (h - humidityRatio * 2501) / (1.006 + humidityRatio * 1.86);
                    const tempDisplay = currentUnits === 'imperial' ? tempC * 9/5 + 32 : tempC;
                    if (tempDisplay >= tempRange.min && tempDisplay <= tempRange.max) {
                        line.push({ x: tempDisplay, y: humidity });
                    }
                }
                enthalpyLines.push(...line);
            });
            
            return { rhLines, enthalpyLines, saturationLine };
        }

        // P-T Chart Generator Functions
        let ptChart = null;

        window.generateChart = function() {
            const refrigerant = document.getElementById('refrigerant').value;
            const tempMin = parseFloat(document.getElementById('tempMin').value);
            const tempMax = parseFloat(document.getElementById('tempMax').value);
            const chartType = document.getElementById('chartType').value;
            
            const ctx = document.getElementById('ptChart');
            if (!ctx) return;
            
            const chartCtx = ctx.getContext('2d');
            
            // Simplified refrigerant pressure data (pressure in PSI at various temperatures in ¬∞C)
            const refrigerantPTData = {
                'R22': {
                    name: 'R-22 (HCFC-22)',
                    data: [
                        {temp: -40, pressure: 10.1}, {temp: -30, pressure: 16.9}, {temp: -20, pressure: 26.5},
                        {temp: -10, pressure: 39.7}, {temp: 0, pressure: 57.7}, {temp: 10, pressure: 81.6},
                        {temp: 20, pressure: 112.7}, {temp: 30, pressure: 152.6}, {temp: 40, pressure: 203.1},
                        {temp: 50, pressure: 266.2}, {temp: 60, pressure: 343.8}
                    ]
                },
                'R134a': {
                    name: 'R-134a (HFC-134a)',
                    data: [
                        {temp: -40, pressure: 2.6}, {temp: -30, pressure: 5.5}, {temp: -20, pressure: 10.3},
                        {temp: -10, pressure: 17.7}, {temp: 0, pressure: 28.4}, {temp: 10, pressure: 43.2},
                        {temp: 20, pressure: 63.0}, {temp: 30, pressure: 88.8}, {temp: 40, pressure: 121.7},
                        {temp: 50, pressure: 163.0}, {temp: 60, pressure: 214.0}
                    ]
                },
                'R410A': {
                    name: 'R-410A (HFC-410A)',
                    data: [
                        {temp: -40, pressure: 32.4}, {temp: -30, pressure: 48.0}, {temp: -20, pressure: 68.5},
                        {temp: -10, pressure: 94.8}, {temp: 0, pressure: 128.0}, {temp: 10, pressure: 169.5},
                        {temp: 20, pressure: 220.9}, {temp: 30, pressure: 283.7}, {temp: 40, pressure: 359.3},
                        {temp: 50, pressure: 449.1}, {temp: 60, pressure: 554.7}
                    ]
                },
                'R407C': {
                    name: 'R-407C (HFC-407C)',
                    data: [
                        {temp: -40, pressure: 8.7}, {temp: -30, pressure: 14.8}, {temp: -20, pressure: 23.5},
                        {temp: -10, pressure: 35.4}, {temp: 0, pressure: 51.2}, {temp: 10, pressure: 71.8},
                        {temp: 20, pressure: 98.1}, {temp: 30, pressure: 131.0}, {temp: 40, pressure: 172.4},
                        {temp: 50, pressure: 223.4}, {temp: 60, pressure: 285.9}
                    ]
                },
                'R404A': {
                    name: 'R-404A (HFC-404A)',
                    data: [
                        {temp: -40, pressure: 18.6}, {temp: -30, pressure: 28.4}, {temp: -20, pressure: 41.4},
                        {temp: -10, pressure: 58.3}, {temp: 0, pressure: 79.9}, {temp: 10, pressure: 107.0},
                        {temp: 20, pressure: 140.5}, {temp: 30, pressure: 181.4}, {temp: 40, pressure: 230.8},
                        {temp: 50, pressure: 289.7}, {temp: 60, pressure: 359.2}
                    ]
                }
            };

            const refData = refrigerantPTData[refrigerant] || refrigerantPTData['R22'];
            
            // Filter data within temperature range
            const filteredData = refData.data.filter(point => 
                point.temp >= tempMin && point.temp <= tempMax
            );

            // If no data in range, extend the range
            if (filteredData.length < 2) {
                // Use all available data
                filteredData.push(...refData.data);
            }

            // Create saturation curve data
            const saturationData = filteredData.map(point => ({
                x: point.temp,
                y: point.pressure
            }));

            // Generate isotherm data (simplified - just vertical lines at key temperatures)
            const isothermData = [];
            const keyTemps = [-20, -10, 0, 10, 20, 30, 40, 50];
            
            keyTemps.forEach(temp => {
                if (temp >= tempMin && temp <= tempMax) {
                    // Find pressure at this temperature
                    let pressure = 0;
                    for (let i = 0; i < refData.data.length - 1; i++) {
                        const p1 = refData.data[i];
                        const p2 = refData.data[i + 1];
                        if (temp >= p1.temp && temp <= p2.temp) {
                            // Linear interpolation
                            pressure = p1.pressure + (p2.pressure - p1.pressure) * 
                                      (temp - p1.temp) / (p2.temp - p1.temp);
                            break;
                        }
                    }
                    
                    if (pressure > 0) {
                        // Create a short vertical line to represent isotherm
                        isothermData.push({
                            label: `${temp}¬∞C`,
                            data: [
                                {x: temp, y: pressure * 0.5},
                                {x: temp, y: pressure * 1.5}
                            ],
                            borderColor: temp < 0 ? 'rgba(54, 162, 235, 0.8)' : 'rgba(255, 99, 132, 0.8)',
                            backgroundColor: 'transparent',
                            showLine: true,
                            pointRadius: 0,
                            borderWidth: 2,
                            borderDash: [5, 5]
                        });
                    }
                }
            });

            // Destroy existing chart
            if (ptChart) {
                ptChart.destroy();
            }

            // Create datasets based on chart type
            let datasets = [];
            
            if (chartType === 'saturation' || chartType === 'both') {
                datasets.push({
                    label: 'Saturation Curve',
                    data: saturationData,
                    borderColor: 'rgba(255, 99, 132, 1)',
                    backgroundColor: 'rgba(255, 99, 132, 0.1)',
                    showLine: true,
                    pointRadius: 3,
                    borderWidth: 3,
                    fill: false,
                    tension: 0.4
                });
            }

            if (chartType === 'isotherms' || chartType === 'both') {
                datasets.push(...isothermData);
            }

            // Create the chart
            ptChart = new Chart(chartCtx, {
                type: 'line',
                data: {
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: {
                                display: true,
                                text: 'Temperature (¬∞C)',
                                font: { size: 14, weight: 'bold' }
                            },
                            min: tempMin,
                            max: tempMax,
                            ticks: {
                                stepSize: Math.max(1, Math.round((tempMax - tempMin) / 10)),
                                callback: function(value) {
                                    return value + '¬∞C';
                                }
                            },
                            grid: {
                                display: true,
                                color: 'rgba(0, 0, 0, 0.1)',
                                drawBorder: true
                            }
                        },
                        y: {
                            type: 'linear',
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Pressure (PSI)',
                                font: { size: 14, weight: 'bold' }
                            },
                            min: 0,
                            ticks: {
                                stepSize: 50,
                                callback: function(value) {
                                    return value + ' PSI';
                                }
                            },
                            grid: {
                                display: true,
                                color: 'rgba(0, 0, 0, 0.1)',
                                drawBorder: true
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: `P-T Chart for ${refData.name}`,
                            font: { size: 18, weight: 'bold' },
                            color: '#333'
                        },
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.parsed.x.toFixed(1)}¬∞C, ${context.parsed.y.toFixed(1)} PSI`;
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'nearest'
                    }
                }
            });

            // Update info displays
            updateChartInfo(refData, tempMin, tempMax, filteredData.length);
        };

        function updateChartInfo(refData, tempMin, tempMax, dataPoints) {
            const chartInfo = document.getElementById('chartInfo');
            const refProperties = document.getElementById('refProperties');
            
            if (chartInfo) {
                chartInfo.innerHTML = `
                    <strong>Chart Generated Successfully!</strong><br>
                    Temperature Range: ${tempMin}¬∞C to ${tempMax}¬∞C<br>
                    Data Points: ${dataPoints} pressure-temperature pairs<br>
                    <small>Interactive chart with hover tooltips for precise readings</small>
                `;
            }
            
            if (refProperties) {
                const safetyInfo = refData.name.includes('üî•') ? 
                    '<br><span style="color: #ff6b6b;">‚ö†Ô∏è Flammable refrigerant - Special precautions required</span>' : 
                    refData.name.includes('‚ö†Ô∏è') ? 
                    '<br><span style="color: #f39c12;">‚ö†Ô∏è Toxic refrigerant - Proper ventilation required</span>' : '';
                
                refProperties.innerHTML = `
                    <strong>${refData.name}</strong><br>
                    Pressure range: ${Math.min(...refData.data.map(p => p.pressure)).toFixed(1)} - ${Math.max(...refData.data.map(p => p.pressure)).toFixed(1)} PSI<br>
                    Temperature range: ${Math.min(...refData.data.map(p => p.temp))}¬∞C to ${Math.max(...refData.data.map(p => p.temp))}¬∞C<br>
                    Chart type: Saturation curve with pressure-temperature relationship
                    ${safetyInfo}
                `;
            }
        }

        // PWA Manifest
        const manifest = {
            name: "HVAC Pro Tools",
            short_name: "HVAC Tools",
            description: "Professional HVAC calculation tools for technicians and engineers",
            start_url: "/",
            display: "standalone",
            background_color: "#1e3c72",
            theme_color: "#4ecdc4",
            orientation: "portrait",
            icons: [
                {
                    src: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxjaXJjbGUgY3g9Ijk2IiBjeT0iOTYiIHI9Ijk2IiBmaWxsPSIjNGVjZGM0Ii8+Cjx0ZXh0IHg9Ijk2IiB5PSIxMTAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSI4MCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPvCfkp43PC90ZXh0Pgo8L3N2Zz4K",
                    sizes: "192x192",
                    type: "image/svg+xml"
                },
                {
                    src: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMiA1MTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxjaXJjbGUgY3g9IjI1NiIgY3k9IjI1NiIgcj0iMjU2IiBmaWxsPSIjNGVjZGM0Ii8+Cjx0ZXh0IHg9IjI1NiIgeT0iMzAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjAwIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+8J+SuDwvdGV4dD4KPC9zdmc+Cg==",
                    sizes: "512x512",
                    type: "image/svg+xml"
                }
            ]
        };

        const manifestBlob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
        const manifestURL = URL.createObjectURL(manifestBlob);
        document.getElementById('app-manifest').href = manifestURL;

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                closeModal();
            }
        }

        setTimeout(() => {
            if (!isInstalled && !deferredPrompt) {
                showPWAPrompt();
            }
        }, 10000);
    </script>
</body>
</html>
