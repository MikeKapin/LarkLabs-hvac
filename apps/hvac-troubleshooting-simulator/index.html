<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HVAC Troubleshooting Simulator - LARK Labs</title>
    <!-- Updated: Build deployment trigger -->
    <meta name="description" content="Interactive HVAC troubleshooting game simulator. Practice diagnosing HVAC problems, compete with friends, and improve your technical skills.">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2c3e50 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #3498db;
            text-decoration: none;
        }

        .back-btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s;
        }

        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        /* Game Interface */
        .game-container {
            padding: 2rem 0;
            min-height: calc(100vh - 80px);
        }

        .game-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .game-title {
            font-size: 2.5rem;
            color: #3498db;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 10px rgba(52, 152, 219, 0.3);
        }

        .game-subtitle {
            font-size: 1.2rem;
            color: #bdc3c7;
            margin-bottom: 2rem;
        }

        /* Stats Bar */
        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 1rem 1.5rem;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-width: 120px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #f1c40f;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #bdc3c7;
            margin-top: 0.5rem;
        }

        /* Game Screen */
        .game-screen {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        /* Welcome Screen */
        .welcome-screen {
            text-align: center;
        }

        .welcome-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .difficulty-selection {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .difficulty-btn {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s;
            min-width: 150px;
        }

        .difficulty-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.4);
        }

        .difficulty-btn.medium {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }

        .difficulty-btn.medium:hover {
            box-shadow: 0 8px 25px rgba(243, 156, 18, 0.4);
        }

        .difficulty-btn.hard {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .difficulty-btn.hard:hover {
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.4);
        }

        /* Scenario Display */
        .scenario-container {
            display: none;
        }

        .scenario-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .scenario-title {
            font-size: 1.8rem;
            color: #3498db;
            margin-bottom: 0.5rem;
        }

        .scenario-info {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .info-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .scenario-image {
            width: 100%;
            max-width: 600px;
            height: 300px;
            background: linear-gradient(45deg, #34495e, #2c3e50);
            border-radius: 15px;
            margin: 0 auto 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .scenario-image::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="%23ffffff" stroke-width="0.5" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
        }

        .image-placeholder {
            font-size: 3rem;
            color: #7f8c8d;
            z-index: 1;
        }

        .scenario-description {
            background: rgba(231, 76, 60, 0.1);
            border-left: 4px solid #e74c3c;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .question-container {
            margin-bottom: 2rem;
        }

        .question-title {
            font-size: 1.3rem;
            color: #f1c40f;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .question-number {
            background: #f1c40f;
            color: #2c3e50;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .answers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .answer-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
            padding: 1rem 1.5rem;
            border-radius: 15px;
            cursor: pointer;
            text-align: left;
            transition: all 0.3s;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .answer-btn:hover {
            background: rgba(52, 152, 219, 0.2);
            border-color: #3498db;
            transform: translateY(-2px);
        }

        .answer-btn.selected {
            background: linear-gradient(45deg, #3498db, #2980b9);
            border-color: #3498db;
        }

        .answer-btn.correct {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            border-color: #27ae60;
        }

        .answer-btn.incorrect {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            border-color: #e74c3c;
        }

        .submit-btn {
            background: linear-gradient(45deg, #f1c40f, #f39c12);
            color: #2c3e50;
            padding: 1rem 2rem;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s;
            display: block;
            margin: 0 auto;
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(241, 196, 31, 0.4);
        }

        .submit-btn:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Results Screen */
        .results-screen {
            display: none;
            text-align: center;
        }

        .results-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .results-title {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .score-display {
            font-size: 3rem;
            font-weight: bold;
            color: #f1c40f;
            margin-bottom: 1rem;
            text-shadow: 0 2px 10px rgba(241, 196, 31, 0.5);
        }

        .performance-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .performance-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 15px;
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .action-btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .action-btn.secondary {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
        }

        .action-btn.secondary:hover {
            box-shadow: 0 5px 15px rgba(149, 165, 166, 0.4);
        }

        /* Leaderboard */
        .leaderboard-container {
            display: none;
            max-width: 800px;
            margin: 0 auto;
        }

        .leaderboard-title {
            text-align: center;
            font-size: 2rem;
            color: #f1c40f;
            margin-bottom: 2rem;
        }

        .leaderboard-list {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }

        .leaderboard-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .leaderboard-item:last-child {
            border-bottom: none;
        }

        .rank {
            font-size: 1.5rem;
            font-weight: bold;
            color: #f1c40f;
            width: 60px;
            text-align: center;
        }

        .rank.gold {
            color: #f1c40f;
        }

        .rank.silver {
            color: #bdc3c7;
        }

        .rank.bronze {
            color: #e67e22;
        }

        .player-info {
            flex: 1;
            margin-left: 1rem;
        }

        .player-name {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffffff;
        }

        .player-details {
            font-size: 0.9rem;
            color: #bdc3c7;
            margin-top: 0.3rem;
        }

        .player-score {
            font-size: 1.5rem;
            font-weight: bold;
            color: #27ae60;
        }

        /* Progress Bar */
        .progress-container {
            margin: 1rem 0;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .progress-text {
            text-align: center;
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: #bdc3c7;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .game-title {
                font-size: 2rem;
            }

            .stats-bar {
                gap: 1rem;
            }

            .stat-item {
                min-width: 100px;
                padding: 0.8rem 1rem;
            }

            .difficulty-selection {
                flex-direction: column;
                align-items: center;
            }

            .difficulty-btn {
                min-width: 200px;
            }

            .scenario-info {
                flex-direction: column;
                align-items: center;
            }

            .answers-grid {
                grid-template-columns: 1fr;
            }

            .performance-summary {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .bounce {
            animation: bounce 1s;
        }

        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translateY(0); }
            40%, 43% { transform: translateY(-30px); }
            70% { transform: translateY(-15px); }
            90% { transform: translateY(-4px); }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="../../index.html" class="logo">üîß HVAC Troubleshooting Simulator</a>
                <a href="../../index.html" class="back-btn">‚Üê Back to LARK Labs</a>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="game-container">
            <div class="game-header">
                <h1 class="game-title">HVAC Troubleshooting Simulator</h1>
                <p class="game-subtitle">Master HVAC diagnostics through interactive scenarios and compete with your peers!</p>
            </div>

            <!-- Stats Bar -->
            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-value" id="currentScore">0</div>
                    <div class="stat-label">Current Score</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="bestScore">0</div>
                    <div class="stat-label">Best Score</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="gamesPlayed">0</div>
                    <div class="stat-label">Games Played</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="accuracy">0%</div>
                    <div class="stat-label">Accuracy</div>
                </div>
            </div>

            <!-- Game Screen -->
            <div class="game-screen">
                <!-- Welcome Screen -->
                <div class="welcome-screen" id="welcomeScreen">
                    <div class="welcome-icon">üéÆ</div>
                    <h2>Welcome to HVAC Troubleshooting Simulator!</h2>
                    <p style="margin: 1rem 0 2rem; font-size: 1.1rem; color: #bdc3c7;">
                        Test your HVAC diagnostic skills with realistic scenarios. Each correct answer builds your score, 
                        while wrong answers reduce it. Compete with friends and climb the leaderboard!
                    </p>

                    <h3 style="color: #3498db; margin-bottom: 1rem;">Select Difficulty Level:</h3>
                    <div class="difficulty-selection">
                        <button class="difficulty-btn" onclick="startGame('easy')">
                            üü¢ Easy<br>
                            <small>Basic residential systems</small>
                        </button>
                        <button class="difficulty-btn medium" onclick="startGame('medium')">
                            üü° Medium<br>
                            <small>Commercial & complex systems</small>
                        </button>
                        <button class="difficulty-btn hard" onclick="startGame('hard')">
                            üî¥ Hard<br>
                            <small>Advanced diagnostics</small>
                        </button>
                    </div>

                    <div style="margin-top: 2rem;">
                        <button class="action-btn secondary" onclick="showLeaderboard()">
                            üèÜ View Leaderboard
                        </button>
                    </div>
                </div>

                <!-- Scenario Container -->
                <div class="scenario-container" id="scenarioContainer">
                    <div class="scenario-header">
                        <h2 class="scenario-title" id="scenarioTitle">Loading Scenario...</h2>
                        <div class="scenario-info">
                            <div class="info-item">
                                <span id="difficultyLevel">Easy</span> Difficulty
                            </div>
                            <div class="info-item">
                                Question <span id="currentQuestion">1</span> of <span id="totalQuestions">5</span>
                            </div>
                            <div class="info-item">
                                ‚è±Ô∏è Time: <span id="timeElapsed">00:00</span>
                            </div>
                        </div>
                        
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill"></div>
                            </div>
                            <div class="progress-text" id="progressText">Starting scenario...</div>
                        </div>
                    </div>

                    <div class="scenario-image" id="scenarioImage">
                        <div class="image-placeholder" id="imagePlaceholder">üîß</div>
                    </div>

                    <div class="scenario-description" id="scenarioDescription">
                        Loading scenario description...
                    </div>

                    <div class="question-container">
                        <div class="question-title">
                            <div class="question-number" id="questionNumber">1</div>
                            <span id="questionText">What is your first diagnostic step?</span>
                        </div>

                        <div class="answers-grid" id="answersGrid">
                            <!-- Answers will be populated by JavaScript -->
                        </div>

                        <button class="submit-btn" id="submitBtn" onclick="submitAnswer()" disabled>
                            Submit Answer
                        </button>
                    </div>
                </div>

                <!-- Results Screen -->
                <div class="results-screen" id="resultsScreen">
                    <div class="results-icon" id="resultsIcon">üéâ</div>
                    <h2 class="results-title" id="resultsTitle">Congratulations!</h2>
                    <div class="score-display" id="finalScore">850</div>
                    <p id="performanceMessage" style="font-size: 1.2rem; color: #bdc3c7; margin-bottom: 2rem;">
                        Excellent troubleshooting skills!
                    </p>

                    <div class="performance-summary">
                        <div class="performance-item">
                            <h4 style="color: #27ae60; margin-bottom: 0.5rem;">‚úÖ Correct Answers</h4>
                            <div style="font-size: 1.5rem; font-weight: bold;" id="correctCount">4</div>
                            <div style="color: #bdc3c7; font-size: 0.9rem;" id="correctPercentage">80%</div>
                        </div>
                        <div class="performance-item">
                            <h4 style="color: #e74c3c; margin-bottom: 0.5rem;">‚ùå Incorrect Answers</h4>
                            <div style="font-size: 1.5rem; font-weight: bold;" id="incorrectCount">1</div>
                            <div style="color: #bdc3c7; font-size: 0.9rem;" id="incorrectPercentage">20%</div>
                        </div>
                        <div class="performance-item">
                            <h4 style="color: #3498db; margin-bottom: 0.5rem;">‚è±Ô∏è Time Taken</h4>
                            <div style="font-size: 1.5rem; font-weight: bold;" id="totalTime">03:45</div>
                            <div style="color: #bdc3c7; font-size: 0.9rem;" id="avgTimePerQuestion">45s avg</div>
                        </div>
                        <div class="performance-item">
                            <h4 style="color: #f1c40f; margin-bottom: 0.5rem;">üéØ Difficulty</h4>
                            <div style="font-size: 1.5rem; font-weight: bold;" id="completedDifficulty">Medium</div>
                            <div style="color: #bdc3c7; font-size: 0.9rem;" id="difficultyBonus">+200 bonus</div>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button class="action-btn" onclick="playAgain()">üîÑ Play Again</button>
                        <button class="action-btn secondary" onclick="showLeaderboard()">üèÜ Leaderboard</button>
                        <button class="action-btn secondary" onclick="shareScore()">üì§ Share Score</button>
                    </div>
                </div>

                <!-- Leaderboard Screen -->
                <div class="leaderboard-container" id="leaderboardContainer">
                    <h2 class="leaderboard-title">üèÜ Top HVAC Troubleshooters</h2>
                    <div class="leaderboard-list" id="leaderboardList">
                        <!-- Leaderboard entries will be populated by JavaScript -->
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn" onclick="backToWelcome()">‚Üê Back to Game</button>
                        <button class="action-btn secondary" onclick="clearLeaderboard()">üóëÔ∏è Clear Scores</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            currentDifficulty: 'easy',
            currentScenarioIndex: 0,
            currentQuestionIndex: 0,
            score: 0,
            startTime: 0,
            endTime: 0,
            correctAnswers: 0,
            incorrectAnswers: 0,
            selectedAnswer: null,
            scenarios: [],
            playerStats: {
                gamesPlayed: 0,
                bestScore: 0,
                totalCorrect: 0,
                totalQuestions: 0
            }
        };

        // HVAC Troubleshooting Scenarios
        const troubleshootingScenarios = {
            easy: [
                {
                    title: "Residential Furnace Not Heating",
                    image: "üè†üî•",
                    description: "A homeowner reports that their natural gas furnace is not producing heat. The thermostat is set to 72¬∞F, but the house temperature is only 65¬∞F. The furnace appears to be running, but no warm air is coming from the vents.",
                    questions: [
                        {
                            question: "What should be your first diagnostic step?",
                            answers: [
                                "Check if the thermostat batteries are working",
                                "Inspect the air filter for blockage",
                                "Check the gas supply to the furnace",
                                "Test the limit switch"
                            ],
                            correct: 1,
                            explanation: "A dirty or clogged air filter is the most common cause of heating problems and should be checked first as it's simple and often resolves the issue."
                        },
                        {
                            question: "The air filter is clean. What's your next step?",
                            answers: [
                                "Check the thermostat settings and wiring",
                                "Replace the igniter immediately",
                                "Check the gas valve",
                                "Test the blower motor"
                            ],
                            correct: 0,
                            explanation: "After confirming the air filter is clean, checking thermostat settings and wiring ensures the system is receiving proper signals."
                        },
                        {
                            question: "The thermostat is correctly set to heat mode and wired properly. The furnace ignites but shuts off after 30 seconds. What's the likely cause?",
                            answers: [
                                "Faulty gas valve",
                                "Bad limit switch",
                                "Flame sensor is dirty or faulty",
                                "Thermocouple failure"
                            ],
                            correct: 2,
                            explanation: "A dirty or faulty flame sensor will cause the furnace to ignite but shut off quickly as a safety measure when it can't detect the flame properly."
                        },
                        {
                            question: "How would you test the flame sensor?",
                            answers: [
                                "Use a multimeter to check for microamp signal",
                                "Visual inspection only",
                                "Replace it immediately",
                                "Check with a gas leak detector"
                            ],
                            correct: 0,
                            explanation: "Testing the flame sensor with a multimeter to check for microamp signal (typically 0.5-10 microamps) is the proper diagnostic procedure."
                        },
                        {
                            question: "After cleaning the flame sensor, the furnace works properly. What maintenance should you recommend to the homeowner?",
                            answers: [
                                "Change the filter every 6 months only",
                                "Annual professional maintenance and monthly filter checks",
                                "No maintenance needed for 5 years",
                                "Only check the thermostat batteries yearly"
                            ],
                            correct: 1,
                            explanation: "Annual professional maintenance and regular filter checks (monthly during heating season) prevent most common furnace problems."
                        }
                    ]
                },
                {
                    title: "Air Conditioner Not Cooling",
                    image: "‚ùÑÔ∏èüè†",
                    description: "A customer calls about their central air conditioning system. The unit runs continuously but the house won't cool down below 78¬∞F even though the thermostat is set to 70¬∞F. Outside temperature is 85¬∞F.",
                    questions: [
                        {
                            question: "What's the most common cause of poor cooling performance?",
                            answers: [
                                "Low refrigerant charge",
                                "Dirty air filter or coils",
                                "Faulty compressor",
                                "Thermostat malfunction"
                            ],
                            correct: 1,
                            explanation: "Dirty air filters and coils are the most common causes of poor cooling performance, restricting airflow and heat transfer."
                        },
                        {
                            question: "You find the air filter is extremely dirty. After replacing it, what should you check next?",
                            answers: [
                                "Immediately check refrigerant levels",
                                "Inspect the outdoor condenser coils",
                                "Test the compressor",
                                "Check the ductwork"
                            ],
                            correct: 1,
                            explanation: "After replacing a dirty filter, checking the outdoor condenser coils for dirt and debris is the logical next step for airflow issues."
                        },
                        {
                            question: "The outdoor coils are clean, but you notice ice formation on the indoor evaporator coil. What's the likely cause?",
                            answers: [
                                "Overcharged system",
                                "Restricted airflow or low refrigerant",
                                "Bad thermostat",
                                "Oversized system"
                            ],
                            correct: 1,
                            explanation: "Ice on the evaporator coil typically indicates restricted airflow (from dirty filters/coils) or low refrigerant charge."
                        },
                        {
                            question: "How should you handle a frozen evaporator coil?",
                            answers: [
                                "Immediately add refrigerant",
                                "Use a heat gun to melt the ice",
                                "Turn off the system and let it thaw naturally, then investigate the cause",
                                "Continue running the system"
                            ],
                            correct: 2,
                            explanation: "The system must be turned off to allow the ice to thaw completely before diagnosing the root cause of the icing."
                        },
                        {
                            question: "After the coil thaws and airflow is restored, the system cools properly. What preventive measures should you recommend?",
                            answers: [
                                "Replace refrigerant annually",
                                "Regular filter changes and annual maintenance",
                                "Add more refrigerant as a precaution",
                                "Install a larger unit"
                            ],
                            correct: 1,
                            explanation: "Regular filter changes and annual professional maintenance are the best preventive measures for most A/C problems."
                        }
                    ]
                }
            ],
            medium: [
                {
                    title: "Commercial Rooftop Unit Cycling Issues",
                    image: "üè¢üîß",
                    description: "A 10-ton commercial rooftop unit is short cycling - turning on and off every 2-3 minutes. The building temperature is not reaching setpoint, and tenants are complaining about poor comfort and noise from the frequent cycling.",
                    questions: [
                        {
                            question: "What is the most likely cause of short cycling in a commercial RTU?",
                            answers: [
                                "Low refrigerant charge",
                                "Dirty air filters or coils causing high head pressure",
                                "Faulty economizer",
                                "Bad thermostat"
                            ],
                            correct: 1,
                            explanation: "Dirty filters or coils cause high head pressure, triggering safety switches and causing short cycling in commercial units."
                        },
                        {
                            question: "You find clean filters but notice the outdoor coil is partially blocked. What should you check next?",
                            answers: [
                                "Refrigerant charge immediately",
                                "Head pressure readings and safety switch operation",
                                "Compressor windings",
                                "Economizer operation"
                            ],
                            correct: 1,
                            explanation: "Checking head pressure readings and safety switch operation confirms if high pressure is causing the short cycling."
                        },
                        {
                            question: "Head pressure is reading 425 PSIG on R-410A with 85¬∞F ambient. This indicates:",
                            answers: [
                                "Normal operation",
                                "Low charge",
                                "High head pressure - blocked condenser or overcharge",
                                "Compressor failure"
                            ],
                            correct: 2,
                            explanation: "425 PSIG is too high for 85¬∞F ambient with R-410A (should be around 350-375 PSIG), indicating blocked condenser or overcharge."
                        },
                        {
                            question: "After cleaning the condenser coil, the unit still cycles on high pressure. What's your next diagnostic step?",
                            answers: [
                                "Replace the compressor",
                                "Check for overcharge or non-condensables in the system",
                                "Replace the high pressure switch",
                                "Check the expansion valve"
                            ],
                            correct: 1,
                            explanation: "If head pressure remains high after cleaning the condenser, the system may be overcharged or have non-condensables."
                        },
                        {
                            question: "You determine the system is overcharged. What's the proper procedure?",
                            answers: [
                                "Vent refrigerant to atmosphere until pressure drops",
                                "Recover excess refrigerant using proper equipment and procedures",
                                "Just reduce the charge by eye",
                                "Add more refrigerant to balance it out"
                            ],
                            correct: 1,
                            explanation: "Excess refrigerant must be recovered using proper EPA-approved equipment and procedures - never vented to atmosphere."
                        }
                    ]
                },
                {
                    title: "Heat Pump Defrost Cycle Problems",
                    image: "üîÑ‚ùÑÔ∏è",
                    description: "A commercial heat pump system is not defrosting properly in winter. Ice is building up on the outdoor coil, and the system's heating capacity is decreasing. The building is struggling to maintain temperature.",
                    questions: [
                        {
                            question: "What initiates the defrost cycle in most heat pump systems?",
                            answers: [
                                "Timer only",
                                "Temperature sensor only", 
                                "Combination of time and temperature sensors",
                                "Manual switch"
                            ],
                            correct: 2,
                            explanation: "Most heat pump defrost cycles are initiated by a combination of time (usually 30-90 minutes runtime) and temperature sensors on the outdoor coil."
                        },
                        {
                            question: "During defrost mode, what should happen to the reversing valve?",
                            answers: [
                                "It should remain in heating position",
                                "It should switch to cooling position to provide hot gas to outdoor coil",
                                "It should cycle on and off",
                                "It should be disabled"
                            ],
                            correct: 1,
                            explanation: "During defrost, the reversing valve switches to cooling mode, sending hot refrigerant gas to the outdoor coil to melt ice."
                        },
                        {
                            question: "You notice the defrost cycle initiates but the reversing valve doesn't switch. What should you check first?",
                            answers: [
                                "Refrigerant charge",
                                "Reversing valve solenoid coil and wiring",
                                "Outdoor fan motor",
                                "Indoor blower"
                            ],
                            correct: 1,
                            explanation: "If the reversing valve doesn't switch during defrost, check the solenoid coil for power and proper operation first."
                        },
                        {
                            question: "The reversing valve solenoid has power but the valve isn't switching. The issue is most likely:",
                            answers: [
                                "Low refrigerant charge",
                                "Reversing valve is mechanically stuck",
                                "Bad defrost sensor",
                                "Dirty air filter"
                            ],
                            correct: 1,
                            explanation: "When the solenoid has power but the valve doesn't switch, the reversing valve is likely mechanically stuck and needs replacement."
                        },
                        {
                            question: "After replacing the reversing valve, what should you verify for proper defrost operation?",
                            answers: [
                                "Only check that it switches",
                                "Verify proper defrost initiation, valve switching, and termination sequence",
                                "Just check refrigerant levels",
                                "Only test in summer"
                            ],
                            correct: 1,
                            explanation: "Complete defrost testing should verify initiation timing, valve switching, hot gas delivery, and proper termination of the defrost cycle."
                        }
                    ]
                }
            ],
            hard: [
                {
                    title: "VRF System Refrigerant Distribution Issues",
                    image: "üèóÔ∏è‚ö°",
                    description: "A 20-ton VRF (Variable Refrigerant Flow) system serving multiple zones is experiencing uneven cooling/heating. Some indoor units are overcooling while others can't reach setpoint. System shows no obvious alarms but performance is poor.",
                    questions: [
                        {
                            question: "In VRF systems, what primarily controls refrigerant flow to each indoor unit?",
                            answers: [
                                "Manual expansion valves",
                                "Electronic expansion valves (EEV) controlled by zone demands",
                                "Fixed orifices",
                                "Thermostatic expansion valves"
                            ],
                            correct: 1,
                            explanation: "VRF systems use electronic expansion valves controlled by sophisticated logic that responds to each zone's heating/cooling demands."
                        },
                        {
                            question: "What diagnostic tool is most important for troubleshooting VRF refrigerant distribution issues?",
                            answers: [
                                "Basic manifold gauges only",
                                "Manufacturer-specific service tool/software for system diagnostics",
                                "Standard multimeter",
                                "Visual inspection only"
                            ],
                            correct: 1,
                            explanation: "VRF systems require manufacturer-specific diagnostic tools to read system parameters, valve positions, and error codes not visible otherwise."
                        },
                        {
                            question: "You discover some EEVs are not responding to control signals. What should you check first?",
                            answers: [
                                "Refrigerant charge level",
                                "EEV motor windings and control wiring",
                                "Outdoor unit compressor",
                                "Indoor unit filters"
                            ],
                            correct: 1,
                            explanation: "Non-responsive EEVs typically indicate electrical issues - check motor windings and control wiring before mechanical problems."
                        },
                        {
                            question: "The diagnostic software shows proper EEV operation but uneven superheat readings. This suggests:",
                            answers: [
                                "All EEVs need replacement",
                                "Possible refrigerant charge issues or improper piping/installation",
                                "Compressor failure",
                                "Thermostat problems"
                            ],
                            correct: 1,
                            explanation: "When EEVs operate properly but superheat is uneven, suspect charge issues or installation problems like improper piping or oil migration."
                        },
                        {
                            question: "What is critical when adding refrigerant to a VRF system?",
                            answers: [
                                "Add refrigerant until gauges look normal",
                                "Follow manufacturer's charge calculation based on piping lengths and indoor unit quantities",
                                "Charge by sight glass only",
                                "Use standard rule-of-thumb charging methods"
                            ],
                            correct: 1,
                            explanation: "VRF systems require precise charging based on manufacturer calculations considering total piping length, elevation differences, and number of indoor units."
                        }
                    ]
                },
                {
                    title: "Complex Building Automation Integration",
                    image: "üñ•Ô∏èüè¢",
                    description: "A BAS-controlled chilled water system in a 50-story building is showing erratic operation. Some floors are too hot while others are too cold. The BAS shows conflicting sensor readings and equipment status doesn't match actual operation.",
                    questions: [
                        {
                            question: "When troubleshooting BAS integration issues, what should be your first priority?",
                            answers: [
                                "Replace all sensors immediately",
                                "Verify actual equipment operation against BAS-reported status",
                                "Reprogram the entire BAS",
                                "Check only the chiller operation"
                            ],
                            correct: 1,
                            explanation: "Always verify actual equipment operation against what the BAS reports - this identifies whether issues are with equipment, sensors, or communication."
                        },
                        {
                            question: "You find that actual valve positions don't match BAS-commanded positions. This indicates:",
                            answers: [
                                "The BAS needs complete reprogramming",
                                "Actuator problems, wiring issues, or communication failures",
                                "The chiller is failing",
                                "All temperature sensors are bad"
                            ],
                            correct: 1,
                            explanation: "When commanded vs. actual positions don't match, suspect actuator mechanical/electrical problems or communication issues between BAS and actuators."
                        },
                        {
                            question: "What tool is essential for diagnosing BAS communication issues?",
                            answers: [
                                "Standard HVAC manifold gauges",
                                "BAS diagnostic software and communication protocol analyzers",
                                "Basic multimeter only",
                                "Temperature gun"
                            ],
                            correct: 1,
                            explanation: "BAS communication issues require specialized diagnostic software and protocol analyzers to monitor data traffic and identify communication failures."
                        },
                        {
                            question: "You discover multiple temperature sensors reading incorrectly. The most systematic approach is:",
                            answers: [
                                "Replace all sensors at once",
                                "Calibrate each sensor individually and verify wiring/communication",
                                "Ignore the sensors and operate manually",
                                "Replace the entire BAS"
                            ],
                            correct: 1,
                            explanation: "Systematic calibration and verification of each sensor, including wiring and communication paths, ensures accurate diagnosis and proper repairs."
                        },
                        {
                            question: "After resolving communication and sensor issues, what's critical for preventing future problems?",
                            answers: [
                                "Nothing - it should work forever now",
                                "Implement regular BAS preventive maintenance including sensor calibration and communication testing",
                                "Replace the system every year",
                                "Only check it when problems occur"
                            ],
                            correct: 1,
                            explanation: "Regular BAS preventive maintenance including sensor calibration, communication testing, and software updates prevents many complex issues."
                        }
                    ]
                }
            ]
        };

        // Initialize game on load
        window.onload = function() {
            loadPlayerStats();
            updateStatsDisplay();
        };

        // Start game with selected difficulty
        function startGame(difficulty) {
            gameState.currentDifficulty = difficulty;
            gameState.currentScenarioIndex = 0;
            gameState.currentQuestionIndex = 0;
            gameState.score = 0;
            gameState.startTime = Date.now();
            gameState.correctAnswers = 0;
            gameState.incorrectAnswers = 0;
            gameState.selectedAnswer = null;
            
            gameState.scenarios = troubleshootingScenarios[difficulty];
            
            // Show scenario container and hide welcome screen
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('scenarioContainer').style.display = 'block';
            document.getElementById('resultsScreen').style.display = 'none';
            document.getElementById('leaderboardContainer').style.display = 'none';
            
            // Update stats
            document.getElementById('currentScore').textContent = '0';
            
            // Load first scenario
            loadScenario();
        };

        // Load current scenario and question
        function loadScenario() {
            const scenario = gameState.scenarios[gameState.currentScenarioIndex];
            const question = scenario.questions[gameState.currentQuestionIndex];
            
            // Update scenario info
            document.getElementById('scenarioTitle').textContent = scenario.title;
            document.getElementById('difficultyLevel').textContent = gameState.currentDifficulty.charAt(0).toUpperCase() + gameState.currentDifficulty.slice(1);
            document.getElementById('currentQuestion').textContent = gameState.currentQuestionIndex + 1;
            document.getElementById('totalQuestions').textContent = scenario.questions.length;
            
            // Update image placeholder
            document.getElementById('imagePlaceholder').textContent = scenario.image;
            
            // Update scenario description
            document.getElementById('scenarioDescription').textContent = scenario.description;
            
            // Update question
            document.getElementById('questionNumber').textContent = gameState.currentQuestionIndex + 1;
            document.getElementById('questionText').textContent = question.question;
            
            // Update progress
            const progress = ((gameState.currentQuestionIndex) / scenario.questions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = `Question ${gameState.currentQuestionIndex + 1} of ${scenario.questions.length}`;
            
            // Load answers
            loadAnswers();
            
            // Update timer
            updateTimer();
        };

        // Load answer options
        function loadAnswers() {
            const scenario = gameState.scenarios[gameState.currentScenarioIndex];
            const question = scenario.questions[gameState.currentQuestionIndex];
            const answersGrid = document.getElementById('answersGrid');
            
            answersGrid.innerHTML = '';
            
            question.answers.forEach((answer, index) => {
                const answerBtn = document.createElement('button');
                answerBtn.className = 'answer-btn';
                answerBtn.textContent = answer;
                answerBtn.onclick = () => selectAnswer(index);
                answerBtn.id = `answer-${index}`;
                answersGrid.appendChild(answerBtn);
            });
            
            // Reset submit button
            document.getElementById('submitBtn').disabled = true;
            gameState.selectedAnswer = null;
        };

        // Select an answer
        function selectAnswer(answerIndex) {
            // Clear previous selections
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Select new answer
            document.getElementById(`answer-${answerIndex}`).classList.add('selected');
            gameState.selectedAnswer = answerIndex;
            
            // Enable submit button
            document.getElementById('submitBtn').disabled = false;
        };

        // Submit answer and check correctness
        function submitAnswer() {
            if (gameState.selectedAnswer === null) return;
            
            const scenario = gameState.scenarios[gameState.currentScenarioIndex];
            const question = scenario.questions[gameState.currentQuestionIndex];
            const isCorrect = gameState.selectedAnswer === question.correct;
            
            // Show correct/incorrect styling
            document.querySelectorAll('.answer-btn').forEach((btn, index) => {
                if (index === question.correct) {
                    btn.classList.add('correct');
                } else if (index === gameState.selectedAnswer && !isCorrect) {
                    btn.classList.add('incorrect');
                }
                btn.onclick = null; // Disable clicking
            });
            
            // Update score and stats
            if (isCorrect) {
                gameState.correctAnswers++;
                const difficultyMultiplier = {easy: 100, medium: 150, hard: 200};
                const timeBonus = Math.max(0, 60 - Math.floor((Date.now() - gameState.startTime) / 1000)) * 2;
                const points = difficultyMultiplier[gameState.currentDifficulty] + timeBonus;
                gameState.score += points;
                showFeedback(true, question.explanation, points);
            } else {
                gameState.incorrectAnswers++;
                gameState.score = Math.max(0, gameState.score - 50);
                showFeedback(false, question.explanation, -50);
            }
            
            // Update score display
            document.getElementById('currentScore').textContent = gameState.score;
            
            // Show next button or finish
            setTimeout(() => {
                if (gameState.currentQuestionIndex + 1 < scenario.questions.length) {
                    gameState.currentQuestionIndex++;
                    loadScenario();
                } else if (gameState.currentScenarioIndex + 1 < gameState.scenarios.length) {
                    gameState.currentScenarioIndex++;
                    gameState.currentQuestionIndex = 0;
                    loadScenario();
                } else {
                    finishGame();
                }
            }, 3000);
        };

        // Show feedback for answer
        function showFeedback(isCorrect, explanation, points) {
            const feedbackDiv = document.createElement('div');
            feedbackDiv.style.cssText = `
                background: ${isCorrect ? 'rgba(39, 174, 96, 0.2)' : 'rgba(231, 76, 60, 0.2)'};
                border: 1px solid ${isCorrect ? '#27ae60' : '#e74c3c'};
                border-radius: 10px;
                padding: 1rem;
                margin: 1rem 0;
                color: ${isCorrect ? '#2ecc71' : '#e74c3c'};
            `;
            
            feedbackDiv.innerHTML = `
                <h4>${isCorrect ? '‚úÖ Correct!' : '‚ùå Incorrect'} ${points > 0 ? '+' : ''}${points} points</h4>
                <p>${explanation}</p>
            `;
            
            document.getElementById('submitBtn').parentNode.insertBefore(feedbackDiv, document.getElementById('submitBtn'));
            
            // Remove feedback after delay
            setTimeout(() => {
                feedbackDiv.remove();
            }, 2800);
        };

        // Finish game and show results
        function finishGame() {
            gameState.endTime = Date.now();
            const totalTime = Math.floor((gameState.endTime - gameState.startTime) / 1000);
            const totalQuestions = gameState.correctAnswers + gameState.incorrectAnswers;
            
            // Update player stats
            gameState.playerStats.gamesPlayed++;
            gameState.playerStats.totalCorrect += gameState.correctAnswers;
            gameState.playerStats.totalQuestions += totalQuestions;
            if (gameState.score > gameState.playerStats.bestScore) {
                gameState.playerStats.bestScore = gameState.score;
            }
            
            // Save stats and score
            savePlayerStats();
            saveScore();
            updateStatsDisplay();
            
            // Show results screen
            document.getElementById('scenarioContainer').style.display = 'none';
            document.getElementById('resultsScreen').style.display = 'block';
            
            // Update results display
            updateResultsDisplay(totalTime, totalQuestions);
        };

        // Update results display
        function updateResultsDisplay(totalTime, totalQuestions) {
            const accuracy = Math.round((gameState.correctAnswers / totalQuestions) * 100);
            
            // Results icon based on performance
            let resultsIcon = 'üéâ';
            let resultsTitle = 'Great Job!';
            let message = 'Good troubleshooting skills!';
            
            if (accuracy >= 90) {
                resultsIcon = 'üèÜ';
                resultsTitle = 'Outstanding!';
                message = 'Expert-level HVAC diagnostics!';
            } else if (accuracy >= 70) {
                resultsIcon = 'üéØ';
                resultsTitle = 'Well Done!';
                message = 'Solid troubleshooting performance!';
            } else if (accuracy < 50) {
                resultsIcon = 'üìö';
                resultsTitle = 'Keep Learning!';
                message = 'Practice makes perfect!';
            }
            
            document.getElementById('resultsIcon').textContent = resultsIcon;
            document.getElementById('resultsTitle').textContent = resultsTitle;
            document.getElementById('finalScore').textContent = gameState.score;
            document.getElementById('performanceMessage').textContent = message;
            
            // Performance summary
            document.getElementById('correctCount').textContent = gameState.correctAnswers;
            document.getElementById('correctPercentage').textContent = `${accuracy}%`;
            document.getElementById('incorrectCount').textContent = gameState.incorrectAnswers;
            document.getElementById('incorrectPercentage').textContent = `${100 - accuracy}%`;
            
            const minutes = Math.floor(totalTime / 60);
            const seconds = totalTime % 60;
            document.getElementById('totalTime').textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('avgTimePerQuestion').textContent = `${Math.round(totalTime / totalQuestions)}s avg`;
            
            document.getElementById('completedDifficulty').textContent = gameState.currentDifficulty.charAt(0).toUpperCase() + gameState.currentDifficulty.slice(1);
            const difficultyBonus = {easy: 0, medium: 200, hard: 500}[gameState.currentDifficulty];
            document.getElementById('difficultyBonus').textContent = difficultyBonus > 0 ? `+${difficultyBonus} bonus` : 'Base level';
        };

        // Update timer display
        function updateTimer() {
            setInterval(() => {
                if (gameState.startTime) {
                    const elapsed = Math.floor((Date.now() - gameState.startTime) / 1000);
                    const minutes = Math.floor(elapsed / 60);
                    const seconds = elapsed % 60;
                    const timeElement = document.getElementById('timeElapsed');
                    if (timeElement) {
                        timeElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    }
                }
            }, 1000);
        };

        // Play again
        function playAgain() {
            backToWelcome();
        };

        // Back to welcome screen
        function backToWelcome() {
            document.getElementById('welcomeScreen').style.display = 'block';
            document.getElementById('scenarioContainer').style.display = 'none';
            document.getElementById('resultsScreen').style.display = 'none';
            document.getElementById('leaderboardContainer').style.display = 'none';
        };

        // Show leaderboard
        function showLeaderboard() {
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('scenarioContainer').style.display = 'none';
            document.getElementById('resultsScreen').style.display = 'none';
            document.getElementById('leaderboardContainer').style.display = 'block';
            
            updateLeaderboardDisplay();
        };

        // Update leaderboard display
        function updateLeaderboardDisplay() {
            const scores = getTopScores();
            const leaderboardList = document.getElementById('leaderboardList');
            
            leaderboardList.innerHTML = '';
            
            scores.forEach((score, index) => {
                const item = document.createElement('div');
                item.className = 'leaderboard-item';
                
                let rankClass = '';
                let rankIcon = '';
                if (index === 0) {
                    rankClass = 'gold';
                    rankIcon = 'ü•á';
                } else if (index === 1) {
                    rankClass = 'silver';
                    rankIcon = 'ü•à';
                } else if (index === 2) {
                    rankClass = 'bronze';
                    rankIcon = 'ü•â';
                }
                
                item.innerHTML = `
                    <div class="rank ${rankClass}">${rankIcon} ${index + 1}</div>
                    <div class="player-info">
                        <div class="player-name">${score.name}</div>
                        <div class="player-details">${score.difficulty.charAt(0).toUpperCase() + score.difficulty.slice(1)} ‚Ä¢ ${score.accuracy}% accuracy ‚Ä¢ ${score.date}</div>
                    </div>
                    <div class="player-score">${score.score}</div>
                `;
                
                leaderboardList.appendChild(item);
            });
            
            if (scores.length === 0) {
                leaderboardList.innerHTML = '<div style="text-align: center; padding: 2rem; color: #bdc3c7;">No scores yet. Be the first to play!</div>';
            }
        };

        // Share score
        function shareScore() {
            const shareText = `I just scored ${gameState.score} points in the HVAC Troubleshooting Simulator! Test your skills at LARK Labs. #HVACTraining #LARKLabs`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'HVAC Troubleshooting Simulator Score',
                    text: shareText,
                    url: window.location.href
                });
            } else {
                // Fallback - copy to clipboard
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('Score copied to clipboard! Share it with your friends.');
                });
            }
        };

        // Clear leaderboard
        function clearLeaderboard() {
            if (confirm('Are you sure you want to clear all high scores? This cannot be undone.')) {
                localStorage.removeItem('hvacTroubleshootingScores');
                updateLeaderboardDisplay();
            }
        };

        // Save player stats
        function savePlayerStats() {
            localStorage.setItem('hvacTroubleshootingStats', JSON.stringify(gameState.playerStats));
        };

        // Load player stats
        function loadPlayerStats() {
            const saved = localStorage.getItem('hvacTroubleshootingStats');
            if (saved) {
                gameState.playerStats = JSON.parse(saved);
            }
        };

        // Update stats display
        function updateStatsDisplay() {
            document.getElementById('bestScore').textContent = gameState.playerStats.bestScore;
            document.getElementById('gamesPlayed').textContent = gameState.playerStats.gamesPlayed;
            
            const accuracy = gameState.playerStats.totalQuestions > 0 ? 
                Math.round((gameState.playerStats.totalCorrect / gameState.playerStats.totalQuestions) * 100) : 0;
            document.getElementById('accuracy').textContent = `${accuracy}%`;
        };

        // Save score to leaderboard
        function saveScore() {
            const playerName = prompt('Enter your name for the leaderboard:') || 'Anonymous';
            const totalQuestions = gameState.correctAnswers + gameState.incorrectAnswers;
            const accuracy = Math.round((gameState.correctAnswers / totalQuestions) * 100);
            
            const scoreData = {
                name: playerName,
                score: gameState.score,
                difficulty: gameState.currentDifficulty,
                accuracy: accuracy,
                date: new Date().toLocaleDateString(),
                timestamp: Date.now()
            };
            
            let scores = JSON.parse(localStorage.getItem('hvacTroubleshootingScores') || '[]');
            scores.push(scoreData);
            scores.sort((a, b) => b.score - a.score);
            scores = scores.slice(0, 10); // Keep only top 10
            
            localStorage.setItem('hvacTroubleshootingScores', JSON.stringify(scores));
        };

        // Get top scores
        function getTopScores() {
            return JSON.parse(localStorage.getItem('hvacTroubleshootingScores') || '[]');
        };
    </script>
</body>
</html>