<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canadian Gas Venting Calculator - CSA B149.1</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        .input-section, .results-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .section-title {
            font-size: 1.4em;
            font-weight: 600;
            color: #2a5298;
            margin-bottom: 20px;
            border-bottom: 2px solid #2a5298;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ced4da;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #2a5298;
            box-shadow: 0 0 0 3px rgba(42, 82, 152, 0.1);
        }

        .appliance-item {
            background: white;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            position: relative;
        }

        .appliance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .appliance-title {
            font-weight: 600;
            color: #2a5298;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(42, 82, 152, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            padding: 8px 15px;
            font-size: 14px;
        }

        .btn-danger:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(220, 53, 69, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            margin-top: 20px;
            font-size: 18px;
            padding: 15px 30px;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }

        .results-grid {
            display: grid;
            gap: 15px;
        }

        .result-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .result-label {
            font-weight: 600;
            color: #6c757d;
            margin-bottom: 5px;
        }

        .result-value {
            font-size: 1.3em;
            font-weight: 700;
            color: #2a5298;
        }

        .total-btuh {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            text-align: center;
        }

        .total-btuh .result-value {
            color: white;
            font-size: 1.8em;
        }

        .warning {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ffeaa7;
            margin-top: 15px;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #f5c6cb;
            margin-top: 15px;
        }

        .info {
            background: #d1ecf1;
            color: #0c5460;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #bee5eb;
            margin-top: 15px;
        }

        .chart-reference {
            margin-top: 20px;
            padding: 15px;
            background: #e7f3ff;
            border-radius: 8px;
            border-left: 4px solid #2a5298;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }

        .calculation-details {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 14px;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Canadian Gas Venting Calculator</h1>
            <p>CSA B149.1:25 Compliant Vent Sizing Tool</p>
        </div>

        <div class="main-content">
            <div class="input-section">
                <h2 class="section-title">System Configuration</h2>
                
                <div class="form-group">
                    <label for="gasType">Gas Type:</label>
                    <select id="gasType">
                        <option value="natural">Natural Gas</option>
                        <option value="propane">Propane</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="ventType">Vent Type:</label>
                    <select id="ventType">
                        <option value="double">Type B Double-Wall</option>
                        <option value="single">Type B Single-Wall</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="connectorType">Connector Type:</label>
                    <select id="connectorType">
                        <option value="double">Double-Wall Connector</option>
                        <option value="single">Single-Wall Connector</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="ventHeight">Total Vent Height (ft):</label>
                    <select id="ventHeight">
                        <option value="6">6 ft</option>
                        <option value="8">8 ft</option>
                        <option value="10" selected>10 ft</option>
                        <option value="15">15 ft</option>
                        <option value="20">20 ft</option>
                        <option value="25">25 ft</option>
                        <option value="30">30 ft</option>
                        <option value="50">50 ft</option>
                        <option value="100">100 ft</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="lateralLength">Total Lateral Length (ft):</label>
                    <select id="lateralLength">
                        <option value="0" selected>0 ft</option>
                        <option value="2">2 ft</option>
                        <option value="4">4 ft</option>
                        <option value="5">5 ft</option>
                        <option value="6">6 ft</option>
                        <option value="8">8 ft</option>
                        <option value="10">10 ft</option>
                        <option value="15">15 ft</option>
                        <option value="20">20 ft</option>
                        <option value="25">25 ft</option>
                        <option value="30">30 ft</option>
                    </select>
                </div>

                <h3 class="section-title">Appliances</h3>
                <div id="appliancesList"></div>
                <button class="btn btn-primary" onclick="addAppliance()">Add Appliance</button>
                
                <button class="btn btn-success" onclick="calculateVentSize()">Calculate Vent Size</button>
            </div>

            <div class="results-section">
                <h2 class="section-title">Results</h2>
                <div class="results-grid" id="resultsContainer">
                    <div class="info">
                        Add appliances and click "Calculate Vent Size" to see results
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let applianceCount = 0;
        let appliances = [];

        // Comprehensive vent sizing tables based on CSA B149.1 Annex C
        const ventSizingTables = {
            natural: {
                double: {
                    double: { // Double-wall vent with double-wall connector
                        6: {
                            0: { 3: 78, 4: 152, 5: 251, 6: 375, 7: 524, 8: 717, 9: 946 },
                            2: { 3: 51, 4: 97, 5: 157, 6: 232, 7: 327, 8: 441, 9: 566 },
                            4: { 3: 46, 4: 84, 5: 138, 6: 201, 7: 279, 8: 371, 9: 473 }
                        },
                        8: {
                            0: { 3: 104, 4: 186, 5: 297, 6: 431, 7: 594, 8: 790, 9: 1012 },
                            2: { 3: 67, 4: 118, 5: 186, 6: 267, 7: 365, 8: 482, 9: 612 },
                            4: { 3: 61, 4: 105, 5: 163, 6: 233, 7: 316, 8: 413, 9: 522 }
                        },
                        10: {
                            0: { 3: 130, 4: 225, 5: 352, 6: 501, 7: 681, 8: 897, 9: 1142 },
                            2: { 3: 86, 4: 148, 5: 230, 6: 324, 7: 436, 8: 568, 9: 715 },
                            4: { 3: 78, 4: 132, 5: 203, 6: 284, 7: 378, 8: 488, 9: 611 }
                        },
                        15: {
                            0: { 3: 170, 4: 289, 5: 445, 6: 625, 7: 838, 8: 1089, 9: 1378 },
                            2: { 3: 124, 4: 203, 5: 309, 6: 427, 7: 564, 8: 721, 9: 897 },
                            4: { 3: 112, 4: 179, 5: 270, 6: 371, 7: 486, 8: 617, 9: 762 }
                        },
                        20: {
                            0: { 3: 208, 4: 346, 5: 525, 6: 731, 7: 972, 8: 1251, 9: 1568 },
                            2: { 3: 157, 4: 254, 5: 379, 6: 518, 7: 677, 8: 856, 9: 1057 },
                            4: { 3: 143, 4: 225, 5: 332, 6: 452, 7: 588, 8: 741, 9: 912 }
                        },
                        25: {
                            0: { 3: 246, 4: 402, 5: 603, 6: 834, 7: 1102, 8: 1410, 9: 1760 },
                            2: { 3: 191, 4: 302, 5: 444, 6: 603, 7: 784, 8: 987, 9: 1214 },
                            4: { 3: 174, 4: 268, 5: 390, 6: 528, 7: 684, 8: 859, 9: 1055 }
                        },
                        30: {
                            0: { 3: 284, 4: 456, 5: 678, 6: 933, 7: 1228, 8: 1566, 9: 1948 },
                            2: { 3: 223, 4: 348, 5: 506, 6: 684, 7: 887, 8: 1115, 9: 1369 },
                            4: { 3: 203, 4: 309, 5: 446, 6: 600, 7: 776, 8: 972, 9: 1190 }
                        },
                        50: {
                            0: { 3: 431, 4: 667, 5: 965, 6: 1307, 7: 1705, 8: 2158, 9: 2669 },
                            2: { 3: 354, 4: 540, 5: 769, 6: 1030, 7: 1327, 8: 1660, 9: 2030 },
                            4: { 3: 331, 4: 497, 5: 700, 6: 931, 7: 1195, 8: 1492, 9: 1824 }
                        },
                        100: {
                            0: { 3: 754, 4: 1126, 5: 1573, 6: 2091, 7: 2685, 8: 3359, 9: 4116 },
                            2: { 3: 651, 4: 953, 5: 1318, 6: 1733, 7: 2202, 8: 2726, 9: 3306 },
                            4: { 3: 618, 4: 889, 5: 1218, 6: 1596, 7: 2025, 8: 2507, 9: 3043 }
                        }
                    },
                    single: { // Double-wall vent with single-wall connector
                        6: {
                            0: { 3: 45, 4: 86, 5: 140, 6: 204, 7: 283, 8: 378, 9: 489 },
                            2: { 3: 36, 4: 67, 5: 104, 6: 156, 7: 215, 8: 288, 9: 375 },
                            4: { 3: 32, 4: 59, 5: 92, 6: 135, 7: 187, 8: 250, 9: 325 }
                        },
                        8: {
                            0: { 3: 59, 4: 110, 5: 174, 6: 251, 7: 342, 8: 447, 9: 566 },
                            2: { 3: 49, 4: 89, 5: 139, 6: 198, 7: 267, 8: 348, 9: 441 },
                            4: { 3: 44, 4: 78, 5: 120, 6: 171, 7: 230, 8: 299, 9: 378 }
                        },
                        10: {
                            0: { 3: 74, 4: 133, 5: 207, 6: 294, 7: 396, 8: 512, 9: 641 },
                            2: { 3: 62, 4: 109, 5: 168, 6: 236, 7: 316, 8: 408, 9: 513 },
                            4: { 3: 56, 4: 96, 5: 147, 6: 207, 7: 275, 8: 353, 9: 442 }
                        },
                        15: {
                            0: { 3: 103, 4: 178, 5: 270, 6: 378, 7: 500, 8: 639, 9: 794 },
                            2: { 3: 87, 4: 147, 5: 220, 6: 304, 7: 399, 8: 507, 9: 628 },
                            4: { 3: 80, 4: 132, 5: 195, 6: 268, 7: 350, 8: 443, 9: 548 }
                        },
                        20: {
                            0: { 3: 128, 4: 216, 5: 322, 6: 446, 7: 588, 8: 749, 9: 928 },
                            2: { 3: 110, 4: 182, 5: 267, 6: 367, 7: 479, 8: 603, 9: 740 },
                            4: { 3: 102, 4: 165, 5: 240, 6: 328, 7: 426, 8: 536, 9: 658 }
                        },
                        25: {
                            0: { 3: 152, 4: 252, 5: 372, 6: 512, 7: 673, 8: 855, 9: 1059 },
                            2: { 3: 132, 4: 215, 5: 313, 6: 425, 7: 552, 8: 693, 9: 849 },
                            4: { 3: 123, 4: 196, 5: 283, 6: 383, 7: 497, 8: 622, 9: 760 }
                        },
                        30: {
                            0: { 3: 176, 4: 288, 5: 422, 6: 577, 7: 756, 8: 958, 9: 1184 },
                            2: { 3: 154, 4: 247, 5: 357, 6: 482, 7: 622, 8: 778, 9: 950 },
                            4: { 3: 144, 4: 226, 5: 323, 6: 435, 7: 561, 8: 701, 9: 854 }
                        },
                        50: {
                            0: { 3: 265, 4: 423, 5: 608, 6: 823, 7: 1069, 8: 1347, 9: 1658 },
                            2: { 3: 240, 4: 376, 5: 536, 6: 717, 7: 922, 8: 1150, 9: 1403 },
                            4: { 3: 227, 4: 352, 5: 497, 6: 662, 7: 850, 8: 1059, 9: 1291 }
                        },
                        100: {
                            0: { 3: 464, 4: 723, 5: 1020, 6: 1364, 7: 1760, 8: 2211, 9: 2716 },
                            2: { 3: 432, 4: 666, 5: 933, 6: 1244, 7: 1600, 8: 2003, 9: 2452 },
                            4: { 3: 413, 4: 632, 5: 881, 6: 1170, 7: 1502, 8: 1878, 9: 2299 }
                        }
                    }
                },
                single: {
                    double: { // Single-wall vent with double-wall connector
                        6: {
                            0: { 3: 67, 4: 128, 5: 207, 6: 303, 7: 421, 8: 564, 9: 730 },
                            2: { 3: 49, 4: 91, 5: 146, 6: 213, 7: 294, 8: 390, 9: 501 },
                            4: { 3: 44, 4: 80, 5: 128, 6: 185, 7: 254, 8: 335, 9: 429 }
                        },
                        8: {
                            0: { 3: 89, 4: 162, 5: 253, 6: 364, 7: 498, 8: 657, 9: 841 },
                            2: { 3: 66, 4: 116, 5: 179, 6: 254, 7: 341, 8: 443, 9: 559 },
                            4: { 3: 59, 4: 102, 5: 156, 6: 220, 7: 295, 8: 382, 9: 481 }
                        },
                        10: {
                            0: { 3: 112, 4: 197, 5: 304, 6: 431, 7: 582, 8: 759, 9: 964 },
                            2: { 3: 84, 4: 142, 5: 214, 6: 297, 7: 394, 8: 506, 9: 633 },
                            4: { 3: 76, 4: 126, 5: 187, 6: 259, 7: 343, 8: 438, 9: 546 }
                        },
                        15: {
                            0: { 3: 148, 4: 252, 5: 378, 6: 528, 7: 702, 8: 902, 9: 1131 },
                            2: { 3: 116, 4: 191, 5: 282, 6: 384, 7: 501, 8: 632, 9: 778 },
                            4: { 3: 106, 4: 170, 5: 248, 6: 337, 7: 437, 8: 549, 9: 673 }
                        },
                        20: {
                            0: { 3: 183, 4: 307, 5: 456, 6: 628, 7: 829, 8: 1061, 9: 1323 },
                            2: { 3: 146, 4: 237, 5: 346, 6: 469, 7: 608, 8: 763, 9: 934 },
                            4: { 3: 134, 4: 213, 5: 305, 6: 410, 7: 529, 8: 662, 9: 810 }
                        },
                        25: {
                            0: { 3: 217, 4: 359, 5: 528, 6: 722, 7: 947, 8: 1205, 9: 1498 },
                            2: { 3: 175, 4: 282, 5: 407, 6: 548, 7: 706, 8: 883, 9: 1079 },
                            4: { 3: 161, 4: 253, 5: 359, 6: 481, 7: 618, 8: 771, 9: 940 }
                        },
                        30: {
                            0: { 3: 251, 4: 410, 5: 597, 6: 810, 7: 1058, 8: 1342, 9: 1664 },
                            2: { 3: 203, 4: 324, 5: 465, 6: 623, 7: 799, 8: 996, 9: 1215 },
                            4: { 3: 187, 4: 292, 5: 414, 6: 551, 7: 706, 8: 878, 9: 1068 }
                        },
                        50: {
                            0: { 3: 379, 4: 600, 5: 859, 6: 1155, 7: 1494, 8: 1878, 9: 2308 },
                            2: { 3: 321, 4: 498, 5: 706, 6: 944, 7: 1214, 8: 1515, 9: 1850 },
                            4: { 3: 303, 4: 462, 5: 651, 6: 868, 7: 1116, 8: 1395, 9: 1706 }
                        },
                        100: {
                            0: { 3: 665, 4: 1004, 5: 1399, 6: 1855, 7: 2375, 8: 2963, 9: 3622 },
                            2: { 3: 584, 4: 866, 5: 1195, 6: 1570, 7: 1995, 8: 2473, 9: 2998 },
                            4: { 3: 557, 4: 814, 5: 1118, 6: 1464, 7: 1854, 8: 2290, 9: 2775 }
                        }
                    },
                    single: { // Single-wall vent with single-wall connector
                        6: {
                            0: { 3: 36, 4: 69, 5: 112, 6: 164, 7: 226, 8: 300, 9: 388 },
                            2: { 3: 28, 4: 51, 5: 81, 6: 117, 7: 161, 8: 213, 9: 274 },
                            4: { 3: 25, 4: 44, 5: 70, 6: 101, 7: 138, 8: 182, 9: 234 }
                        },
                        8: {
                            0: { 3: 48, 4: 87, 5: 136, 6: 195, 7: 265, 8: 348, 9: 444 },
                            2: { 3: 38, 4: 67, 5: 103, 6: 146, 7: 196, 8: 254, 9: 321 },
                            4: { 3: 34, 4: 58, 5: 89, 6: 125, 7: 168, 8: 217, 9: 273 }
                        },
                        10: {
                            0: { 3: 59, 4: 104, 5: 161, 6: 228, 7: 307, 8: 398, 9: 503 },
                            2: { 3: 48, 4: 82, 5: 124, 6: 174, 7: 232, 8: 298, 9: 373 },
                            4: { 3: 43, 4: 72, 5: 108, 6: 150, 7: 199, 8: 254, 9: 317 }
                        },
                        15: {
                            0: { 3: 82, 4: 139, 5: 209, 6: 291, 7: 386, 8: 496, 9: 619 },
                            2: { 3: 69, 4: 113, 5: 168, 6: 232, 7: 306, 8: 389, 9: 483 },
                            4: { 3: 62, 4: 100, 5: 147, 6: 202, 7: 265, 8: 336, 9: 416 }
                        },
                        20: {
                            0: { 3: 103, 4: 172, 5: 255, 6: 352, 7: 464, 8: 593, 9: 738 },
                            2: { 3: 88, 4: 141, 5: 206, 6: 281, 7: 367, 8: 465, 9: 575 },
                            4: { 3: 81, 4: 127, 5: 183, 6: 248, 7: 322, 8: 406, 9: 500 }
                        },
                        25: {
                            0: { 3: 122, 4: 202, 5: 298, 6: 408, 7: 535, 8: 680, 9: 844 },
                            2: { 3: 106, 4: 167, 5: 241, 6: 327, 7: 425, 8: 536, 9: 660 },
                            4: { 3: 98, 4: 151, 5: 216, 6: 291, 7: 377, 8: 474, 9: 583 }
                        },
                        30: {
                            0: { 3: 141, 4: 231, 5: 340, 6: 462, 7: 603, 8: 765, 9: 947 },
                            2: { 3: 123, 4: 192, 5: 275, 6: 370, 7: 479, 8: 601, 9: 738 },
                            4: { 3: 115, 4: 175, 5: 248, 6: 332, 7: 427, 8: 536, 9: 656 }
                        },
                        50: {
                            0: { 3: 213, 4: 339, 5: 487, 6: 656, 7: 850, 8: 1070, 9: 1316 },
                            2: { 3: 193, 4: 299, 5: 425, 6: 568, 7: 731, 8: 915, 9: 1123 },
                            4: { 3: 183, 4: 281, 5: 396, 6: 525, 7: 673, 8: 841, 9: 1030 }
                        },
                        100: {
                            0: { 3: 373, 4: 577, 5: 811, 6: 1081, 7: 1390, 8: 1740, 9: 2131 },
                            2: { 3: 347, 4: 532, 5: 745, 6: 991, 7: 1272, 8: 1587, 9: 1938 },
                            4: { 3: 332, 4: 505, 5: 703, 6: 932, 7: 1194, 8: 1487, 9: 1814 }
                        }
                    }
                }
            },
            propane: {
                double: {
                    double: { // Double-wall vent with double-wall connector
                        6: {
                            0: { 3: 61, 4: 119, 5: 196, 6: 293, 7: 410, 8: 560, 9: 738 },
                            2: { 3: 40, 4: 76, 5: 123, 6: 181, 7: 256, 8: 344, 9: 443 },
                            4: { 3: 36, 4: 66, 5: 108, 6: 157, 7: 218, 8: 290, 9: 369 }
                        },
                        8: {
                            0: { 3: 81, 4: 145, 5: 232, 6: 337, 7: 464, 8: 617, 9: 792 },
                            2: { 3: 52, 4: 92, 5: 145, 6: 209, 7: 285, 8: 376, 9: 478 },
                            4: { 3: 47, 4: 82, 5: 127, 6: 182, 7: 247, 8: 323, 9: 408 }
                        },
                        10: {
                            0: { 3: 102, 4: 175, 5: 275, 6: 391, 7: 532, 8: 701, 9: 892 },
                            2: { 3: 67, 4: 116, 5: 179, 6: 253, 7: 341, 8: 444, 9: 559 },
                            4: { 3: 61, 4: 103, 5: 159, 6: 222, 7: 295, 8: 382, 9: 478 }
                        },
                        15: {
                            0: { 3: 133, 4: 222, 5: 342, 6: 482, 7: 647, 8: 843, 9: 1073 },
                            2: { 3: 97, 4: 158, 5: 241, 6: 333, 7: 441, 8: 564, 9: 701 },
                            4: { 3: 87, 4: 140, 5: 211, 6: 290, 7: 380, 8: 482, 9: 596 }
                        },
                        20: {
                            0: { 3: 163, 4: 266, 5: 405, 6: 567, 7: 757, 8: 977, 9: 1226 },
                            2: { 3: 123, 4: 198, 5: 296, 6: 405, 7: 529, 8: 669, 9: 826 },
                            4: { 3: 112, 4: 176, 5: 259, 6: 353, 7: 459, 8: 579, 9: 712 }
                        },
                        25: {
                            0: { 3: 193, 4: 314, 5: 467, 6: 649, 7: 861, 8: 1103, 9: 1376 },
                            2: { 3: 149, 4: 236, 5: 346, 6: 471, 7: 613, 8: 771, 9: 950 },
                            4: { 3: 136, 4: 209, 5: 304, 6: 412, 7: 535, 8: 672, 9: 824 }
                        },
                        30: {
                            0: { 3: 222, 4: 359, 5: 530, 6: 732, 7: 964, 8: 1228, 9: 1525 },
                            2: { 3: 174, 4: 272, 5: 395, 6: 534, 7: 692, 8: 869, 9: 1069 },
                            4: { 3: 159, 4: 242, 5: 347, 6: 468, 7: 606, 8: 760, 9: 930 }
                        },
                        50: {
                            0: { 3: 337, 4: 522, 5: 754, 6: 1023, 7: 1334, 8: 1689, 9: 2090 },
                            2: { 3: 277, 4: 421, 5: 600, 6: 805, 7: 1037, 8: 1297, 9: 1588 },
                            4: { 3: 259, 4: 388, 5: 547, 6: 727, 7: 933, 8: 1166, 9: 1427 }
                        },
                        100: {
                            0: { 3: 590, 4: 880, 5: 1228, 6: 1634, 7: 2099, 8: 2627, 9: 3218 },
                            2: { 3: 509, 4: 744, 5: 1030, 6: 1354, 7: 1720, 8: 2130, 9: 2583 },
                            4: { 3: 483, 4: 695, 5: 952, 6: 1246, 7: 1581, 8: 1958, 9: 2377 }
                        }
                    },
                    single: { // Double-wall vent with single-wall connector
                        6: {
                            0: { 3: 35, 4: 67, 5: 109, 6: 159, 7: 221, 8: 295, 9: 382 },
                            2: { 3: 28, 4: 52, 5: 81, 6: 122, 7: 168, 8: 225, 9: 293 },
                            4: { 3: 25, 4: 46, 5: 72, 6: 105, 7: 145, 8: 195, 9: 254 }
                        },
                        8: {
                            0: { 3: 46, 4: 86, 5: 136, 6: 196, 7: 267, 8: 349, 9: 442 },
                            2: { 3: 38, 4: 69, 5: 108, 6: 154, 7: 208, 8: 272, 9: 344 },
                            4: { 3: 34, 4: 61, 5: 94, 6: 133, 7: 179, 8: 234, 9: 295 }
                        },
                        10: {
                            0: { 3: 58, 4: 104, 5: 162, 6: 231, 7: 309, 8: 400, 9: 505 },
                            2: { 3: 48, 4: 84, 5: 128, 6: 184, 7: 247, 8: 319, 9: 401 },
                            4: { 3: 44, 4: 74, 5: 112, 6: 159, 7: 213, 8: 275, 9: 346 }
                        },
                        15: {
                            0: { 3: 80, 4: 139, 5: 211, 6: 295, 7: 391, 8: 500, 9: 622 },
                            2: { 3: 68, 4: 115, 5: 172, 6: 237, 7: 312, 8: 397, 9: 493 },
                            4: { 3: 62, 4: 103, 5: 152, 6: 209, 7: 274, 8: 347, 9: 431 }
                        },
                        20: {
                            0: { 3: 100, 4: 169, 5: 252, 6: 348, 7: 459, 8: 585, 9: 725 },
                            2: { 3: 86, 4: 142, 5: 208, 6: 285, 7: 374, 8: 472, 9: 581 },
                            4: { 3: 79, 4: 129, 5: 187, 6: 254, 7: 332, 8: 419, 9: 515 }
                        },
                        25: {
                            0: { 3: 118, 4: 197, 5: 290, 6: 399, 7: 525, 8: 668, 9: 828 },
                            2: { 3: 103, 4: 167, 5: 242, 6: 331, 7: 432, 8: 544, 9: 669 },
                            4: { 3: 95, 4: 153, 5: 219, 6: 298, 7: 388, 8: 488, 9: 598 }
                        },
                        30: {
                            0: { 3: 137, 4: 225, 5: 329, 6: 450, 7: 588, 8: 747, 9: 925 },
                            2: { 3: 120, 4: 191, 5: 275, 6: 373, 7: 485, 8: 609, 9: 747 },
                            4: { 3: 112, 4: 176, 5: 249, 6: 337, 7: 437, 8: 548, 9: 671 }
                        },
                        50: {
                            0: { 3: 207, 4: 329, 5: 474, 6: 640, 7: 829, 8: 1043, 9: 1282 },
                            2: { 3: 187, 4: 293, 5: 417, 6: 559, 7: 719, 8: 898, 9: 1099 },
                            4: { 3: 177, 4: 276, 5: 387, 6: 515, 7: 660, 8: 823, 9: 1004 }
                        },
                        100: {
                            0: { 3: 362, 4: 560, 5: 787, 6: 1050, 7: 1350, 8: 1691, 9: 2073 },
                            2: { 3: 337, 4: 517, 5: 724, 6: 962, 7: 1235, 8: 1543, 9: 1887 },
                            4: { 3: 323, 4: 491, 5: 680, 6: 900, 7: 1153, 8: 1439, 9: 1758 }
                        }
                    }
                },
                single: {
                    double: { // Single-wall vent with double-wall connector
                        6: {
                            0: { 3: 52, 4: 100, 5: 162, 6: 237, 7: 329, 8: 440, 9: 570 },
                            2: { 3: 38, 4: 71, 5: 114, 6: 166, 7: 230, 8: 305, 9: 391 },
                            4: { 3: 34, 4: 62, 5: 100, 6: 144, 7: 199, 8: 262, 9: 335 }
                        },
                        8: {
                            0: { 3: 69, 4: 127, 5: 198, 6: 285, 7: 389, 8: 513, 9: 657 },
                            2: { 3: 51, 4: 90, 5: 140, 6: 199, 7: 266, 8: 345, 9: 436 },
                            4: { 3: 46, 4: 80, 5: 122, 6: 172, 7: 230, 8: 298, 9: 376 }
                        },
                        10: {
                            0: { 3: 87, 4: 154, 5: 238, 6: 337, 7: 455, 8: 593, 9: 752 },
                            2: { 3: 66, 4: 111, 5: 167, 6: 232, 7: 307, 8: 395, 9: 494 },
                            4: { 3: 59, 4: 98, 5: 146, 6: 202, 7: 268, 8: 342, 9: 426 }
                        },
                        15: {
                            0: { 3: 115, 4: 197, 5: 295, 6: 409, 7: 548, 8: 705, 9: 883 },
                            2: { 3: 90, 4: 149, 5: 220, 6: 300, 7: 392, 8: 496, 9: 608 },
                            4: { 3: 83, 4: 133, 5: 193, 6: 263, 7: 342, 8: 429, 9: 526 }
                        },
                        20: {
                            0: { 3: 143, 4: 238, 5: 356, 6: 490, 7: 647, 8: 827, 9: 1032 },
                            2: { 3: 114, 4: 185, 5: 270, 6: 366, 7: 475, 8: 596, 9: 730 },
                            4: { 3: 104, 4: 166, 5: 237, 6: 320, 7: 413, 8: 518, 9: 633 }
                        },
                        25: {
                            0: { 3: 169, 4: 278, 5: 412, 6: 565, 7: 742, 8: 943, 9: 1171 },
                            2: { 3: 137, 4: 218, 5: 318, 6: 429, 7: 552, 8: 690, 9: 842 },
                            4: { 3: 126, 4: 197, 5: 280, 6: 375, 7: 482, 8: 603, 9: 735 }
                        },
                        30: {
                            0: { 3: 196, 4: 318, 5: 466, 6: 633, 7: 826, 8: 1048, 9: 1299 },
                            2: { 3: 159, 4: 253, 5: 363, 6: 487, 7: 626, 8: 781, 9: 951 },
                            4: { 3: 146, 4: 228, 5: 323, 6: 431, 7: 553, 8: 688, 9: 836 }
                        },
                        50: {
                            0: { 3: 296, 4: 469, 5: 671, 6: 903, 7: 1169, 8: 1469, 9: 1804 },
                            2: { 3: 251, 4: 389, 5: 551, 6: 736, 7: 947, 8: 1183, 9: 1444 },
                            4: { 3: 237, 4: 361, 5: 509, 6: 678, 7: 870, 8: 1085, 9: 1324 }
                        },
                        100: {
                            0: { 3: 519, 4: 785, 5: 1093, 6: 1450, 7: 1857, 8: 2317, 9: 2831 },
                            2: { 3: 456, 4: 683, 5: 938, 6: 1230, 7: 1562, 8: 1935, 9: 2349 },
                            4: { 3: 435, 4: 636, 5: 872, 6: 1142, 7: 1447, 8: 1789, 9: 2167 }
                        }
                    },
                    single: { // Single-wall vent with single-wall connector
                        6: {
                            0: { 3: 28, 4: 54, 5: 87, 6: 128, 7: 177, 8: 235, 9: 303 },
                            2: { 3: 22, 4: 40, 5: 63, 6: 91, 7: 126, 8: 167, 9: 214 },
                            4: { 3: 20, 4: 35, 5: 55, 6: 79, 7: 108, 8: 142, 9: 183 }
                        },
                        8: {
                            0: { 3: 37, 4: 68, 5: 106, 6: 152, 7: 207, 8: 272, 9: 346 },
                            2: { 3: 30, 4: 52, 5: 80, 6: 113, 7: 153, 8: 199, 9: 251 },
                            4: { 3: 27, 4: 46, 5: 69, 6: 98, 7: 131, 8: 170, 9: 214 }
                        },
                        10: {
                            0: { 3: 46, 4: 82, 5: 126, 6: 178, 7: 240, 8: 311, 9: 393 },
                            2: { 3: 38, 4: 65, 5: 98, 6: 136, 7: 181, 8: 233, 9: 291 },
                            4: { 3: 34, 4: 56, 5: 84, 6: 117, 7: 155, 8: 200, 9: 249 }
                        },
                        15: {
                            0: { 3: 64, 4: 109, 5: 163, 6: 226, 7: 301, 8: 387, 9: 484 },
                            2: { 3: 54, 4: 88, 5: 129, 6: 177, 7: 232, 8: 296, 9: 367 },
                            4: { 3: 49, 4: 78, 5: 113, 6: 154, 7: 201, 8: 254, 9: 315 }
                        },
                        20: {
                            0: { 3: 80, 4: 134, 5: 199, 6: 274, 7: 362, 8: 463, 9: 576 },
                            2: { 3: 69, 4: 110, 5: 158, 6: 214, 7: 279, 8: 353, 9: 436 },
                            4: { 3: 63, 4: 99, 5: 142, 6: 193, 7: 251, 8: 317, 9: 391 }
                        },
                        25: {
                            0: { 3: 95, 4: 158, 5: 233, 6: 318, 7: 418, 8: 533, 9: 661 },
                            2: { 3: 83, 4: 131, 5: 186, 6: 251, 7: 325, 8: 409, 9: 502 },
                            4: { 3: 76, 4: 118, 5: 168, 6: 226, 7: 292, 8: 367, 9: 451 }
                        },
                        30: {
                            0: { 3: 110, 4: 181, 5: 265, 6: 361, 7: 472, 8: 600, 9: 743 },
                            2: { 3: 96, 4: 150, 5: 213, 6: 286, 7: 369, 8: 463, 9: 568 },
                            4: { 3: 89, 4: 135, 5: 192, 6: 257, 7: 331, 8: 415, 9: 509 }
                        },
                        50: {
                            0: { 3: 166, 4: 264, 5: 380, 6: 513, 7: 665, 8: 837, 9: 1028 },
                            2: { 3: 151, 4: 233, 5: 329, 6: 442, 7: 570, 8: 714, 9: 874 },
                            4: { 3: 143, 4: 217, 5: 305, 6: 409, 7: 526, 8: 657, 9: 803 }
                        },
                        100: {
                            0: { 3: 291, 4: 450, 5: 633, 6: 844, 7: 1085, 8: 1358, 9: 1663 },
                            2: { 3: 271, 4: 415, 5: 582, 6: 774, 7: 993, 8: 1240, 9: 1516 },
                            4: { 3: 259, 4: 394, 5: 549, 6: 728, 7: 932, 8: 1163, 9: 1420 }
                        }
                    }
                }
            }
        };

        function addAppliance() {
            applianceCount++;
            const appliance = {
                id: applianceCount,
                btuh: 0,
                draftType: 'NAT'
            };
            appliances.push(appliance);
            renderAppliances();
        }

        function removeAppliance(id) {
            appliances = appliances.filter(app => app.id !== id);
            renderAppliances();
        }

        function renderAppliances() {
            const container = document.getElementById('appliancesList');
            if (appliances.length === 0) {
                container.innerHTML = '<div class="info">No appliances added yet. Click "Add Appliance" to start.</div>';
                return;
            }

            container.innerHTML = appliances.map(appliance => `
                <div class="appliance-item">
                    <div class="appliance-header">
                        <span class="appliance-title">Appliance ${appliance.id}</span>
                        <button class="btn btn-danger" onclick="removeAppliance(${appliance.id})">Remove</button>
                    </div>
                    <div class="form-group">
                        <label>BTU/h Input:</label>
                        <input type="number" min="1000" max="500000" step="1000" 
                               value="${appliance.btuh}" 
                               onchange="updateAppliance(${appliance.id}, 'btuh', this.value)">
                    </div>
                    <div class="form-group">
                        <label>Draft Type:</label>
                        <select onchange="updateAppliance(${appliance.id}, 'draftType', this.value)">
                            <option value="NAT" ${appliance.draftType === 'NAT' ? 'selected' : ''}>Natural Draft (NAT)</option>
                            <option value="FAN" ${appliance.draftType === 'FAN' ? 'selected' : ''}>Fan Assisted (FAN)</option>
                        </select>
                    </div>
                </div>
            `).join('');
        }

        function updateAppliance(id, property, value) {
            const appliance = appliances.find(app => app.id === id);
            if (appliance) {
                appliance[property] = parseFloat(value) || 0;
            }
        }

        function determineDraftType(appliances) {
            // According to CSA B149.1, if any appliance is fan-assisted (FAN), 
            // the entire system must be calculated using FAN tables
            const hasFanAssisted = appliances.some(app => app.draftType === 'FAN');
            return hasFanAssisted ? 'FAN' : 'NAT';
        }

        function getTableReference(gasType, ventType, connectorType, systemDraftType) {
            // Generate the specific table reference based on configuration
            const gasTypeName = gasType === 'natural' ? 'Natural Gas' : 'Propane';
            const ventTypeName = ventType === 'double' ? 'Type B Double-Wall' : 'Type B Single-Wall';
            const connectorTypeName = connectorType === 'double' ? 'Double-Wall' : 'Single-Wall';
            
            // Determine the table number based on vent type
            let tableNumber;
            if (gasType === 'natural') {
                tableNumber = ventType === 'double' ? 'C.1' : 'C.2';
            } else {
                tableNumber = ventType === 'double' ? 'C.3' : 'C.4';
            }
            
            return `CSA B149.1:25 Table ${tableNumber} - ${gasTypeName} with ${ventTypeName} Vent, ${connectorTypeName} Connector (${systemDraftType} Appliances)`;
        }

        function findVentSize(totalBtuh, gasType, ventType, connectorType, height, lateralLength, systemDraftType) {
            const table = ventSizingTables[gasType]?.[ventType]?.[connectorType];
            
            if (!table) {
                return null;
            }

            // Find available heights in table
            const heights = Object.keys(table).map(h => parseInt(h)).sort((a, b) => a - b);
            let selectedHeight = heights[0];
            for (let h of heights) {
                if (height >= h) {
                    selectedHeight = h;
                }
            }

            // Find available lateral lengths
            const lateralData = table[selectedHeight];
            if (!lateralData) return null;

            const laterals = Object.keys(lateralData).map(l => parseInt(l)).sort((a, b) => a - b);
            let selectedLateral = laterals[0];
            for (let l of laterals) {
                if (lateralLength >= l) {
                    selectedLateral = l;
                }
            }

            const ventSizes = lateralData[selectedLateral];
            if (!ventSizes) return null;
            
            // Convert BTU/h to MBtu/h (thousands) for table lookup
            const totalMBtuh = totalBtuh / 1000;
            
            // Find minimum vent size that can handle the BTU load
            const sizes = Object.keys(ventSizes).map(s => parseInt(s)).sort((a, b) => a - b);
            let selectedSize = null;
            let originalSize = null;
            let threeInchOverride = false;
            
            for (let size of sizes) {
                if (ventSizes[size] >= totalMBtuh) {
                    selectedSize = size;
                    originalSize = size;
                    
                    // CSA B149.1 requirement: 3" vents shall not be used when sized by charts
                    // Must use 4" vent instead
                    if (size === 3) {
                        selectedSize = 4;
                        threeInchOverride = true;
                    }
                    
                    return {
                        diameter: selectedSize,
                        originalDiameter: originalSize,
                        capacity: ventSizes[selectedSize] ? ventSizes[selectedSize] * 1000 : ventSizes[4] * 1000,
                        heightUsed: selectedHeight,
                        lateralUsed: selectedLateral,
                        systemDraftType: systemDraftType,
                        threeInchOverride: threeInchOverride
                    };
                }
            }

            return null; // No suitable size found
        }

        function calculateVentSize() {
            if (appliances.length === 0) {
                document.getElementById('resultsContainer').innerHTML = 
                    '<div class="error">Please add at least one appliance before calculating.</div>';
                return;
            }

            const gasType = document.getElementById('gasType').value;
            const ventType = document.getElementById('ventType').value;
            const connectorType = document.getElementById('connectorType').value;
            const ventHeight = parseFloat(document.getElementById('ventHeight').value);
            const lateralLength = parseFloat(document.getElementById('lateralLength').value);

            const totalBtuh = appliances.reduce((sum, app) => sum + app.btuh, 0);

            if (totalBtuh === 0) {
                document.getElementById('resultsContainer').innerHTML = 
                    '<div class="error">Please enter BTU/h values for your appliances.</div>';
                return;
            }

            // Determine system draft type based on appliances
            const systemDraftType = determineDraftType(appliances);
            const ventSize = findVentSize(totalBtuh, gasType, ventType, connectorType, ventHeight, lateralLength, systemDraftType);

            // Determine the table reference for display
            const tableReference = getTableReference(gasType, ventType, connectorType, systemDraftType);
            
            let resultsHTML = `
                <div class="result-item" style="background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%); color: white; text-align: center;">
                    <div class="result-label" style="color: white;">Table Used for Calculation</div>
                    <div class="result-value" style="color: white; font-size: 1.4em;">${tableReference}</div>
                </div>
                
                <div class="result-item total-btuh">
                    <div class="result-label">Total System BTU/h</div>
                    <div class="result-value">${totalBtuh.toLocaleString()}</div>
                </div>
                
                <div class="result-item">
                    <div class="result-label">Gas Type</div>
                    <div class="result-value">${gasType === 'natural' ? 'Natural Gas' : 'Propane'}</div>
                </div>
                
                <div class="result-item">
                    <div class="result-label">Configuration</div>
                    <div class="result-value">${ventType === 'double' ? 'Type B Double-Wall' : 'Type B Single-Wall'} Vent<br>
                    ${connectorType === 'double' ? 'Double-Wall' : 'Single-Wall'} Connector<br>
                    System Type: ${systemDraftType} Appliances</div>
                </div>
                
                <div class="result-item">
                    <div class="result-label">System Dimensions</div>
                    <div class="result-value">Height: ${ventHeight}ft<br>Lateral: ${lateralLength}ft</div>
                </div>
            `;

            if (ventSize) {
                resultsHTML += `
                    <div class="result-item" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white;">
                        <div class="result-label" style="color: white;">Required Vent Diameter</div>
                        <div class="result-value" style="color: white; font-size: 2em;">${ventSize.diameter}"</div>
                        ${ventSize.threeInchOverride ? '<div style="font-size: 0.9em; margin-top: 5px; color: #fff3cd;">Upgraded from 3" per CSA B149.1</div>' : ''}
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">Vent Capacity</div>
                        <div class="result-value">${ventSize.capacity.toLocaleString()} BTU/h</div>
                    </div>
                    
                    <div class="calculation-details">
                        <strong>Calculation Details:</strong><br>
                        • Table: ${tableReference}<br>
                        • Table values used: Height ${ventSize.heightUsed}ft, Lateral ${ventSize.lateralUsed}ft<br>
                        • Load for lookup: ${(totalBtuh/1000).toFixed(1)} MBtu/h (${totalBtuh.toLocaleString()} BTU/h)<br>
                        ${ventSize.threeInchOverride ? '• Code requirement: 3" vent upgraded to 4" per CSA B149.1<br>' : ''}
                        • Safety factor: ${Math.round((ventSize.capacity / totalBtuh - 1) * 100)}% overcapacity
                    </div>
                `;

                // Add 3-inch override notice if applicable
                if (ventSize.threeInchOverride) {
                    resultsHTML += `
                        <div class="info">
                            <strong>CSA B149.1 Code Requirement:</strong> The table calculation indicated a 3" vent would be adequate, 
                            however CSA B149.1 requires that 3" vents shall not be used when sized by the charts. 
                            The vent size has been automatically upgraded to 4" to comply with the code.
                        </div>
                    `;
                }

                if (ventSize.capacity < totalBtuh * 1.15) {
                    resultsHTML += `
                        <div class="warning">
                            <strong>Warning:</strong> The selected vent size provides minimal overcapacity. 
                            Consider the next larger size for safety and future expansion.
                        </div>
                    `;
                }
            } else {
                resultsHTML += `
                    <div class="error">
                        <strong>Error:</strong> No suitable vent size found for this configuration. 
                        The BTU load may be too high for the available vent sizes, or you may need 
                        to reduce lateral length or increase vent height.
                    </div>
                `;
            }

            // Add appliance breakdown
            const natAppliances = appliances.filter(app => app.draftType === 'NAT');
            const fanAppliances = appliances.filter(app => app.draftType === 'FAN');
            
            resultsHTML += `
                <div class="chart-reference">
                    <strong>Appliance Breakdown:</strong><br>
                    ${appliances.map(app => 
                        `• Appliance ${app.id}: ${app.btuh.toLocaleString()} BTU/h (${app.draftType === 'NAT' ? 'Natural Draft' : 'Fan Assisted'})`
                    ).join('<br>')}
                    <br><br>
                    <strong>Draft Type Analysis:</strong><br>
                    • Natural Draft (NAT): ${natAppliances.length} appliance(s), ${natAppliances.reduce((sum, app) => sum + app.btuh, 0).toLocaleString()} BTU/h<br>
                    • Fan Assisted (FAN): ${fanAppliances.length} appliance(s), ${fanAppliances.reduce((sum, app) => sum + app.btuh, 0).toLocaleString()} BTU/h<br>
                    • System calculation uses: <strong>${systemDraftType} tables</strong>
                    ${systemDraftType === 'FAN' && natAppliances.length > 0 ? '<br>• Mixed system: FAN tables required per CSA B149.1' : ''}
                    <br><br>
                    <strong>Code Compliance:</strong><br>
                    This calculation is based on CSA B149.1:25 "Natural gas and propane installation code" 
                    Annex C venting tables for ${gasType === 'natural' ? 'natural gas' : 'propane'} appliances.
                </div>
            `;

            document.getElementById('resultsContainer').innerHTML = resultsHTML;
        }

        // Initialize with one appliance
        addAppliance();
    </script>
</body>
</html>