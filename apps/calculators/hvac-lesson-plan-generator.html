<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HVAC Lesson Plan Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #374151;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .header-title h1 {
            font-size: 2rem;
            font-weight: 700;
            color: #1f2937;
        }

        .icon {
            width: 24px;
            height: 24px;
        }

        .section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .section-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .section-header.blue { background: #f0f9ff; }
        .section-header.green { background: #f0fdf4; }
        .section-header.purple { background: #faf5ff; }
        .section-header.orange { background: #fff7ed; }

        .section-header h2 {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .section-header.blue h2 { color: #1e40af; }
        .section-header.green h2 { color: #166534; }
        .section-header.purple h2 { color: #7c3aed; }
        .section-header.orange h2 { color: #ea580c; }

        .section-content {
            padding: 1.5rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
            text-decoration: none;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }

        .btn-success {
            background: #059669;
            color: white;
        }

        .btn-success:hover {
            background: #047857;
        }

        .btn-danger {
            background: #dc2626;
            color: white;
        }

        .btn-danger:hover {
            background: #b91c1c;
        }

        .btn-outline {
            background: white;
            border: 2px solid #e5e7eb;
            color: #374151;
        }

        .btn-outline:hover {
            border-color: #3b82f6;
            color: #3b82f6;
        }

        .module-item, .objective-item {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .module-item:last-child, .objective-item:last-child {
            margin-bottom: 0;
        }

        .pdf-upload {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            transition: all 0.2s;
            cursor: pointer;
        }

        .pdf-upload:hover {
            border-color: #3b82f6;
            background: #f8fafc;
        }

        .pdf-upload.dragover {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .pdf-list {
            margin-top: 1rem;
        }

        .pdf-item {
            display: flex;
            align-items: center;
            justify-content: between;
            padding: 0.75rem;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            margin-bottom: 0.5rem;
        }

        .pdf-item-info {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .pdf-item-actions {
            display: flex;
            gap: 0.5rem;
        }

        .progress-bar {
            background: #e5e7eb;
            border-radius: 4px;
            height: 8px;
            margin-top: 0.5rem;
        }

        .progress-fill {
            background: #3b82f6;
            border-radius: 4px;
            height: 100%;
            transition: width 0.3s;
        }

        .results-section {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .schedule-table th,
        .schedule-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        .schedule-table th {
            background: #f9fafb;
            font-weight: 600;
            color: #374151;
        }

        .week-reading { background: #fef3c7; }
        .week-midterm { background: #fed7aa; }
        .week-final { background: #fecaca; }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            display: flex;
            align-items: start;
            gap: 0.75rem;
        }

        .alert-warning {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            color: #92400e;
        }

        .alert-info {
            background: #dbeafe;
            border: 1px solid #3b82f6;
            color: #1e40af;
        }

        .loading {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid #e5e7eb;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .header-title h1 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-title">
                <i data-lucide="book-open" class="icon"></i>
                <h1>HVAC Lesson Plan Generator</h1>
            </div>
            <p>Generate comprehensive HVAC lesson plans following Fanshawe College standards with PDF content analysis.</p>
        </div>

        <!-- Course Information -->
        <div class="section">
            <div class="section-header blue">
                <i data-lucide="file-text" class="icon"></i>
                <h2>Course Information</h2>
            </div>
            <div class="section-content">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Course Title</label>
                        <input type="text" id="courseTitle" class="form-input" placeholder="e.g., CSA Unit 13 - Controls">
                    </div>
                    <div class="form-group">
                        <label>Course Code</label>
                        <input type="text" id="courseCode" class="form-input" placeholder="e.g., CNTL 3004">
                    </div>
                    <div class="form-group">
                        <label>Program</label>
                        <select id="program" class="form-select">
                            <option value="MHT Heating Refrigeration and Air Conditioning Technician">MHT Heating Refrigeration and Air Conditioning Technician</option>
                            <option value="HVAC Fundamentals">HVAC Fundamentals</option>
                            <option value="Advanced HVAC Systems">Advanced HVAC Systems</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Program Level</label>
                        <select id="level" class="form-select">
                            <option value="1">Level 1</option>
                            <option value="2">Level 2</option>
                            <option value="3" selected>Level 3</option>
                            <option value="4">Level 4</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Duration</label>
                        <select id="duration" class="form-select">
                            <option value="15 Weeks" selected>15 Weeks</option>
                            <option value="8 Weeks">8 Weeks</option>
                            <option value="12 Weeks">12 Weeks</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Term</label>
                        <select id="term" class="form-select">
                            <option value="1">Term 1</option>
                            <option value="2">Term 2</option>
                            <option value="3" selected>Term 3</option>
                            <option value="4">Term 4</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- PDF Upload Section -->
        <div class="section">
            <div class="section-header orange">
                <i data-lucide="upload" class="icon"></i>
                <h2>Upload Course Materials (PDF)</h2>
            </div>
            <div class="section-content">
                <div class="pdf-upload" id="pdfUpload">
                    <i data-lucide="file-plus" style="width: 48px; height: 48px; margin-bottom: 1rem; color: #6b7280;"></i>
                    <h3>Drop PDF files here or click to browse</h3>
                    <p style="color: #6b7280; margin-top: 0.5rem;">Upload chapter content, textbooks, or reference materials</p>
                    <input type="file" id="pdfInput" multiple accept=".pdf" style="display: none;">
                </div>
                <div class="pdf-list" id="pdfList"></div>
            </div>
        </div>

        <!-- Modules Section -->
        <div class="section">
            <div class="section-header green">
                <i data-lucide="target" class="icon"></i>
                <h2>Course Modules & Chapters</h2>
            </div>
            <div class="section-content">
                <div id="modulesList"></div>
                <button class="btn btn-success" onclick="addModule()">
                    <i data-lucide="plus" class="icon"></i>
                    Add Module
                </button>
            </div>
        </div>

        <!-- Learning Objectives Section -->
        <div class="section">
            <div class="section-header purple">
                <i data-lucide="users" class="icon"></i>
                <h2>Learning Objectives</h2>
            </div>
            <div class="section-content">
                <div id="objectivesList"></div>
                <button class="btn btn-primary" onclick="addObjective()">
                    <i data-lucide="plus" class="icon"></i>
                    Add Learning Objective
                </button>
            </div>
        </div>

        <!-- Generate Button -->
        <div style="text-align: center; margin: 2rem 0;">
            <button class="btn btn-primary" onclick="generateLessonPlan()" style="font-size: 1.125rem; padding: 1rem 2rem;">
                <i data-lucide="clock" class="icon"></i>
                Generate Lesson Plan
            </button>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="hidden"></div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Global state
        let courseState = {
            modules: [{ id: 1, title: '', chapters: '', description: '', pdfContent: '' }],
            objectives: [{ id: 1, objective: '' }],
            uploadedPDFs: [],
            generatedPlan: null
        };

        // PDF Processing functionality
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // Initialize PDF upload
        function initializePDFUpload() {
            const pdfUpload = document.getElementById('pdfUpload');
            const pdfInput = document.getElementById('pdfInput');

            pdfUpload.addEventListener('click', () => pdfInput.click());
            pdfUpload.addEventListener('dragover', handleDragOver);
            pdfUpload.addEventListener('drop', handleDrop);
            pdfInput.addEventListener('change', (e) => handleFiles(e.target.files));
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        }

        async function handleFiles(files) {
            for (let file of files) {
                if (file.type === 'application/pdf') {
                    await processPDF(file);
                }
            }
        }

        async function processPDF(file) {
            const pdfId = Date.now() + Math.random();
            const pdfItem = {
                id: pdfId,
                name: file.name,
                size: file.size,
                content: '',
                status: 'processing'
            };

            courseState.uploadedPDFs.push(pdfItem);
            renderPDFList();

            try {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                let fullText = '';

                for (let pageNum = 1; pageNum <= Math.min(pdf.numPages, 50); pageNum++) { // Limit to 50 pages
                    const page = await pdf.getPage(pageNum);
                    const textContent = await page.getTextContent();
                    const pageText = textContent.items.map(item => item.str).join(' ');
                    fullText += pageText + '\n\n';
                }

                // Update PDF item with extracted content
                const pdfIndex = courseState.uploadedPDFs.findIndex(p => p.id === pdfId);
                courseState.uploadedPDFs[pdfIndex].content = fullText;
                courseState.uploadedPDFs[pdfIndex].status = 'completed';

                renderPDFList();
                
                // Auto-generate modules from PDF content
                if (courseState.uploadedPDFs.length === 1 && courseState.modules.length === 1 && !courseState.modules[0].title) {
                    await generateModulesFromPDF(fullText);
                }

            } catch (error) {
                console.error('Error processing PDF:', error);
                const pdfIndex = courseState.uploadedPDFs.findIndex(p => p.id === pdfId);
                courseState.uploadedPDFs[pdfIndex].status = 'error';
                renderPDFList();
            }
        }

        async function generateModulesFromPDF(pdfContent) {
            // Simple content analysis to extract potential modules
            const lines = pdfContent.split('\n').filter(line => line.trim().length > 0);
            const potentialModules = [];

            // Look for chapter headings, sections, etc.
            const chapterRegex = /(chapter|unit|section|module)\s+(\d+)[:\-\s]*(.+)/gi;
            
            let match;
            while ((match = chapterRegex.exec(pdfContent)) !== null) {
                potentialModules.push({
                    id: Date.now() + Math.random(),
                    title: match[3].trim(),
                    chapters: `${match[1]} ${match[2]}`,
                    description: `Content from ${match[1]} ${match[2]}`,
                    pdfContent: match[0]
                });
            }

            if (potentialModules.length > 0) {
                courseState.modules = potentialModules.slice(0, 8); // Limit to 8 modules
                renderModules();
            }

            // Generate learning objectives from PDF content
            const objectives = await generateObjectivesFromContent(pdfContent);
            if (objectives.length > 0) {
                courseState.objectives = objectives;
                renderObjectives();
            }
        }

        async function generateObjectivesFromContent(content) {
            // Extract key concepts and create learning objectives
            const objectives = [];
            const keyTerms = extractKeyTerms(content);
            
            keyTerms.slice(0, 6).forEach((term, index) => {
                objectives.push({
                    id: Date.now() + index,
                    objective: `Understand and apply concepts related to ${term.toLowerCase()}`
                });
            });

            return objectives;
        }

        function extractKeyTerms(content) {
            // Simple term extraction based on frequency and technical nature
            const words = content.toLowerCase().match(/\b[a-z]{4,}\b/g) || [];
            const technicalTerms = ['control', 'system', 'heating', 'cooling', 'refrigeration', 'hvac', 'temperature', 'pressure', 'valve', 'sensor', 'thermostat', 'compressor'];
            
            const termFreq = {};
            words.forEach(word => {
                if (technicalTerms.some(tech => word.includes(tech)) || word.length > 6) {
                    termFreq[word] = (termFreq[word] || 0) + 1;
                }
            });

            return Object.entries(termFreq)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10)
                .map(([term]) => term);
        }

        function renderPDFList() {
            const pdfList = document.getElementById('pdfList');
            if (courseState.uploadedPDFs.length === 0) {
                pdfList.innerHTML = '';
                return;
            }

            pdfList.innerHTML = courseState.uploadedPDFs.map(pdf => `
                <div class="pdf-item">
                    <div class="pdf-item-info">
                        <i data-lucide="file-text" style="width: 16px; height: 16px;"></i>
                        <span>${pdf.name} (${(pdf.size / 1024).toFixed(1)} KB)</span>
                        ${pdf.status === 'processing' ? '<div class="loading"><div class="spinner"></div> Processing...</div>' : ''}
                        ${pdf.status === 'completed' ? '<span style="color: #059669; font-size: 0.875rem;">✓ Processed</span>' : ''}
                        ${pdf.status === 'error' ? '<span style="color: #dc2626; font-size: 0.875rem;">✗ Error</span>' : ''}
                    </div>
                    <div class="pdf-item-actions">
                        <button class="btn btn-outline" style="padding: 0.5rem;" onclick="removePDF(${pdf.id})">
                            <i data-lucide="trash-2" style="width: 14px; height: 14px;"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            
            lucide.createIcons();
        }

        function removePDF(id) {
            courseState.uploadedPDFs = courseState.uploadedPDFs.filter(pdf => pdf.id !== id);
            renderPDFList();
        }

        // Module management
        function addModule() {
            courseState.modules.push({
                id: Date.now(),
                title: '',
                chapters: '',
                description: '',
                pdfContent: ''
            });
            renderModules();
        }

        function removeModule(id) {
            if (courseState.modules.length > 1) {
                courseState.modules = courseState.modules.filter(m => m.id !== id);
                renderModules();
            }
        }

        function updateModule(id, field, value) {
            const moduleIndex = courseState.modules.findIndex(m => m.id === id);
            if (moduleIndex !== -1) {
                courseState.modules[moduleIndex][field] = value;
            }
        }

        function renderModules() {
            const modulesList = document.getElementById('modulesList');
            modulesList.innerHTML = courseState.modules.map(module => `
                <div class="module-item">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Module Title</label>
                            <input type="text" class="form-input" value="${module.title}" 
                                   onchange="updateModule(${module.id}, 'title', this.value)"
                                   placeholder="e.g., Fundamentals of Controls">
                        </div>
                        <div class="form-group">
                            <label>Chapters/Sections</label>
                            <input type="text" class="form-input" value="${module.chapters}"
                                   onchange="updateModule(${module.id}, 'chapters', this.value)"
                                   placeholder="e.g., CSA Unit 13 - Chapter 1">
                        </div>
                        <div class="form-group" style="display: flex; align-items: end;">
                            <button class="btn btn-danger" onclick="removeModule(${module.id})" 
                                    ${courseState.modules.length === 1 ? 'disabled' : ''}>
                                <i data-lucide="trash-2" class="icon"></i>
                                Remove
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Module Description</label>
                        <textarea class="form-textarea" onchange="updateModule(${module.id}, 'description', this.value)"
                                  placeholder="Brief description of module content and key topics...">${module.description}</textarea>
                    </div>
                </div>
            `).join('');
            
            lucide.createIcons();
        }

        // Objective management
        function addObjective() {
            courseState.objectives.push({
                id: Date.now(),
                objective: ''
            });
            renderObjectives();
        }

        function removeObjective(id) {
            if (courseState.objectives.length > 1) {
                courseState.objectives = courseState.objectives.filter(obj => obj.id !== id);
                renderObjectives();
            }
        }

        function updateObjective(id, value) {
            const objIndex = courseState.objectives.findIndex(obj => obj.id === id);
            if (objIndex !== -1) {
                courseState.objectives[objIndex].objective = value;
            }
        }

        function renderObjectives() {
            const objectivesList = document.getElementById('objectivesList');
            objectivesList.innerHTML = courseState.objectives.map(obj => `
                <div class="objective-item">
                    <div style="display: flex; gap: 1rem; align-items: start;">
                        <div style="flex: 1;">
                            <input type="text" class="form-input" value="${obj.objective}"
                                   onchange="updateObjective(${obj.id}, this.value)"
                                   placeholder="Upon completion, students will be able to...">
                        </div>
                        <button class="btn btn-danger" onclick="removeObjective(${obj.id})"
                                ${courseState.objectives.length === 1 ? 'disabled' : ''}>
                            <i data-lucide="trash-2" class="icon"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            
            lucide.createIcons();
        }

        // Lesson plan generation
        function generateLessonPlan() {
            const courseInfo = {
                title: document.getElementById('courseTitle').value,
                code: document.getElementById('courseCode').value,
                program: document.getElementById('program').value,
                level: document.getElementById('level').value,
                duration: document.getElementById('duration').value,
                term: document.getElementById('term').value
            };

            if (!courseInfo.title || !courseInfo.code) {
                alert('Please fill in course title and code');
                return;
            }

            const schedule = generateWeeklySchedule();
            const assessments = generateAssessmentBreakdown();

            courseState.generatedPlan = {
                courseInfo,
                modules: courseState.modules.filter(m => m.title.trim()),
                objectives: courseState.objectives.filter(obj => obj.objective.trim()),
                schedule,
                assessments,
                pdfContent: courseState.uploadedPDFs,
                generatedDate: new Date().toLocaleDateString()
            };

            renderGeneratedPlan();
        }

        function generateWeeklySchedule() {
            const schedule = [];
            let currentWeek = 1;
            
            const availableWeeks = 12; // 15 weeks minus reading week, midterm, final
            const weeksPerModule = Math.max(1, Math.floor(availableWeeks / courseState.modules.length));
            
            courseState.modules.forEach((module, moduleIndex) => {
                const moduleWeeks = moduleIndex === courseState.modules.length - 1 
                    ? availableWeeks - (weeksPerModule * (courseState.modules.length - 1))
                    : weeksPerModule;
                
                for (let week = 0; week < moduleWeeks && currentWeek <= 14; week++) {
                    // Skip week 7 (reading week) and week 8 (midterm)
                    if (currentWeek === 7) {
                        schedule.push({
                            week: currentWeek,
                            type: 'reading',
                            title: 'Reading Week',
                            content: 'No scheduled classes - Student study time'
                        });
                        currentWeek++;
                    }
                    if (currentWeek === 8) {
                        schedule.push({
                            week: currentWeek,
                            type: 'midterm',
                            title: 'MIDTERM EXAMINATION',
                            content: `Chapters 1-${Math.ceil(courseState.modules.length/2)} material`,
                            assessment: 'Midterm Exam (30% of grade)'
                        });
                        currentWeek++;
                    }
                    
                    if (currentWeek <= 14) {
                        const isFirstWeek = week === 0;
                        const isLastWeek = week === moduleWeeks - 1;
                        
                        // Theory session
                        schedule.push({
                            week: currentWeek,
                            session: 'Theory',
                            hours: isFirstWeek ? 4 : 2,
                            module: module.title,
                            chapters: module.chapters,
                            type: 'theory',
                            content: isFirstWeek 
                                ? `${module.title} - Introduction and fundamentals${module.pdfContent ? ' (Enhanced with PDF content)' : ''}`
                                : `${module.title} - Advanced concepts and applications`,
                            resources: `${module.chapters} - ${module.description}`,
                            assessment: isLastWeek 
                                ? `${module.title} Assignment Due` 
                                : `${module.title} Quiz Questions`,
                            pdfEnhanced: !!module.pdfContent
                        });
                        
                        // Lab session
                        schedule.push({
                            week: currentWeek,
                            session: 'Lab',
                            hours: 3,
                            module: module.title,
                            type: 'lab',
                            content: `${module.title} - Practical application and testing`,
                            resources: 'Hands-on equipment, testing tools, safety equipment',
                            assessment: `${module.title} practical lab exercise`
                        });
                        
                        currentWeek++;
                    }
                }
            });
            
            // Add final exam week
            if (currentWeek <= 15) {
                schedule.push({
                    week: 15,
                    type: 'final',
                    title: 'FINAL EXAMINATION',
                    content: 'Comprehensive examination covering all course material',
                    assessment: 'Final Exam (40% of grade)'
                });
            }
            
            return schedule;
        }

        function generateAssessmentBreakdown() {
            const assignments = courseState.modules.map((module, index) => ({
                name: `${module.title} Assignment`,
                weight: '7%',
                week: `Week ${6 + (index * 2)}`
            }));
            
            return [
                ...assignments,
                { name: 'Practical Assignments (Weekly)', weight: '15%', week: 'Ongoing' },
                { name: 'Midterm Examination', weight: '30%', week: 'Week 8' },
                { name: 'Final Examination', weight: '40%', week: 'Week 15' },
                { name: 'Final Practical Evaluation', weight: '8%', week: 'Week 15' }
            ];
        }

        function renderGeneratedPlan() {
            const resultsSection = document.getElementById('resultsSection');
            const plan = courseState.generatedPlan;
            
            resultsSection.innerHTML = `
                <div class="section">
                    <div class="section-header green">
                        <i data-lucide="check-circle" class="icon"></i>
                        <h2>Generated Lesson Plan</h2>
                        <div style="margin-left: auto;">
                            <button class="btn btn-success" onclick="exportLessonPlan()">
                                <i data-lucide="download" class="icon"></i>
                                Export Plan
                            </button>
                        </div>
                    </div>
                    <div class="section-content">
                        <!-- Course Info -->
                        <div class="alert alert-info">
                            <i data-lucide="info" style="width: 20px; height: 20px;"></i>
                            <div>
                                <h4>Course Information</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 0.5rem;">
                                    <div><strong>Course:</strong> ${plan.courseInfo.title}</div>
                                    <div><strong>Code:</strong> ${plan.courseInfo.code}</div>
                                    <div><strong>Program:</strong> ${plan.courseInfo.program}</div>
                                    <div><strong>Level:</strong> ${plan.courseInfo.level}</div>
                                    <div><strong>Duration:</strong> ${plan.courseInfo.duration}</div>
                                    <div><strong>Term:</strong> ${plan.courseInfo.term}</div>
                                </div>
                            </div>
                        </div>

                        <!-- Learning Objectives -->
                        <h3>Learning Outcomes</h3>
                        <ol style="margin: 1rem 0; padding-left: 2rem;">
                            ${plan.objectives.map(obj => `<li>${obj.objective}</li>`).join('')}
                        </ol>

                        <!-- PDF Content Summary -->
                        ${plan.pdfContent.length > 0 ? `
                            <div class="alert alert-info">
                                <i data-lucide="file-text" style="width: 20px; height: 20px;"></i>
                                <div>
                                    <h4>PDF Content Integrated</h4>
                                    <p>This lesson plan has been enhanced with content from ${plan.pdfContent.length} uploaded PDF(s):</p>
                                    <ul style="margin-top: 0.5rem;">
                                        ${plan.pdfContent.map(pdf => `<li>${pdf.name} (${pdf.status})</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                        ` : ''}

                        <!-- Weekly Schedule -->
                        <h3>Weekly Schedule</h3>
                        <table class="schedule-table">
                            <thead>
                                <tr>
                                    <th>Week</th>
                                    <th>Session</th>
                                    <th>Content</th>
                                    <th>Assessment</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${plan.schedule.map(item => `
                                    <tr class="${
                                        item.type === 'reading' ? 'week-reading' :
                                        item.type === 'midterm' ? 'week-midterm' :
                                        item.type === 'final' ? 'week-final' : ''
                                    }">
                                        <td><strong>Week ${item.week}</strong></td>
                                        <td>
                                            ${item.session ? `${item.session} (${item.hours}h)` : item.title}
                                            ${item.pdfEnhanced ? '<br><small style="color: #059669;">📄 PDF Enhanced</small>' : ''}
                                        </td>
                                        <td>${item.content}</td>
                                        <td>${item.assessment || '-'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>

                        <!-- Assessment Breakdown -->
                        <h3>Assessment Breakdown</h3>
                        <table class="schedule-table">
                            <thead>
                                <tr>
                                    <th>Assessment Item</th>
                                    <th>Weight</th>
                                    <th>Week Due</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${plan.assessments.map(assessment => `
                                    <tr>
                                        <td>${assessment.name}</td>
                                        <td><strong>${assessment.weight}</strong></td>
                                        <td>${assessment.week}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>

                        <!-- Safety Notice -->
                        <div class="alert alert-warning" style="margin-top: 2rem;">
                            <i data-lucide="alert-triangle" style="width: 20px; height: 20px;"></i>
                            <div>
                                <h4>Safety Considerations</h4>
                                <p><strong>WARNING:</strong> This course involves working with HVAC systems and electrical equipment. Students must:</p>
                                <ul style="margin-top: 0.5rem;">
                                    <li>Follow all safety procedures and use appropriate PPE</li>
                                    <li>Never work on live circuits without proper authorization and supervision</li>
                                    <li>Comply with CSA standards and safety protocols</li>
                                    <li>Understand lockout/tagout procedures before beginning any practical work</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            resultsSection.classList.remove('hidden');
            lucide.createIcons();
        }

        function exportLessonPlan() {
            if (!courseState.generatedPlan) return;
            
            const plan = courseState.generatedPlan;
            const planText = `
HVAC COURSE LESSON PLAN

Generated on: ${plan.generatedDate}
Prepared by: Mike Kapin (Program Coordinator)

COURSE INFORMATION
==================
Course Title: ${plan.courseInfo.title}
Course Code: ${plan.courseInfo.code}
Program: ${plan.courseInfo.program}
Program Level: ${plan.courseInfo.level}
School/Institution: Fanshawe College
Duration: ${plan.courseInfo.duration}
Term: ${plan.courseInfo.term}

LEARNING OUTCOMES
================
${plan.objectives.map((obj, index) => `${index + 1}. ${obj.objective}`).join('\n')}

PDF CONTENT INTEGRATION
======================
${plan.pdfContent.length > 0 ? 
    plan.pdfContent.map(pdf => `- ${pdf.name} (Status: ${pdf.status})`).join('\n') :
    'No PDF content uploaded'
}

WEEKLY SCHEDULE
==============
${plan.schedule.map((item, index) => 
    `Week ${item.week}: ${item.session ? item.session + ' (' + item.hours + 'h)' : item.title}
Content: ${item.content}
Assessment: ${item.assessment || 'Ongoing learning'}
${item.pdfEnhanced ? 'Enhanced with PDF content analysis' : ''}
`).join('\n')}

ASSESSMENT BREAKDOWN
==================
${plan.assessments.map(assessment => 
    `${assessment.name}: ${assessment.weight} (Due: ${assessment.week})`
).join('\n')}

MODULES OVERVIEW
===============
${plan.modules.map((module, index) => 
    `Module ${index + 1}: ${module.title}
Chapters: ${module.chapters}
Description: ${module.description}
`).join('\n')}

SAFETY CONSIDERATIONS
====================
WARNING: This course involves working with HVAC systems and electrical equipment. Students must:
- Follow all safety procedures and use appropriate PPE
- Never work on live circuits without proper authorization and supervision
- Comply with CSA standards and safety protocols
- Understand lockout/tagout procedures before beginning any practical work

END OF LESSON PLAN
            `;
            
            const blob = new Blob([planText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${plan.courseInfo.code}_lesson_plan_${plan.generatedDate.replace(/\//g, '-')}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializePDFUpload();
            renderModules();
            renderObjectives();
        });
    </script>
</body>
</html>