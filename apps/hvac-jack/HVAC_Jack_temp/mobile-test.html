<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HVAC Jack 4.0 - Mobile Maintenance Form Test</title>
    <link rel="stylesheet" href="./components/MaintenanceForm/maintenanceForm.css">
    <style>
        body {
            background: linear-gradient(135deg, #1A1F2E 0%, #16213E 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        
        .test-header {
            text-align: center;
            color: #E2E8F0;
            margin-bottom: 30px;
        }
        
        .test-header h1 {
            color: #E85A4F;
            margin-bottom: 10px;
        }
        
        .test-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .test-btn {
            background: linear-gradient(135deg, #E85A4F 0%, #FF6B5B 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 15px 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(232, 90, 79, 0.3);
            min-height: 48px;
        }
        
        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(232, 90, 79, 0.4);
        }
        
        .test-btn:active {
            transform: translateY(0);
        }
        
        .test-info {
            background: rgba(49, 130, 206, 0.1);
            border: 1px solid rgba(49, 130, 206, 0.3);
            border-radius: 10px;
            padding: 20px;
            color: #A5B4FC;
            line-height: 1.6;
        }
        
        .device-info {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            font-size: 14px;
            color: #86EFAC;
        }
        
        .breakpoint-indicator {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
            z-index: 10000;
        }
        
        /* Responsive test indicators */
        .breakpoint-indicator::after {
            content: 'Desktop';
        }
        
        @media (max-width: 1023px) {
            .breakpoint-indicator::after {
                content: 'Tablet';
            }
        }
        
        @media (max-width: 767px) {
            .breakpoint-indicator::after {
                content: 'Mobile';
            }
        }
        
        @media (max-width: 480px) {
            .breakpoint-indicator::after {
                content: 'Small Mobile';
            }
        }
    </style>
</head>
<body>
    <div class="breakpoint-indicator"></div>
    
    <div class="test-container">
        <div class="test-header">
            <h1>üîß HVAC Jack 4.0</h1>
            <h2>Maintenance Form Mobile Test</h2>
            <p>Test the mobile responsiveness and touch interactions of the maintenance form system</p>
        </div>
        
        <div class="test-buttons">
            <button class="test-btn" onclick="simulatePhotoAnalysis()">
                üì∑ Simulate Photo Analysis
            </button>
            <button class="test-btn" onclick="showMaintenanceForm()">
                üìã Show Maintenance Form
            </button>
            <button class="test-btn" onclick="testTouchTargets()">
                üëÜ Test Touch Targets
            </button>
            <button class="test-btn" onclick="testOrientation()">
                üîÑ Test Orientation
            </button>
            <button class="test-btn" onclick="generateTestPDF()">
                üìÑ Generate Test PDF
            </button>
        </div>
        
        <div class="test-info">
            <h3>üì± Mobile Test Instructions:</h3>
            <ul>
                <li><strong>Photo Analysis:</strong> Click "Simulate Photo Analysis" to trigger equipment detection</li>
                <li><strong>Form Display:</strong> After photo analysis, the "Generate Maintenance Form" button should appear</li>
                <li><strong>Touch Targets:</strong> All interactive elements should be at least 44px tall for easy tapping</li>
                <li><strong>Responsive Design:</strong> Form should adapt to different screen sizes (watch the breakpoint indicator)</li>
                <li><strong>Signatures:</strong> Test the touch signature functionality</li>
                <li><strong>PDF Generation:</strong> Test PDF creation on mobile devices</li>
            </ul>
        </div>
        
        <div class="device-info" id="device-info">
            Loading device information...
        </div>
    </div>

    <!-- Load maintenance form scripts -->
    <script src="./services/mobileDetection.js"></script>
    <script src="./services/equipmentDataMapper.js"></script>
    <script src="./components/MaintenanceForm/MaintenanceFormContainer.js"></script>
    <script src="./components/MaintenanceForm/GasFurnaceForm.js"></script>
    <script src="./components/MaintenanceForm/MaintenanceFormPDF.js"></script>
    <script src="./components/MaintenanceForm/EmailService.js"></script>

    <script>
        // Test utilities
        let mobileService, maintenanceFormContainer;
        
        // Initialize test environment
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize mobile detection
            mobileService = new MobileDetectionService();
            
            // Display device information
            displayDeviceInfo();
            
            // Create a mock HVAC Jack instance for testing
            const mockHVACJack = {
                trackUsage: (action, data) => console.log('üìä Analytics:', action, data),
                photoAnalysisData: null
            };
            
            // Initialize maintenance form container
            maintenanceFormContainer = new MaintenanceFormContainer(mockHVACJack);
            
            console.log('üß™ Mobile test environment initialized');
        });
        
        // Display device and browser information
        function displayDeviceInfo() {
            const info = document.getElementById('device-info');
            const device = mobileService.deviceInfo;
            const viewport = mobileService.getViewport();
            const capabilities = mobileService.capabilities;
            
            info.innerHTML = `
                <h4>üì± Device Information:</h4>
                <p><strong>Type:</strong> ${device.type} (${device.os} - ${device.browser})</p>
                <p><strong>Screen:</strong> ${viewport.deviceWidth}x${viewport.deviceHeight} (${viewport.pixelRatio}x DPI)</p>
                <p><strong>Viewport:</strong> ${viewport.width}x${viewport.height} (${viewport.orientation})</p>
                <p><strong>Touch:</strong> ${capabilities.touch ? '‚úÖ Supported' : '‚ùå Not Supported'}</p>
                <p><strong>Camera:</strong> ${capabilities.camera ? '‚úÖ Available' : '‚ùå Not Available'}</p>
                <p><strong>Touch Targets:</strong> ${mobileService.getTouchTargetSize().recommended}px recommended</p>
            `;
        }
        
        // Update device info on orientation change
        window.addEventListener('resize', displayDeviceInfo);
        window.addEventListener('orientationchange', () => {
            setTimeout(displayDeviceInfo, 100);
        });
        
        // Test functions
        function simulatePhotoAnalysis() {
            console.log('üß™ Simulating photo analysis...');
            
            // Create mock photo analysis data
            const mockAnalysisData = `
## üîç EQUIPMENT IDENTIFICATION
- Equipment type: Gas Furnace
- Brand: Carrier
- Model number: 58MCA080
- Age estimation: 5-7 years based on design
- System size: 80,000 BTU input

## ‚öôÔ∏è TECHNICAL SPECIFICATIONS  
- Model: 58MCA080
- Serial: 2318M12345
- Input BTU: 80,000
- Output BTU: 64,000
- AFUE: 80%
- Gas type: Natural Gas
- Electrical: 120V, 3.5A

## üîß CONDITION ASSESSMENT
- Overall condition: Good
- Minor dust accumulation on heat exchanger
- Filter needs replacement
- All connections secure
            `;
            
            // Dispatch the photo analysis event
            setTimeout(() => {
                window.dispatchEvent(new CustomEvent('hvacjack-photo-analysis-complete', {
                    detail: mockAnalysisData
                }));
                
                alert('‚úÖ Photo analysis simulated! The maintenance form button should now appear.');
            }, 1000);
        }
        
        function showMaintenanceForm() {
            if (maintenanceFormContainer) {
                // Simulate photo analysis first if not done
                if (!maintenanceFormContainer.analysisData) {
                    maintenanceFormContainer.analysisData = 'Mock analysis data for testing';
                }
                
                maintenanceFormContainer.showMaintenanceForm();
            } else {
                alert('‚ùå Maintenance form container not initialized');
            }
        }
        
        function testTouchTargets() {
            // Highlight all touch targets
            const touchElements = document.querySelectorAll('button, input, select, textarea, [onclick]');
            
            touchElements.forEach(element => {
                const rect = element.getBoundingClientRect();
                const height = rect.height;
                const width = rect.width;
                
                // Check if meets minimum touch target size
                const minSize = 44;
                const isGoodSize = height >= minSize && width >= minSize;
                
                // Add visual indicator
                element.style.border = isGoodSize ? '2px solid #22c55e' : '2px solid #ef4444';
                element.style.boxShadow = isGoodSize ? '0 0 5px #22c55e' : '0 0 5px #ef4444';
                
                // Add tooltip
                element.title = `Size: ${Math.round(width)}x${Math.round(height)}px ${isGoodSize ? '‚úÖ' : '‚ùå'}`;
            });
            
            alert('Touch targets are now highlighted. Green = Good size (‚â•44px), Red = Too small');
            
            // Remove highlights after 5 seconds
            setTimeout(() => {
                touchElements.forEach(element => {
                    element.style.border = '';
                    element.style.boxShadow = '';
                });
            }, 5000);
        }
        
        function testOrientation() {
            const currentOrientation = mobileService.getOrientation();
            alert(`Current orientation: ${currentOrientation}\n\nRotate your device to test responsive design changes.`);
            
            // Listen for orientation changes
            let orientationCount = 0;
            const orientationHandler = () => {
                orientationCount++;
                const newOrientation = mobileService.getOrientation();
                
                if (orientationCount <= 3) {
                    setTimeout(() => {
                        alert(`Orientation changed to: ${newOrientation}\n\nChanges detected: ${orientationCount}/3`);
                    }, 200);
                }
                
                if (orientationCount >= 3) {
                    window.removeEventListener('hvacjack-orientation-change', orientationHandler);
                    setTimeout(() => {
                        alert('‚úÖ Orientation test complete! Layout should adapt properly to different orientations.');
                    }, 500);
                }
            };
            
            window.addEventListener('hvacjack-orientation-change', orientationHandler);
        }
        
        async function generateTestPDF() {
            try {
                console.log('üß™ Testing PDF generation...');
                
                // Create test form data
                const testFormData = {
                    'customer-name': 'Test Customer',
                    'customer-phone': '(555) 123-4567',
                    'customer-email': 'test@example.com',
                    'service-address': '123 Test Street, Test City, TC 12345',
                    'service-date': new Date().toISOString().split('T')[0],
                    'equipment-manufacturer': 'Carrier',
                    'equipment-model': '58MCA080',
                    'equipment-serial': '2318M12345',
                    'equipment-btu': '80,000',
                    'equipment-afue': '80%',
                    'equipment-gas-type': 'Natural Gas',
                    'check-thermostat': true,
                    'check-filter': true,
                    'oxygen-reading': '9.2',
                    'oxygen-result': 'pass',
                    'carbon-monoxide-reading': '45',
                    'carbon-monoxide-result': 'pass',
                    'service-status': 'completed',
                    'service-time': '2.5',
                    'technician-name': 'Test Technician',
                    'data-confidence': '85'
                };
                
                // Create PDF generator and test
                const pdfGenerator = new MaintenanceFormPDF();
                await pdfGenerator.generate(testFormData, mobileService);
                
                console.log('‚úÖ PDF test completed successfully');
            } catch (error) {
                console.error('‚ùå PDF test failed:', error);
                alert('PDF test failed: ' + error.message);
            }
        }
        
        // Add touch event testing
        document.addEventListener('touchstart', (e) => {
            console.log('üëÜ Touch start detected:', e.touches.length, 'touch(es)');
        });
        
        document.addEventListener('touchmove', (e) => {
            e.preventDefault(); // Prevent scrolling during touch tests
        }, { passive: false });
        
        // Add keyboard testing for mobile
        document.addEventListener('input', (e) => {
            if (e.target.inputMode) {
                console.log('‚å®Ô∏è Mobile keyboard mode:', e.target.inputMode);
            }
        });
    </script>
</body>
</html>