// CSA Gas Technician Module Data
export const moduleMapping = {
  1: {
    id: 1,
    title: "Safety",
    chapters: [
      { id: 1, title: "Safety Fundamentals", file: "CSA_Unit_1_Safety.html" },
      { id: 2, title: "Chapter 1", file: "CSA_Unit_1_Chapter_1.html" },
      { id: 3, title: "Chapter 2", file: "CSA_Unit_1_Chapter_2.html" },
      { id: 4, title: "Chapter 3", file: "CSA_Unit_1_Chapter_3.html" },
      { id: 5, title: "Chapter 4", file: "CSA_Unit_1_Chapter_4.html" }
    ],
    keywords: ["safety", "hazards", "ppe", "personal protective equipment", "gas safety", "emergency procedures"],
    description: "Fundamental safety principles and procedures for gas technicians"
  },
  2: {
    id: 2,
    title: "Fasteners, Tools and Test Equipment",
    chapters: [
      { id: 1, title: "Chapter 1", file: "CSA_Unit_2_Chapter_1.html" },
      { id: 2, title: "Chapter 2", file: "CSA_Unit_2_Chapter_2.html" },
      { id: 3, title: "Chapter 3", file: "CSA_Unit_2_Chapter_3.html" },
      { id: 4, title: "Chapter 4", file: "CSA_Unit_2_Chapter_4.html" },
      { id: 5, title: "Chapter 5", file: "CSA_Unit_2_Chapter_5.html" },
      { id: 6, title: "Chapter 6", file: "CSA_Unit_2_Chapter_6.html" }
    ],
    keywords: ["tools", "fasteners", "test equipment", "measurements", "calibration", "maintenance"],
    description: "Essential tools, fasteners, and testing equipment for gas work"
  },
  3: {
    id: 3,
    title: "Properties and Safe Handling of Fuel Gases",
    chapters: [
      { id: 1, title: "Chapter 1", file: "CSA_Unit_3_Chapter_1.html" },
      { id: 2, title: "Chapter 2", file: "CSA_Unit_3_Chapter_2.html" },
      { id: 3, title: "Chapter 3", file: "CSA_Unit_3_Chapter_3.html" }
    ],
    keywords: ["natural gas", "propane", "fuel properties", "gas characteristics", "BTU", "specific gravity", "combustion"],
    description: "Understanding fuel gas properties and safe handling procedures"
  },
  4: {
    id: 4,
    title: "Gas Industry Codes, Acts and Regulations",
    chapters: [
      { id: 1, title: "Chapter 1", file: "CSA_Unit_4_Chapter_1.html" },
      { id: 2, title: "Chapter 2", file: "CSA_Unit_4_Chapter_2.html" },
      { id: 3, title: "Chapter 3", file: "CSA_Unit_4_Chapter_3.html" }
    ],
    keywords: ["CSA B149.1", "CSA B149.2", "codes", "regulations", "standards", "compliance", "TSSA"],
    description: "Gas industry codes, acts, and regulatory requirements"
  },
  "4a": {
    id: "4a",
    title: "Laws Governing the Gas Industry",
    chapters: [
      { id: 1, title: "Chapter 1", file: "CSA_Unit_4a_Chapter_1.html" },
      { id: 2, title: "Chapter 2", file: "CSA_Unit_4a_Chapter_2.html" },
      { id: 3, title: "Chapter 3", file: "CSA_Unit_4a_Chapter_3.html" },
      { id: 4, title: "Chapter 4", file: "CSA_Unit_4a_Chapter_4.html" }
    ],
    keywords: ["laws", "legal requirements", "licensing", "permits", "jurisdiction", "enforcement"],
    description: "Legal framework governing gas industry operations"
  },
  5: {
    id: 5,
    title: "Basic Electricity",
    chapters: [
      { id: 1, title: "Chapter 1", file: "CSA_Unit_5_Chapter_1.html" },
      { id: 2, title: "Chapter 2", file: "CSA_Unit_5_Chapter_2.html" },
      { id: 3, title: "Chapter 3", file: "CSA_Unit_5_Chapter_3.html" },
      { id: 4, title: "Chapter 4", file: "CSA_Unit_5_Chapter_4.html" },
      { id: 5, title: "Chapter 5", file: "CSA_Unit_5_Chapter_5.html" },
      { id: 6, title: "Chapter 6", file: "CSA_Unit_5_Chapter_6.html" },
      { id: 7, title: "Chapter 7", file: "CSA_Unit_5_Chapter_7.html" }
    ],
    keywords: ["electricity", "voltage", "current", "ohm's law", "circuits", "multimeter", "electrical safety"],
    description: "Basic electrical principles for gas appliance technicians"
  },
  6: {
    id: 6,
    title: "Technical Manuals, Specs and Drawings",
    chapters: [
      { id: 1, title: "Chapter 1", file: "CSA_Unit_6_Chapter_1.html" },
      { id: 2, title: "Chapter 2", file: "CSA_Unit_6_Chapter_2.html" },
      { id: 3, title: "Chapter 3", file: "CSA_Unit_6_Chapter_3.html" }
    ],
    keywords: ["technical drawings", "specifications", "manuals", "schematics", "blueprints", "symbols"],
    description: "Reading and interpreting technical documentation and drawings"
  },
  7: {
    id: 7,
    title: "Customer Relations",
    keywords: ["customer service", "communication", "professionalism", "ethics", "conflict resolution"],
    description: "Professional customer relations and communication skills"
  },
  8: {
    id: 8,
    title: "Introduction to Piping and Tubing Systems",
    keywords: ["piping", "tubing", "pipe sizing", "materials", "joints", "fittings", "installation"],
    description: "Fundamentals of gas piping and tubing systems"
  },
  9: {
    id: 9,
    title: "Introduction to Gas Appliances",
    keywords: ["appliances", "burners", "controls", "venting", "installation", "operation"],
    description: "Overview of gas appliances and their operation"
  },
  10: {
    id: 10,
    title: "Advanced Piping Systems",
    keywords: ["advanced piping", "complex systems", "pressure regulators", "distribution", "sizing calculations"],
    description: "Advanced piping system design and installation"
  },
  11: {
    id: 11,
    title: "Pressure Regulators",
    keywords: ["pressure regulation", "regulators", "pressure control", "adjustment", "maintenance"],
    description: "Gas pressure regulation systems and components"
  },
  12: {
    id: 12,
    title: "Basic Electricity for Gas Fired Appliances",
    keywords: ["electrical controls", "gas appliance electricity", "ignition systems", "safety controls"],
    description: "Electrical systems specific to gas-fired appliances"
  },
  13: {
    id: 13,
    title: "Controls",
    keywords: ["gas controls", "thermostats", "safety controls", "limit switches", "flame sensors"],
    description: "Gas appliance control systems and components"
  },
  14: {
    id: 14,
    title: "The Building as a System",
    keywords: ["building systems", "ventilation", "air quality", "combustion air", "building science"],
    description: "Understanding buildings as integrated systems"
  },
  15: {
    id: 15,
    title: "Domestic Appliances",
    keywords: ["domestic appliances", "residential", "stoves", "ovens", "dryers", "installation"],
    description: "Installation and servicing of domestic gas appliances"
  },
  16: {
    id: 16,
    title: "Gas Fired Refrigerators",
    keywords: ["gas refrigerators", "absorption cooling", "rv appliances", "recreational vehicles"],
    description: "Gas-fired refrigeration systems and maintenance"
  },
  17: {
    id: 17,
    title: "Conversion Burners",
    keywords: ["conversion burners", "oil to gas conversion", "burner replacement", "retrofitting"],
    description: "Converting heating systems to gas operation"
  },
  18: {
    id: 18,
    title: "Water Heaters and Combination Systems",
    keywords: ["water heaters", "tankless", "combination systems", "combi boilers", "domestic hot water"],
    description: "Gas water heating systems and combination units"
  },
  19: {
    id: 19,
    title: "Forced Warm Air Appliances",
    keywords: ["furnaces", "forced air", "ductwork", "air handlers", "heat exchangers"],
    description: "Forced air heating systems and furnaces"
  },
  20: {
    id: 20,
    title: "Hydronic Heating Systems",
    keywords: ["hydronic", "boilers", "radiant heating", "baseboard", "water heating systems"],
    description: "Hot water and steam heating systems"
  },
  21: {
    id: 21,
    title: "Space Heaters and Fireplaces",
    keywords: ["space heaters", "fireplaces", "direct vent", "ventless", "decorative appliances"],
    description: "Space heating appliances and decorative gas systems"
  },
  22: {
    id: 22,
    title: "Venting Systems",
    keywords: ["venting", "chimneys", "flue systems", "draft", "combustion products", "venting categories"],
    description: "Comprehensive venting system design and installation"
  },
  23: {
    id: 23,
    title: "Forced Air Add-Ons",
    keywords: ["add-on equipment", "air conditioning", "heat pumps", "ductwork modifications"],
    description: "Additional equipment for forced air systems"
  },
  24: {
    id: 24,
    title: "Air Handling",
    keywords: ["air handling", "ventilation", "air quality", "filtration", "air distribution"],
    description: "Air handling systems and indoor air quality"
  }
};

// Quick reference knowledge base for common topics
export const knowledgeBase = {
  "pressure calculations": {
    content: `**Gas Pressure Calculation Fundamentals:**

**Key Concepts:**
• Working Pressure: Normal operating pressure (typically 7" w.c. for natural gas, 11" w.c. for propane)
• Test Pressure: Higher pressure used for leak testing (typically 1.5x working pressure)
• Pressure Drop: Loss of pressure through piping due to friction

**Essential Formulas:**
1. **Basic Pressure Drop:** ΔP = (Q² × L × F) / (D⁵)
   Where: ΔP = pressure drop, Q = flow rate, L = length, F = friction factor, D = diameter

2. **Gas Flow Rate:** Q = BTU Input ÷ Heating Value
   Example: 100,000 BTU appliance ÷ 1000 BTU/ft³ = 100 ft³/hr

**Practical Applications:**
• Pipe Sizing: Ensure adequate gas supply with acceptable pressure drop
• System Design: Account for all fittings, valves, and elevation changes
• Testing: Verify system can maintain required pressure under load

**Common Values:**
• Natural Gas: ~1000 BTU/ft³ heating value
• Propane: ~2500 BTU/ft³ heating value
• Maximum pressure drop: typically 0.5" w.c. for branch lines`,
    keywords: ["pressure", "calculation", "pipe sizing", "flow rate", "BTU"]
  },

  "venting requirements": {
    content: `**Venting System Categories & Requirements:**

**Category Classifications:**
• **Category I (80% AFUE):** Natural draft, non-condensing
  - Vent material: Type B vent or masonry chimney
  - Minimum rise: 5 feet vertical
  - Termination: 2 feet above roof within 10 feet

• **Category II:** Rarely used in residential

• **Category III (90% AFUE):** Fan-assisted, non-condensing  
  - Vent material: Type B vent or approved plastic
  - Fan overcomes resistance
  - Special termination requirements

• **Category IV (90%+ AFUE):** Condensing appliances
  - Vent material: PVC, CPVC, or polypropylene
  - Condensate drainage required
  - Lower temperature exhaust

**Key Installation Requirements:**
• Slope: 1/4" per foot toward appliance for condensing
• Clearances: 1" from combustibles for single wall
• Joints: Properly sealed and supported
• Termination: Follow manufacturer's clearance requirements

**Common Issues:**
• Backdrafting in natural draft systems
• Improper condensate drainage
• Inadequate combustion air supply
• Blocked or damaged vent systems`,
    keywords: ["venting", "categories", "draft", "condensing", "clearances"]
  },

  "leak testing procedures": {
    content: `**Comprehensive Leak Testing Procedures:**

**Pre-Test Preparation:**
1. Visual inspection of all joints and connections
2. Ensure all appliances are disconnected or shut off
3. Install test gauge at appropriate location
4. Verify test medium (air, nitrogen, or inert gas)

**Testing Methods:**
1. **Soap Solution Test:**
   - Use approved leak detection solution
   - Apply to all joints, fittings, and connections
   - Look for bubble formation indicating leaks
   - Most common field method

2. **Electronic Detection:**
   - Use calibrated electronic leak detector
   - More sensitive than soap solution
   - Good for hard-to-reach areas
   - Follow manufacturer's procedures

**Pressure Test Procedure:**
1. Pressurize system to test pressure (typically 1.5x working pressure)
2. Monitor pressure for specified time (10-15 minutes typical)
3. Check for pressure drop indicating leaks
4. If pressure drops, locate and repair leaks
5. Retest until system holds pressure

**Safety Requirements:**
• Never use open flame for leak detection
• Use proper PPE (safety glasses, gloves)
• Ensure adequate ventilation
• Follow all manufacturer procedures
• Document all test results

**Acceptance Criteria:**
• No visible bubbles during soap test
• No audible or electronic detection of leaks
• Pressure holds steady during timed test
• All connections tight and properly sealed`,
    keywords: ["leak testing", "soap solution", "pressure test", "electronic detection"]
  },

  "carbon monoxide safety": {
    content: `**Carbon Monoxide Safety & Detection:**

**Danger Levels (PPM):**
• 0-9 PPM: Normal background levels
• 10-24 PPM: Acceptable in occupied spaces
• 25-35 PPM: Action level - investigate source immediately
• 36+ PPM: Dangerous - immediate evacuation required
• 400+ PPM: Immediately life-threatening

**Common CO Sources:**
• Cracked heat exchangers in furnaces
• Blocked or damaged chimneys/vents
• Backdrafting appliances
• Inadequate combustion air supply
• Improperly adjusted burners
• Corroded venting systems

**Detection Methods:**
1. **Electronic CO Analyzers:**
   - Most accurate for field testing
   - Instant readings in PPM
   - Required for professional diagnosis

2. **CO Detectors (Residential):**
   - Early warning for occupants
   - Alarm at 30+ PPM over time
   - Not suitable for precise measurements

**Testing Procedures:**
• Test in flue pipe near appliance
• Check ambient air levels
• Test with appliances operating under load
• Document all readings
• Compare to acceptable limits

**Emergency Response:**
1. Evacuate area immediately if high levels detected
2. Shut off gas supply to affected appliances
3. Provide ventilation to area
4. Do not re-enter until CO levels are safe
5. Identify and correct source before restart

**Prevention:**
• Regular maintenance and inspection
• Proper combustion air supply
• Adequate venting systems
• Professional installation and service`,
    keywords: ["carbon monoxide", "CO", "safety", "detection", "PPM", "emergency"]
  },

  "appliance clearances": {
    content: `**Gas Appliance Clearance Requirements:**

**Combustible Material Clearances:**
• **Single Wall Vent Pipe:** 6" minimum from combustibles
• **Type B Gas Vent:** 1" minimum from combustibles  
• **Appliance Sides/Back:** Varies by model (check nameplate)
• **Appliance Front:** 24" minimum for service access

**Specific Appliance Clearances:**
• **Furnaces:** Typically 1" sides, 1" back, 24" front
• **Water Heaters:** 6" from walls, 18" front access
• **Space Heaters:** Follow manufacturer specifications strictly
• **Fireplaces:** Special clearances for decorative appliances

**Vent Termination Clearances:**
• **Above Grade:** Minimum 12" above ground level
• **From Windows/Doors:** 4 feet horizontally minimum
• **From Air Intakes:** 10 feet minimum
• **Property Lines:** 5 feet minimum
• **Above Roof:** 2 feet within 10 horizontal feet

**Floor Protection:**
• Non-combustible pad under appliance
• Extend 18" beyond appliance on service side
• 6" beyond on other sides
• Thickness per manufacturer requirements

**Service Access:**
• Front access for controls and service
• Adequate room for component removal
• Clearance for venting connections
• Access to all safety controls

**Special Considerations:**
• Alcove installations have reduced clearances
• Listed appliances may have different requirements
• Local codes may be more restrictive
• Always check appliance nameplate for specific requirements`,
    keywords: ["clearances", "combustible", "installation", "venting", "termination"]
  },

  "code violations": {
    content: `**Common CSA B149.1 Code Violations:**

**Installation Violations:**
• Insufficient clearances to combustibles
• Improper appliance support/mounting
• Missing or inadequate floor protection
• Unapproved appliance locations

**Piping System Violations:**
• Wrong pipe materials for application
• Inadequate pipe sizing for load
• Missing or improper shutoff valves
• Exposed piping in prohibited areas
• Improper joint compounds or methods

**Venting System Violations:**
• Wrong vent materials for appliance category
• Inadequate vent sizing
• Improper slope or support
• Missing or damaged vent caps
• Clearance violations at terminations

**Combustion Air Violations:**
• Insufficient combustion air openings
• Blocked or restricted air supplies
• Wrong sizing for confined spaces
• Missing outside air when required

**Electrical Violations:**
• Missing electrical disconnect
• Improper electrical connections
• Inadequate grounding
• Wrong electrical ratings

**Testing & Documentation:**
• Missing leak test documentation
• Inadequate pressure testing
• No commissioning documentation
• Missing appliance manuals

**Safety Control Violations:**
• Bypassed or disabled safety controls
• Missing flame rollout switches
• Inadequate limit controls
• Wrong control settings

**Inspection Requirements:**
• Work performed without permits
• No final inspection completed
• Non-compliant with local amendments
• Unlicensed technician work`,
    keywords: ["code violations", "CSA B149.1", "installation", "piping", "venting"]
  }
};

export const getModuleById = (moduleId) => {
  return moduleMapping[moduleId] || null;
};

export const searchModules = (query) => {
  const searchTerm = query.toLowerCase();
  const results = [];
  
  Object.values(moduleMapping).forEach(module => {
    if (module.title.toLowerCase().includes(searchTerm) ||
        module.description?.toLowerCase().includes(searchTerm) ||
        module.keywords?.some(keyword => keyword.toLowerCase().includes(searchTerm))) {
      results.push(module);
    }
  });
  
  return results;
};

export const getKnowledgeByKeywords = (message) => {
  const lowerMessage = message.toLowerCase();
  
  for (const [topic, data] of Object.entries(knowledgeBase)) {
    if (data.keywords.some(keyword => lowerMessage.includes(keyword))) {
      return { topic, ...data };
    }
  }
  
  return null;
};